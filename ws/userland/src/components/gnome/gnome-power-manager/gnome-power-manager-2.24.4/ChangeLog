2009-02-12  Richard Hughes  <richard@hughsie.com>

	==== Version 2.24.4 ====

2009-02-12  Josselin Mouette  <joss@malsain.org>

	* src/gpm-brightness-xrandr.c:
	(gpm_brightness_xrandr_output_get_internal):
	Use memcpy instead of casting a char* to an int* without 
	alignment guarantees.
	Fixes #566115 (fails to build on sparc)

2009-02-12  Richard Hughes  <richard@hughsie.com>

	* configure.ac:
	Add Wno-strict-aliasing to fix the compile thanks to GCC 4.4

	* src/gpm-brightness-xrandr.c: (gpm_brightness_xrandr_output_set):
	Don't step through each brightness state when we fade modes, some
	devices using XRandR have an insane number of steps. Use the step
	value we calculated for the _up and _down logic.
	Fixes #566095

2009-01-28  Richard Hughes  <richard@hughsie.com>

	* src/gpm-brightness-xrandr.c: (gpm_brightness_xrandr_output_down):
	When the minimum reported brightness is not zero don't wraparound 0
	when we try to step down a large number of brightness levels.
	Instead truncate to the minimum to fix a hang.
	Fixes #569100
	Patch from Fortunato Ventre, many thanks.

2009-01-23  Richard Hughes  <richard@hughsie.com>

	* src/gpm-cell-unit.h:
	* src/gpm-cell.c: (gpm_cell_refresh_hal_all), (gpm_cell_get_id):
	We have to include capacity in the profile name as some vendors create
	different sized batteries with the same serial number.
	This break batteries that use the current voltage for the mAh to mWh
	conversion when the design voltage is also invalid. In this case
	use the reporting string as we don't care about units.
	Patch from Stephen Gildea and Joe, many thanks.
	Fixes #562576

2009-01-16  Richard Hughes  <richard@hughsie.com>

	* RELEASE:
	* configure.ac:
	Post release bump.

2009-01-16  Richard Hughes  <richard@hughsie.com>

	==== Version 2.24.3 ====

2008-12-02  Richard Hughes  <richard@hughsie.com>

	* src/gpm-button.c: (gpm_button_reset_time):
	* src/gpm-button.h:
	* src/gpm-manager.c: (gpm_manager_action_suspend),
	(gpm_manager_action_hibernate):
	Reset the event time after we resume so the duplicate key detection
	code works correctly.
	Many thanks to Adel Gadllah <drago01@gmail.com> for debugging and
	testing.

2008-12-02  Wang Xin  <jedy.wang@sun.com>

	* src/gpm-main.c: (main): Remove daemon code.

2008-12-02  Richard Hughes  <richard@hughsie.com>

	* src/gpm-brightness-xrandr.c:
	(gpm_brightness_xrandr_output_get_percentage),
	(gpm_brightness_xrandr_output_down),
	(gpm_brightness_xrandr_output_up),
	(gpm_brightness_xrandr_output_set):
	* src/gpm-brightness.c: (gpm_brightness_set), (gpm_brightness_get),
	(gpm_brightness_up), (gpm_brightness_down), (gpm_brightness_init):
	Currently, several Dell laptops contain Intel graphics cards.
	The Intel driver reports that it is able to change the display
	brightness, however it also reports the number of levels supported
	as zero.
	In cases such as these, gnome power manager should fallback to the
	functional HAL Backend if it's available for the laptop.
	Fixes #562900

	Patch from Mario Limonciello <mario_limonciello@dell.com>, and slightly
	modified by me. Many thanks.

2008-12-02  Richard Hughes  <richard@hughsie.com>

	* src/gpm-brightness-hal.c: (gpm_brightness_hal_up),
	(gpm_brightness_hal_down):
	The Dell Studio 1535 and 1537 both support reading the brightness via
	HAL and setting via HAL, but handles the keypress in firmware.
	There is a lack in the logic for handling the OSD in this case.
	Fixes #562836

	Patch from Mario Limonciello <mario_limonciello@dell.com>, many thanks.

2008-11-17  Richard Hughes  <richard@hughsie.com>

	* RELEASE:
	* configure.ac:
	Post release bump.

2008-11-17  Richard Hughes  <richard@hughsie.com>

	==== Version 2.24.2 ====

2008-11-17  Richard Hughes  <richard@hughsie.com>

	* src/gpm-button.c: (gpm_button_emit_type),
	(gpm_button_filter_x_events), (gpm_button_xevent_key),
	(gpm_button_class_init), (emit_button_pressed),
	(hal_device_property_modified_cb), (hal_device_condition_cb),
	(gpm_button_init), (gpm_button_finalize):
	Backport the duplicate button handling from trunk.
	This should fix where the HAL button comes before the X button.

2008-11-17  Richard Hughes  <richard@hughsie.com>

	* src/Makefile.am:
	* src/gpm-manager.c: (idle_changed_cb), (button_pressed_cb),
	(ac_adapter_changed_cb),
	(gpm_manager_console_kit_active_changed_cb), (gpm_manager_init),
	(gpm_manager_finalize):
	Don't apply policy when not active. This is needed when multiple
	instances of g-p-m are present in multiple sessions.

2008-11-17  Richard Hughes  <richard@hughsie.com>

	* src/egg-console-kit.c: (egg_console_kit_is_local),
	(egg_console_kit_is_active), (egg_console_kit_active_changed_cb),
	(egg_console_kit_class_init), (egg_console_kit_init),
	(egg_console_kit_finalize), (egg_console_kit_new):
	* src/egg-console-kit.h:
	Add a new GObject so we can monitor if the session is local. We'll
	need this when we ignore buttons from non-local machines.

2008-11-04  Richard Hughes  <richard@hughsie.com>

	* configure.ac:
	Allow configure to complete without PolicyKit.
	Patch from Chris Vine <chris@cvine.freeserve.co.uk>, many thanks.

2008-10-31  Vincent Untz  <vuntz@gnome.org>

	* src/gpm-prefs-core.c: (gpk_prefs_setup_policykit): use the right
	PolicyKit action to setup the "Make defaults" button. The button was
	always insensitive.
	Fix bug #558670.

2008-10-22  Richard Hughes  <richard@hughsie.com>

	==== Version 2.24.1 ====

2008-10-15  Richard Hughes  <richard@hughsie.com>

	* src/gpm-cell-array.c: (gpm_cell_array_class_init):
	Fix segfault with low battery.
	Original patch from James Westby, many thanks.

2008-10-06  Richard Hughes  <richard@hughsie.com>

	* src/gpm-control.c: (gpm_control_allowed_shutdown),
	(gpm_control_allowed_reboot):
	Correct the name of the HAL PolicyKit methods now the deprecated names
	are no longer valid.

2008-09-22  Richard Hughes  <richard@hughsie.com>

	==== Version 2.24.0 ====

2008-09-09  Richard Hughes  <richard@hughsie.com>

	* src/gpm-cell-array.c: (gpm_cell_array_get_time_until_action):
	Don't clear the array when attempt to get the time.
	Fix from Joakim Andersson, many thanks.

2008-09-03  Richard Hughes  <richard@hughsie.com>

	* src/egg-color.c: (egg_st_color):
	* src/gpm-array-float.c: (gpm_st_array_float):
	* src/gpm-array.c: (gpm_st_array):
	* src/gpm-cell-array.c: (gpm_st_cell_array):
	* src/gpm-cell-unit.c: (gpm_st_cell_unit):
	* src/gpm-cell.c: (gpm_st_cell):
	* src/gpm-common.c: (gpm_st_common):
	* src/gpm-graph-widget.c: (gpm_st_graph_widget):
	* src/gpm-inhibit.c: (gpm_st_inhibit):
	* src/gpm-phone.c: (gpm_st_phone):
	* src/gpm-profile.c: (gpm_st_profile):
	* src/gpm-self-test.c: (gpm_st_start), (gpm_st_end),
	(gpm_st_title), (gpm_st_success), (gpm_st_failed),
	(gpm_st_warning), (main):
	* src/gpm-self-test.h:
	* test/gpm-st-hal-device.c: (gpm_st_hal_device):
	* test/gpm-st-hal-devicestore.c: (gpm_st_hal_devicestore):
	* test/gpm-st-hal-manager.c: (gpm_st_hal_manager):
	* test/gpm-st-hal-power.c: (gpm_st_hal_power):
	* test/gpm-st-idletime.c: (gpm_st_idletime):
	* test/gpm-st-proxy.c: (gpm_st_proxy):
	Remove the class type from the self check code, we need to make
	all the tests automatic.

2008-09-03  Richard Hughes  <richard@hughsie.com>

	* src/gpm-common.c:
	* src/gpm-common.h:
	* src/egg-color.c:
	* src/egg-color.h:
	Move the color code to a shared file.

	* src/gdb-efence.gdb:
	* src/gdb-underfence.gdb:
	Remove files I no longer use.

	* src/egg-debug.c:
	* src/egg-debug.h:
	* po/POTFILES.in:
	* src/Makefile.am:
	* src/*.c:
	Switch from using a homegrown gpm_debug to a shared egg_debug that
	I use in all my other projects. Fix up all the build failures, as the
	new egg_debug is much more strict on valid formatters.
	No string changes.

2008-09-02  Richard Hughes  <richard@hughsie.com>

	* libhal-glib/libhal-gpower.c: (hal_gpower_init),
	(hal_gpower_filter_error), (hal_gpower_suspend),
	(hal_gpower_pm_method_void), (hal_gpower_enable_power_save):
	Check for suspend or hibernate actions that take longer than 6 hours,
	as we cannot specify a longer timeout in the GLIB bindings and thus
	sometimes 'fail' when we actually succeed. Patch reformated from an
	original patch from Mario Limonciello, many thanks. Fixes #549844

2008-09-01  Richard Hughes  <richard@hughsie.com>

	==== Version 2.23.91 ====

2008-08-31  Claude Paroz  <claude@2xlibre.net>

	* src/gpm-cell.c: (gpm_cell_get_description):
	Produce more translator-friendly strings. Fixes #549854.

2008-08-29  Seán de Búrca  <sdeburca@svn.gnome.org>

	* src/gpm-cell.c: (gpm_cell_get_description):
	Handle "unknown" battery technology result from HAL. Fixes #549789.

2008-08-14  Richard Hughes  <richard@hughsie.com>

	* src/gpm-cell-array.c: (gpm_cell_percent_changed_cb):
	The callback passes a gfloat, not a guint. Fixes #547766

2008-08-14  Richard Hughes  <richard@hughsie.com>

	* src/gpm-cell-array.c:
	Add some g_return_val_if_fail()'s to try to debug #547766

2008-08-14  Richard Hughes  <richard@hughsie.com>

	* src/gpm-cell-array.c: (gpm_cell_array_index_device_id),
	(gpm_cell_array_add_device_id), (gpm_cell_array_coldplug),
	(hal_device_removed_cb), (hal_new_capability_cb),
	(hal_device_added_cb):
	* src/gpm-cell.c: (gpm_cell_set_device_id),
	(gpm_cell_get_device_id), (gpm_st_cell):
	* src/gpm-cell.h:
	Change some internal funciton names to metion an ID, not a UDI.

2008-08-14  Wouter Bolsterlee  <wbolster@svn.gnome.org>

	* m4/: Added empty m4/ directory to fix
	autogen/configure failures.

2008-08-13  Gilles Dartiguelongue  <gdartigu@svn.gnome.org>

	* Makefile.am:
	* configure.ac: enhance autofoo readability and fix a typo
	with the gconf-defaults option. Fixes #547502.

2008-08-06  Richard Hughes  <richard@hughsie.com>

	==== Version 2.23.6 ====

2008-08-06  simon.zheng  <simon.zheng@sun.com>

	* src/gpm-brightness-xrandr.c: (gpm_brightness_xrandr_init):
	Fix #546556. No longer call XRR-related functions if XRandr
	is not available.

2008-08-05  Richard Hughes  <richard@hughsie.com>

	* src/Makefile.am:
	Fix make check

2008-08-05  Matthew Garrett  <mjg59@redhat.com>

	* src/gpm-cell-unit.c: (gpm_cell_unit_init):
	* src/gpm-cell-unit.h:
	* src/gpm-cell.c: (gpm_cell_refresh_hal_all):
	The ACPI spec has the following:

	'Notice that when the battery is a primary battery (a non-rechargeable
	battery such as an Alkaline-Manganese battery) and cannot provide
	accurate information about the battery to use in the calculation of the
	remaining battery life, the Control Method Battery can report the
	percentage directly to OS. It does so by reporting the Last Full
	Charged Capacity = 100 and BatteryPresentRate=0xFFFFFFFF.
	This means that Battery Remaining Capacity directly reports the
	battery's remaining capacity [%] as a value in the range 0 through 100'

	The Eee behaves like this despite the fact that its battery is
	rechargeable, so ends up triggering the 'Broken battery' warning in
	g-p-m. This patch adds support for avoiding this case.

2008-08-01  Richard Hughes  <richard@hughsie.com>

	* src/gpm-control.c: (gpm_control_is_user_privileged),
	(gpm_control_allowed_suspend), (gpm_control_allowed_hibernate):
	Use the correct Policykit action names, we've not used hal-power-* in
	a very long time.

2008-08-01  Richard Hughes  <richard@hughsie.com>

	* src/gpm-button.c: (gpm_button_xevent_key):
	Make sure we convert from a keysym to keycode.

2008-07-27  Richard Hughes  <richard@hughsie.com>

	* src/gpm-notify.c: (gpm_notify_display):
	Fix compile error in #544298

2008-07-27  Richard Hughes  <richard@hughsie.com>

	* src/gpm-cell-array.c: (gpm_cell_array_update),
	(gpm_cell_percent_changed_cb), (gpm_cell_array_get_description),
	(gpm_cell_array_class_init):
	* src/gpm-cell-array.h:
	* src/gpm-cell-unit.c: (gpm_cell_unit_init), (gpm_cell_unit_print),
	(gpm_st_cell_unit):
	* src/gpm-cell-unit.h:
	* src/gpm-cell.c: (gpm_cell_refresh_hal_all),
	(hal_device_property_modified_cb), (gpm_cell_set_phone_index),
	(gpm_cell_get_description), (phone_device_refresh_cb),
	(gpm_cell_class_init):
	* src/gpm-cell.h:
	* src/gpm-engine.c: (gpm_cell_array_percent_changed_cb),
	(gpm_cell_array_charge_low_cb),
	(gpm_cell_array_charge_critical_cb),
	(gpm_cell_array_charge_action_cb):
	* src/gpm-manager.c: (gpm_engine_charge_low_cb),
	(gpm_engine_charge_critical_cb):
	* src/gpm-tray-icon.c: (gpm_tray_icon_add_device):
	Convert the percentage charge to a gfloat type.

2008-07-27  Richard Hughes  <richard@hughsie.com>

	* src/gpm-ac-adapter.c: (gpm_ac_adapter_class_init):
	* src/gpm-brightness-kbd.c: (gpm_brightness_kbd_class_init):
	* src/gpm-light-sensor.c: (gpm_light_sensor_class_init):
	* src/gpm-notify.c: (gpm_notify_class_init):
	* src/gpm-sound.c: (gpm_sound_class_init):
	* src/gpm-srv-brightness-kbd.c:
	(gpm_srv_brightness_kbd_class_init):
	* src/gpm-tray-icon.c: (gpm_tray_icon_class_init):
	* src/gpm-warnings.c: (gpm_warnings_class_init):
	Remove some default contructors from some GObjects.

2008-07-27  Richard Hughes  <richard@hughsie.com>

	* configure.ac:
	Rip out the DBUS_VERSION_X logic, nothing uses it

2008-07-27  Richard Hughes  <richard@hughsie.com>

	* configure.ac:
	* src/Makefile.am:
	* src/gpm-control.c: (gpm_control_is_user_privileged),
	(gpm_control_allowed_suspend), (gpm_control_allowed_hibernate),
	(gpm_control_allowed_shutdown), (gpm_control_allowed_reboot),
	(gpm_control_finalize), (gpm_control_init):
	* src/gpm-polkit.c:
	* src/gpm-polkit.h:
	Use polkit-simple to simplify the PolicyKit bits.
	This wasn't around when the support in g-p-m was added, but now it is.

2008-07-27  Richard Hughes  <richard@hughsie.com>

	* applets/brightness/brightness-applet.c:
	(gpm_applet_get_brightness), (gpm_applet_set_brightness):
	* applets/inhibit/inhibit-applet.c: (gpm_applet_inhibit),
	(gpm_applet_uninhibit), (gpm_applet_has_inhibit):
	* libdbus-glib/libdbus-proxy.c: (dbus_noc_session_cb),
	(dbus_noc_system_cb), (dbus_proxy_assign):
	* libdbus-glib/libdbus-watch.c: (dbus_noc_session_cb),
	(dbus_noc_system_cb), (dbus_watch_assign):
	* libhal-glib/libhal-gdevice.c: (hal_gdevice_get_bool),
	(hal_gdevice_get_string), (hal_gdevice_get_int),
	(hal_gdevice_query_capability),
	(hal_gdevice_watch_property_modified),
	(hal_gdevice_watch_condition), (proxy_status_cb),
	(hal_gdevice_finalize):
	* libhal-glib/libhal-gdevicestore.c: (hal_gdevicestore_insert):
	* libhal-glib/libhal-gmanager.c: (hal_gmanager_find_capability),
	(hal_gmanager_find_device_string_match),
	(hal_gmanager_num_devices_of_capability),
	(hal_gmanager_num_devices_of_capability_with_value),
	(proxy_status_cb), (hal_gmanager_init):
	* libhal-glib/libhal-gpower.c: (hal_gpower_suspend),
	(hal_gpower_pm_method_void):
	* libidletime/libidletime.c: (idletime_xsync_alarm_set):
	* src/gpm-ac-adapter.c: (gpm_ac_adapter_is_present),
	(gpm_ac_adapter_init):
	* src/gpm-array.c: (gpm_array_append),
	(gpm_array_append_from_file), (gpm_array_save_to_file),
	(gpm_array_add), (gpm_st_array):
	* src/gpm-backlight.c: (gpm_backlight_sync_policy),
	(gpm_backlight_get_mode), (gpm_backlight_get_brightness),
	(gpm_backlight_set_brightness),
	(gpm_backlight_brightness_evaluate_and_set), (idle_changed_cb),
	(gpm_backlight_init):
	* src/gpm-brightness-hal.c: (gpm_brightness_hal_get_hw),
	(gpm_brightness_hal_set_hw), (gpm_brightness_hal_dim_hw_step):
	* src/gpm-brightness-kbd.c: (gpm_brightness_kbd_get_hw),
	(gpm_brightness_kbd_set_hw), (gpm_brightness_kbd_set_dim),
	(gpm_brightness_kbd_dim),
	(adjust_kbd_brightness_according_to_ambient_light):
	* src/gpm-brightness-xrandr.c:
	* src/gpm-button.c: (gpm_button_xevent_key), (emit_button_pressed),
	(hal_device_property_modified_cb), (coldplug_buttons),
	(gpm_button_init):
	* src/gpm-cell-array.c: (gpm_cell_array_get_time_until_action),
	(gpm_cell_array_update), (gpm_cell_array_percent_changed),
	(gpm_cell_charging_changed_cb), (gpm_cell_discharging_changed_cb),
	(gpm_check_device_key), (gpm_cell_array_add_hal_udi),
	(gpm_cell_array_coldplug), (gpm_cell_array_get_description),
	(hal_device_added_cb), (gpm_st_cell_array):
	* src/gpm-cell-unit.c: (gpm_cell_unit_get_icon),
	(gpm_cell_unit_get_kind_localised), (gpm_st_cell_unit):
	* src/gpm-cell.c: (gpm_cell_refresh_hal_all),
	(hal_device_property_modified_cb), (gpm_cell_set_hal_udi),
	(gpm_cell_get_description), (gpm_cell_get_battery), (gpm_st_cell):
	* src/gpm-control.c: (gpm_control_check_foreground_console),
	(gpm_control_allowed_suspend), (gpm_control_allowed_hibernate),
	(gpm_control_shutdown), (gpm_control_reboot),
	(gpm_control_suspend), (gpm_control_hibernate):
	* src/gpm-debug.h:
	* src/gpm-engine.c: (gpm_engine_get_summary),
	(gpm_engine_get_icon), (gpm_cell_array_perhaps_recall_cb),
	(gpm_cell_array_low_capacity_cb),
	(gpm_engine_recalculate_state_icon),
	(gpm_engine_recalculate_state_summary),
	(gpm_engine_recalculate_state),
	(gpm_cell_array_discharging_changed_cb),
	(gpm_cell_array_fully_charged_cb):
	* src/gpm-graph-widget.c: (gpm_graph_widget_draw_graph),
	(gpm_st_graph_widget):
	* src/gpm-idle.c: (session_idle_changed_cb),
	(powersave_idle_changed_cb):
	* src/gpm-info.c: (gpm_info_log_do_poll), (ac_adapter_changed_cb),
	(gpm_info_init):
	* src/gpm-inhibit.c: (gpm_inhibit_has_inhibit), (inhibit),
	(has_inhibit), (gpm_st_inhibit):
	* src/gpm-light-sensor.c: (gpm_light_sensor_get_hw),
	(gpm_light_sensor_poll_cb), (gpm_light_sensor_init):
	* src/gpm-load.c: (gpm_load_get_current):
	* src/gpm-main.c: (gpm_object_register), (main):
	* src/gpm-manager.c: (gpm_manager_is_inhibit_valid),
	(gpm_manager_sync_policy_sleep), (gpm_manager_blank_screen),
	(gpm_manager_unblank_screen), (gpm_manager_get_on_battery),
	(idle_do_sleep), (idle_changed_cb), (lid_button_pressed),
	(ac_adapter_changed_cb), (gpm_manager_check_sleep_errors),
	(screensaver_auth_request_cb), (control_sleep_failure_cb),
	(gpm_manager_init):
	* src/gpm-notify.c: (gpm_notify_create), (gpm_notify_show),
	(ac_adapter_changed_cb), (notify_general_clicked_cb),
	(gpm_notify_sleep_failed):
	* src/gpm-phone.c: (gpm_phone_get_num_batteries),
	(gpm_phone_num_batteries_changed), (gpm_phone_dbus_disconnect),
	(gpm_st_phone):
	* src/gpm-polkit.c: (gpm_polkit_is_user_privileged):
	* src/gpm-prefs-core.c: (gpm_dbus_method_bool),
	(gpm_dbus_method_int), (prefs_setup_notification):
	* src/gpm-profile.c: (gpm_profile_get_data_file),
	(gpm_profile_print), (gpm_profile_get_data_time_percent),
	(gpm_profile_get_accuracy_average),
	(gpm_profile_get_data_accuracy_percent), (gpm_profile_get_time),
	(gpm_profile_set_average_no_accuracy),
	(gpm_profile_save_percentage), (gpm_profile_register_percentage),
	(gpm_profile_register_charging), (ac_adaptor_changed_cb),
	(gpm_profile_load_data), (gpm_profile_set_config_id),
	(gpm_profile_get_accuracy), (gpm_profile_init), (gpm_st_profile):
	* src/gpm-screensaver.c: (gpm_screensaver_add_throttle),
	(gpm_screensaver_remove_throttle), (gpm_screensaver_get_idle):
	* src/gpm-self-test.c: (gpm_st_start):
	* src/gpm-srv-brightness-kbd.c: (conf_key_changed_cb),
	(ac_adapter_changed_cb), (gpm_srv_brightness_kbd_new):
	* src/gpm-srv-screensaver.c: (screensaver_auth_request_cb),
	(update_ac_throttle):
	* src/gpm-statistics-core.c: (gpm_statistics_get_events),
	(gpm_statistics_find_types), (gpm_statistics_get_data_dbus),
	(gpm_statistics_get_parameters_dbus),
	(gpm_statistics_refresh_data),
	(gpm_statistics_populate_graph_types):
	* src/gpm-tray-icon.c: (gpm_tray_icon_activate_cb):
	* src/gpm-warnings.c: (gpm_warnings_get_state),
	(gpm_warnings_init):
	* test/gpm-st-hal-device.c: (gpm_st_hal_device):
	* test/gpm-st-hal-devicestore.c: (gpm_st_hal_devicestore):
	* test/gpm-st-hal-manager.c: (gpm_st_hal_manager):
	* test/gpm-st-hal-power.c: (gpm_st_hal_power):
	* test/gpm-st-idletime.c: (gpm_st_idletime):
	Trivial coding style changes to bring us up to 2008.

2008-07-23  Richard Hughes  <richard@hughsie.com>

	* src/gpm-control.c: (gpm_control_check_foreground_console),
	(gpm_control_allowed_suspend), (gpm_control_allowed_hibernate),
	(gpm_control_allowed_shutdown), (gpm_control_allowed_reboot),
	(gpm_control_suspend), (gpm_control_hibernate),
	(gpm_control_class_init), (gpm_control_init):
	* src/gpm-control.h:
	* src/gpm-manager.c: (manager_policy_do), (idle_changed_cb):
	Completely remove all traces of the skipping suppressed action --
	we might introduce regressions, but people are complaining about
	the bad error message.

2008-07-22  Richard Hughes  <richard@hughsie.com>

	* src/gpm-button.c: (gpm_button_filter_x_events),
	(gpm_button_grab_keystring), (gpm_button_xevent_key),
	(gpm_button_init):
	Don't use KeySyms, instead use KeyCodes directly. This should fix
	multimedia keyboards and get rid of the warnings at startup.

2008-07-22  Richard Hughes  <richard@hughsie.com>

	* src/gpm-tray-icon.c: (gpm_tray_icon_show_info_cb):
	Don't use a libnotify window for the battery information, use a
	GtkDialog instead.

2008-07-08  Richard Hughes  <richard@hughsie.com>

	* configure.ac:
	Post release version bump.

2008-07-01  Richard Hughes  <richard@hughsie.com>

	==== Version 2.23.3 ====

2008-06-30  Richard Hughes  <richard@hughsie.com>

	* data/gnome-power-manager.schemas.in:
	* src/gpm-backlight.c: (gpm_backlight_brightness_evaluate_and_set),
	(conf_key_changed_cb):
	* src/gpm-conf.h:
	Fix the name and description of the gconf key:
	/apps/gnome-power-manager/backlight/brightness_dim_battery
	Fixes #483144

2008-06-23  Richard Hughes  <richard@hughsie.com>

	* src/gpm-cell.c: (gpm_cell_get_id):
	Don't segfault in gpm_cell_get_id() if we don't have a model or serial number.

2008-06-23  Tomaž Šolc  <tomaz.solc@tablix.org>

	* src/gpm-brightness-hal.c: (gpm_brightness_hal_up),
	(gpm_brightness_hal_down), (gpm_brightness_hal_init):
	Added support for the 'brightness_in_hardware' hal property.

2008-06-22  Brian Pepple  <bpepple@fedoraproject.org>

	* data/icons/Makefile.am (uninstall-hook): fix gtk-update-icon-cache for 
	uninstall-hook.

2008-06-06  simon.zheng  <simon.zheng@sun.com>

	* data/gnome-power-manager.schemas.in: 
	Cleanup useless gconf key cpufreq_show. See #536956.

2008-06-06  Richard Hughes  <richard@hughsie.com>

	* data/gnome-power-manager.schemas.in:
	Don't show the inhibit lid warning by default. It's pretty meaningless and doesn't mean
	much to most users.

2008-06-04  Richard Hughes  <richard@hughsie.com>

	* src/gpm-prefs-core.c: (pk_prefs_set_defaults_cb):
	Matthias pointed out that we need to call gconf_client_suggest_sync() before calling into
	the 'make settings default' service otherwise you push system-wide whatever is in the files
	not your latest setting that is still in the gconf cache.

2008-06-03  Richard Hughes  <richard@hughsie.com>

	* src/gpm-manager.c: (ac_adapter_changed_cb):
	Allow events a few seconds after the ac unplug. Fixes #492132

2008-06-02  Richard Hughes  <richard@hughsie.com>

	* src/gpm-info.c: (gpm_statistics_add_events_typical),
	(gpm_statistics_get_parameters):
	* src/gpm-profile.c: (gpm_profile_get_data_time_percent),
	(gpm_profile_get_data_accuracy_percent):
	Fix the colour mess once and for all.

2008-05-29  Richard Hughes  <richard@hughsie.com>

	* src/gpm-brightness-xrandr.c:
	(gpm_brightness_xrandr_foreach_screen),
	(gpm_brightness_monitors_changed),
	(gpm_brightness_xrandr_update_cache),
	(gpm_brightness_xrandr_finalize), (gpm_brightness_xrandr_init):
	When using XRANDR, cache the list of resources as getting a new list on each brightness
	change causes the outputs to be reprobed, which is done over i2c in some cases.
	This fix was insired from a patch by Bastien Nocera, and fixes #535271

2008-05-29  simon.zheng  <simon.zheng@sun.com>

	* configure.ac:
	* src/Makefile.am:
	* src/gpm-load.c: (gpm_load_get_cpu_values): 
	Fix #534335, make cpu load calculation work on Solaris.

2008-05-27  Richard Hughes  <richard@hughsie.com>

	* src/gpm-cell.c: (gpm_cell_get_id):
	Use model-capacity-serial in the config_id so we can still distinguish
	between batteries of different capacity even when the battery vendor is a dumb-ass
	and does not set serial or model numbers.

2008-05-27  Richard Hughes  <richard@hughsie.com>

	* src/gpm-button.c: (gpm_button_init), (gpm_button_finalize):
	Don't use GpmSound, we don't need to use it.

2008-05-20  Richard Hughes  <richard@hughsie.com>

	* configure.ac:
	Post release version increment to 2.23.2

2008-05-20  Richard Hughes  <richard@hughsie.com>

	==== Version 2.23.1 ====

2008-05-19  Kjartan Maraas  <kmaraas@gnome.org>

	* applets/inhibit/inhibit-applet.c: (gpm_applet_update_tooltip):
	Don't g_strdup() strings when it's not needed.

2008-05-19  Kjartan Maraas  <kmaraas@gnome.org>

	* applets/brightness/brightness-applet.c:
	(gpm_applet_update_tooltip):
	* applets/inhibit/inhibit-applet.c: (gpm_applet_update_tooltip):
	* src/gpm-common.c: (gpm_get_timestring):
	* src/gpm-control.c: (gpm_control_convert_hal_error):
	* src/gpm-inhibit.c: (gpm_inhibit_get_message):
	* src/gpm-manager.c: (gpm_manager_is_inhibit_valid),
	(gpm_engine_charge_critical_cb), (gpm_engine_charge_action_cb):
	* src/gpm-notify.c: (gpm_notify_inhibit_lid):
	* src/gpm-statistics-core.c: (gpm_statistics_populate_graph_types):
	Fix a bunch of build warnings with glib trunk.

2008-05-15  Richard Hughes  <richard@hughsie.com>

	* src/gpm-conf.c: (gpm_conf_set_bool), (gpm_conf_set_string),
	(gpm_conf_set_int):
	Check keys for writability before we try to change them. Fixes rh#444026

2008-05-14  Richard Hughes  <richard@hughsie.com>

	* configure.ac:
	Correct the Unique buildrequire.

	* libunique/libunique.c: (libunique_assign):
	Fix build for non-HAVE_UNIQUE

2008-05-14  Richard Hughes  <richard@hughsie.com>

	* Makefile.am:
	* configure.ac:
	* libunique/Makefile.am:
	* libunique/libunique.c: (libunique_message_cb),
	(libunique_assign), (libunique_class_init), (libunique_init),
	(libunique_finalize), (libunique_new):
	* libunique/libunique.h:
	Add a simple GObject that can optionally use Unique to give single instance capability
	to the client tools. This removes a lot of HAVE_GTK_UNIQUE and random complexity from
	source files also.

	* src/Makefile.am:
	* src/gpm-prefs.c: (gpm_prefs_close_cb), (gpm_prefs_activated_cb),
	(main):
	* src/gpm-statistics-core.c: (gpm_statistics_activate_window):
	* src/gpm-statistics.c: (gpm_statistics_close_cb),
	(gpm_statistics_activated_cb), (main):
	Use LibUnique to make g-p-p and g-p-s single instance. GtkUnique is now obsolete.

2008-05-12  Richard Hughes  <richard@hughsie.com>

	* configure.ac:
	* data/gpm-prefs.glade:
	* src/Makefile.am:
	* src/gpm-prefs-core.c: (pk_prefs_set_defaults_cb),
	(gpk_prefs_create_custom_widget), (gpk_prefs_setup_policykit),
	(gpm_prefs_init):
	Rework a patch from Matthias Clasen adding a default button for GConf settings.
	This option requires an optional dep on polkit-gnome.

2008-05-09  Richard Hughes  <richard@hughsie.com>

	* src/gpm-brightness.c: (gpm_brightness_finalize),
	(gpm_brightness_changed), (gpm_brightness_xrandr_changed_cb),
	(gpm_brightness_hal_changed_cb), (gpm_brightness_init):
	Be more careful only listening to the brightness changed signals from the event source
	we are using. This should fix duplicate notifications from hardware that can do both sorts
	of dimming.

2008-05-09  Richard Hughes  <richard@hughsie.com>

	* src/gpm-brightness-hal.c: (gpm_brightness_hal_dim_hw),
	(gpm_brightness_hal_up), (gpm_brightness_hal_down):
	* src/gpm-brightness-xrandr.c: (gpm_brightness_xrandr_output_down),
	(gpm_brightness_xrandr_output_up), (gpm_brightness_xrandr_up),
	(gpm_brightness_xrandr_down):
	* src/gpm-brightness.c: (gpm_brightness_get_step):
	* src/gpm-brightness.h:
	Use the same logic for xrandr as hal when we have a large number of brightness steps.

2008-05-09  Richard Hughes  <richard@hughsie.com>

	* data/gnome-power-manager.schemas.in:
	* data/gpm-prefs.glade:
	* libhal-glib/Makefile.am:
	* libhal-glib/libhal-gcpufreq.c:
	* libhal-glib/libhal-gcpufreq.h:
	* po/POTFILES.in:
	* help/C/gnome-power-manager.xml
	* src/Makefile.am:
	* src/gpm-conf.h:
	* src/gpm-cpufreq.c:
	* src/gpm-cpufreq.h:
	* src/gpm-manager.c: (gpm_manager_init), (gpm_manager_finalize):
	* src/gpm-prefs-core.c: (prefs_setup_ac), (prefs_setup_battery),
	(gpm_prefs_init), (gpm_prefs_finalize):
	We've not had the CPU freq stuff by default in the UI for many releases.
	Remove all the cpufreq code, as I keep being told I'm insane by Matthew.
	See http://www.advogato.org/person/mjg59/diary.html?start=123 for rationale.

2008-04-25  Richard Hughes  <richard@hughsie.com>

	* src/gpm-srv-brightness-kbd.c: (conf_key_changed_cb):
	Correct a typo in the keyboard brightness code. From a Debian patch found randomly on
	the Internet by Matthias.
	It might have been nice if it could have been sent to me by the Debian maintainer...

2008-04-18  Richard Hughes  <richard@hughsie.com>

	* src/gpm-cell-array.c: (gpm_cell_array_update):
	* src/gpm-cell.c: (gpm_cell_refresh_hal_all),
	(hal_device_property_modified_cb):
	* src/gpm-info.c: (gpm_info_log_do_poll):
	Be more paranoid about the rates reported from HAL, and also only add data to the graph if
	it's notn-zero. Perhaps fixes rh#443069

2008-04-10  Richard Hughes  <richard@hughsie.com>

	* src/gpm-backlight.c: (conf_key_changed_cb):
	Watch for two new gconf keys, so checking the 'Reduce battery brightness' in the battery
	tab of gnome-power-preferences makes the panel dim if we are on battery power.

2008-04-10  Richard Hughes  <richard@hughsie.com>

	* applets/inhibit/inhibit-applet.c: (gpm_applet_check_size),
	(gpm_applet_click_cb):
	Watch the panel size in case we resize the panel and need to change the icon.
	Patch from Ted Gould, many thanks.

2008-04-10  Richard Hughes  <richard@hughsie.com>

	* applets/inhibit/inhibit-applet.c: (gpm_applet_draw_cb):
	Clear the brightness applet background so we can draw on it later.
	Patch from Ted Gould, many thanks.

2008-04-10  Richard Hughes  <richard@hughsie.com>

	* configure.ac:
	Turn on some extra warnings for GCC.

	* applets/brightness/brightness-applet.c: (gpm_applet_help_cb):
	* applets/inhibit/inhibit-applet.c: (gpm_applet_help_cb):
	* src/gpm-backlight.c: (gpm_backlight_brightness_evaluate_and_set):
	* src/gpm-brightness-hal.c: (gpm_brightness_hal_up),
	(gpm_brightness_hal_down):
	* src/gpm-brightness-xrandr.c:
	(gpm_brightness_xrandr_output_get_internal),
	(gpm_brightness_xrandr_output_set_internal),
	(gpm_brightness_xrandr_output_set),
	(gpm_brightness_xrandr_foreach_resource):
	* src/gpm-brightness.c: (gpm_brightness_get):
	* src/gpm-common.c: (gpm_help_display):
	* src/gpm-inhibit.c: (gpm_inhibit_get_message):
	* src/gpm-light-sensor.c: (gpm_light_sensor_poll_cb),
	(gpm_light_sensor_init):
	* src/gpm-debug.c:
	* src/gpm-main.c: (main):
	* src/gpm-manager.c: (gpm_manager_is_inhibit_valid):
	Fix the warnings!

2008-04-10  Richard Hughes  <richard@hughsie.com>

	* src/gpm-brightness.c: (gpm_brightness_trust_cache),
	(gpm_brightness_set), (gpm_brightness_get), (gpm_brightness_up),
	(gpm_brightness_down), (gpm_brightness_changed_cb),
	(gpm_brightness_init):
	* src/gpm-brightness.h:
	Allow some data to be cached to speed up querying brightess.

	* src/gpm-backlight.c: (gpm_backlight_set_brightness),
	(gpm_backlight_brightness_evaluate_and_set),
	(gpm_backlight_button_pressed_cb):
	* src/gpm-brightness-hal.c: (gpm_brightness_hal_set_hw),
	(gpm_brightness_hal_dim_hw_step), (gpm_brightness_hal_set),
	(gpm_brightness_hal_up), (gpm_brightness_hal_down),
	(gpm_brightness_hal_init):
	* src/gpm-brightness-hal.h:
	* src/gpm-brightness-xrandr.c:
	(gpm_brightness_xrandr_output_set_internal),
	(gpm_brightness_xrandr_output_set), (gpm_brightness_xrandr_set),
	(gpm_brightness_xrandr_get), (gpm_brightness_xrandr_up),
	(gpm_brightness_xrandr_down), (gpm_brightness_xrandr_init):
	* src/gpm-brightness-xrandr.h:
	Make the methods sane, so we can tell the difference between a failed method, and one
	that did not change the hardware brightness. This should fix lots of issues with the
	brightness applet.

2008-04-10  Richard Hughes  <richard@hughsie.com>

	* src/gpm-brightness-xrandr.c:
	(gpm_brightness_xrandr_output_set_internal),
	(gpm_brightness_xrandr_output_down),
	(gpm_brightness_xrandr_output_up),
	(gpm_brightness_xrandr_output_set),
	(gpm_brightness_xrandr_foreach_resource),
	(gpm_brightness_xrandr_foreach_screen):
	Add better error handling to detect if functions had any effect on the hardware.

2008-04-10  Richard Hughes  <richard@hughsie.com>

	* src/gpm-backlight.c: (gpm_backlight_brightness_evaluate_and_set):
	Don't let the user supply invalid gconf values to upset the brightness calculation.

	* src/gpm-brightness-xrandr.c:
	(gpm_brightness_xrandr_output_get_internal),
	(gpm_brightness_xrandr_output_set_internal),
	(gpm_brightness_xrandr_init):
	Fix some warnings in the current code.

2008-04-10  Richard Hughes  <richard@hughsie.com>

	* src/gpm-backlight.c: (brightness_changed_cb):
	* src/gpm-brightness-hal.c: (gpm_brightness_hal_up),
	(gpm_brightness_hal_down):
	* src/gpm-brightness-xrandr.c:
	(gpm_brightness_xrandr_output_get_limits),
	(gpm_brightness_xrandr_may_have_changed),
	(gpm_brightness_xrandr_filter_xevents):
	More code in preparation to emit a ::changed signal when xrandr changes.
	Also don't emit this when we do up&down in the HAL backend, else we will get
	a double notification event.

2008-04-10  Richard Hughes  <richard@hughsie.com>

	* src/gpm-brightness-xrandr.c:
	(gpm_brightness_xrandr_setup_display),
	(gpm_brightness_xrandr_filter_xevents),
	(gpm_brightness_xrandr_finalize), (gpm_brightness_xrandr_init):
	Try to grab brightness_changed events from BACKLIGHT.

2008-04-09  Richard Hughes  <richard@hughsie.com>

	* src/gpm-backlight.c: (gpm_backlight_get_brightness),
	(gpm_backlight_set_brightness),
	(gpm_backlight_brightness_evaluate_and_set), (conf_key_changed_cb),
	(gpm_backlight_button_pressed_cb), (idle_changed_cb),
	(gpm_backlight_init):
	* src/gpm-brightness.c: (gpm_brightness_set), (gpm_brightness_get),
	(gpm_brightness_up), (gpm_brightness_down):
	Make the backlight do what the user expects rather than what the policy says.
	This should fix the bug where auto-dimming returns the level to the policy value
	rather than the value the user just set using the brightness applet or brightness keys.

2008-04-09  Richard Hughes  <richard@hughsie.com>

	* po/POTFILES.in:
	* src/Makefile.am:
	* src/gpm-backlight.c: (gpm_backlight_get_brightness),
	(gpm_backlight_set_brightness),
	(gpm_backlight_brightness_evaluate_and_set), (button_pressed_cb),
	(brightness_changed_cb), (gpm_backlight_init):
	* src/gpm-brightness-hal.c: (gpm_brightness_hal_get_hw),
	(gpm_brightness_hal_set_hw), (gpm_brightness_hal_dim_hw_step),
	(gpm_brightness_hal_get_step), (gpm_brightness_hal_dim_hw),
	(gpm_brightness_hal_set), (gpm_brightness_hal_get),
	(gpm_brightness_hal_up), (gpm_brightness_hal_down),
	(gpm_brightness_hal_has_hw), (gpm_brightness_hal_finalize),
	(gpm_brightness_hal_class_init), (gpm_brightness_hal_init),
	(gpm_brightness_hal_new):
	* src/gpm-brightness-hal.h:
	* src/gpm-brightness-lcd.c:
	* src/gpm-brightness-lcd.h:
	* src/gpm-common.c: (gpm_percent_to_discrete),
	(gpm_discrete_to_percent):
	* src/gpm-srv-screensaver.c: (screensaver_auth_request_cb),
	(gpm_srv_screensaver_init), (gpm_srv_screensaver_finalize):
	Convert the GpmBacklight class to use GpmBrightness and fix up a few issues along the way.

2008-04-09  Richard Hughes  <richard@hughsie.com>

	* src/gpm-brightness.c: (gpm_brightness_set), (gpm_brightness_get),
	(gpm_brightness_up), (gpm_brightness_down),
	(gpm_brightness_has_hw), (gpm_brightness_finalize),
	(gpm_brightness_class_init), (gpm_brightness_changed_cb),
	(gpm_brightness_init), (gpm_brightness_new):
	* src/gpm-brightness.h:
	Add a class that allows us to use either the XRANDR or HAL methods automatically.

2008-04-09  Richard Hughes  <richard@hughsie.com>

	* src/gpm-brightness-xrandr.c:
	(gpm_brightness_xrandr_output_get_internal),
	(gpm_brightness_xrandr_output_set_internal),
	(gpm_brightness_xrandr_setup_display),
	(gpm_brightness_xrandr_output_get_limits),
	(gpm_brightness_xrandr_output_get_percentage),
	(gpm_brightness_xrandr_output_down),
	(gpm_brightness_xrandr_output_up),
	(gpm_brightness_xrandr_output_set),
	(gpm_brightness_xrandr_foreach_resource),
	(gpm_brightness_xrandr_foreach_screen),
	(gpm_brightness_xrandr_set), (gpm_brightness_xrandr_get),
	(gpm_brightness_xrandr_up), (gpm_brightness_xrandr_down),
	(gpm_brightness_xrandr_has_hw), (gpm_brightness_xrandr_finalize),
	(gpm_brightness_xrandr_class_init), (gpm_brightness_xrandr_init),
	(gpm_brightness_xrandr_new):
	* src/gpm-brightness-xrandr.h:
	New class allowing us to change the backlight brightness using XRANDR.

2008-04-09  Richard Hughes  <richard@hughsie.com>

	* src/gpm-debug.c: (gpm_set_console_mode), (gpm_print_line),
	(gpm_debug_real), (gpm_warning_real), (gpm_syslog_internal),
	(gpm_error_real), (gpm_syslog), (gpm_debug_init):
	* src/gpm-main.c: (main):
	* src/run-gpm.sh:
	Use better debugging output, code mostly stolen from PackageKit.

2008-04-09  Richard Hughes  <richard@hughsie.com>

	* configure.ac:
	Add a hard dep on XRANDR for the upcoming brightness changes.

2008-04-07  simon.zheng  <simon.zheng@sun.com>

	* src/gpm-prefs-core.c: (gpm_prefs_setup_action_combo),
	(gpm_prefs_init):
	Check "CanShutdown" before showing option shutdown in 
	preferences, as well as suspend and hibernate. Fixes #526178.
	* tools/gnome-power-bugreport.sh:
	Support Solaris platform. See #526349.

2008-04-01  simon.zheng  <simon.zheng@sun.com>

	* tools/gnome-power-cmd.sh:
	Only show "Failed" when D-Bus method call really fails. 

2008-03-26  Richard Hughes  <richard@hughsie.com>

	* src/gpm-notify.c: (gpm_notify_perhaps_recall),
	(gpm_notify_low_capacity), (gpm_notify_inhibit_lid):
	Don't show some notifications under GDM. Fixes #108075

2008-03-26  Richard Hughes  <richard@hughsie.com>

	* src/gpm-prefs-core.c: (prefs_setup_battery):
	Fix a critical warning in gnome-power-preferences. Fixes #524449

2008-03-24  Richard Hughes  <richard@hughsie.com>

	* src/gpm-array.c: (gpm_array_append), (gpm_array_limit_x_size):
	Add some extra debugging to try to work out #523682

2008-03-19  Richard Hughes  <richard@hughsie.com>

	* src/gpm-info.c: (gpm_statistics_get_parameters):
	The graph colors are used inconsistently between the various graphs.
	Patch by Jérôme Guelfucci <jerome.guelfucci@gmail.com>, many thanks.
	Fixes #517914

2008-03-19  Richard Hughes  <richard@hughsie.com>

	* src/gpm-brightness-kbd.c: (gpm_brightness_kbd_get_hw):
	GetBrightness returns a INT not a UINT, so fix the keyboard brightness.
	Patch by Sjoerd Simons <sjoerd@luon.net>, many thanks.
	Fixes #523152

2008-03-16  Richard Hughes  <richard@hughsie.com>

	* src/gpm-sound.c: (gpm_sound_gst_bus_cb), (gpm_sound_init):
	We never change state of the playbin back to NULL when playing a sound
	event.
	This as multiple problems :
	- lock indefinitely the mixer when using ALSA as gstreamer audio sink :
	- Create an HUGE leak when using pulsaudio as gstreamer audio sink and for
	  some reasons pulsaudio crash, or you terminate the stream in pavucontrol.

	Patch by Florent Mertens <outpourav@yahoo.fr>, and slightly tweaked by
	me. Fixes #522336

2008-03-16  Richard Hughes  <richard@hughsie.com>

	* applets/brightness/brightness-applet.c:
	(gpm_applet_create_popup):
	* data/gpm-feedback-widget.glade:
	g-p-m should set a window type hint for the brightness feedback window.
	That makes it easier for compositors like Compiz to properly animate
	the window.
	Patch by Danny Baumann <dannybaumann@web.de>, many thanks. Fixes #522236

2008-03-16  Richard Hughes  <richard@hughsie.com>

	* data/sounds/Makefile.am:
	* src/gpm-button.c: (emit_button_pressed):
	* src/gpm-sound.c: (gpm_sound_force):
	* src/gpm-sound.h:
	Remove the lid sounds (originally for debugging). Everbody hates them.

2008-03-12  Richard Hughes  <richard@hughsie.com>

	* src/gpm-main.c: (gpm_exit), (main):
	This is was removed from gpm-main.c, but GpmManager breaks,
	What the users sees is that GPM can no longer cause a session kill.
	Found by Ted Gould, many thanks. (#521686)

2008-03-12  Richard Hughes  <richard@hughsie.com>

	* src/gpm-manager.c: (gpm_manager_action_suspend),
	(gpm_manager_action_hibernate):
	Remove some dead code.

2008-03-12  Richard Hughes  <richard@hughsie.com>

	* src/gpm-cell-array.c: (gpm_cell_array_collection_changed):
	Don't try to generate a config_id when we have no primary batteries.
	Fixes a segfault in gdm2 (#522078)

2008-03-10  Richard Hughes  <richard@hughsie.com>

	* configure.ac:
	Post release version increment to 2.23.1

2008-03-10  Richard Hughes  <richard@hughsie.com>

	==== Version 2.22.0 ====

2008-03-04  David Zeuthen  <davidz@redhat.com>

	* src/gpm-prefs-core.c: (conf_key_changed_cb): Update the slider
	when the value in gconf changes. This fixes a bug when using the
	brightness applet and the slider isn't updated. Fixes bug #520411.

2008-02-19  Richard Hughes  <richard@hughsie.com>

	* src/gpm-engine.c: (gpm_engine_get_icon):
	Only get the state if the collection item is present, to avoid lots of
	printing of 'percentage zero, something's gone wrong'.
	Should be no functional change.

2008-02-19  Richard Hughes  <richard@hughsie.com>

	* applets/brightness/brightness-applet.c: (gpm_applet_draw_cb):
	The brightness applet leaks memory, and appears to be because it leaks
	references like mad; this can be seen pretty easily by running xrestop
	and opening/closing the slider.
	Free the gc to avoid the leak, fixes #514590 (Matthias Clasen)

2008-02-19  Richard Hughes  <richard@hughsie.com>

	* libdbus-glib/libdbus-monitor-session.c:
	* libdbus-glib/libdbus-monitor-system.c:
	* libdbus-glib/libdbus-proxy.c:
	* libdbus-glib/libdbus-watch.c:
	* libhal-glib/libhal-gdevice.c:
	* libhal-glib/libhal-gdevicestore.c:
	* libhal-glib/libhal-gmanager.c:
	* libidletime/libidletime.c:
	* src/gpm-ac-adapter.c:
	* src/gpm-backlight.c:
	* src/gpm-brightness-kbd.c:
	* src/gpm-brightness-lcd.c:
	* src/gpm-button.c:
	* src/gpm-cell-array.c:
	* src/gpm-cell-unit.h:
	* src/gpm-cell.c:
	* src/gpm-conf.c:
	* src/gpm-control.c:
	* src/gpm-dpms.c:
	* src/gpm-engine.c:
	* src/gpm-idle.c:
	* src/gpm-inhibit.c:
	* src/gpm-light-sensor.c:
	* src/gpm-manager.c:
	* src/gpm-notify.c:
	* src/gpm-phone.c:
	* src/gpm-prefs-core.c:
	* src/gpm-prefs-server.c:
	* src/gpm-refcount.c:
	* src/gpm-screensaver.c:
	* src/gpm-statistics-core.c:
	* src/gpm-tray-icon.c:
	Remove non-required trailing commas.

2008-02-19  Richard Hughes  <richard@hughsie.com>

	* libdbus-glib/libdbus-proxy.c: (dbus_proxy_finalize):
	* libdbus-glib/libdbus-watch.c: (dbus_watch_finalize):
	* src/gpm-cell-array.c: (gpm_cell_array_finalize):
	* src/gpm-cell.c: (gpm_cell_finalize):
	* src/gpm-engine.c: (gpm_engine_finalize):
	* src/gpm-graph-widget.c: (gpm_graph_widget_finalize):
	* src/gpm-refcount.c: (gpm_refcount_finalize):
	Add some missing finaliser calls.

2008-02-19  Richard Hughes  <richard@hughsie.com>

	* libhal-glib/libhal-gdevice.c: (hal_gdevice_get_udi):
	* libhal-glib/libhal-gdevicestore.c: (hal_gdevicestore_find_udi):
	* src/gpm-array.c: (gpm_array_get), (gpm_array_copy),
	(gpm_array_copy_append), (gpm_array_interpolate):
	* src/gpm-brightness-kbd.c: (gpm_brightness_kbd_get_step):
	* src/gpm-brightness-lcd.c: (gpm_brightness_lcd_get_step):
	* src/gpm-cell-array.c: (gpm_cell_array_get_cell),
	(gpm_cell_array_get_description):
	* src/gpm-screensaver.c: (gpm_screensaver_add_throttle):
	Fix some return types.

2008-02-19  Richard Hughes  <richard@hughsie.com>

	* autogen.sh:
	* configure.in:
	Rename configure.in to configure.ac

2008-02-14  Richard Hughes  <richard@hughsie.com>

	==== Version 2.21.92 ====

2008-02-03  Richard Hughes  <richard@hughsie.com>

	* src/gpm-cell.c: (gpm_cell_get_id):
	Add the forward slash, which is the thing that caused #514077.

2008-02-03  Richard Hughes  <richard@hughsie.com>

	* src/gpm-cell.c: (gpm_cell_get_id):
	Filter out invalid characters in the model and serial numbers else
	we may get an invalid id and fail to do the time profiling.
	Fixes #514077.

2008-01-27  Jaap Haitsma  <jaap@haitsma.org>

	reviewed by: Richard Hughes

	* configure.in:
	* data/gnome-power-manager.desktop.in:
	* data/gnome-power-manager.desktop.in.in:
	* data/gnome-power-preferences.desktop.in:
	* data/gnome-power-preferences.desktop.in.in:
	* data/gnome-power-statistics.desktop.in:
	* data/gnome-power-statistics.desktop.in.in:
	Automatically put version in desktop files
	Fixes bug #512267

2008-01-24  Richard Hughes  <richard@hughsie.com>

	* data/icons/clean_svg_icons.sh:
	Add a script inspired from Nicu Buculei that saves the svg files as
	plain svg and vacuumed. The size difference is pretty huge.

	* data/icons/scalable/apps/gnome-brightness-applet.svg:
	* data/icons/scalable/apps/gnome-inhibit-applet.svg:
	* data/icons/scalable/apps/gnome-power-manager.svg:
	* data/icons/scalable/status/gpm-brightness-kbd-disabled.svg:
	* data/icons/scalable/status/gpm-brightness-kbd-invalid.svg:
	* data/icons/scalable/status/gpm-brightness-lcd-disabled.svg:
	* data/icons/scalable/status/gpm-brightness-lcd-invalid.svg:
	* data/icons/scalable/status/gpm-inhibit-invalid.svg:
	* data/icons/scalable/status/gpm-phone-000.svg:
	* data/icons/scalable/status/gpm-phone-030.svg:
	* data/icons/scalable/status/gpm-phone-060.svg:
	* data/icons/scalable/status/gpm-phone-100.svg:
	Resave as plain vacuumed svg to save over 2Mb from the tarball and
	installed size.

2008-01-21  Richard Hughes  <richard@hughsie.com>

	* src/gpm-cell.c: (gpm_cell_refresh_hal_all):
	Notify if the cell capacity is zero, not >0 && <50.

2008-01-17  simon.zheng  <simon.zheng@sun.com>

	* src/gpm-prefs-core.c: (prefs_setup_battery):
	Fix #510068. Mess up checkbox widget name, let's change to the correct one.

2008-01-14  simon.zheng  <simon.zheng@sun.com>

	* src/gpm-prefs-core.c: (prefs_setup_ac), (prefs_setup_battery):
	Add shutdown to lid actions. When suspend and hibernate aren't
	supported on some systems, shutdown may be the third choice.

2008-01-07  simon.zheng  <simon.zheng@sun.com>

	* src/gpm-sound.c: (gpm_sound_play):
	Modify some typo to get correct wav file, fix #507789.

2008-01-02  Richard Hughes  <richard@hughsie.com>

	* src/gpm-cell.c: (gpm_cell_refresh_hal_all):
	HAL isn't being helpful here and setting battery.rechargeable.is_discharging
	and battery.rechargeable.is_charging without setting battery.is_rechargeable.
	Work around the brokenness here for now.

2007-12-30  Richard Hughes  <richard@hughsie.com>

	* src/gpm-main.c: (main):
	Manually poke gtk, it seems gtk_get_option_group isn't good enough any
	more. This fixes the warning:
	gtk_icon_theme_get_for_screen: assertion 'GDK_IS_SCREEN (screen)' failed

2007-12-29  simon.zheng  <simon.zheng@sun.com>

	* applets/brightness/GNOME_BrightnessApplet.server.in.in:
	* applets/brightness/Makefile.am:
	* applets/inhibit/GNOME_InhibitApplet.server.in.in:
	* applets/inhibit/Makefile.am:
	Since applet binary can't be run by users directly, move them
	from "bindir" to "libexecdir" referring to gnome-panel source.

2007-12-24  simon.zheng  <simon.zheng@sun.com>

	* src/gpm-manager.c: (gpm_manager_action_hibernate):
	When doing hibernation, event should be GPM_EVENT_HIBERNATE instead of
	GPM_EVENT_SUSPEND.

2007-12-21  Richard Hughes  <richard@hughsie.com>

	* data/gnome-power-manager.schemas.in:
	* src/gpm-conf.h:
	* src/gpm-tray-icon.c: (gpm_tray_icon_enable_context_menu),
	(gpm_tray_icon_popup_menu_cb), (conf_key_changed_cb),
	(gpm_tray_icon_init):
	Here is a gnome-power-manager patch that adds a show_context_menu gconf key.
	If we turn that off in the gdm session, we not only get rid of the
	preferences ui, but also the possibly unwanted help (brings up yelp,
	and may offer ways to bring up a browser) and about (has a link).

	Patch from Matthias Clasen <matthias.clasen@gmail.com>, many thanks.

2007-12-21  Richard Hughes  <richard@hughsie.com>

	* src/gpm-main.c: (main):
	Drop unused gnome client from main.c

	The GnomeClient usage in main.c is a noop currently (commented out
	code, and a "die" callback that does not seem useful)

	Patch from Jani Monoses <jani@ubuntu.com>, many thanks.

also do GOption parsing via gtk and drop gnome_program_init()
2007-12-21  simon.zheng  <simon.zheng@sun.com>

	* src/gpm-engine.c: (gpm_engine_recalculate_state_icon):
	Avoid printing NULL string in the case of "icon == NULL".

2007-12-16  Richard Hughes  <richard@hughsie.com>

	* configure.in:
	Post release version increment to 2.21.2

2007-12-16  Richard Hughes  <richard@hughsie.com>

	==== Version 2.21.1 ====

2007-12-14  Richard Hughes  <richard@hughsie.com>

	* applets/inhibit/inhibit-applet.c: (gpm_applet_get_icon),
	(gpm_applet_check_size), (gpm_applet_draw_cb),
	(gpm_applet_change_background_cb), (gpm_applet_click_cb),
	(watch_connection_cb), (gpm_inhibit_applet_init):
	Revert to the old version of the applet for now as mclasens patch
	causes a 100% hang on startup.

2007-12-13  simon.zheng  <simon.zheng@sun.com>

	* man/Makefile.am:
	* man/gnome-power-statistics.sgml:
	Add a new manpage for gnome-power-statistics by referring
	to gnome-power-preferences's manpage.

2007-12-12  simon.zheng  <simon.zheng@sun.com>

	* libdbus-glib/libdbus-proxy.c: (dbus_proxy_disconnect):
	Avoid printing NULL point when daemon runs in debug pattern
	without HAL.

2007-12-11  Richard Hughes  <richard@hughsie.com>

	* help/C/gnome-power-manager.xml:
	Correcting documentation policy according to the UI.
	Patch from Bob Mauchin <zebob.m@pengzone.org>, many thanks.

2007-12-11  Richard Hughes  <richard@hughsie.com>

	* help/C/gnome-power-manager.xml:
	Lots of the GConf keys are out of date or have been removed, so they
	need to be updated.
	Patch from Bob Mauchin <zebob.m@pengzone.org>, many thanks.

2007-12-11  Richard Hughes  <richard@hughsie.com>

	* help/C/gnome-power-manager.xml:
	Correct version string to:
	In GNOME Power Manager 2.16 and newer...
	Patch from Bob Mauchin <zebob.m@pengzone.org>, many thanks.

2007-12-11  Richard Hughes  <richard@hughsie.com>

	* help/Makefile.am:
	Update help/Makefile.am to reflect changes made to the documentation
	and figures.
	Patch from Bob Mauchin <zebob.m@pengzone.org>, many thanks.

2007-11-28  Rodrigo Moya <rodrigo@gnome-db.org>

	* src/gpm-notify.c (gpm_notify_sleep_failed): use _NEVER for sleep
	problems notification, so that the user can always see it.

2007-11-18  Richard Hughes  <richard@hughsie.com>

	* src/gpm-cell-array.c: (gpm_st_cell_array):
	* src/gpm-cell.c: (gpm_st_cell):
	* src/gpm-self-test.c: (gpm_st_warning):
	* src/gpm-self-test.h:
	Try to pass make distcheck on a desktop machine.

2007-11-17  Josselin Mouette <joss@malsain.org>

	reviewed by: Richard Hugues

	* configure.in: document that --enable-checkfg is for Ubuntu 
	systems, not Debian. Fixes #497328.

2007-11-16  simon.zheng  <simon.zheng@sun.com>

	* src/gpm-backlight.c: (gpm_backlight_brightness_evaluate_and_set):
	Avoid float computation error, fixes #497298.

2007-11-15  Gabor Kelemen  <kelemeng@gnome.hu>

	* src/gpm-manager.c:
	* src/gpm-inhibit.c:
	* src/gpm-info.c: Make log messages more translator/user-friendly. Fixes #474973

2007-11-14  Richard Hughes  <richard@hughsie.com>

	* src/gpm-srv-brightness-kbd.c: (button_pressed_cb):
	Use the correct enumerated type for the button press.
	From the ubuntu patch archive.

2007-11-14  Richard Hughes  <richard@hughsie.com>

	* tools/gnome-power-cmd.sh:
	Fix bashisms in the command script. From the ubuntu patch archive.

2007-11-14  Richard Hughes  <richard@hughsie.com>

	* src/gpm-graph-widget.c: (gpm_graph_widget_get_y_label_max_width),
	(gpm_graph_widget_draw_graph):
	Work out the size of the label text to avoid truncating numbers in
	other locales. Fixes #496367

2007-11-09  Richard Hughes  <richard@hughsie.com>

	* src/gpm-notify.c: (gpm_notify_inhibit_lid):
	Make the warning a bit more sane when a program has inihibited.

2007-11-09  Richard Hughes  <richard@hughsie.com>

	* src/gpm-button.c: (gpm_button_filter_x_events),
	(gpm_button_grab_keystring), (gpm_button_button_key):
	Properly process the GdkXEvent so we don't hide the GtkStatusIcon
	when we compile with --enable-xevents.
	The bug of icon not appearing happened because addition of
	notification-area-applet generates an X Event for notification-manager
	ownership change, and the bug in gpm_button_filter_x_events didn't allow
	gtktrayicon-x11.c to see the event due to the propagation stopping from
	GDK_FILTER_REMOVE being returned on all non-keypresses.
	This is a slightly modied patch from Mart Raudsepp, many thanks.
	Fixes #413360

2007-11-02  Richard Hughes  <richard@hughsie.com>

	* data/gnome-power-manager.schemas.in:
	* data/gpm-prefs.glade:
	* src/gpm-backlight.c: (gpm_backlight_brightness_evaluate_and_set):
	* src/gpm-conf.h:
	* src/gpm-prefs-core.c: (prefs_setup_battery):
	Don't have a slider for brightness reduction on battery - it confuses
	too many people. Switch to a checkbox and leave gconf for power users
	to tweak this if they want. Fixes #489176

2007-11-02  Richard Hughes  <richard@hughsie.com>

	* src/gpm-cell-array.c: (phone_device_removed_cb):
	Check to see if we have a gnome-phone-manager device before we unref
	it - I've a sneaking suspicion gnome-phone-manager is telling us
	Remove before Added at session start, although we certainly shouldn't
	crash out in this case. Hopefully fixes #484516

2007-11-02  Richard Hughes  <richard@hughsie.com>

	* configure.in:
	Post release version increment - better late than never.

2007-11-01  Richard Hughes  <richard@hughsie.com>

	* src/Makefile.am:
	Fix make distcheck... OOps.

2007-11-01  Richard Hughes  <richard@hughsie.com>

	* docs/dbus-interface.html:
	* src/Makefile.am:
	* src/gpm-light-sensor.c: (gpm_light_sensor_get_absolute),
	(gpm_light_sensor_calibrate), (gpm_light_sensor_get_relative),
	(gpm_light_sensor_finalize), (gpm_light_sensor_has_hw),
	(gpm_light_sensor_poll_cb), (gpm_light_sensor_init):
	* src/gpm-self-test.c: (main):
	* src/gpm-webcam.c:
	* src/gpm-webcam.h:
	Rip out GpmWebcam - it's pretty crack, and I'm getting some odd
	bugreports about flashing webcam lights and brightness levels changing.

2007-10-16  Richard Hughes  <richard@hughsie.com>

	* src/gpm-manager.c: (idle_do_sleep):
	Always pass an error into gpm_control_ functions, else we can't detect
	if the method failed or if it just timed out.
	Patch from David Zeuthen, many thanks.

2007-10-13  Richard Hughes  <richard@hughsie.com>

	* src/gpm-manager.c: (gpm_manager_action_suspend),
	(gpm_manager_action_hibernate), (manager_policy_do),
	(gpm_manager_suspend), (gpm_manager_hibernate),
	(gpm_manager_reboot), (gpm_manager_shutdown), (idle_do_sleep),
	(idle_changed_cb):
	Check for inhibit in more places. Needed for gnome-packagekit work.

2007-10-05  Richard Hughes  <richard@hughsie.com>

	* applets/inhibit/inhibit-applet.c: (gpm_applet_uninhibit),
	(gpm_applet_set_icon), (gpm_applet_check_size),
	(gpm_applet_draw_cb), (gpm_applet_change_background_cb),
	(gpm_applet_click_cb), (watch_connection_cb),
	(gpm_inhibit_applet_init):
	Apply a patch from Matthias Clasen to improve the icon drawing.
	Slightly modified by me. Fixes #483826.

2007-10-05  Richard Hughes  <richard@hughsie.com>

	* src/gpm-manager.c: (gpm_manager_action_suspend),
	(gpm_manager_action_hibernate), (idle_do_sleep):
	Apply a patch from David Zeuthen:
	OK, so it turns out we're getting a D-Bus timeout. Actually g-p-m got
	codepaths to handle this but the call site passes NULL for the
	GError so we never get to examine this and properly handle timeouts.
	This patch takes care of that. I've tested and it works. Fixes rh:312761

2007-10-05  Richard Hughes  <richard@hughsie.com>

	* libhal-glib/libhal-gpower.c: (hal_gpower_suspend),
	(hal_gpower_pm_method_void), (hal_gpower_enable_power_save):
	* src/gpm-brightness-lcd.c: (gpm_brightness_lcd_get_hw),
	(gpm_brightness_lcd_set_hw):
	Use the correct DBUS return types now HAL enforces the return type.
	Based on a patch from David Zeuthen. Many thanks.

2007-09-17  Richard Hughes  <richard@hughsie.com>

	==== Version 2.20.0 ====

2007-09-13  Alex Jones  <alex@weej.com>

	reviewed by: Richard Hughes

	* applets/inhibit/GNOME_InhibitApplet.server.in.in,
	* applets/brightness/GNOME_BrightnessApplet.server.in.in:
	Add bonobo:environment and bugzilla:other_binaries oaf attributes.
	Fixes Bug 470481 – Inhibit applet does not work after first login.

2007-09-06  Richard Hughes  <richard@hughsie.com>

	* src/gpm-profile.c: (gpm_profile_delete_data),
	(gpm_profile_load_data):
	Fix a build error pointed out by Ken VanDine.

2007-09-04  Richard Hughes  <richard@hughsie.com>

	==== Version 2.19.92 ====

2007-08-21  Richard Hughes  <richard@hughsie.com>

	* src/gdb-efence.gdb:
	* src/gdb-underfence.gdb:
	* src/valgrind.supp:
	Add some checker scripts.

2007-08-21  Richard Hughes  <richard@hughsie.com>

	* help/C/gnome-power-manager.xml:
	Correct a lot of grammar mistakes. Fixes #468509
	Patch from Bruce Cowan <bruce.cowan@dsl.pipex.com>, many thanks.

2007-08-21  Richard Hughes  <richard@hughsie.com>

	* src/gpm-main.c: (main):
	Make this description proper English.

	* src/gpm-info.c: (gpm_statistics_get_data_types),
	(gpm_statistics_get_event_log), (gpm_statistics_get_data):
	List the time before the accuracy for clarity.

	* src/gpm-statistics-core.c:
	Rework the descriptions to fix #468825

2007-08-19  Richard Hughes  <richard@hughsie.com>

	* src/gpm-prefs.c:
	* src/gpm-statistics.c:
	We have to use gtk_init with the new tooltip API.

2007-08-15  Stéphane Raimbault  <stephane.raimbault@gmail.com>

	* data/gnome-power-manager.schemas.in:
	Typo 'the the'. Fixes bug #467094

2007-08-15  Richard Hughes  <richard@hughsie.com>

	* po/POTFILES.in:
	Make check work again by removing removed files.

	* data/Makefile.am:
	Make intltool a little happier.

	* src/gdb-gpm.sh:
	* src/massif-gpm.sh:
	* src/profile-gpm.sh:
	* src/valgrind-gpm.sh:
	* src/run-gpm.sh:
	Move into one tool.

2007-08-14  Jaap Haitsma  <jaap@haitsma.org>

	* applets/brightness/Makefile.am:
	* applets/brightness/brightness-applet.h: 
	* applets/brightness/brightness-applet.c:
	(gpm_applet_update_tooltip), (gpm_brightness_applet_init):
	Removed brightness-applet.h as we do not need to export anything.
	Use new tooltip object of GTK 2.12
 
	* applets/inhibit/Makefile.am:
	* applets/inhibit/inhibit-applet.h:
	* applets/inhibit/inhibit-applet.c: (gpm_applet_update_tooltip),
	(gpm_inhibit_applet_init):
	Removed inhibit-applet.h as we do not need to export anything.
	Use new tooltip object of GTK 2.12

	* configure.in: bump GTK requirement to 2.11 and glib to 2.13
	Fixes bug #462347

2007-08-14  Jaap Haitsma  <jaap@haitsma.org>

	* MAINTAINERS: Update to new format

2007-08-03  Jani Monoses  <jani@ubuntu.com>

	* src/gpm-notify.c:
	Replace gnome_url_show() with calls to gnome-open or xdg-open.
	* src/gpm-common.h:
	* src/gpm-common.c:
	* src/gpm-statistics.c:
	* src/gpm-prefs.c:
	* src/gpm-tray-icon.c:
	Replace gnome_help_display() with calls to gnome-open.
	* src/gpm-statistics.c:
	* src/gpm-prefs.c:
	* src/gpm-self-test.c:
	* test/gpm-inhibit-test.c:
	Drop gnome_program_init(), handle "destroy" signal in the test window.

2007-07-31  Richard Hughes  <richard@hughsie.com>

	* src/gpm-stock-icons.h:
	Use the correct icon for the right click drop down.

2007-07-31  Jaap Haitsma  <jaap@haitsma.org>

	* src/gpm-cell-array.c: (gpm_st_cell_array): make "make distcheck" work
	on laptop with multiple batteries. Fixes bug #462109

2007-07-31  Jaap Haitsma  <jaap@haitsma.org>

	* data/gnome-power-preferences.desktop.in:
	* data/sounds/Makefile.am:
	Oops missed something more of previous two commits

2007-07-31  Jaap Haitsma  <jaap@haitsma.org>

	* src/gpm-stock-icons.c: deleted not needed anymore
	* src/gpm-stock-icons.h: removed function prototypes

2007-07-31  Jaap Haitsma  <jaap@haitsma.org>

	* applets/brightness/GNOME_BrightnessApplet.server.in.in:
	* applets/brightness/Makefile.am:
	* applets/brightness/brightness-applet.c:
	(gpm_brightness_applet_init):
	* applets/inhibit/GNOME_InhibitApplet.server.in.in:
	* applets/inhibit/Makefile.am:
	* applets/inhibit/inhibit-applet.c: (gpm_inhibit_applet_init):
	* configure.in:
	* data/gnome-power-manager.desktop.in:
	* data/gnome-power-statistics.desktop.in:
	* data/icons/16x16/Makefile.am:
	* data/icons/16x16/actions/Makefile.am:
	* data/icons/16x16/apps/Makefile.am:
	* data/icons/16x16/status/Makefile.am:
	* data/icons/22x22/Makefile.am:
	* data/icons/22x22/actions/Makefile.am:
	* data/icons/22x22/apps/Makefile.am:
	* data/icons/22x22/status/Makefile.am:
	* data/icons/24x24/Makefile.am:
	* data/icons/24x24/actions/Makefile.am:
	* data/icons/24x24/apps/Makefile.am:
	* data/icons/24x24/status/Makefile.am:
	* data/icons/48x48/Makefile.am:
	* data/icons/48x48/actions/Makefile.am:
	* data/icons/48x48/apps/Makefile.am:
	* data/icons/48x48/status/Makefile.am:
	* data/icons/generate_24x24_icons.sh:
	* data/icons/generate_48x48_icons.sh:
	* data/icons/scalable/Makefile.am:
	* data/icons/scalable/actions/Makefile.am:
	* data/icons/scalable/apps/Makefile.am:
	* data/icons/scalable/apps/gnome-brightness-applet.svg:
	* data/icons/scalable/apps/gnome-inhibit-applet.svg:
	* data/icons/scalable/apps/gnome-power-manager.svg:
	* data/icons/scalable/gpm-brightness-kbd-disabled.svg:
	* data/icons/scalable/gpm-brightness-kbd-invalid.svg:
	* data/icons/scalable/gpm-brightness-lcd-disabled.svg:
	* data/icons/scalable/gpm-brightness-lcd-invalid.svg:
	* data/icons/scalable/gpm-inhibit-invalid.svg:
	* data/icons/scalable/gpm-phone-000.svg:
	* data/icons/scalable/gpm-phone-030.svg:
	* data/icons/scalable/gpm-phone-060.svg:
	* data/icons/scalable/gpm-phone-100.svg:
	* data/icons/scalable/status/Makefile.am:
	* src/Makefile.am:
	* src/gpm-main.c: (gpm_exit), (main):
	* src/gpm-stock-icons.c:
	* src/gpm-stock-icons.h:
	Use application specific icons in the recommended way. Fixes bug #449274

2007-07-30  Jaap Haitsma  <jaap@haitsma.org>

	* applets/brightness/GNOME_BrightnessApplet.xml:
	* applets/inhibit/GNOME_InhibitApplet.xml:
	Use gtk-about icon i.s.o. deprecated gnome-stock-about

2007-07-29  Richard Hughes  <richard@hughsie.com>

	* configure.in: Post release bump to 2.19.7

2007-07-29  Richard Hughes  <richard@hughsie.com>

	==== Version 2.19.6 ====

2007-07-29  Richard Hughes  <richard@hughsie.com>

	* src/gpm-phone.c: (gpm_st_phone):
	Connecting the phone for the self test requires manual intervention,
	it's not automatic.

2007-07-26  Richard Hughes  <richard@hughsie.com>

	* src/gpm-brightness-lcd.c: (gpm_brightness_lcd_set_hw),
	(gpm_brightness_lcd_dim_hw_step), (gpm_brightness_lcd_dim_hw),
	(gpm_brightness_lcd_get), (gpm_brightness_lcd_up),
	(gpm_brightness_lcd_down), (gpm_brightness_lcd_init):
	Try to discover the laptop backlight type by checking the backlight
	state before we try and set it. Fixes #436717
	If this breaks for people with 2.19.6, I'll revert it for 2.20.

2007-07-26  Richard Hughes  <richard@hughsie.com>

	* src/gpm-phone.c: (gpm_phone_num_batteries_changed):
	Ignore second coldplug, which can happen if you run make check and
	g-p-m at the same time.

2007-07-26  Richard Hughes  <richard@hughsie.com>

	* data/gpm-feedback-widget.glade:
	* src/gpm-feedback-widget.c: (gpm_feedback_show),
	(gpm_feedback_display_value):
	Apply a patch from Cosimo Cecchi <anarki@lilik.it> to fix the position
	and the style of the brightness widget. Fixes #405421

2007-07-26  Richard Hughes  <richard@hughsie.com>

	* data/gnome-power-manager.schemas.in:
	* src/gpm-conf.h:
	* src/gpm-control.c: (gpm_control_suspend),
	(gpm_control_hibernate):
	Split up the lock/gnome_keyring options into lock/gnome_keyring_suspend
	and lock/gnome_keyring_hibernate to fix #459747.
	We default to off for suspend and on for hibernate.

2007-07-25  Richard Hughes  <richard@hughsie.com>

	* data/icons/scalable/gpm-phone-000.svg:
	* data/icons/scalable/gpm-phone-030.svg:
	* data/icons/scalable/gpm-phone-060.svg:
	* data/icons/scalable/gpm-phone-100.svg:
	Better hi-res icons.

2007-07-25  Richard Hughes  <richard@hughsie.com>

	* src/gpm-cell-array.c: (gpm_cell_array_get_description):
	* src/gpm-cell.c: (gpm_cell_set_phone_index),
	(phone_device_refresh_cb):
	Monitor phone AC state, so we can put the charging state in the tooltip.

2007-07-25  Richard Hughes  <richard@hughsie.com>

	* src/gpm-cell-unit.c: (gpm_cell_unit_get_kind_localised):
	Correct title case in mobile phone text.

2007-07-25  Richard Hughes  <richard@hughsie.com>

	* src/gpm-cell.c: (gpm_cell_refresh_hal_all),
	(hal_device_property_modified_cb), (gpm_cell_set_type),
	(gpm_cell_set_hal_udi), (gpm_cell_set_phone_index),
	(gpm_cell_get_icon), (gpm_cell_print), (gpm_cell_get_description),
	(phone_device_refresh_cb), (gpm_cell_init), (gpm_cell_finalize):
	* src/gpm-phone.c: (gpm_phone_coldplug), (gpm_phone_get_present),
	(gpm_phone_get_percentage), (gpm_phone_get_on_ac),
	(gpm_phone_get_num_batteries), (gpm_phone_battery_state_changed),
	(gpm_phone_num_batteries_changed), (gpm_phone_dbus_connect),
	(gpm_phone_dbus_disconnect), (phone_device_refresh_cb),
	(gpm_st_phone):
	Add in checks for the object type, and also remember to disconnect the
	signal when GpmCell is unref'ed, else we segfault on phone connect,
	disconnect, connect.

2007-07-25  Richard Hughes  <richard@hughsie.com>

	* src/gpm-cell.c: (phone_device_refresh_cb):
	Correct the function type to correct a crash.

2007-07-25  Richard Hughes  <richard@hughsie.com>

	* src/gpm-manager.c: (manager_policy_do):
	Pass the reason on. Needed to debug #456489

2007-07-25  Richard Hughes  <richard@hughsie.com>

	* libhal-glib/libhal-gpower.c: (hal_gpower_filter_error),
	(hal_gpower_suspend), (hal_gpower_pm_method_void):
	Fix a potential crasher after resume.

2007-07-25  Richard Hughes  <richard@hughsie.com>

	* src/gpm-cell-array.c: (gpm_cell_array_update),
	(phone_device_added_cb):
	Only do the percentage override if we have enough data on a primary
	battery. Pretty major bugfix, not sure why we haven't hit this.

	* src/gpm-cell-unit.c: (gpm_cell_unit_get_icon),
	(gpm_cell_unit_get_kind_localised):
	Use the percentage, not the charge level. Also add translation.

	* src/gpm-cell.c: (gpm_cell_refresh_hal_all),
	(hal_device_property_modified_cb), (gpm_cell_set_hal_udi),
	(gpm_cell_set_phone_index), (phone_device_refresh_cb):
	* src/gpm-cell.h:
	Support the correct methods to update the icon when the phone device
	changes.

2007-07-25  Richard Hughes  <richard@hughsie.com>

	* src/Makefile.am:
	* src/gpm-cell.c:
	* src/gpm-cell-array.c: (gpm_cell_array_index_udi),
	(gpm_cell_array_coldplug), (phone_device_added_cb),
	(phone_device_removed_cb), (gpm_cell_array_init),
	(gpm_cell_array_finalize):
	Add support for GpmPhone devices. These show as laptop batteries for
	now, soon to be fixed.

	* src/gpm-marshal.list:
	* src/gpm-phone.c: (gpm_phone_coldplug),
	(gpm_phone_battery_state_changed),
	(gpm_phone_num_batteries_changed), (gpm_phone_class_init),
	(gpm_phone_dbus_connect), (gpm_phone_dbus_disconnect),
	(gpm_st_mainloop_wait), (gpm_st_phone):
	Listen for the correct signals, and add the correct GpmCell device.

	* src/gpm-self-test.c: (main):
	* src/gpm-self-test.h:
	Add the phone self-checks.

2007-07-24  Richard Hughes  <richard@hughsie.com>

	* applets/inhibit/inhibit-applet.c:
	(gpm_inhibit_applet_dbus_disconnect):
	Drop the inhibit when gnome-power-manager disconnects from the bus.

2007-07-24  Richard Hughes  <richard@hughsie.com>

	* src/gpm-cell.c: (gpm_st_cell):
	Fix a memory leak. 14 bytes.

	* src/gpm-main.c: (main):
	Don't unref the context, it makes valgrind unhappy.

	* src/gpm-profile.c: (gpm_profile_delete_data),
	(gpm_profile_load_data), (gpm_st_profile):
	Add some more tests.

2007-07-24  Richard Hughes  <richard@hughsie.com>

	* src/gpm-profile.c: (gpm_profile_get_nonzero_accuracy_percent),
	(gpm_profile_save_percentage), (gpm_profile_delete_data),
	(gpm_profile_use_guessing), (gpm_profile_init), (reset_profile),
	(gpm_st_profile):
	* src/gpm-profile.h:
	* src/gpm-self-test.c: (main):
	Fix the profile test. Also default to estimating the 5-95% data for
	unknown profile data.

2007-07-23  Richard Hughes  <richard@hughsie.com>

	* po/POTFILES.skip:
	The following files contain translations and are currently not in use.
	Please consider adding these to the POTFILES.in file, located in the
	po/ directory:
		applets/brightness/GNOME_BrightnessApplet.server.in
		applets/inhibit/GNOME_InhibitApplet.server.in

2007-07-23  Richard Hughes  <richard@hughsie.com>

	* src/gpm-self-test.c:
	* src/gpm-self-test.h:
	Oops. Actually add the main files.

2007-07-23  Richard Hughes  <richard@hughsie.com>

	* src/Makefile.am:
	* src/gpm-phone.c:
	* src/gpm-phone.h:
	Add initial gnome-phone-manager support. Untested.

2007-07-23  Richard Hughes  <richard@hughsie.com>

	* src/gpm-cell-array.c: (gpm_cell_array_add_hal_udi),
	(gpm_cell_array_coldplug), (hal_new_capability_cb),
	(hal_device_added_cb):
	* src/gpm-cell.c: (gpm_cell_set_type), (gpm_cell_set_hal_udi),
	(gpm_st_cell):
	* src/gpm-cell.h:
	Rename some methods to allow gnome-phone-manager integration.

2007-07-23  Richard Hughes  <richard@hughsie.com>

	* po/POTFILES.in:
	* src/Makefile.am:
	* src/gpm-array-float.c: (gpm_st_array_float):
	* src/gpm-array.c: (gpm_st_array):
	* src/gpm-cell-array.c: (gpm_cell_array_perhaps_recall_cb),
	(gpm_st_cell_array):
	* src/gpm-cell-unit.c: (gpm_st_cell_unit):
	* src/gpm-cell.c: (gpm_cell_perhaps_recall_cb),
	(gpm_cell_get_battery), (gpm_st_cell):
	* src/gpm-common.c: (gpm_st_common):
	* src/gpm-graph-widget.c: (close_handler), (clicked_passed_cb),
	(clicked_failed_cb), (create_graph_window), (wait_for_input),
	(gpm_st_title_graph), (gpm_st_graph_widget):
	* src/gpm-inhibit.c: (inhibit), (uninhibit), (has_inhibit),
	(gpm_st_inhibit):
	* src/gpm-profile.c: (gpm_st_profile):
	* src/gpm-webcam.c: (gpm_st_webcam):
	* test/Makefile.am:
	* test/gpm-selftest-hal-devices.fdi:
	* test/gpm-st-array-float.c:
	* test/gpm-st-array.c:
	* test/gpm-st-cell-array.c:
	* test/gpm-st-cell-unit.c:
	* test/gpm-st-cell.c:
	* test/gpm-st-common.c:
	* test/gpm-st-graph-widget.c:
	* test/gpm-st-inhibit.c:
	* test/gpm-st-main.c:
	* test/gpm-st-main.h:
	* test/gpm-st-profile.c:
	* test/gpm-st-webcam.c:
	* test/install-fdi.sh:
	Move the tests into src/ to be able to to run make check.

2007-07-23  Richard Hughes  <richard@hughsie.com>

	* data/icons/48x48/Makefile.am:
	* data/icons/scalable/Makefile.am:
	* data/icons/scalable/gpm-phone-000.svg:
	* data/icons/scalable/gpm-phone-030.svg:
	* data/icons/scalable/gpm-phone-060.svg:
	* data/icons/scalable/gpm-phone-100.svg:
	More icons...

2007-07-23  Richard Hughes  <richard@hughsie.com>

	* data/icons/24x24/Makefile.am:
	More phone icons.

2007-07-23  Richard Hughes  <richard@hughsie.com>

	* data/icons/16x16/Makefile.am:
	* data/icons/22x22/Makefile.am:
	Add some more phone icons.

	* src/gpm-control.c: (gpm_control_shutdown), (gpm_control_suspend),
	(gpm_control_hibernate):
	Only do gpm_control_convert_hal_error if false.

2007-07-22  Richard Hughes  <richard@hughsie.com>

	* src/gpm-control.c: (gpm_control_convert_hal_error),
	(gpm_control_shutdown), (gpm_control_suspend),
	(gpm_control_hibernate):
	Convert the HAL error to a localised error to avoid a crash in GDM.

2007-07-22  Richard Hughes  <richard@hughsie.com>

	* libhal-glib/libhal-gpower.c: (hal_gpower_suspend),
	(hal_gpower_pm_method_void), (hal_gpower_enable_power_save):
	Be more careful with errors. retval != 0 doesn't mean that an error
	is set.

2007-07-21  Richard Hughes  <richard@hughsie.com>

	* data/gnome-power-manager.schemas.in:
	* src/gpm-manager.c: (idle_changed_cb):
	* src/gpm-srv-screensaver.c: (update_lid_throttle):
	Remove a broken string that we don't ever use. Fixes #459099

	* src/gpm-profile.c: (gpm_profile_save_percentage):
	* test/gpm-st-profile.c: (gpm_st_profile):
	Add some more tests.

2007-07-20  Gabor Kelemen  <kelemeng@gnome.hu>

	* src/gpm-info.c:
	Add translator comment before the occurrences of the Q_ macro.
	Fixes #458609.

2007-07-20  Richard Hughes  <richard@hughsie.com>

	* src/gpm-notify.c: (gpm_notify_low_capacity):
	Correct some broken UI test. Invalid isn't a great word to use.

2007-07-20  Richard Hughes  <richard@hughsie.com>

	* src/gpm-info.c: (gpm_statistics_get_parameters):
	Correct some broken UI text. Fixes #458613

2007-07-20  Richard Hughes  <richard@hughsie.com>

	* src/gpm-profile.c: (gpm_profile_print),
	(gpm_test_profile_save_percentage):
	OOps. Don't recurse.

	* test/gpm-st-main.c: (main):
	* test/gpm-st-profile.c: (gpm_st_profile):
	Correct test, and make more specific. Test now passes.

2007-07-19  Richard Hughes  <richard@hughsie.com>

	* src/gpm-profile.c: (gpm_profile_print),
	(gpm_profile_get_data_time_percent),
	(gpm_profile_set_zero_accuracy_average),
	(gpm_profile_set_average_no_accuracy),
	(gpm_profile_save_percentage), (gpm_test_profile_save_percentage),
	(gpm_profile_test_force_discharging):
	* src/gpm-profile.h:
	Add new functionality. It doesn't work.

2007-07-19  Richard Hughes  <richard@hughsie.com>

	* libhal-glib/libhal-gpower.c: (hal_gpower_enable_power_save):
	Don't unref the error, we pass it back.

2007-07-19  Richard Hughes  <richard@hughsie.com>

	* src/gpm-info.c: (gpm_statistics_get_parameters):
	* src/gpm-profile.c: (gpm_profile_get_data_time_percent):
	Correct the colours to be more bold, and support the extrapolated data.

2007-07-19  Richard Hughes  <richard@hughsie.com>

	* test/gpm-st-main.c: (main):
	Rearrange some tests.

2007-07-19  Richard Hughes  <richard@hughsie.com>

	* src/gpm-engine.c: (gpm_engine_get_summary):
	Add better wording when accuracy is truely zero.

2007-07-19  Richard Hughes  <richard@hughsie.com>

	* help/C/gnome-power-manager.xml:
	* src/gpm-main.c:
	* src/gpm-prefs.c:
	* src/gpm-statistics.c:
	* test/gpm-inhibit-test.c:
	* tools/gnome-power-cmd.sh:
	Update some more API to match the docs.

2007-07-18  William Jon McCann  <mccann@jhu.edu>

	* data/gnome-power-manager.service.in (Name):
	Use the service name from the spec so we can activate
	in gdm greeter.

2007-07-18  Richard Hughes  <richard@hughsie.com>

	* src/gpm-main.c: (main):
	Log to syslog if name is already taken.

2007-07-18  Richard Hughes  <richard@hughsie.com>

	* src/gpm-debug.c: (gpm_syslog_internal), (gpm_error_real):
	Log to syslog when we exit because of an error.

2007-07-18  Richard Hughes  <richard@hughsie.com>

	* src/gpm-main.c: (main):
	Temporarily don't do the system bus check for gdm session activation.

2007-07-18  Richard Hughes  <richard@hughsie.com>

	* src/gpm-control.c: (gpm_control_reboot):
	Typo buildfix.

2007-07-18  Richard Hughes  <richard@hughsie.com>

	* libhal-glib/libhal-gpower.c: (hal_gpower_suspend),
	(hal_gpower_pm_method_void), (hal_gpower_hibernate),
	(hal_gpower_shutdown), (hal_gpower_reboot):
	* libhal-glib/libhal-gpower.h:
	* src/gpm-control.c: (gpm_control_shutdown), (gpm_control_reboot),
	(gpm_control_suspend), (gpm_control_hibernate):
	Propogate the error from hal to the session DBUS.

	* src/gpm-profile.c: (gpm_profile_get_nonzero_accuracy_percent),
	(gpm_profile_set_zero_accuracy_average),
	(gpm_profile_save_percentage):
	Try setting profile code from average. Nothing works yet.

2007-07-18  Richard Hughes  <richard@hughsie.com>

	* src/gpm-cell-array.c: (control_sleep_action_cb),
	(gpm_cell_array_init), (gpm_cell_array_finalize):
	Rescan the cell array when we resume as the primary battery may have
	been changed or removed. This hopefully fixes the big where the wrong
	profile is used when the battery is swapped whilst hibernating.

	* src/gpm-profile.c: (gpm_profile_init):
	Cosmetic whitespace fix.

	* test/gpm-st-main.c: (main):
	Uncomment the test so we do the whole suite.

2007-07-18  Richard Hughes  <richard@hughsie.com>

	* applets/inhibit/inhibit-applet.c:
	* applets/inhibit/inhibit-applet.h:
	Cosmetic changes.

	* applets/brightness/brightness-applet.c:
	* applets/brightness/brightness-applet.h:
	Watch the session bus for g-p-m, which prevents a race at startup.

	* applets/inhibit/Makefile.am:
	* data/icons/16x16/Makefile.am:
	* data/icons/22x22/Makefile.am:
	* data/icons/24x24/Makefile.am:
	* data/icons/48x48/Makefile.am:
	* data/icons/scalable/Makefile.am:
	* data/icons/scalable/gpm-inhibit-invalid.svg:
	* docs/icon-naming.txt:
	Add another icon to signify the inhibit applet is unable to connect.

2007-07-16  Richard Hughes  <richard@hughsie.com>

	* docs/icon-naming.txt:
	* src/gpm-cell-array.c: (gpm_cell_array_get_description):
	* src/gpm-cell-unit.c: (gpm_cell_unit_get_icon),
	(gpm_cell_unit_get_kind_string), (gpm_cell_unit_set_kind):
	* src/gpm-cell-unit.h:
	* src/gpm-engine.c: (gpm_engine_delayed_refresh),
	(gpm_engine_get_summary), (gpm_engine_get_icon), (gpm_engine_init),
	(gpm_engine_start), (gpm_engine_finalize):
	* src/gpm-engine.h:
	* src/gpm-manager.c: (gpm_engine_charge_low_cb),
	(gpm_engine_charge_critical_cb):
	* src/gpm-tray-icon.c: (gpm_tray_icon_activate_cb):
	* src/gpm-warnings.c: (gpm_warnings_get_state):
	* test/gpm-st-idletime.c: (gpm_st_idletime):
	* test/gpm-st-main.c: (main):
	Add the initial phone code for mobile phone support.
	No backend stuff yet, I need to write the backend stuff before it will
	work.

2007-07-16  Richard Hughes  <richard@hughsie.com>

	* src/gpm-info.c: (gpm_statistics_get_parameters):
	Add the guessed data into the key.

	* src/gpm-sound.c: (gpm_sound_init):
	Fix the build. Fixes #457414.

2007-07-12  Bastien Nocera  <hadess@hadess.net>

	* src/gpm-sound.c: (gpm_sound_play), (gpm_sound_init):
	Try to use gconfaudiosink, and set the profile, so that
	right output is used when playing an alert sound, use
	g_build_filename to create the URI for playbin to play

2007-07-10  Richard Hughes  <richard@hughsie.com>

	* src/gpm-backlight.c: (idle_changed_cb):
	Don't show the brightness UI on idle dim. Fixes #455148

2007-07-10  Theppitak Karoonboonyanan  <thep@linux.thai.net>

	* src/gpm-notify.c: (gpm_notify_sleep_failed):
	Add translation comment for "quirk website". Fixes #455499.

2007-07-09  Richard Hughes  <richard@hughsie.com>

	* Makefile.am:
	* configure.in:
	* libidletime/Makefile.am:
	* libidletime/libidletime.c:
	* libidletime/libidletime.h:
	* test/Makefile.am:
	* test/gpm-st-idletime.c:
	* test/gpm-st-main.c: (gpm_st_success), (main):
	* test/gpm-st-main.h:
	Add libidletime for querying IDLETIME.

2007-07-05  Richard Hughes  <richard@hughsie.com>

	* src/gpm-profile.c: (control_sleep_action_cb), (gpm_profile_init),
	(gpm_profile_finalize):
	Use GpmControl to notify GpmProfile when a suspend is about to happen,
	or when it has just happened so the data valid flag is made false.
	This stops oddball readings where the percentage time is used when
	the machine is a sleep state. The profile code now waits for the start
	of the next complete percentage point. Fixes #453853
	Many thanks to Christopher Halse Rogers for the excellent debugging.

	* test/Makefile.am:
	Now we are using gpm-control in gpm-profile, pull it in as a dep.

2007-07-05  Richard Hughes  <richard@hughsie.com>

	* src/gpm-manager.c: (gpm_manager_finalize):
	Fix a small memory leak on exit.

2007-07-04  Richard Hughes  <richard@hughsie.com>

	* src/gpm-profile.c:
	* src/gpm-tray-icon.c:
	Remove duplicate includes.

2007-07-04  Richard Hughes  <richard@hughsie.com>

	* configure.in: Post release bump to 2.19.6

2007-07-04  Richard Hughes  <richard@hughsie.com>

	==== Version 2.19.5 ====

2007-07-04  Richard Hughes  <richard@hughsie.com>

	* test/gpm-st-main.c: (main):
	Don't mark text translatable. This program is not installed, and is not
	used by end users. Fixes #453721

2007-07-04  Richard Hughes  <richard@hughsie.com>

	* src/gpm-cell-unit.h:
	Lower the value of GPM_CELL_UNIT_MIN_CHARGED_PERCENTAGE to 60 to cope
	with really broken batteries, or when using smapi-tools. Fixes #411932

2007-07-04  Richard Hughes  <richard@hughsie.com>

	* src/gpm-notify.c: (notify_general_clicked_cb),
	(gpm_notify_perhaps_recall), (gpm_notify_sleep_failed):
	Provide a link to the quirk self-help site when sleep fails.
	Fixes #442425

2007-07-04  Richard Hughes  <richard@hughsie.com>

	* help/C/gnome-power-manager.xml:
	Fix power units confusion. Fixes #423289

2007-07-04  Richard Hughes  <richard@hughsie.com>

	* data/sounds/gpm-suspend-failure.wav:
	Use a more professional warning sound. Fixes #406144

2007-07-01  Richard Hughes  <richard@hughsie.com>

	* src/gpm-array-float.c: (gpm_array_float_free):
	* src/gpm-main.c: (main):
	* test/gpm-st-array-float.c: (gpm_st_array_float):
	* test/gpm-st-cell-array.c: (gpm_st_cell_array):
	* test/gpm-st-cell.c: (gpm_st_cell):
	* test/gpm-st-hal-device.c: (gpm_st_hal_device):
	Fix some memory leaks.

2007-07-01  Richard Hughes  <richard@hughsie.com>

	* libdbus-glib/libdbus-proxy.c: (dbus_proxy_connect),
	(dbus_proxy_disconnect), (dbus_proxy_get_proxy):
	* libhal-glib/libhal-gpower.c: (hal_gpower_has_support):
	* src/gpm-array.c: (gpm_array_get):
	Don't push debugging text to stderr.

	* src/gpm-inhibit.c: (gpm_inhibit_error_quark),
	(gpm_inhibit_un_inhibit):
	* src/gpm-inhibit.h:
	Set an error when we return false for the UnInhibit.

	* test/gpm-st-array-float.c: (gpm_st_array_float):
	* test/gpm-st-array.c: (gpm_st_array):
	* test/gpm-st-cell-array.c: (gpm_st_cell_array):
	* test/gpm-st-cell-unit.c: (gpm_st_cell_unit):
	* test/gpm-st-cell.c: (gpm_st_cell):
	* test/gpm-st-common.c: (gpm_st_common):
	* test/gpm-st-graph-widget.c: (clicked_passed_cb),
	(clicked_failed_cb), (gpm_st_title_graph), (gpm_st_graph_widget):
	* test/gpm-st-hal-device.c: (gpm_st_hal_device):
	* test/gpm-st-hal-devicestore.c: (gpm_st_hal_devicestore):
	* test/gpm-st-hal-manager.c: (gpm_st_hal_manager):
	* test/gpm-st-hal-power.c: (gpm_st_hal_power):
	* test/gpm-st-inhibit.c: (uninhibit), (gpm_st_inhibit):
	* test/gpm-st-main.c: (gpm_st_start), (gpm_st_end), (gpm_st_title),
	(gpm_st_success), (gpm_st_failed), (gpm_st_run_test), (main):
	* test/gpm-st-main.h:
	* test/gpm-st-profile.c: (gpm_st_profile):
	* test/gpm-st-proxy.c: (gpm_st_proxy):
	* test/gpm-st-webcam.c: (gpm_st_webcam):
	Try a better infrastructure for the self tests. It's better. Trust me.

2007-06-29  Richard Hughes  <richard@hughsie.com>

	* data/gnome-power-manager.schemas.in:
	* src/gpm-conf.h:
	* src/gpm-inhibit.c: (gpm_inhibit_inhibit),
	(gpm_inhibit_un_inhibit):
	* src/gpm-manager.c: (manager_policy_do), (has_inhibit_changed_cb),
	(gpm_manager_init):
	* src/gpm-notify.c: (gpm_notify_inhibit_lid):
	* src/gpm-notify.h:
	* src/gpm-stock-icons.h:
	Add functionality so that g-p-m warns the user when manually inhibited
	and the lid action on battery is suspend or hibernate. Fixes #452244

2007-06-26  Richard Hughes  <richard@hughsie.com>

	* src/gpm-webcam.c: (gpm_webcam_get_brightness):
	If the webcam brightness capture fails we exit because the image
	generated in ~/.gnome2/gnome-power-manager/webcam.png has zero length.
	Patch by nadir@users.sourceforge.net, many thanks. Fixes #451241.

2007-06-25  Richard Hughes  <richard@hughsie.com>

	* src/gpm-engine.c: (gpm_engine_get_summary):
	Don't mention profiles (instead use 'time'), and remove the warning as
	users are not going to know what to do. Fixes #450362

2007-06-25  Richard Hughes  <richard@hughsie.com>

	* src/gpm-array.c: (gpm_array_add):
	Don't do crazy things when adding points. We already do clever things
	to remove points, so just add them.

	* src/gpm-statistics-core.c: (gpm_statistics_refresh_data):
	Increase the size of the gaussian array to further smooth the data.

	* test/gpm-st-array.c: (gpm_st_array):
	Correct a typo. We should never not add, even when zero.

2007-06-25  Richard Hughes  <richard@hughsie.com>

	* src/gpm-profile.c: (gpm_profile_register_percentage):
	Don't try to save the 100% profile point, which can happen the moment
	the percentage charge hits 100% from 99% a split second before being
	marked as non-discharging.

2007-06-24  Richard Hughes  <richard@hughsie.com>

	* test/gpm-selftest-hal-devices.fdi:
	Match on any primary battery, rather than a specific UDI.

2007-06-24  Richard Hughes  <richard@hughsie.com>

	* test/gpm-st-graph-widget.c: (gpm_st_graph_widget):
	* test/gpm-st-main.c: (main):
	Don't stop running the interactive test after the graph check.

2007-06-24  Richard Hughes  <richard@hughsie.com>

	* src/gpm-graph-widget.c:
	Fix the event dot stacking.

	* src/gpm-info.c:
	* src/gpm-info.h:
	Monitor and log powersave events.

	* src/gpm-graph-widget.h:
	* src/gpm-statistics-core.c: (gpm_statistics_refresh_events):
	* test/gpm-st-graph-widget.c: (gpm_st_graph_widget):
	Allow clearing of the event data.

2007-06-24  Richard Hughes  <richard@hughsie.com>

	* src/gpm-graph-widget.c: (gpm_graph_widget_auto_range):
	Cosmetic adjustments to ranging for time.

2007-06-24  Richard Hughes  <richard@hughsie.com>

	* src/gpm-main.c: (main):
	* tools/gnome-power-bugreport.sh:
	Report the installed g-p-m version in bugreports.

2007-06-24  Richard Hughes  <richard@hughsie.com>

	* src/gpm-info.c:
	Move the colour defines here.

	* src/gpm-statistics-core.c: (gpm_statistics_refresh_data):
	* src/gpm-graph-widget.h:
	Allow the graph data to be cleared, so rename the function to create.

	* test/gpm-st-graph-widget.c: (gpm_st_graph_widget):
	* test/gpm-st-main.c: (gpm_st_failed):
	Add lots more tests.

	* src/gpm-graph-widget.c:
	Fix the no-legend bug, and the autoranging bugs. We need more
	unit-tests, but this should fix the most glaring errors.

2007-06-24  Gabor Kelemen  <kelemeng@gnome.hu>
	* src/gpm-main.c:
	* src/gpm-statistics.c:
	* src/gpm-prefs.c: use g_option_context_set_translation_domain to translate
	application description. Closes bug #450154.

2007-06-24  Richard Hughes  <richard@hughsie.com>

	* src/gpm-graph-widget.c:
	* src/gpm-graph-widget.h:
	Rip out some unused API.

	* test/Makefile.am:
	* test/gpm-st-graph-widget.c:
	* test/gpm-st-main.c: (main):
	* test/gpm-st-main.h:
	Add a self test module for the graph. It's incomplete, and already
	shows numerous bugs with the graphing code. More to come.

2007-06-23  Richard Hughes  <richard@hughsie.com>

	* src/gpm-info.c: (gpm_statistics_get_parameters):
	Correct axis label, the unit is already encoded in the value.

2007-06-19  Jaap Haitsma  <jaap@haitsma.org>

	* src/gpm-main.c: (main):
	Add g_set_application_name
	* src/gpm-trayicon.c: (gpm_tray_icon_show_about_cb):
	Make about dialog work with GTK 2.12
	Add website label. Closed #448570

2007-06-17  Richard Hughes  <richard@hughsie.com>

	* data/gnome-power-manager.schemas.in:
	* src/gpm-conf.h:
	* src/gpm-manager.c: (gpm_manager_init):
	Add a special key to detect if the gconf schema has been correctly
	installed. I'm getting more and more bugreports from people compiling
	g-p-m from source, but not installing the default schema and thus
	getting odd unreproducable crashes.

2007-06-17  Stéphane Raimbault  <stephane.raimbault@gmail.com>

	* src/gpm-info.c: (gpm_statistics_add_events_typical):
        Allow different translations for the same string in two different
	contexts. Closed #413642.

2007-06-15  Richard Hughes  <richard@hughsie.com>

	* src/gpm-button.c: (emit_button_pressed):
	Only do the sound if we configured sound effects to be on.

	* src/gpm-sound.c: (gpm_sound_play), (gpm_sound_force),
	(gpm_sound_finalize), (gpm_sound_init):
	Do the sounds in-process, rather than executing gst-launch.

2007-06-15  Richard Hughes  <richard@hughsie.com>

	* data/sounds/Makefile.am:
	* src/gpm-button.c: (emit_button_pressed), (gpm_button_init),
	(gpm_button_finalize):
	* src/gpm-sound.c: (gpm_sound_force):
	* src/gpm-sound.h:
	Emit a sound when the lid state changes, which I need for debugging.

2007-06-14  Richard Hughes  <richard@hughsie.com>

	* src/gpm-idle.c: (gpm_idle_init):
	Initialise a variable to maybe fix #446496.

2007-06-14  Richard Hughes  <richard@hughsie.com>

	* applets/brightness/brightness-applet.c (gpm_applet_get_icon):
        Use the new invalid icon when g-p-m is not running. Fixes #433367

	* applets/brightness/brightness-applet.c
	(gpm_brightness_applet_dbus_connect):
	Refresh the value when g-p-m re-appears back on the bus, so the value
	on the slider is correct.

2007-06-14  Richard Hughes  <richard@hughsie.com>

	* docs/backlight-interactions.svg:
	Add this useful diagram.

2007-06-14  Richard Hughes  <richard@hughsie.com>

	* data/icons/16x16/Makefile.am:
	* data/icons/22x22/Makefile.am:
	* data/icons/24x24/Makefile.am:
	* data/icons/48x48/Makefile.am:
	* data/icons/scalable/Makefile.am:
	* data/icons/scalable/gpm-brightness-kbd-invalid.svg:
	* data/icons/scalable/gpm-brightness-lcd-invalid.svg:
	* docs/icon-naming.txt:
	Add some new icons so we can tell the difference between no hardware
	and no gnome-power-manager.

2007-06-14  Richard Hughes  <richard@hughsie.com>

	* src/gpm-conf.c: (gpm_conf_init):
	* src/gpm-conf.h:
	* src/gpm-screensaver.c: (gconf_key_changed_cb):
	* src/gpm-screensaver.h:
	Watch the gnome-screensaver keys to fix #422124.

2007-06-13  Richard Hughes  <richard@hughsie.com>

	* src/gpm-engine.c: (gpm_engine_get_summary):
	Make wording better.

2007-06-13  Richard Hughes  <richard@hughsie.com>

	* configure.in: Post release bump to 2.19.4

2007-06-13  Richard Hughes  <richard@hughsie.com>

	==== Version 2.19.3 ====

2007-06-13  Richard Hughes  <richard@hughsie.com>

	* src/gpm-cell-array.c: (gpm_cell_array_emit_system_action),
	(gpm_cell_array_percent_changed):
	* src/gpm-engine.c: (gpm_engine_get_summary):
	* src/gpm-profile.c: (gpm_profile_get_accuracy_average):
	* src/gpm-profile.h:
	Don't try to do the policy action when the average accuracy is low.
	This should solve the problem where g-p-m shuts down when the profile
	is very new, and g-p-m has not "seen" the lower states.
	Should fix #446895 and other duplicates.

	* src/gpm-array-float.c: (gpm_array_float_get_average):
	* src/gpm-array-float.h:
	* test/gpm-st-array-float.c: (gpm_st_array_float):
	Add code to compute the average of a float list.

	* test/gpm-selftest-hal-devices.fdi:
	Use BAT0.

	* test/gpm-st-cell.c: (gpm_cell_get_battery), (gpm_st_cell):
	* test/gpm-st-main.c: (gpm_st_failed), (main):
	Stop the checks when an error happens.

	* test/install-fdi.sh:
	Restart HAL to get the new fdi set.

2007-06-13  Richard Hughes  <richard@hughsie.com>

	* data/gnome-power-manager.schemas.in:
	* src/gpm-conf.h:
	Add in /apps/gnome-power-manager/general/debug for the future.

2007-06-07  Gabor Kelemen  <kelemeng@gnome.hu>

	* applets/brightness/GNOME_BrightnessApplet.server.in.in:
	* applets/inhibit/GNOME_InhibitApplet.server.in.in: Mark descriptions for translation.
	  Fixes #445173

2007-06-06  Richard Hughes  <richard@hughsie.com>

	* src/gpm-main.c: (main):
	* src/gpm-webcam.c: (gpm_webcam_get_image):
	Do the gst_init where we have argv.

2007-06-02  Richard Hughes  <richard@hughsie.com>

	* src/gpm-graph-widget.c: (gpm_graph_widget_draw_graph):
	Give more room to the y-axis labels as sometimes the text does not fit.
	Ideally we should make this auto-range, but this will do for now.

2007-06-01  Richard Hughes  <richard@hughsie.com>

	* data/gpm-prefs.glade:
	* src/gpm-prefs-core.c: (prefs_setup_ac), (prefs_setup_battery):
	Move the headings around, and also include a dim-on-idle checkbox for
	each battery-ac state.

	* src/gpm-common.c: (gpm_discrete_to_fraction):
	* src/gpm-common.h:
	* test/gpm-st-common.c: (gpm_st_common):
	Add a new function and test it.

	* src/gpm-backlight.c: (gpm_backlight_init):
	* src/gpm-brightness-kbd.c:
	(adjust_kbd_brightness_according_to_ambient_light):
	* src/gpm-light-sensor.c: (gpm_light_sensor_get_absolute),
	(gpm_light_sensor_calibrate), (gpm_light_sensor_get_relative),
	(gpm_light_sensor_poll_cb), (gpm_light_sensor_init):
	* src/gpm-light-sensor.h:
	* src/gpm-webcam.c:
	Add in functionality so we can get relative brightness readings after
	an initial calibration has been done.

2007-05-25  Richard Hughes  <richard@hughsie.com>

	* src/gpm-manager.c: (gpm_engine_charge_critical_cb):
	Don't segfault if the schema is invalid.

2007-05-23  Richard Hughes  <richard@hughsie.com>

	* src/gpm-backlight.c: (gpm_backlight_set_brightness):
	Just set the AC brightness when we adjust the brightness applet.
	We might do something cleverer in the future.

2007-05-22  Richard Hughes  <richard@hughsie.com>

	* data/gnome-power-manager.schemas.in:
	* src/gpm-backlight.c: (gpm_backlight_brightness_evaluate_and_set),
	(gpm_backlight_notify_system_idle_changed), (idle_changed_cb),
	(gpm_backlight_init):
	* src/gpm-conf.h:
	Make the brightness dim code "learn" to take longer to dim if you keep
	undimming the screen shortly after auto-dimming it.

2007-05-22  Richard Hughes  <richard@hughsie.com>

	* data/gnome-power-manager.schemas.in:
	Correct key typo.

2007-05-22  Richard Hughes  <richard@hughsie.com>

	* data/gnome-power-manager.schemas.in:
	Change default of /apps/gnome-power-manager/general/network_sleep to
	false, as we now do the system action in pm-utils.
	The code will be ripped out altogether closer to 2.20.

2007-05-22  Richard Hughes  <richard@hughsie.com>

	* po/POTFILES.in:
	* src/Makefile.am:
	* src/gpm-cell-array.c: (gpm_cell_array_percent_changed),
	(gpm_cell_charging_changed_cb), (gpm_cell_discharging_changed_cb),
	(gpm_cell_array_init), (gpm_cell_array_finalize):
	* src/gpm-engine.c: (gpm_engine_get_icon), (gpm_engine_init),
	(gpm_engine_finalize):
	* src/gpm-warning.c:
	* src/gpm-warning.h:
	* src/gpm-warnings.c: (gpm_warnings_get_state_csr),
	(gpm_warnings_get_state_time), (gpm_warnings_get_state_percentage),
	(gpm_warnings_get_state), (gpm_warnings_constructor),
	(gpm_warnings_finalize), (gconf_key_changed_cb),
	(gpm_warnings_class_init), (gpm_warnings_init), (gpm_warnings_new):
	* src/gpm-warnings.h:
	* test/Makefile.am:
	Rename the gpm_warning module to gpm_warnings to avoid aliasing the
	gpm_warning debugging command. Fixes build on Solaris, #440409

2007-05-22  Richard Hughes  <richard@hughsie.com>

	* applets/brightness/brightness-applet.c:
	(gpm_brightness_applet_dbus_connect):
	* data/gnome-power-manager.schemas.in:
	* data/gpm-prefs.glade:
	* src/gpm-backlight.c: (gpm_backlight_sync_policy),
	(gpm_common_sum_scale),
	(gpm_backlight_brightness_evaluate_and_set), (conf_key_changed_cb),
	(ac_adapter_changed_cb), (button_pressed_cb),
	(gpm_backlight_notify_system_idle_changed), (idle_changed_cb),
	(sensor_changed_cb), (gpm_backlight_finalize),
	(gpm_backlight_init):
	* src/gpm-brightness-lcd.c: (gpm_brightness_lcd_dim_hw),
	(gpm_brightness_lcd_set_std), (gpm_brightness_lcd_init):
	* src/gpm-brightness-lcd.h:
	* src/gpm-cell-array.c: (gpm_cell_array_get_time_until_action):
	* src/gpm-conf.h:
	* src/gpm-cpufreq.c: (gpm_cpufreq_sync_policy),
	(conf_key_changed_cb):
	* src/gpm-engine.c: (conf_key_changed_cb), (gpm_engine_init):
	* src/gpm-info.c: (gpm_info_init):
	* src/gpm-light-sensor.c: (gpm_light_sensor_get),
	(gpm_light_sensor_poll_cb):
	* src/gpm-manager.c: (gpm_manager_sync_policy_sleep),
	(idle_do_sleep), (lid_button_pressed), (ac_adapter_changed_cb),
	(manager_critical_action_do), (conf_key_changed_cb),
	(gpm_engine_charge_critical_cb), (gpm_engine_charge_action_cb),
	(gpm_manager_init):
	* src/gpm-prefs-core.c: (gpm_prefs_icon_radio_cb),
	(conf_key_changed_cb), (prefs_setup_notification),
	(prefs_setup_ac), (prefs_setup_battery), (prefs_setup_ups):
	* src/gpm-sound.c: (conf_key_changed_cb), (gpm_sound_init):
	* src/gpm-srv-brightness-kbd.c: (conf_key_changed_cb),
	(ac_adapter_changed_cb):
	* src/gpm-srv-screensaver.c: (screensaver_auth_request_cb):
	* src/gpm-statistics-core.c: (conf_key_changed_cb),
	(gpm_statistics_checkbox_events_cb),
	(gpm_statistics_refresh_axis_labels),
	(gpm_statistics_refresh_data),
	(gpm_statistics_type_combo_changed_cb),
	(gpm_statistics_populate_graph_types), (gpm_statistics_init):
	* src/gpm-tray-icon.c: (conf_key_changed_cb), (gpm_tray_icon_init):
	* src/gpm-warning.c: (gpm_warning_init):
	* test/gpm-st-webcam.c: (gpm_st_webcam):
	Rework the brightness interactions, and rename a large part of the
	gconf schemas. Currently unfinished.

2007-05-21  Benjamin Canou <benjamin@benjamin-laptop>

	* applets/brightness/brightness-applet.c: (gpm_applet_draw_cb),
	(gpm_applet_change_background_cb), (gpm_applet_update_popup_level),
	(gpm_applet_plus_cb), (gpm_applet_scroll_cb),
	(gpm_applet_theme_change_cb), (gpm_applet_stop_scroll_events_cb),
	(gpm_brightness_applet_init):
	Correct drawing code to handle themes with panel background picture.
	Correct max value from 99% to 100%.
	Correct tooltip behaviour.

2007-05-21  Richard Hughes  <richard@hughsie.com>

	* src/gpm-debug.c: (gpm_error_real):
	Still exit, even if we are not debugging. Fixes #438838

2007-05-18  Richard Hughes  <richard@hughsie.com>

	* data/gnome-power-manager.schemas.in:
	* data/gpm-prefs.glade:
	* src/gpm-backlight.c: (gpm_backlight_set_brightness),
	(sensor_changed_cb), (gpm_backlight_finalize),
	(gpm_backlight_init):
	* src/gpm-conf.h:
	* src/gpm-light-sensor.c: (gpm_light_sensor_get_hw),
	(gpm_light_sensor_get), (gpm_light_sensor_constructor),
	(gpm_light_sensor_finalize), (gpm_light_sensor_class_init),
	(gpm_light_sensor_has_hw), (gpm_light_sensor_poll_cb),
	(conf_key_changed_cb), (gpm_light_sensor_init),
	(gpm_light_sensor_new):
	* src/gpm-light-sensor.h:
	* src/gpm-prefs-core.c: (prefs_setup_general), (gpm_prefs_init):
	* src/gpm-prefs-server.h:
	Make the ambient light sensor do something interesting, and remove the
	UI from the prefs program. We should just choose good defaults, and
	then just learn what the user wants.

2007-05-18  Richard Hughes  <richard@hughsie.com>

	* applets/brightness/brightness-applet.c:
	* src/Makefile.am:
	* src/dbus/xdg-power-management-core.xml:
	* src/gpm-backlight.c: (gpm_backlight_init):
	* src/gpm-engine.c: (gpm_engine_start):
	* src/gpm-light-sensor.c: (gpm_light_sensor_init):
	* src/gpm-manager.c: (gpm_manager_get_preferences_options),
	(gpm_manager_init), (gpm_manager_finalize):
	* src/gpm-manager.h:
	* src/gpm-prefs-core.c: (gpm_dbus_method_int),
	(prefs_setup_ambient), (gpm_prefs_init):
	* src/gpm-prefs-server.c: (gpm_prefs_server_get_capability),
	(gpm_prefs_server_set_capability), (gpm_prefs_server_class_init),
	(gpm_prefs_server_init), (gpm_prefs_server_new):
	* src/gpm-prefs-server.h:
	Move the capabilities detection to the daemon, don't try to second guess
	the information in the prefs tool.

2007-05-17  Richard Hughes  <richard@hughsie.com>

	* src/gpm-backlight.c: (idle_changed_cb):
	* src/gpm-idle.c: (session_idle_changed_cb),
	(powersave_idle_changed_cb), (gpm_idle_init):
	* src/gpm-idle.h:
	Dim the screen after a few seconds.

2007-05-17  Richard Hughes  <richard@hughsie.com>

	* applets/brightness/Makefile.am:
	* applets/brightness/brightness-applet.c:
	* applets/brightness/brightness-applet.h:
	Use DbusWatch.

	* libdbus-glib/Makefile.am:
	* libdbus-glib/libdbus-proxy.c: (dbus_proxy_disconnect):
	* libdbus-glib/libdbus-watch.c:
	Add new class, not wrapping the proxy. Simple.

	* src/gpm-idle.c: (gpm_idle_init):
	* src/gpm-screensaver.c:
	* src/gpm-screensaver.h:
	Add idle reporting for powersave.

2007-05-17  Richard Hughes  <richard@hughsie.com>

	* applets/brightness/brightness-applet.c: (gpm_applet_get_icon),
	(gpm_applet_check_size), (gpm_applet_draw_cb),
	(gpm_applet_destroy_popup_cb), (gpm_applet_update_tooltip),
	(gpm_applet_update_popup_level), (gpm_applet_plus_cb),
	(gpm_applet_minus_cb), (gpm_applet_slide_cb),
	(gpm_applet_key_press_cb), (gpm_applet_scroll_cb),
	(gpm_applet_create_popup), (gpm_applet_popup_cb),
	(gpm_applet_dialog_about_cb), (gpm_applet_destroy_cb),
	(brightness_changed_cb), (gpm_brightness_applet_init),
	(gpm_applet_bonobo_cb):
	Don't reduce the brightness when clicking on the icon. Fixes #428401

	* src/gpm-backlight.c: (conf_key_changed_cb):
	Emit BrightnessChanged events when the conf key changes.

2007-05-17  Richard Hughes  <richard@hughsie.com>

	* Makefile.am:
	* applets/brightness/Makefile.am:
	* applets/brightness/brightness-applet.c:
	(gpm_applet_get_brightness), (gpm_applet_set_brightness),
	(update_level), (destroy_cb), (gpm_brightness_applet_init):
	* applets/brightness/brightness-applet.h:
	* applets/inhibit/Makefile.am:
	* applets/inhibit/inhibit-applet.c: (gpm_applet_inhibit),
	(gpm_applet_uninhibit), (gpm_applet_has_inhibit), (click_cb),
	(destroy_cb), (gpm_inhibit_applet_init):
	* applets/inhibit/inhibit-applet.h:
	* configure.in:
	* libgpm-glib/Makefile.am:
	* libgpm-glib/libgpm.c:
	* libgpm-glib/libgpm.h:
	* src/Makefile.am:
	* src/gpm-common.h:
	* src/gpm-main.c:
	* src/gpm-manager.c:
	* src/gpm-notify.c:
	* src/gpm-prefs-core.c:
	* src/gpm-profile.c:
	* src/gpm-statistics-core.c:
	* src/gpm-tray-icon.c:
	* test/Makefile.am:
	* test/gpm-st-inhibit.c: (inhibit), (uninhibit), (has_inhibit),
	(gpm_st_inhibit):
	* test/gpm-st-proxy.c:
	Remove libgpm, it's only used properly in one place. Also lets us solve
	the brghtness bug easily (to follow).

2007-05-15  Richard Hughes  <richard@hughsie.com>

	* src/gpm-profile.c: (gpm_profile_load_data):
	Create the data directory with the correct permissions.

	* test/gpm-st-webcam.c: (gpm_st_webcam):
	Oops. Actually add this file.

2007-05-14  Richard Hughes  <richard@hughsie.com>

	* data/gnome-power-manager.schemas.in:
	* src/gpm-webcam.c:
	* src/gpm-webcam.h:
	* test/Makefile.am:
	* test/gpm-st-main.c:
	* test/gpm-st-main.h:
	Make some more changes to the webcam module, and add a self-test
	section that just gets an image.

2007-05-14  Richard Hughes  <richard@hughsie.com>

	* data/gpm-prefs.glade:
	* src/gpm-conf.h:
	* src/gpm-light-sensor.c:
	More fixes.

2007-05-14  Richard Hughes  <richard@hughsie.com>

	* data/gnome-power-manager.schemas.in:
	Fix type.

2007-05-14  Richard Hughes  <richard@hughsie.com>

	* configure.in:
	* data/gnome-power-manager.schemas.in:
	* data/gpm-prefs.glade:
	* src/Makefile.am:
	* src/gpm-light-sensor.c:
	* src/gpm-webcam.c:
	* src/gpm-webcam.h:
	Add initial code to use a webcam as a brightness sensor.

2007-05-14  Richard Hughes  <richard@hughsie.com>

	* configure.in: Post release bump to 2.19.3

2007-05-14  Richard Hughes  <richard@hughsie.com>

	==== Version 2.19.2 ====

2007-05-14  Richard Hughes  <richard@hughsie.com>

	* src/gpm-graph-widget.c:
	Make 400% sure we can't dereference a null pointer.

2007-05-14  Richard Hughes  <richard@hughsie.com>

	* data/gnome-power-manager.schemas.in:
	Change the /apps/gnome-power-manager/battery/event_when_closed
	key to default to true. This means that if you shut the lid and then
	remove the AC power then the system will by default suspend.
	This may make systems that have dodgey lid reporting to immediatly
	suspend when removed from AC, but we can blacklist (or fix) them as
	they are reported. Fixes fedora:214404

2007-05-13  Richard Hughes  <richard@hughsie.com>

	* src/gpm-dpms.c: (gpm_dpms_init):
	Add a note about the DPMS polling, and default to once every 10 seconds
	rather than once every 500ms as this wakes up X a lot.

2007-05-13  Richard Hughes  <richard@hughsie.com>

	* src/gpm-array.c: (gpm_array_check_max_and_size), (gpm_array_add):
	Abstract out a method, should be no logic changes.

2007-05-13  Richard Hughes  <richard@hughsie.com>

	* src/gpm-load.c: (gpm_load_get_current), (gpm_load_init):
	Fix a build failure with -Werror, where we were ignoring the return
	value of gpm_load_get_cpu_values, possibly leading to uninitialised
	values of the counters.
	Thanks to Ed Catmur <ed@catmur.co.uk> for the patch. Fixes #437920.

2007-05-09  Richard Hughes  <richard@hughsie.com>

	* src/gpm-brightness-lcd.c: (gpm_brightness_lcd_dim_hw_step):
	If we failed the last brightness set command, don't keep trying;
	This fixes a long "hang" when we resume from suspend when on PPC,
	although the real problem is the HAL method dying for some reason.

2007-05-09  Richard Hughes  <richard@hughsie.com>

	* src/gpm-graph-widget.c: (gpm_graph_widget_init):
	Comment out pango_context_set_base_gravity as this requires pango 1.16
	when FC6 only supports version 1.14

2007-05-09  Richard Hughes  <richard@hughsie.com>

	* tools/gnome-power-bugreport.sh:
	Add process information for HAL and g-p-m so I can see what is running.

2007-05-09  Richard Hughes  <richard@hughsie.com>

	* src/gpm-engine.c: (gpm_engine_icon_clear_delay),
	(gpm_engine_recalculate_state_icon):
	Don't send the action for the icon to clear for a few seconds so that
	any notification can be shown pointing to the icon. Fixes #437042

2007-05-08  Richard Hughes  <richard@hughsie.com>

	* src/dbus/xdg-power-management-stats.xml:
	Add a comment about adding a type field.

	* src/gpm-graph-widget.c: (gpm_graph_widget_draw_event_dots):
	Fix a potential crasher where the wrong event data was being processed.

2007-05-07  Richard Hughes  <richard@hughsie.com>

	* applets/brightness/brightness-applet.c: (update_level):
	Don't chicken out when brightness access fails in the addon.
	Continue to try to connect, hopefully trying to fix #436704.

2007-05-07  Richard Hughes  <richard@hughsie.com>

	* src/gpm-dpms.c: (x11_sync_server_dpms_settings), (x11_get_mode),
	(x11_set_mode), (sync_settings), (gpm_dpms_init):
	DPMSCapable() can never change for a given display, so cache the
	result and cut our wakeups in half. Change modified from a similar patch
	by Adam Jackson <ajax@redhat.com>, many thanks.

2007-05-04  Richard Hughes  <richard@hughsie.com>

	* src/gpm-button.c: (coldplug_buttons), (hal_daemon_start_cb),
	(hal_daemon_stop_cb), (gpm_button_init):
	Reconnect the buttons after HAL has been restarted.

2007-05-04  Richard Hughes  <richard@hughsie.com>

	* src/gpm-info.c: (gpm_info_event_log), (gpm_info_log_do_poll),
	(gpm_info_init), (gpm_info_finalize):
	Don't use gettimeofday-type functions, instead use GTimer as it now has
	monotonic clock support. Thanks to Jon McCann for the pointer.
	This should fix #419403 where ntp clock adjustment made the graphs
	go screwy.

2007-05-03  Richard Hughes  <richard@hughsie.com>

	* data/gnome-power-manager.schemas.in:
	* data/gpm-graph.glade:
	* src/gpm-conf.h:
	* src/gpm-graph-widget.c:
	* src/gpm-statistics-core.c:
	Make the UI of the graph program a little more sane.

2007-05-03  Richard Hughes  <richard@hughsie.com>

	* src/gpm-graph-widget.c:
	Convert gnome-power-statistics to use Pango for text rendering.
	This is based heavily on a patch by Young-Ho Cha <ganadist@chollian.net>
	and fixes #418605. Many thanks.

2007-05-03  Richard Hughes  <richard@hughsie.com>

	* configure.in: Post release bump to 2.19.2

2007-05-03  Richard Hughes  <richard@hughsie.com>

	==== Version 2.19.1 ====

2007-05-03  Richard Hughes  <richard@hughsie.com>

	* src/gpm-cell-array.c: (gpm_cell_array_get_description):
	Fix a failure in the self test program when the battery is detected
	broken. Return 'Battery state could not be read at this time'.

	* src/dbus/xdg-power-management-stats.xml:
	* src/gpm-graph-widget.c:
	* src/gpm-graph-widget.h:
	* src/gpm-info.c:
	* src/gpm-info.h:
	* src/gpm-statistics-core.c:
	Send the key data over DBUS. Allows us to do some cool new things.

2007-05-01  Richard Hughes  <richard@hughsie.com>

	* src/dbus/xdg-power-management-stats.xml:
	* src/gpm-graph-widget.c:
	* src/gpm-graph-widget.h:
	* src/gpm-info.c:
	* src/gpm-info.h:
	* src/gpm-profile.c:
	* src/gpm-statistics-core.c:
	Impliment the key data types. Lightly tested. Now at least we are not
	displaying a generic key, although the wording could do with some work.

2007-04-30  Richard Hughes  <richard@hughsie.com>

	* src/dbus/xdg-power-management-stats.xml:
	* src/gpm-info.c:
	* src/gpm-info.h:
	* src/gpm-statistics-core.c:
	Rip out GetAxisTypes and use GetParameters instead. The key still isn't
	implimented yet, although the data for it is now passed over dbus.

2007-04-30  Richard Hughes  <richard@hughsie.com>

	* src/dbus/xdg-power-management-stats.xml:
	* src/gpm-info.c:
	* src/gpm-info.h:
	Impliment some more of the new stats interface.
	Nothing really works yet, and it isn't used at all.

2007-04-29  Richard Hughes  <richard@hughsie.com>

	* src/dbus/xdg-power-management-core.xml:
	* src/gpm-manager.c:
	* src/gpm-manager.h:
	Rip out the standby stuff as it's no longer in the spec. Also make
	the can_X and allowed_X checking more sane with more user warnings
	if things are denied.

2007-04-29  Richard Hughes  <richard@hughsie.com>

	* src/gpm-tray-icon.c: (gpm_tray_icon_activate_cb):
	Only do the seporator if we have at least one device and can do an
	action.

2007-04-25  Richard Hughes  <richard@hughsie.com>

	* src/dbus/xdg-power-management-stats.xml:
	* src/gpm-info.c:
	* src/gpm-info.h:
	* src/gpm-statistics-core.c:
	Rip out the seconds parameter, nothing uses it.

2007-04-25  Richard Hughes  <richard@hughsie.com>

	* src/gpm-array.c:
	* src/gpm-array.h:
	* src/gpm-array-float.c:
	* src/gpm-array-float.h:
	Add some code to help convert to and from a GpmArray.

	* src/gpm-debug.c: (gpm_debug_is_verbose):
	* src/gpm-debug.h:
	Add an extra method so we only do the (expensive) profiling debugging
	when we are versbose to a console.

	* src/gpm-cell-array.c: (gpm_cell_array_get_time_until_action):
	Check for a zero return value, which we can now get on empty profile.

	* src/gpm-main.c:
	Don't include stuff we don't use.

	* src/gpm-statistics-core.c: (gpm_statistics_refresh_data):
	Adjust the smoothing.

	* src/gpm-profile.c:
	Move to a 1D mapping of data, rather than the hodge-podge of refresh
	methods that was done before. This makes querying time and data for
	the graph program much less CPU intensive, which is good.
	Startup time is measurably improved.

	* test/gpm-st-array-float.c: (gpm_st_array_float):
	* test/gpm-st-array.c: (gpm_st_array):
	* test/gpm-st-main.c: (main):
	* test/gpm-st-profile.c: (gpm_st_profile):
	Fix all of the tests - now all work!

2007-04-24  Richard Hughes  <richard@hughsie.com>

	* src/gpm-array.c:
	* src/gpm-array.h:
	Rip out some unused code. Things are simpler now.

	* data/gnome-power-manager.schemas.in:
	* data/gpm-graph.glade:
	* src/Makefile.am:
	* src/gpm-conf.h:
	Add an option in g-p-s to smooth the graphs to see trends more easily.

	* src/gpm-array-float.c:
	* src/gpm-array-float.h:
	Add a routine so we can copy back to a GpmArray.

	* src/gpm-profile.c:
	Don't smooth here, we only do the processor insive bits in the
	presentation application.

	* test/gpm-st-array-float.c: (gpm_st_array_float):
	* test/gpm-st-array.c: (gpm_st_array):
	* test/gpm-st-main.c: (main):
	Remove obsolete tests. Now we pass everything again.

2007-04-23  Richard Hughes  <richard@hughsie.com>

	* src/gpm-array-float.c:
	* src/gpm-array-float.h:
	* test/gpm-st-array-float.c: (gpm_st_array_float):
	* test/gpm-st-main.c: (main):
	Make the tests work. Gaussian smoothing is sssmmmooootttthhhhh....

2007-04-24  David Lodge <dave@cirt.net>

	* data/gnome-power-manager-schema.in:
	Updated a few strings about the use of the screensaver upon resumption
	to make them sound better.

2007-04-23  Richard Hughes  <richard@hughsie.com>

	* configure.in:
	Re-enable -Wall

	* src/Makefile.am:
	* src/gpm-array-float.c:
	* src/gpm-array-float.h:
	* test/Makefile.am:
	* test/gpm-st-array-float.c: (gpm_st_array_float):
	* test/gpm-st-main.c: (main):
	* test/gpm-st-main.h:
	Write a new float class. Cool new stuff to come. Really untested.

2007-04-22  Richard Hughes  <richard@hughsie.com>

	* test/gpm-st-array.c: (gpm_st_array):
	Add some more tests. They fail.

	* test/gpm-st-profile.c: (gpm_st_profile):
	Remove the error.

2007-04-16  Richard Hughes  <richard@hughsie.com>

	* configure.in:
	Add in gprof configure switches. Disabled by default.

	* src/gpm-array.c: (gpm_array_get), (gpm_array_set),
	(gpm_array_append), (gpm_array_invert), (gpm_array_print),
	(gpm_array_set_data), (gpm_array_get_size):
	Don't check the array type in the fast path.

	* src/gpm-button.c:
	* src/gpm-conf.c:
	* src/gpm-srv-brightness-kbd.c:
	Remove non-required defines.

2007-04-12  simon.zheng  <simon.zheng@sun.com>

	reviewed by Richard Hughes

	* src/Makefile.am:
	Specify DPMS extra library because of gnome-power-preference's
	dependency.

2007-04-10  Wouter Bolsterlee  <wbolster@svn.gnome.org>

	reviewed by: Richard Hughes

	* data/Makefile.am:
	Added uninstall rule for gconf schemas.

2007-04-09  Richard Hughes  <richard@hughsie.com>

	* src/gpm-cell-array.c: (gpm_cell_array_get_description):
	Do the rounding down before the time check to avoid showing Unknown
	time remaining in the tooltip.

2007-04-08  Richard Hughes  <richard@hughsie.com>

	* src/gpm-engine.c: (gpm_engine_class_init),
	(gpm_cell_array_charge_action_cb):
	Oops. Return the unit, not the percentage charge. Should fix #427566

	* src/gpm-warning.c: (gpm_warning_get_state_time),
	(gpm_warning_get_state_percentage):
	Don't trigger action on 0% percentage (split second on unpug), which
	we still need to fully debug.

2007-04-05  Richard Hughes  <richard@hughsie.com>

	* libhal-glib/libhal-gmanager.h:
	* libhal-glib/libhal-gmanager.c:
	(hal_gmanager_find_device_string_match):
	Add another method.

	* src/gpm-debug.h:
	Add gpm_assert_run_once for debugging.

	* src/gpm-cell-unit.c: (gpm_cell_unit_print):
	Don't print zero data for some of the fields.

	* src/gpm-engine.c: (gpm_engine_recalculate_state),
	(gpm_engine_init), (gpm_engine_start):
	Monitor when we are in coldplug to save some CPU cycles when starting.

	* src/gpm-profile.c: (gpm_profile_load_data):
	Don't print profile data, it's quite expensive.

2007-04-04  Richard Hughes  <richard@hughsie.com>

	* src/gpm-main.c: (main):
	Add the --immediate-exit command line option.

	* src/gpm-profile.c: (gpm_profile_compute_data_battery),
	(gpm_profile_compute_data_accuracy), (gpm_profile_save_percentage),
	(gpm_profile_load_data):
	Make the array choosing more obvious.

	* src/profile-gpm.sh:
	Add a cool new script that just starts and stops g-p-m 20 times.

	* src/valgrind-gpm.sh:
	Whitespace.

2007-04-04  Richard Hughes  <richard@hughsie.com>

	* src/gpm-array.c: (gpm_array_append_from_file),
	(gpm_array_load_from_file):
	* src/gpm-cell-array.c: (gpm_cell_array_get_config_id),
	(gpm_cell_array_collection_changed), (gpm_cell_array_add),
	(gpm_cell_array_set_type), (hal_device_removed_cb):
	* src/gpm-engine.c: (gpm_engine_recalculate_state_icon),
	(gpm_engine_recalculate_state_summary), (gpm_engine_finalize):
	* src/gpm-manager.c: (gpm_manager_init), (gpm_manager_finalize):
	* src/gpm-profile.c: (gpm_profile_get_data_file),
	(gpm_profile_get_time), (gpm_profile_save_percentage),
	(gpm_profile_delete_data), (gpm_profile_load_data),
	(gpm_profile_set_config_id), (gpm_profile_get_accuracy),
	(gpm_profile_init), (gpm_profile_finalize):
	* src/gpm-profile.h:
	Make the profile code work with multiple batteries.

	* test/Makefile.am:
	* test/gpm-st-main.c: (main):
	* test/gpm-st-main.h:
	* test/gpm-st-profile.c: (gpm_st_profile):
	Add a test suite for the GpmProfile code.

2007-04-03  Richard Hughes  <richard@hughsie.com>

	* src/gpm-common.h:
	* src/gpm-common.c: (gpm_precision_round_up), (gpm_precision_round_down):
	Create two helper functions to do base rounding in a sane way.

	* test/gpm-st-common.c: (gpm_st_common):
	Test the new round up and round down code.

	* src/gpm-cell-array.c: (gpm_cell_array_get_description):
	* src/gpm-graph-widget.c: (gpm_graph_widget_auto_range):
	Use the round up and down code to make the graph scaling a bit more
	sane, and also to limit the precision to 5 minutes in the tooltip.

2007-04-03  Richard Hughes  <richard@hughsie.com>

	* applets/inhibit/inhibit-applet.c: (click_cb):
	* data/gpm-inhibit-test.glade:
	* docs/dbus-interface.html:
	* docs/dbus-interface.xml:
	* docs/dbus-test-inhibit.py:
	* libgpm-glib/libgpm.c: (gpm_powermanager_inhibit),
	(gpm_powermanager_has_inhibit):
	* libgpm-glib/libgpm.h:
	* src/dbus/xdg-power-management-backlight.xml:
	* src/dbus/xdg-power-management-core.xml:
	* src/dbus/xdg-power-management-inhibit.xml:
	* src/gpm-cell-array.c: (gpm_cell_array_class_init):
	* src/gpm-inhibit.c: (gpm_inhibit_find_cookie),
	(gpm_inhibit_inhibit), (gpm_inhibit_un_inhibit),
	(gpm_inhibit_remove_dbus), (gpm_inhibit_has_inhibit),
	(gpm_inhibit_get_message), (gpm_inhibit_class_init),
	(gpm_inhibit_init), (gpm_inhibit_finalize):
	* src/gpm-inhibit.h:
	* src/gpm-manager.c: (gpm_manager_error_get_type),
	(gpm_manager_is_inhibit_valid), (gpm_manager_get_on_battery),
	(gpm_manager_get_low_battery), (ac_adapter_changed_cb),
	(gpm_manager_class_init):
	* src/gpm-manager.h:
	* test/gpm-inhibit-test.c: (dbus_inhibit_gpm), (widget_inhibit_cb),
	(main):
	* test/gpm-st-inhibit.c: (gpm_st_inhibit):
	Update to conform to the session power management spec version 0.2

2007-04-02  Matthias Clasen <mclasen@redhat.com>

	* applets/brightness/GNOME_BrightnessApplet.server.in.in:
	* applets/inhibit/GNOME_BrightnessApplet.server.in.in:
	Add bugzilla information to applet .server files.  (#425000)

	* applets/brightness/Makefile.am:
	* applets/inhibit/Makefile.am: Substitute @VERSION@ in
	.server files.

2007-03-29  Richard Hughes  <richard@hughsie.com>

	* Makefile.am:
	* applets/brightness/Makefile.am:
	* applets/brightness/brightness-applet.c:
	* applets/brightness/brightness-applet.h:
	* applets/inhibit/Makefile.am:
	* applets/inhibit/inhibit-applet.c:
	* libdbus-glib/Makefile.am:
	* libdbus-glib/libdbus-monitor-session.c:
	* libdbus-glib/libdbus-monitor-session.h:
	* libdbus-glib/libdbus-monitor-system.c:
	* libdbus-glib/libdbus-monitor-system.h:
	* libdbus-glib/libdbus-proxy.c: (dbus_noc_session_cb),
	* libdbus-glib/libdbus-proxy.h:
	* libgpm-glib/Makefile.am:
	* libgpm-glib/libgpm.c: (gpm_powermanager_get_brightness_lcd),
	* libgpm-glib/libgpm.h:
	* libhal-glib/Makefile.am:
	* libhal-glib/libhal-gcpufreq.c: (hal_gcpufreq_set_performance),
	* libhal-glib/libhal-gdevice.c: (hal_gdevice_set_udi),
	* libhal-glib/libhal-gmanager.c: (hal_gmanager_proxy_connect_more),
	* libhal-glib/libhal-gpower.c: (hal_gpower_init),
	* po/POTFILES.in:
	* src/Makefile.am:
	* src/gpm-backlight.c:
	* src/gpm-brightness-kbd.c: (gpm_brightness_kbd_get_hw),
	* src/gpm-brightness-lcd.c: (gpm_brightness_lcd_get_hw),
	* src/gpm-common.h:
	* src/gpm-dbus-monitor.c:
	* src/gpm-dbus-monitor.h:
	* src/gpm-inhibit.c: (dbus_noc_session_cb), (gpm_inhibit_init):
	* src/gpm-light-sensor.c: (gpm_light_sensor_get_hw),
	* src/gpm-main.c:
	* src/gpm-notify.c:
	* src/gpm-polkit.c: (gpm_polkit_is_user_privileged),
	* src/gpm-profile.c:
	* src/gpm-proxy.c:
	* src/gpm-proxy.h:
	* src/gpm-screensaver.c: (gpm_screensaver_proxy_connect_more),
	* src/gpm-statistics-core.c: (gpm_statistics_get_events),
	* src/gpm-tray-icon.c:
	* test/Makefile.am:
	* test/gpm-st-proxy.c: (gpm_st_proxy):
	Don't make gpm-proxy multiple times, use dbus_proxy.

2007-03-29  Richard Hughes  <richard@hughsie.com>

	* configure.in:
	* data/icons/48x48/Makefile.am:
	* data/icons/Makefile.am:
	* data/icons/generate_48x48_icons.sh:
	Generate and ship the 48x48 icons.

2007-03-29  Richard Hughes  <richard@hughsie.com>

	* libdbus-glib/Makefile.am:
	* libdbus-glib/libdbus-marshal.list:
	* libdbus-glib/libdbus-monitor-session.c:
	* libdbus-glib/libdbus-monitor-session.h:
	* libdbus-glib/libdbus-monitor-system.c:
	* libdbus-glib/libdbus-monitor-system.h:
	* libdbus-glib/libdbus-proxy.c:
	* libdbus-glib/libdbus-proxy.h:
	Add a new abstract dbus local library.

	* Makefile.am:
	* applets/brightness/Makefile.am:
	* applets/inhibit/Makefile.am:
	* configure.in:
	* src/Makefile.am:
	* test/Makefile.am:
	Include the new library, although nothing uses it yet.

	* src/gpm-refcount.c:
	Remove non-required include.

2007-03-28  Richard Hughes  <richard@hughsie.com>

	* libhal-glib/libhal-gcpufreq.c: (hal_gcpufreq_string_to_enum),
	* libhal-glib/libhal-gdevice.c: (hal_gdevice_set_udi),
	* libhal-glib/libhal-gdevicestore.c: (hal_gdevicestore_index_udi),
	* libhal-glib/libhal-gmanager.c:
	* libhal-glib/libhal-gpower.c: (hal_gpower_init),
	Don't use gpm_debug, it means looking in the src/ tree.

	* Makefile.am:
	* applets/brightness/Makefile.am:
	* applets/brightness/brightness-applet.c:
	* applets/brightness/brightness-applet.h:
	* applets/inhibit/Makefile.am:
	* applets/inhibit/inhibit-applet.c:
	* applets/inhibit/inhibit-applet.h:
	* configure.in:
	* libgpm-glib/Makefile.am:
	* libgpm-glib/libgpm.c:
	* libgpm-glib/libgpm.h:
	* src/Makefile.am:
	* src/gpm-manager.c:
	* src/gpm-powermanager.c:
	* src/gpm-powermanager.h:
	* src/gpm-prefs-core.c:
	* src/gpm-statistics-core.c:
	* test/Makefile.am:
	* test/gpm-st-inhibit.c:
	* test/gpm-st-proxy.c:
	Abstact out gpm-powermanager into a static library, so we don't build
	-four- copies of this file on every build.

2007-03-28  Richard Hughes  <richard@hughsie.com>

	* docs/config.xsl:
	Output in UTF-8.

	* docs/dbus-interface.html:
	* docs/dbus-interface.xml:
	Update with latest from 0.1 of the spec.

	* docs/dbus-test-inhibit.py:
	* src/dbus/Makefile.am:
	* src/dbus/gpm-dbus-backlight.xml:
	* src/dbus/gpm-dbus-control.xml:
	* src/dbus/gpm-dbus-inhibit.xml:
	* src/dbus/gpm-dbus-manager.xml:
	* src/dbus/gpm-dbus-statistics.xml:
	* src/dbus/gpm-dbus-ui.xml:
	* src/dbus/xdg-power-management-backlight.xml:
	* src/dbus/xdg-power-management-core.xml:
	* src/dbus/xdg-power-management-inhibit.xml:
	* src/dbus/xdg-power-management-stats.xml:
	* src/dbus/xdg-power-management-widget.xml:
	* src/gpm-control.c: (gpm_control_finalize), (gpm_control_init):
	* src/gpm-main.c: (gpm_object_register):
	* src/gpm-manager.c: (gpm_manager_error_get_type):
	* src/gpm-manager.h:
	* src/gpm-powermanager.h:
	* src/gpm-prefs-core.c: (gpm_dbus_method_bool), (gpm_prefs_init):
	Use the power management spec as per defined by freedesktop:
	http://www.freedesktop.org/wiki/Specifications
	This means our service name and interface names have changed.
	PLEASE UPDATE PROGRAMS THAT USE THE CORE INTERFACE OF G-P-M.

2007-03-27  Richard Hughes  <richard@hughsie.com>

	* configure.in:
	* docs/Makefile.am:
	* docs/dbus-interface.html:
	* docs/dbus-interface.xml:
	* docs/gnome-power-manager.xml.in:
	Document the XDG power-management spec, with additions.
	We'll switch soon, and break *everything* in the process.

2007-03-27  Richard Hughes  <richard@hughsie.com>

	* docs/Makefile.am:
	* docs/faq.xml:
	* docs/gnome-power-manager.xml.in:
	Move the FAQ to http://live.gnome.org/GnomePowerManager/FAQ it's just
	so inconvenient to have it in RCS.

2007-03-27  Richard Hughes  <richard@hughsie.com>

	* docs/Makefile.am:
	* docs/gnome-power-manager.xml.in:
	* docs/icon-naming.txt:
	* docs/icon-scheme.xml:
	Convert the SGML to a text file. There's no real need to be a HTML.

2007-03-27  Richard Hughes  <richard@hughsie.com>

	* docs/Makefile.am:
	* docs/dbus-interface.html:
	* docs/faq.html:
	* docs/gnome-power-manager.xml.in:
	* docs/icon-scheme.html:
	* docs/index.html:
	* docs/sleep-names.html:
	* docs/sleep-names.xml:
	Rip out some cruft, now we have moved the nomenclature to XDG.

2007-03-27  Richard Hughes  <richard@hughsie.com>

	* docs/sleep-names.xml:
	Spelling corrections.

	* src/gpm-cell-array.c: (gpm_cell_array_get_profile_id),
	(gpm_cell_array_set_type), (gpm_cell_array_get_description):
	* src/gpm-cell.c: (gpm_cell_get_id):
	* src/gpm-cell.h:
	* test/gpm-st-cell.c: (gpm_st_cell):
	Get a profile string, which represents the connection of different
	batteries in a system. Only useful for primary battery profiling code.

2007-03-26  Richard Hughes  <richard@hughsie.com>

	* data/gnome-power-manager.schemas.in:
	* src/gpm-conf.h:
	* src/gpm-control.c: (gpm_control_suspend),
	(gpm_control_hibernate):
	Add a configurable lock/gnome_keyring so we can disable the lock
	of the GNOME keyring at run time. Defaults to false for now.
	See http://hughsient.livejournal.com/19481.html for reasoning.

2007-03-25  Richard Hughes  <richard@hughsie.com>

	* libhal-glib/libhal-gcpufreq.c: (hal_gcpufreq_string_to_enum):
	Don't assert if there is no CPU frequency scalers.

	* src/gpm-engine.c: (gpm_engine_get_summary):
	Only show accuracy unit when we have a primary battery installed.

	* src/gpm-info.c: (gpm_statistics_get_data_types):
	Don't segfault when we have no valid array.

	* src/gpm-notify.c: (gpm_notify_show), (gpm_notify_create):
	Fix compilation when we don't have libnotify.

	* src/gpm-tray-icon.c: (gpm_tray_icon_activate_cb):
	Don't show the left click menu if there's nothing there.

2007-03-25  Richard Hughes  <richard@hughsie.com>

	* src/gpm-engine.c: (gpm_engine_get_summary), (gpm_engine_init),
	(gpm_engine_finalize):
	* src/gpm-manager.c: (gpm_manager_init):
	* src/gpm-notify.c:
	* src/gpm-notify.h:
	* src/gpm-profile.c: (gpm_profile_class_init),
	(gpm_profile_load_data):
	* src/gpm-profile.h:
	Move the libnotify cracktastic notifiaction window to a simple tooltip.

2007-03-25  Richard Hughes  <richard@hughsie.com>

	* src/gpm-cell.c: (gpm_cell_refresh_all):
	Mark wireless devices as always discharging, so the notices work.

	* src/gpm-cell-array.c:
	* src/gpm-cell-array.h:
	* src/gpm-engine.c: (gpm_cell_array_charging_changed_cb):
	* src/gpm-proxy.c: (gpm_proxy_connect), (gpm_proxy_disconnect):
	Add a collection changed signal so we deal with hotplugged wireless
	devices.

2007-03-25  Loïc Minier  <lool@dooz.org>

	* applets/brightness/Makefile.am:
	* applets/inhibit/Makefile.am:
	Link applets against dbus-glib to fix build with non-dbus gnome-vfs;
	fixes #422345.

2007-03-24  Richard Hughes  <richard@hughsie.com>

	* src/gpm-backlight.c: (gpm_backlight_init):
	Patch from Young-Ho Cha, to sync dpms policy setting when starting.

2007-03-24  Richard Hughes  <richard@hughsie.com>

	* src/gpm-notify.c: (gpm_notify_estimated_data):
	Make sentance shorter.

2007-03-24  Richard Hughes  <richard@hughsie.com>

	* data/gpm-graph.glade:
	* src/gpm-graph-widget.c:
	* src/gpm-graph-widget.h:
	* src/gpm-statistics-core.c:
	Move the axis labels into the glade file so we can do the rotation
	there. This removes loads of complexity, and should make the upcoming
	pango-ification much easier.

2007-03-23  Richard Hughes  <richard@hughsie.com>

	* src/gpm-cell-array.c: (gpm_cell_array_get_description):
	Make the fully charged time remaining work.

	* data/gnome-power-manager.schemas.in:
	* src/gpm-conf.h:
	* src/gpm-manager.c: (gpm_profile_estimated_data_cb):
	* src/gpm-notify.c: (gpm_notify_estimated_data):
	* src/gpm-notify.h:
	* src/gpm-profile.c: (gpm_profile_class_init),
	(gpm_profile_get_time), (gpm_profile_estimated_data),
	(gpm_profile_load_data), (gpm_profile_get_accuracy):
	* src/gpm-profile.h:
	Emit a warning if we have not got enough profile data.

2007-03-23  Richard Hughes  <richard@hughsie.com>

	* src/gpm-cell-array.c: (gpm_cell_array_get_description):
	Display how much time we have, even with a fully charged battery.

	* src/gpm-profile.c: (gpm_profile_class_init),
	(gpm_profile_load_data), (gpm_profile_get_accuracy):
	* src/gpm-profile.h:
	Emit a signal when we create a file. Also provide a way to get the
	accuracy so we don't show stuff in the tooltip we can't justify.

2007-03-21  Richard Hughes  <richard@hughsie.com>

	* src/gpm-cell-array.c: (gpm_cell_array_get_description):
	Only show provides text if over 10 minutes.

	* src/gpm-engine.c: (gpm_engine_class_init):
	Correct the signal type.

	* src/gpm-notify.c: (gpm_notify_create):
	Make notifications longer.

2007-03-21  Richard Hughes  <richard@hughsie.com>

	* BRANCHES:
	Add some info about 2-19.

	* src/gpm-manager.c: (gpm_engine_charge_low_cb),
	(gpm_manager_get_time_until_action_text),
	(gpm_engine_charge_critical_cb):
	Make the primary critical low diaglue more modular, to avoid
	translators writing repetative long strings.

2007-03-21  Richard Hughes  <richard@hughsie.com>

	* src/gpm-cell.c: (hal_device_property_modified_cb):
	Reload the cell if we remove or add the ACPI battery.

2007-03-21  Richard Hughes  <richard@hughsie.com>

	* src/gpm-manager.c: (gpm_engine_fully_charged_cb),
	Correct a signal prototype, and don't notify by default on startup.

	* src/gpm-cell-array.c: (gpm_cell_array_get_time_until_action):
	* src/gpm-cell-array.h:
	* src/gpm-warning.c: (gpm_warning_init):
	Print the time remaining on the critical warning. Lots of new strings.

2007-03-20  Richard Hughes  <richard@hughsie.com>

	* src/gpm-power.c:
	* src/gpm-power.h:
	* src/gpm-battery.c:
	* src/gpm-battery.h:
	Remove this crappy code.

	* po/POTFILES.in:
	* src/Makefile.am:
	* src/gpm-engine.c: (ac_adaptor_changed_cb),
	* src/gpm-engine.h:
	* src/gpm-main.c: (main):
	* src/gpm-manager.c: (gpm_manager_sync_policy_sleep),
	* src/gpm-info.c: (gpm_info_set_collection_data),
	* src/gpm-info.h:
	* src/gpm-marshal.list:
	* src/gpm-tray-icon.c: (gpm_tray_icon_set_collection_data),
	* src/gpm-tray-icon.h:
	* src/gpm-warning.c: (gpm_warning_get_state_csr),
	* src/gpm-warning.h:
	* src/gpm-cell-array.c: (gpm_cell_array_get_unit),
	* src/gpm-cell-array.h:
	* src/gpm-cell.c: (gpm_cell_refresh_all),
	* test/Makefile.am:
	Add the engine component, so we can remove GpmBattery and GpmPower.

	* libhal-glib/libhal-gmanager.c: (hal_gmanager_init):

	* src/gpm-conf.h:
	* data/gnome-power-manager.schemas.in:
	Re-organsise the schema with better names, and with a tree structure.
	We have lots of keys, these need some structure.
	Yes, I'm aware we are not migrating settings, this is a major change.

	* docs/dbus-interface.xml:
	Correct some spelling error.

	* src/gpm-ac-adapter.h:
	* src/gpm-backlight.c: (gpm_backlight_sync_policy),
	* src/gpm-button.c: (emit_button_pressed):
	* src/gpm-cpufreq.c: (gpm_cpufreq_sync_policy),
	* src/gpm-srv-brightness-kbd.c: (conf_key_changed_cb),
	Make the AcAdapter callback simpler.

	* src/gdb-gpm.sh:
	Add this file so I can lauch gdb with fewer keystrokes. Yes, I'm lazy.

	* src/gpm-array.c: (gpm_array_compute_integral):
	Don't assert if we try to integrate from X->X, i.e. the same number.

	* src/gpm-cell.h:
	* src/gpm-control.c:
	* src/gpm-control.h:
	* src/gpm-feedback-widget.c: (gpm_feedback_init):
	* src/gpm-prefs-core.c: (gpm_prefs_setup_action_combo),
	* src/gpm-statistics-core.c: (gpm_statistics_init):
	General tidyups.

	* src/gpm-debug.c: (gpm_debug_add_option), (gpm_error_real),
	* src/gpm-debug.h:
	Don't use GTK+ error dialogues for errors, just print to the console.

	* src/gpm-profile.c: (gpm_profile_get_time),
	* src/gpm-profile.h:
	Use the engine, don't connect to HAL ourselves.

	* src/gpm-notify.c: (notify_closed_cb), (gpm_notify_create),
	* src/gpm-notify.h:
	Make many more dialogues interactive. We still don't handle multiple
	dialogs well, this to to fix real soon.

2007-03-19  Richard Hughes  <richard@hughsie.com>

	* Makefile.am:
	* configure.in:
	Make the self tests configurable.

2007-03-17  Richard Hughes  <richard@hughsie.com>

	* src/gpm-ac-adapter.c: (gpm_ac_adapter_is_present),
	(hal_device_property_modified_cb):
	* src/gpm-ac-adapter.h:
	* src/gpm-backlight.c: (gpm_backlight_sync_policy),
	(conf_key_changed_cb), (ac_adapter_changed_cb), (idle_changed_cb),
	(gpm_backlight_init):
	* src/gpm-cell-array.c: (gpm_cell_array_update):
	* src/gpm-cpufreq.c: (gpm_cpufreq_sync_policy):
	* src/gpm-info.c: (ac_adapter_changed_cb):
	* src/gpm-manager.c: (gpm_manager_sync_policy_sleep),
	(gpm_manager_get_on_ac), (gpm_manager_get_low_power_mode),
	(idle_do_sleep), (lid_button_pressed), (ac_adapter_changed_cb),
	(battery_status_changed_primary), (gpm_manager_init):
	* src/gpm-notify.c: (ac_adapter_changed_cb):
	* src/gpm-power.c: (battery_kind_cache_update),
	(power_get_summary_for_battery_kind),
	(gpm_power_get_status_summary), (ac_adaptor_changed_cb):
	* src/gpm-profile.c: (ac_adaptor_changed_cb), (gpm_profile_init):
	* src/gpm-sound.c: (ac_adapter_changed_cb):
	* src/gpm-srv-brightness-kbd.c: (conf_key_changed_cb),
	(ac_adapter_changed_cb):
	* src/gpm-srv-screensaver.c: (update_ac_throttle),
	(ac_adapter_changed_cb), (gpm_srv_screensaver_init):
	* src/gpm-tray-icon.c: (ac_adapter_changed_cb):
	Make the ac adapter state easier to get. We never return "unknown",
	so don't pretend we can generate it.

2007-03-17  Richard Hughes  <richard@hughsie.com>

	* configure.in:
	* data/Makefile.am:
	* data/gnome-power-manager.conf:
	Remove this file. We are not starting on the system bus and this should
	not be ever installed.

	* src/gpm-cell-array.c: (gpm_cell_array_percent_changed),
	(gpm_cell_percent_changed_cb), (gpm_cell_array_class_init):
	* src/gpm-cell-array.h:
	* src/gpm-conf.h:
	Add fully charged notification into the array, not the manager...

2007-03-15  Richard Hughes  <richard@hughsie.com>

	* src/gpm-cell-array.c: (gpm_cell_percent_changed_cb),
	(gpm_cell_array_class_init), (gpm_cell_array_init):
	* src/gpm-cell-array.h:
	Add the fully charged logic.

	* src/gpm-conf.h:
	* src/gpm-notify.c: (notify_recall_action_cb):
	* src/gpm-power.c: (battery_device_cache_entry_update_all):
	Add an extra key, and change the defined name of another.
	FIXME: Add into schema.

2007-03-15  Richard Hughes  <richard@hughsie.com>

	* src/gpm-cell-array.c: (gpm_cell_array_index_udi),
	(gpm_check_device_key), (gpm_cell_array_add),
	(gpm_cell_array_set_type), (hal_device_removed_cb),
	(hal_new_capability_cb), (hal_device_added_cb),
	(gpm_cell_array_init):
	Add code to detect batteries plugged in or removed at runtime.

	* src/gpm-cell.c: (gpm_cell_get_udi):
	* src/gpm-cell.h:
	Add required method to check for duplicates.

2007-03-15  Richard Hughes  <richard@hughsie.com>

	* src/gpm-tray-icon.c: (gpm_tray_icon_show),
	(gpm_tray_icon_set_image_from_stock), (gpm_tray_icon_sync):
	Simplify the icon display code. Fixes g-p-m on the KDE tray.
	Many thank to Pascal Terjan for the patch. Fixes #414032

2007-03-15  Richard Hughes  <richard@hughsie.com>

	* data/gnome-power-manager.schemas.in:
	More spelling and grammer mistakes. Fixes #393388

2007-03-15  Richard Hughes  <richard@hughsie.com>

	* data/gnome-power-statistics.desktop.in:
	GNOME Goal #3: Remove "Application" category from .desktop files
	Fixes #417006

2007-03-15  Richard Hughes  <richard@hughsie.com>

	* data/gnome-power-manager.schemas.in:
	Fix grammatical errors in descriptions. Fixes #417291

2007-03-14  Richard Hughes  <richard@hughsie.com>

	* src/gpm-profile.c:
	Fix the battery charged before 100% case, as it was being marked as
	invalid.

	* test/gpm-st-main.c: (main):
	Add command line arguments for the type of tests to be run.

2007-03-14  Richard Hughes  <richard@hughsie.com>

	* src/gpm-profile.c: (gpm_profile_register_percentage):
	Only allow accuracy to get to 100%

2007-03-14  Richard Hughes  <richard@hughsie.com>

	* libhal-glib/libhal-gdevicestore.c: (hal_gdevicestore_finalize):
	Free the device array.

	* src/gpm-cell-array.c:
	* src/gpm-cell-array.h:
	* src/gpm-cell-unit.c:
	* src/gpm-cell-unit.h:
	Add GpmCellArray class to manage sets of GpmCells.

	* src/gpm-cell.c: (gpm_cell_class_init):
	Correct signal ID.

	* test/Makefile.am:
	* test/gpm-st-cell-array.c:
	* test/gpm-st-main.c: (main):
	* test/gpm-st-main.h:
	Add test case for GpmCellArray.

2007-03-13  Richard Hughes  <richard@hughsie.com>

	* src/gpm-cell.c: (gpm_cell_get_icon):
	* src/gpm-cell.h:
	Add a helper function.

	* test/gpm-selftest-hal-devices.fdi:
	* test/install-fdi.sh:
	Add these files to create fake HAL properties for testing.

2007-03-13  Richard Hughes  <richard@hughsie.com>

	* docs/calculate-video-fdi.sh:
	Remove file, we don't need this data anymore.

	* src/gpm-profile.c:
	Correctly profile batteries that stop charging before they get to
	100%.

	* test/gpm-st-cell.c: (gpm_cell_perhaps_recall_cb), (gpm_st_cell):
	Test to see if the recall notifier was called.

2007-03-13  Richard Hughes  <richard@hughsie.com>

	* src/gpm-cell-unit.c (gpm_cell_unit_get_kind_localised):
	* src/gpm-cell-unit.h:
	* test/gpm-st-cell-unit.c (gpm_st_cell_unit):
	Allow pluralised descriptions.

2007-03-13  Richard Hughes  <richard@hughsie.com>

	* src/gpm-cell-unit.c:
	* src/gpm-cell-unit.h:
	* src/gpm-cell.c:
	* src/gpm-cell.h:
	* test/Makefile.am:
	* test/gpm-st-cell-unit.c:
	Add some more common code, and some more test cases.

2007-03-12  Richard Hughes  <richard@hughsie.com>

	* test/gpm-st-cell-unit.c: (gpm_st_cell_unit):
	* src/gpm-cell-unit.c: (gpm_cell_unit_set_measure):
	* src/gpm-cell-unit.h:
	Create a new function to set the measurement unit.

	* src/gpm-profile.c:
	Make the graphs smoother, and put into a constant value.

	* src/gpm-cell.c:
	* src/gpm-cell.h:
	* src/gpm-marshal.list:
	* test/Makefile.am:
	* test/gpm-st-cell.c: (gpm_st_cell):
	* test/gpm-st-main.c: (main):
	* test/gpm-st-main.h:
	Add GpmCell, a generic class for a single battery object.

2007-03-12  Richard Hughes  <richard@hughsie.com>

	* test/Makefile.am:
	* test/gpm-st-cell-unit.c: (gpm_st_cell_unit):
	* test/gpm-st-main.c: (main):
	* test/gpm-st-main.h:
	* src/gpm-cell-unit.c:
	* src/gpm-cell-unit.h:
	GpmPower and GpmBattery confuse me greatly. I'll be abstracting these
	out in the next few days into GpmCellUnit, GpmCell and GpmCellAray,
	which hopefully will be easier to read.
	Add the GpmCellUnit helper, and unit tests for now, but nothing
	uses it yet, so no worries.

2007-03-11  Richard Hughes  <richard@hughsie.com>

	* src/dbus/gpm-dbus-manager.xml:
	* src/gpm-manager.c:
	* src/gpm-manager.h:
	Remove depricated Manager DBUS interface.

	* src/gpm-power.c: (gpm_power_init), (gpm_power_finalize):
	* src/gpm-profile.h:
	Add in prelim profile support. Does nothing yet.

2007-03-10  Richard Hughes  <richard@hughsie.com>

	* src/gpm-power.c: (gpm_power_status_for_device):
	* src/gpm-power.h:
	* src/gpm-tray-icon.c: (gpm_tray_icon_show_info_cb):
	Improve the tray icon libnotify device information window.

2007-03-10  Richard Hughes  <richard@hughsie.com>

	* test/gpm-st-array.c: (gpm_st_array):
	Add some self tests for the integration.

	* src/gpm-array.c: (gpm_array_compute_integral):
	* src/gpm-manager.c: (gpm_manager_init):
	Fix two bugs with the integration.

2007-03-10  Richard Hughes  <richard@hughsie.com>

	* src/gpm-profile.c: (gpm_profile_register_percentage):
	Fix a thinko where we were checking the wrong thing.

2007-03-10  Richard Hughes  <richard@hughsie.com>

	* po/POTFILES.in:
	Fix make distcheck.

2007-03-10  Richard Hughes  <richard@hughsie.com>

	* src/gpm-array.c:
	* test/Makefile.am:
	* test/gpm-self-test.c:
	* test/gpm-st-array.c: (gpm_st_array):
	* test/gpm-st-common.c: (gpm_st_common):
	* test/gpm-st-hal-device.c: (gpm_st_hal_device):
	* test/gpm-st-hal-devicestore.c: (gpm_st_hal_devicestore):
	* test/gpm-st-hal-manager.c: (gpm_st_hal_manager):
	* test/gpm-st-hal-power.c: (gpm_st_hal_power):
	* test/gpm-st-inhibit.c: (gpm_st_inhibit):
	* test/gpm-st-main.c:
	* test/gpm-st-main.h:
	* test/gpm-st-proxy.c: (gpm_st_proxy):
	Modulalize the test program.

2007-03-10  Richard Hughes  <richard@hughsie.com>

	* src/gpm-info.c: (gpm_statistics_get_data_types):
	* src/gpm-info.h:
	* src/gpm-manager.c: (gpm_manager_init), (gpm_manager_finalize):
	* src/gpm-profile.c: (gpm_profile_get_data_file),
	* src/gpm-profile.h:
	Convert the GpmProfile class back into a singleton and handle both
	charging and discharging data. We'll use less memory and resources this
	way, and we also don't have to play horrible pointer passing games.

2007-03-10  Richard Hughes  <richard@hughsie.com>

	* src/gpm-array.c: (gpm_array_compute_uwe_self),
	(gpm_array_compute_uwe), (gpm_array_copy), (gpm_array_copy_append):
	* src/gpm-array.h:
	* test/gpm-self-test.c: (test_gpm_array):
	Create some new functions to help us with the data smoothing.

	* src/gpm-profile.c: (gpm_profile_get_data_time_percent),
	(gpm_profile_get_data_accuracy_percent):
	* src/gpm-statistics-core.c:
	Smooth the data we use, and report over the interface.

2007-03-10  Richard Hughes  <richard@hughsie.com>

	* src/gpm-profile.c: (gpm_profile_init):
	Don't hardcode the UDI of my battery, try to discover it. Bodge.

2007-03-10  Richard Hughes  <richard@hughsie.com>

	* src/gpm-array.c: (gpm_array_add):
	Fix a crash after we try to do gpm_array_limit_x_size and then
	gpm_array_limit_x_width and access a cached length that's invalid.

	* src/gpm-info.c: (gpm_info_register_profile):
	* src/gpm-info.h:
	* src/gpm-manager.c: (gpm_manager_init), (gpm_manager_finalize):
	* src/gpm-profile.c: (gpm_profile_get_data_file):
	Make the profile code work.

2007-03-09  Richard Hughes  <richard@hughsie.com>

	* src/gpm-array.c: (gpm_array_compute_uwe):
	* src/gpm-array.h:
	* src/gpm-profile.c: (gpm_profile_get_data_time_percent):
	Add a new function to compute the uniform weighted average of
	the whole dataset. This is a very nice smoothing function.

2007-03-09  Richard Hughes  <richard@hughsie.com>

	* src/gpm-common.h:
	* src/gpm-graph-widget.c: (gpm_graph_widget_key_add),
	* src/gpm-graph-widget.h:
	* src/gpm-info.c: (gpm_info_log_do_poll):
	* src/gpm-profile.c: (gpm_profile_get_data_time_percent),
	* src/gpm-statistics-core.c: (gpm_statistics_init):
	Allow the graphs to be any colour, and rip out the crazy enumerated
	colour types. This lets us do some very cool stuff.

2007-03-09  Richard Hughes  <richard@hughsie.com>

	* src/gpm-common.c: (gpm_rgb_to_colour), (gpm_colour_to_rgb):
	* src/gpm-common.h:
	* test/gpm-self-test.c: (test_common), (main):
	Add some colour handling code. I want to sort out the graph colours.

2007-03-09  Richard Hughes  <richard@hughsie.com>

	* src/gpm-profile.c:
	Add DPMS state monitoring. When the panel is off, we are not
	representative of power used.

2007-03-09  Richard Hughes  <richard@hughsie.com>

	* src/gpm-array.c:
	Comment fix.

	* src/gpm-graph-widget.c:
	Add better checks for empty arrays.

	* src/gpm-info.c:
	* src/gpm-profile.c: (gpm_profile_get_data_file),
	* src/gpm-statistics-core.c:
	Add some more types, colourize the graphs, and fit the average for
	unknown data.

2007-03-09  Richard Hughes  <richard@hughsie.com>

	* po/POTFILES.in:
	Fix make distcheck. Oops.

	* src/gpm-graph-widget.c: (gpm_graph_widget_auto_range):
	Allow down to 4 minutes in the y autoscale.

	* src/gpm-info.c:
	* src/gpm-profile.c: (gpm_profile_init):
	* src/gpm-statistics-core.c:
	Prefix with charging and discharging for future usage.

2007-03-08  Richard Hughes  <richard@hughsie.com>

	* src/gpm-profile.c:
	* src/gpm-profile.h:
	Use the load in a sane way, and also don't count the first reading as
	we may be between updates.

2007-03-08  Richard Hughes  <richard@hughsie.com>

	* src/gpm-graph-widget.c: (gpm_graph_widget_get_axis_label_x):
	Add X percentage caption text.

	* src/gpm-info.c:
	* src/gpm-manager.c:
	* src/gpm-profile.c:
	* src/gpm-profile.h:
	* src/gpm-statistics-core.c:
	Load the profile module, and export the data over DBUS.

2007-03-08  Richard Hughes  <richard@hughsie.com>

	* src/gpm-array.h:
	Fixed compile error. Oops.

	* src/Makefile.am:
	* src/gpm-profile.c:
	* src/gpm-profile.h:
	Add files to do battery profile. Do not use these yet.

2007-03-08  Richard Hughes  <richard@hughsie.com>

	* src/gpm-array.c: (gpm_array_set):
	* src/gpm-array.h:
	Add a new trivial function to set elements of an array.

2007-03-08  Richard Hughes  <richard@hughsie.com>

	* src/gpm-array.c: (gpm_array_append_from_file);
	Add a check to ensure the data is not fixed size.

	* src/gpm-array.c: (gpm_array_load_from_file):
	* src/gpm-array.h:
	Add a new function to load a fixed size dataset.

2007-03-07  Richard Hughes  <richard@hughsie.com>

	* po/POTFILES.in:
	* src/Makefile.am:
	* src/gpm-idle.c:
	* src/gpm-load.c:
	* src/gpm-load.h:
	Split out the CPU load functionality into a super small GObject
	so that we can use it for other future (super cool) stuff.

2007-03-07  Richard Hughes  <richard@hughsie.com>

	* src/gpm-hal.c:
	* src/gpm-hal.h:
	Woohoo. Remove the monstrosity that was GpmHal.
	 gpm-hal.c | 1550 -----------------------------
	 gpm-hal.h |  169 -----------------------------
	 2 files changed, 1719 deletions(-)

2007-03-07  Richard Hughes  <richard@hughsie.com>

	* po/POTFILES.in:
	* src/Makefile.am:
	* src/gpm-power.c:
	* src/gpm-power.h:
	* src/gpm-tray-icon.c:
	Switch to using libhal-glib functions rather than gpm-hal.
	This completes the transformation, and was the most complex to do.
	If there are bugs in the new system, they will be exposed here. ;-)

2007-03-07  Richard Hughes  <richard@hughsie.com>

	* src/gpm-brightness-kbd.c:
	* src/gpm-brightness-lcd.c:
	Switch to using libhal-glib functions rather than gpm-hal.

2007-03-07  Richard Hughes  <richard@hughsie.com>

	* src/gpm-light-sensor.c:
	Switch to using libhal-glib functions rather than gpm-hal.

2007-03-07  Richard Hughes  <richard@hughsie.com>

	* src/gpm-srv-brightness-kbd.c: (gpm_srv_brightness_kbd_init):
	Remove GpmHal stuff. Nothing uses it in this class.

2007-03-07  Richard Hughes  <richard@hughsie.com>

	* test/gpm-self-test.c: (test_gpm_array):
	Add a test for gpm_array_limit_x_size to try to trigger #415717

	* src/gpm-array.c: (gpm_array_limit_x_size), (gpm_array_add):
	Hopefully fix the crash in #415717, where we were accessing longer
	than the array size, as the length of the array was not re-evaluated
	when an element was removed.
	This might be also the source of some odd 2.17.x bugs.

2007-03-07  Richard Hughes  <richard@hughsie.com>

	* libhal-glib/libhal-gdevicestore.c: (hal_gdevicestore_remove):
	Unref the device because this may be the only pointer to this instance.

	* test/gpm-self-test.c: (test_hal_devicestore):
	Fix the test to ref the object before deletion else we get an error.

	* src/gpm-battery.c:
	Switch to using libhal-glib functions rather than gpm-hal and a custom
	hacky hashtable implimentation.
	Unplug and plug events are also handled much quicker now!

2007-03-07  Richard Hughes  <richard@hughsie.com>

	* libhal-glib/libhal-gdevicestore.c: (hal_gdevicestore_find_udi):
	* libhal-glib/libhal-gdevicestore.h:
	* test/gpm-self-test.c: (test_hal_devicestore):
	Provide methods to find the HalGDevice from the UDI.

2007-03-07  Richard Hughes  <richard@hughsie.com>

	* src/Makefile.am:
	* src/gpm-button.c:
	Switch to using libhal-glib functions rather than gpm-hal and a custom
	hacky hashtable implimentation.

2007-03-07  Richard Hughes  <richard@hughsie.com>

	* libhal-glib/Makefile.am:
	* libhal-glib/libhal-gdevicestore.c:
	* test/Makefile.am:
	* test/gpm-self-test.c:
	Add a new devicestore class that, well, stores devices.

2007-03-07  Richard Hughes  <richard@hughsie.com>

	* src/gpm-brightness-lcd.c: (gpm_brightness_lcd_get_hw):
	Make sure we initialize a value to zero to prevent a warning if the
	method call fails.

2007-03-07  Richard Hughes  <richard@hughsie.com>

	* po/POTFILES.in:
	* src/Makefile.am:
	* src/gpm-backlight.c:
	* src/gpm-backlight.h:
	* src/gpm-manager.c:
	* src/gpm-srv-backlight.c:
	* src/gpm-srv-backlight.h:
	Switch to using libhal-glib manager functions rather than gpm-hal.
	Rename from gpm-srv-backlight to gpm-backlight.

2007-03-07  Richard Hughes  <richard@hughsie.com>

	* src/gpm-srv-backlight.c:
	Switch to using libhal-glib manager functions rather than gpm-hal.

2007-03-06  Richard Hughes  <richard@hughsie.com>

	* src/gpm-info.c: (gpm_info_init), (gpm_info_finalize):
	Switch to using libhal-glib manager functions rather than gpm-hal.

2007-03-06  Richard Hughes  <richard@hughsie.com>

	* src/README:
	Remove obsolete file.

	* po/POTFILES.in:
	* src/Makefile.am:
	* src/gpm-srv-cpufreq.c:
	* src/gpm-srv-cpufreq.h:
	* src/gpm-cpufreq.c:
	* src/gpm-cpufreq.h:
	* src/gpm-manager.c:
	Rename from gpm-srv-cpufreq to gpm-cpufreq, no need for the srv prefix.

2007-03-06  Richard Hughes  <richard@hughsie.com>

	* po/POTFILES.in:
	* src/Makefile.am:
	* src/gpm-cpufreq.c:
	* src/gpm-cpufreq.h:
	Remove gpm-cpufreq as it is no longer required.

2007-03-06  Richard Hughes  <richard@hughsie.com>

	* src/gpm-srv-cpufreq.c:
	Switch to using libhal-glib cpufreq functions rather than gpm-cpufreq.

2007-03-06  Richard Hughes  <richard@hughsie.com>

	* libhal-glib/libhal-gcpufreq.c:
	Whitespace fixes.

	* src/gpm-prefs-core.c:
	Switch to using libhal-glib cpufreq functions rather than gpm-hal.

2007-03-06  Richard Hughes  <richard@hughsie.com>

	* src/gpm-manager.c:
	Switch to using libhal-glib power functions rather than gpm-hal.

2007-03-06  Richard Hughes  <richard@hughsie.com>

	* src/gpm-control.c:
	Switch to using libhal-glib power functions rather than gpm-hal.

2007-03-06  Richard Hughes  <richard@hughsie.com>

	* libhal-glib/libhal-gpower.c:
	* libhal-glib/libhal-gpower.h:
	Cleanup the class variable names a bit.

2007-03-06  Richard Hughes  <richard@hughsie.com>

	* libhal-glib/libhal-gdevice.c:
	* libhal-glib/libhal-gdevice.h:
	* libhal-glib/libhal-gmanager.c:
	* libhal-glib/libhal-gmanager.h:
	* libhal-glib/libhal-marshal.list:
	Merge a whole heap of cleanups, and remove the udi from the
	property modified and devive condition callbacks.

	* src/gpm-ac-adapter.c: (gpm_ac_adapter_get_state):
	Switch to using the libhal-glib functions rather than gpm-hal.

2007-03-06  Richard Hughes  <richard@hughsie.com>

	* configure.in:
	* libhal-glib/libhal-gpower.c:
	* src/gpm-hal.c: (gpm_hal_can_suspend), (gpm_hal_can_hibernate),
	(gpm_hal_clear_suspend_error), (gpm_hal_clear_hibernate_error):
	* src/gpm-power.c: (gpm_power_status_for_device_more):
	Increase dependency on HAL to 0.5.8 and remove a lot of the
	compatibility code.

2007-03-06  Richard Hughes  <richard@hughsie.com>

	* configure.in:
	* src/gpm-notify.c: (gpm_notify_create):
	Increase dependency on libnotify to 0.4.3 and remove a lot of the
	compatibility code working around the broken GtkStatusIcon support.

2007-03-04  Richard Hughes  <richard@hughsie.com>

	* po/POTFILES.in:
	* src/Makefile.am:
	* src/gpm-graph-widget.c: (gpm_graph_widget_finalize),
	* src/gpm-graph-widget.h:
	* src/gpm-info.c: (gpm_statistics_get_data_types),
	* src/gpm-statistics-core.c: (gpm_statistics_get_events),
	Remove gpm-info-data.* and use gpm-array.* instead.

	* test/gpm-self-test.c: (test_gpm_array):
	Add another test for the interpolation.

	* src/gpm-refcount.c: (gpm_refcount_finalize):
	Whitespace fixes.

2007-03-04  Richard Hughes  <richard@hughsie.com>

	* src/gpm-array.c:
	* src/gpm-array.h:
	Add a supercool, superfast (tested) smart array class with some nifty
	mathematics and convenient processing functions. The idea is to convert
	the old GpmInfoData code to the new GpmArray code.

	* test/Makefile.am:
	* test/gpm-self-test.c:
	Add lots of test cases for the new GpmArray object.

2007-03-04  Richard Hughes  <richard@hughsie.com>

	* src/*:
	* applets/*:
	* libhal-glib/*:
	Remove an insane amount of trailing whitespace.

2007-03-04  Richard Hughes  <richard@hughsie.com>

	* Makefile.am:
	Build the library first to fix make distcheck.

	* src/Makefile.am:
	Add the libhal-glib paths. Nothing uses these yet.

2007-03-04  Richard Hughes  <richard@hughsie.com>

	* libhal-glib/Makefile.am:
	Add file that missed the import.

2007-03-04  Richard Hughes  <richard@hughsie.com>

	* applets/inhibit/inhibit-applet.c:
	* src/gpm-ac-adapter.c: (gpm_ac_adapter_finalize):
	Trivial fixes.

2007-03-04  Richard Hughes  <richard@hughsie.com>

	* test/Makefile.am:
	* test/gpm-self-test.c:
	Add lots of extra self-tests for the new HalG* classes.

2007-03-04  Richard Hughes  <richard@hughsie.com>

	* libhal-glib/libhal-gcpufreq.c: (hal_gcpufreq_finalize),
	* libhal-glib/libhal-gmanager.c: (hal_gmanager_finalize),
	* libhal-glib/libhal-gpower.c: (hal_gpower_init),
	* libhal-glib/libhal-gpower.h:
	* src/gpm-button.c: (gpm_button_finalize), (gpm_button_new):
	* src/gpm-conf.c: (gpm_conf_new):
	* src/gpm-control.c: (gpm_control_new):
	* src/gpm-dbus-monitor.c: (gpm_dbus_monitor_finalize),
	* src/gpm-dpms.c: (gpm_dpms_new):
	* src/gpm-idle.c: (gpm_idle_new):
	* src/gpm-light-sensor.c: (gpm_light_sensor_new):
	* src/gpm-main.c:
	* src/gpm-notify.c: (gpm_notify_finalize), (gpm_notify_new):
	* src/gpm-power.c: (gpm_power_new):
	* src/gpm-screensaver.c: (gpm_screensaver_new):
	* src/gpm-sound.c: (gpm_sound_finalize), (gpm_sound_new):
	* src/gpm-warning.c: (gpm_warning_new):
	Use the g_object_add_weak_pointer function rather than rely on the
	fact that we *shouldn't* hit the finalise->new case.

2007-03-04  Richard Hughes  <richard@hughsie.com>

	* Makefile.am:
	* configure.in:
	* po/POTFILES.in:
	* src/Makefile.am:
	* src/gpm-inhibit-test.c:
	* src/gpm-self-test.c:
	* test/Makefile.am:
	* test/gpm-self-test.c:
	Move test files to thier own directory.

	* docs/dbus-interface.html:
	* docs/faq.html:
	* docs/icon-scheme.html:
	* docs/index.html:
	* docs/sleep-names.html:
	Regenerate with new versions.

2007-03-04  Richard Hughes  <richard@hughsie.com>

	* Makefile.am:
	* configure.in:
	* libhal-glib/libhal-gcpufreq.c: (hal_gcpufreq_string_to_enum),
	* libhal-glib/libhal-gcpufreq.h:
	* libhal-glib/libhal-gdevice.c: (hal_gdevice_set_udi),
	* libhal-glib/libhal-gdevice.h:
	* libhal-glib/libhal-gmanager.c: (hal_gmanager_is_running),
	* libhal-glib/libhal-gmanager.h:
	* libhal-glib/libhal-gpower.c: (hal_gpower_class_init),
	* libhal-glib/libhal-gpower.h:
	* libhal-glib/libhal-marshal.list:
	Add a really simple libhal glib binding to greatly simplify the
	HAL access in gnome-power-manager.

2007-03-04  Richard Hughes  <richard@hughsie.com>

	* src/massif-gpm.sh:
	* src/run-gpm.sh:
	Add the profile script, and adjust the run tool to make critical
	warnings fatal.

2007-03-04  Richard Hughes  <richard@hughsie.com>

	* data/gnome-power-preferences.desktop.in:
	* data/gnome-power-statistics.desktop.in:
	Add StartupNotify to get the pretty busy cursor when loading.
	Patch from Sven Arvidsson, fixes #414311

2007-03-04  Richard Hughes  <richard@hughsie.com>

	Branched for 2-18

2007-03-04  Richard Hughes  <richard@hughsie.com>

	* src/gpm-graph-widget.c: (gpm_graph_widget_draw_line):
	* src/gpm-statistics-core.c: (gpm_statistics_graph_refresh):
	Fix the segfault when we try to draw a graph that does not exist.
	Fixes #412345 and plenty more duplicates.

2007-03-04  Richard Hughes  <richard@hughsie.com>

	* src/gpm-notify.c: (gpm_notify_create):
	Don't point to the icon if it's not currently showing. Fixes #414010

2007-03-01  Richard Hughes  <richard@hughsie.com>

	* src/gpm-power.c: (battery_key_changed):
	Merge a modified patch from Peter Jones (thanks!) to properly
	handle when a battery is removed and inserted when hibernated, or
	just replaced with really broken ACPI.

2007-03-01  Richard Hughes  <richard@hughsie.com>

	* src/gpm-power.c: (battery_device_cache_entry_update_all):
	Merge a patch from Peter Jones to actually get the vendor of the
	battery. We should have been using battery.vendor and not info.vendor.

2007-02-27  Richard Hughes  <richard@hughsie.com>

	==== Version 2.17.92 ====

2007-02-27  Richard Hughes  <richard@hughsie.com>

	* configure.in:
	Bump to 2.17.92

2007-02-27  Richard Hughes  <richard@hughsie.com>

	* applets/brightness/brightness-applet.c:
	* data/gnome-power-manager.schemas.in:
	Fix two trivial spelling typos to fix #411592

2007-02-18  Richard Hughes  <richard@hughsie.com>

	* src/gpm-power.c: (gpm_power_init), (gpm_power_finalize):
	Don't ref and unref hal twice for no reason.

	* src/gpm-srv-backlight.c: (button_pressed_cb):
	Check to see if we can do the action to fix #407613

2007-02-18  Richard Hughes  <richard@hughsie.com>

	* src/gpm-proxy.c:
	Save the signal connection id's and remove then when we finalize.
	Prevents a very difficult to trigger and even more difficult to debug
	crasher where proxy instances are connecting to GpmDbusMonitor objects.

2007-02-17  Richard Hughes  <richard@hughsie.com>

	* src/gpm-hal.c: (gpm_hal_device_get_bool),
	(gpm_hal_device_get_string), (gpm_hal_device_get_int),
	(gpm_hal_device_find_capability), (gpm_hal_device_has_capability):
	Check for a NULL proxy when we access HAL to help debug #408705

2007-02-14  Benjamin Canou  <bookeldor@gmail.com>

	* applets/brightness/brightness-applet.c:
	Patch against the SVN trunk to enable scroll and keyboard events.
	It corrects also corrects two little bugs too: tooltips are not shown
	anymore when popped, and a comment was wrong.
	There's still a bug: themes using an image as background are not
	handled correctly. I'll try to correct it soon. Fixes #383653

2007-02-13  Richard Hughes  <richard@hughsie.com>

	* src/gpm-srv-backlight.c: (ac_adapter_changed_cb):
	Check we have the hardware before trying to set the brightness.
	Trivial patch. Fixes #407613

2007-02-12  Richard Hughes  <richard@hughsie.com>

	==== Version 2.17.91 ====

2007-02-12  Richard Hughes  <richard@hughsie.com>

	* docs/dbus-interface.html:
	* docs/index.html:
	Regenerate

	* tools/Makefile.am:
	* tools/gnome-power-cmd.sh:
	Add this new trivial script to fix #405013

2007-02-12  Richard Hughes  <richard@hughsie.com>

	* docs/dbus-interface.xml:
	Fix up a load of spelling errors.

	* tools/gnome-power-bugreport.sh:
	Update copyright year.

2007-02-11  Richard Hughes  <richard@hughsie.com>

	* applets/inhibit/inhibit-applet.c:
	* src/gpm-ac-adapter.c:
	* src/gpm-ac-adapter.h:
	* src/gpm-battery.c:
	* src/gpm-battery.h:
	* src/gpm-brightness-kbd.c:
	* src/gpm-brightness-kbd.h:
	* src/gpm-brightness-lcd.c:
	* src/gpm-brightness-lcd.h:
	* src/gpm-button.c:
	* src/gpm-button.h:
	* src/gpm-common.c:
	* src/gpm-common.h:
	* src/gpm-conf.c:
	* src/gpm-conf.h:
	* src/gpm-control.c:
	* src/gpm-control.h:
	* src/gpm-cpufreq.c:
	* src/gpm-cpufreq.h:
	* src/gpm-dbus-monitor.c:
	* src/gpm-dbus-monitor.h:
	* src/gpm-debug.c:
	* src/gpm-debug.h:
	* src/gpm-feedback-widget.c:
	* src/gpm-feedback-widget.h:
	* src/gpm-graph-widget.c:
	* src/gpm-graph-widget.h:
	* src/gpm-hal.c:
	* src/gpm-hal.h:
	* src/gpm-idle.c:
	* src/gpm-info-data.c:
	* src/gpm-info-data.h:
	* src/gpm-info.c:
	* src/gpm-info.h:
	* src/gpm-inhibit-test.c:
	* src/gpm-inhibit.c:
	* src/gpm-inhibit.h:
	* src/gpm-light-sensor.c:
	* src/gpm-light-sensor.h:
	* src/gpm-main.c:
	* src/gpm-manager.c:
	* src/gpm-manager.h:
	* src/gpm-networkmanager.c:
	* src/gpm-networkmanager.h:
	* src/gpm-notify.c:
	* src/gpm-notify.h:
	* src/gpm-polkit.c:
	* src/gpm-polkit.h:
	* src/gpm-power.c:
	* src/gpm-power.h:
	* src/gpm-powermanager.c:
	* src/gpm-powermanager.h:
	* src/gpm-prefs-core.c:
	* src/gpm-prefs-core.h:
	* src/gpm-prefs.c:
	* src/gpm-prefs.h:
	* src/gpm-proxy.c:
	* src/gpm-proxy.h:
	* src/gpm-refcount.c:
	* src/gpm-refcount.h:
	* src/gpm-screensaver.c:
	* src/gpm-screensaver.h:
	* src/gpm-sound.c:
	* src/gpm-sound.h:
	* src/gpm-srv-backlight.c:
	* src/gpm-srv-backlight.h:
	* src/gpm-srv-brightness-kbd.c:
	* src/gpm-srv-brightness-kbd.h:
	* src/gpm-srv-cpufreq.c:
	* src/gpm-srv-cpufreq.h:
	* src/gpm-srv-screensaver.c:
	* src/gpm-srv-screensaver.h:
	* src/gpm-statistics-core.c:
	* src/gpm-statistics-core.h:
	* src/gpm-statistics.c:
	* src/gpm-stock-icons.c:
	* src/gpm-stock-icons.h:
	* src/gpm-tray-icon.c:
	* src/gpm-tray-icon.h:
	* src/gpm-warning.c:
	* src/gpm-warning.h:
	Update my copyright statement to 2007.

2007-02-11  Richard Hughes  <richard@hughsie.com>

	* src/gpm-battery.c: (gpm_battery_init):
	Fix a tiny memory leak as spotted in #404929

2007-02-10  Richard Hughes  <richard@hughsie.com>

	* src/gpm-battery.c: (coldplug_batteries):
	Do not try to dereference error if we find no battery devices, it might
	actually be okay. Rework the error handling a little to fix #406529

	* src/gpm-ac-adapter.c: (gpm_ac_adapter_init):
	* src/gpm-button.c: (gpm_button_init):
	Fix two small memory leaks when no devices are found.

2007-02-10  Richard Hughes  <richard@hughsie.com>

	* src/gpm-srv-backlight.c: (gpm_srv_backlight_init):
	Part of a patch from Jon McCann:
	Don't use the ac-adapter object before you create it.
	Fixes half of #404474.

2007-02-08  Richard Hughes  <richard@hughsie.com>

	* src/gpm-common.c: (gpm_exponential_average):
	* src/gpm-common.h:
	Rename factor_pc into slew.

	* src/gpm-graph-widget.c:
	* src/gpm-graph-widget.h:
	Add graph title functionality. No UI change, as g-p-s does't do titles.

2007-02-07  Richard Hughes  <richard@hughsie.com>

	* src/gpm-battery.c: (watch_add_battery):
	Fix the bug where hotplug batteries (such as mice) would show up more
	than once after a suspend-resume cycle. Fixes #404929.

2007-02-07  Richard Hughes  <richard@hughsie.com>

	* src/gpm-graph-widget.c: (gpm_graph_widget_draw_labels),
	(gpm_graph_widget_get_pos_on_graph):
	Fix a bug where the labels were negative and the line didn't show
	when our starting auto-range vale was not zero.

2007-02-07  Richard Hughes  <richard@hughsie.com>

	* src/gpm-graph-widget.c: (gpm_graph_widget_set_data):
	Allow datasets to be over-written with new data.

2007-02-07  Richard Hughes  <richard@hughsie.com>

	* src/gpm-common.c: (gpm_exponential_average):
	* src/gpm-common.h:
	* src/gpm-power.c: (battery_kind_cache_update):
	Move common functionality to a shared file. No logic changes.

2007-02-07  Richard Hughes  <richard@hughsie.com>

	* src/gpm-graph-widget.c: (gpm_graph_widget_auto_range):
	Don't autorange INVALID graphs.

2007-02-07  Richard Hughes  <richard@hughsie.com>

	* src/gpm-graph-widget.c:
	* src/gpm-graph-widget.h:
	* src/gpm-statistics-core.c:
	Allow the graph widget to display more than one data line.
	This is required for the detailed line fitting algorithm testing.

2007-02-06  Richard Hughes  <richard@hughsie.com>

	* src/gpm-info.c:
	Remove some superfluous debugging text.

2007-02-06  Richard Hughes  <richard@hughsie.com>

	* src/gpm-info.c: (gpm_statistics_get_data_types):
	* src/gpm-statistics-core.c: (gpm_statistics_type_combo_changed_cb):
	Prevent a crasher when we open the statistics program very soon after
	we start gnome-power-manager.

2007-02-06  Richard Hughes  <richard@hughsie.com>

	* src/gpm-brightness-kbd.c: (gpm_brightness_kbd_set_hw):
	Apply patch from David Zeuthen <david@fubar.dk>:
	g-p-m times out on lots of method calls on startup.
	Attached patch makes it work for me on my Macbook Pro.

2007-02-06  Richard Hughes  <richard@hughsie.com>

	* data/gpm-graph.glade:
	* src/gpm-graph-widget.c:
	* src/gpm-graph-widget.h:
	* src/gpm-statistics-core.c:
	Add the graph axis caption support. Fixes the first half of #394526

2007-02-06  Richard Hughes  <richard@hughsie.com>

	* src/gpm-graph-widget.c:
	* src/gpm-graph-widget.h:
	* src/gpm-statistics-core.c:
	Add some initial code to support axis labels. No UI change yet.

2007-02-06  Richard Hughes  <richard@hughsie.com>

	* docs/dbus-interface.xml:
	* src/dbus/gpm-dbus-statistics.xml:
	* src/gpm-info.c:
	* src/gpm-info.h:
	* src/gpm-statistics-core.c:
	Rename two methods in the new statistics API for clarity.
	Changed from GetAxisType->GetAxisTypes and GetTypes->GetDataTypes.

2007-02-06  Richard Hughes  <richard@hughsie.com>

	* data/gnome-power-manager.schemas.in:
	* src/gpm-conf.h:
	Add the key statistics_show_axis_labels before the string freeze.
	We might get this feature tested and in before the next release.

2007-02-05  Richard Hughes  <richard@hughsie.com>

	* data/gpm-inhibit-test.glade:
	Rename a button so we don't get an error on startup.

2007-02-05  Richard Hughes  <richard@hughsie.com>

	* src/gpm-main.c: (main):
	Print the version number at startup.

	* src/gpm-ac-adapter.c:
	* src/gpm-battery.c:
	* src/gpm-brightness-kbd.c:
	* src/gpm-brightness-lcd.c:
	* src/gpm-button.c:
	* src/gpm-cpufreq.c:
	* src/gpm-hal.c:
	* src/gpm-hal.h:
	* src/gpm-light-sensor.c:
	* src/gpm-manager.c:
	* src/gpm-power.c:
	Use conventional GError based error reporting rather than alert the
	user about missing optional keys. Convert most of the users to just
	ignore the error by passing NULL to the HAL function, but handle the
	ones that need something special done.

2007-02-05  Richard Hughes  <richard@hughsie.com>

	* src/gpm-hal.c:
	* src/gpm-hal.h:
	Remove the unused gpm_hal_device_rescan_capability()

2007-02-05  Richard Hughes  <richard@hughsie.com>

	* src/gpm-brightness-lcd.c:
	* src/gpm-srv-backlight.c:
	Make sure we set the policy brightness when gnome-power-manager is
	started. Also check for the dim brightness in a better way.

2007-02-05  Richard Hughes  <richard@hughsie.com>

	* src/gpm-info-data.c: (gpm_info_data_add):
	* src/gpm-info.c: (gpm_statistics_get_types):
	Don't return the types that have no data when we call GetTypes().

2007-02-05  Richard Hughes  <richard@hughsie.com>

	* src/gpm-brightness-lcd.c:
	Use the old (2.16) GetBrightness and SetBrightness methods because
	these work. I think the DELL smbios addon is returning an integer rather
	than an unsigned integer and this is the source of confusion.

	* src/gpm-common.c:
	Check that the levels are not zero, else we get non-sensical results.

	* src/gpm-srv-backlight.c:
	Set the dim value after the first GetBrightness to avoid setting the
	dim value as the current brightness.

2007-02-04  Richard Hughes  <richard@hughsie.com>

	* src/gpm-srv-backlight.c: (button_pressed_cb):
	Only update the DPMS parameters if we closed the lid, not on every
	brightness change.

2007-02-04  Richard Hughes  <richard@hughsie.com>

	* src/gpm-brightness-lcd.c: (gpm_brightness_lcd_init):
	Add a check for non zero brightness levels.

2007-02-01  Richard Hughes  <richard@hughsie.com>

	* data/Makefile.am:
	Move an ifdef to keep Anjuta from printing an error on startup.

2007-02-01  Richard Hughes  <richard@hughsie.com>

	* src/gpm-inhibit.c: (gpm_inhibit_is_valid):
	* src/gpm-self-test.c: (test_inhibit):
	Add some more tests and also fix up a situation where a manual inhibit
	was not stopping an auto-action.

2007-02-01  Richard Hughes  <richard@hughsie.com>

	* src/gpm-info.c: (gpm_statistics_get_data):
	Only try to get the percentage data if we are a laptop.
	If we are not a laptop then info->priv->percentage_data will be NULL
	and a dereference will kill gnome-power-manager.
	Should fix the crash reported by Kjartan Maraas in #402823.

2007-02-01  Richard Hughes  <richard@hughsie.com>

	* applets/inhibit/inhibit-applet.c: (click_cb):
	Fix compile error. OOps.

	* src/gpm-info.c: (gpm_info_log_do_poll):
	Fix a typo where we were not checking the brightness.

2007-02-01  Richard Hughes  <richard@hughsie.com>

	* data/gpm-inhibit-test.glade:
	* docs/dbus-interface.html:
	* docs/dbus-interface.xml:
	* docs/icon-scheme.html:
	* docs/index.html:
	* src/dbus/gpm-dbus-inhibit.xml:
	* src/gpm-inhibit-test.c: (dbus_inhibit_gpm),
	* src/gpm-inhibit.c: (gpm_inhibit_find_cookie),
	* src/gpm-inhibit.h:
	* src/gpm-manager.c: (gpm_manager_is_inhibit_valid),
	* src/gpm-powermanager.c: (gpm_powermanager_inhibit_auto),
	* src/gpm-powermanager.h:
	* src/gpm-self-test.c: (test_inhibit):
	Convert the new API to InhibitAuto for auto-suspend prevention and
	InhibitManual for stuff like RPM transactions and BIOS flashes.
	The old manager inhibit API has been converted to the InihibitAuto
	style to fix #402863
	Update the self test program, the inhibit example program and the
	documentation.

2007-02-01  Richard Hughes  <richard@hughsie.com>

	* src/gpm-info.c: (gpm_statistics_get_event_log):
	Do the same fix as #403156 for GetEventLog.

2007-02-01  Richard Hughes  <richard@hughsie.com>

	* src/gpm-info.c: (gpm_statistics_get_data):
	Fix a 153 byte memory leak that would happen each time the statistics
	GetData method was accessed over DBUS.
	Spotted by Kjartan Maraas, many thanks. Fixes #403156.

2007-01-29  Richard Hughes  <richard@hughsie.com>

	* src/gpm-power.c: (gpm_power_status_for_device):
	Make the text more translatable in the power description text.
	Many thanks for Stephane Raimbault for noticing this. Fixes #402230

2007-01-29 Colin Watson <cjwatson@ubuntu.com>

        * src/gpm-tray-icon.c: (gpm_tray_icon_sync):
        Fix arguments to description-changed signal. Fixes #400654 and lp:81427

2007-01-28  Richard Hughes  <richard@hughsie.com>

	* src/gpm-button.c: (gpm_button_is_lid_closed):
	* src/gpm-srv-backlight.c: (gpm_srv_backlight_init):
	Fix a difficult-to-find crasher which would only happen sometimes when
	the session became idle on a laptop without a backlight.

2007-01-28  Richard Hughes  <richard@hughsie.com>

	* applets/brightness/brightness-applet.c:
	* data/icons/16x16/Makefile.am:
	* data/icons/22x22/Makefile.am:
	* data/icons/24x24/Makefile.am:
	* data/icons/scalable/Makefile.am:
	* data/icons/scalable/gpm-brightness-kbd-disabled.svg:
	* data/icons/scalable/gpm-brightness-lcd-disabled.svg:
	* docs/icon-scheme.xml:
	Add some icons by Paul Betts <paul.betts@gmail.com> to convey the
	brightness control in the addon is either disabled, or no hardware is
	present. Fixes #400006

2007-01-26  Richard Hughes  <richard@hughsie.com>

	* src/gpm-tray-icon.c: (gpm_tray_icon_set_image_from_stock):
	Fix a crasher on PPC where we were not sending the correct marshalled
	type on icon change. Should fix lp:81427 and #400654.

2007-01-25  Richard Hughes  <richard@hughsie.com>

	* configure.in:
	* src/gpm-control.c: (gpm_control_is_policy_timout_valid):
	Add the --enable-checkfg configure argument to upstream one of the
	ubuntu patches. You only need this argument if you want to check with
	check-foreground-console before you do an action.
	Original patch from Oliver Grawert, many thanks.

2007-01-22  Richard Hughes  <richard@hughsie.com>

	==== Version 2.17.90 ====

2007-01-21  Richard Hughes  <richard@hughsie.com>

	* src/gpm-button.c:
	* src/gpm-button.h:
	* src/gpm-manager.c:
	* src/gpm-srv-backlight.c: (idle_changed_cb):
	* src/gpm-srv-screensaver.c: (ac_adapter_changed_cb):
	Don't poke the screensaver when we remove the ac adapter when the lid
	is closed. Fixes #384254.

2007-01-19  Denis Washington <dwashington@gmx.net>

	Fixes #394701

	* data/gnome-power-preferences.desktop.in: use correct category name.

2007-01-13  Richard Hughes  <richard@hughsie.com>

	* docs/dbus-interface.xml:
	* po/POTFILES.in:
	* src/Makefile.am:
	* src/dbus/Makefile.am:
	* src/dbus/gpm-dbus-backlight.xml:
	* src/dbus/gpm-dbus-brightness-lcd.xml:
	* src/dbus/gpm-dbus-dpms.xml:
	* src/gpm-manager.c: (gpm_manager_init), (gpm_manager_finalize):
	* src/gpm-powermanager.c: (gpm_powermanager_init):
	* src/gpm-powermanager.h:
	As discussed, having two interfaces for backlight control is crazy.
	Merge BrightnessLcd and Dpms into Backlight so we can use this interface
	in a more generic way.

	* src/gpm-srv-brightness-lcd.c:
	* src/gpm-srv-brightness-lcd.h:
	* src/gpm-srv-dpms.c:
	* src/gpm-srv-dpms.h:
	* src/gpm-srv-backlight.c:
	* src/gpm-srv-backlight.h:
	Merge the two interfaces into one new GObject.

2007-01-13  Richard Hughes  <richard@hughsie.com>

	* src/dbus/gpm-dbus-brightness-lcd.xml:
	* src/dbus/gpm-dbus-control.xml:
	* src/dbus/gpm-dbus-dpms.xml:
	* src/dbus/gpm-dbus-inhibit.xml:
	* src/dbus/gpm-dbus-statistics.xml:
	* src/dbus/gpm-dbus-ui.xml:
	Add scoping information. Whoops.

	* src/gpm-self-test.c: (test_proxy), (main):
	Add tests for the GpmProxy class.

2007-01-12  Richard Hughes  <richard@hughsie.com>

	Patch by: William Jon McCann <mccann@jhu.edu>

	* src/gpm-brightness-lcd.c:
	GPM uses UINT32 for brightness but HAL uses INT32. Fix the crasher
	of #395174. This is only become apparent as the new DELL smbios addon
	enforces correct signedness but the old method did not.

2007-01-12  Richard Hughes  <richard@hughsie.com>

	* src/gpm-brightness-kbd.c: (gpm_brightness_kbd_get_hw),
	* src/gpm-brightness-kbd.h:
	* src/gpm-brightness-lcd.c: (gpm_brightness_lcd_class_init),
	* src/gpm-brightness-lcd.h:
	Clear up some more guint and gint problems.

	* src/gpm-proxy.c:
	Make sure an invalid proxy doesn't segfault gnome-power-manager.
	This is due to a critical log message, where we should probably
	only be a developer warning.

2007-01-12  Thomas Wood  <thos@gnome.org>

	Patch by: Denis Washington <dwashington@gmx.net>

	* data/gnome-power-preferences.desktop.in: Categorize
	gnome-power-preferences for the control center shell. Fixes bug 394701.

2007-01-10  Richard Hughes  <richard@hughsie.com>

	* docs/dbus-interface.xml:
	* docs/dbus-interface.html:
	* src/gpm-powermanager.c: (gpm_powermanager_init):
	* src/gpm-powermanager.h:
	* src/gpm-prefs-core.c: (gpm_dbus_method_bool):
	* src/gpm-statistics-core.c: (gpm_statistics_init):
	Move back to the indervidual interface definition after Rob pointed out
	this breaks glib bindings. OOps.

2007-01-10  Richard Hughes  <richard@hughsie.com>

	* docs/dbus-interface.xml:
	Update docs.

2007-01-10  Richard Hughes  <richard@hughsie.com>

	* src/dbus/gpm-dbus-brightness-lcd.xml:
	* src/gpm-brightness-lcd.c: (gpm_brightness_lcd_set_hw):
	* src/gpm-powermanager.c: (gpm_powermanager_get_brightness_lcd),
	* src/gpm-srv-brightness-lcd.c:
	* src/gpm-srv-brightness-lcd.h:
	Make sure we always use an unsigned int for brightness.
	This should fix #395174.

2007-01-08  Richard Hughes  <richard@hughsie.com>

	* docs/dbus-interface.html:
	* docs/dbus-interface.xml:
	* docs/index.html:
	Update to reflect the current API.
	NOTE TO PEOPLE STRESSING OUT: The old API still exists as a
	compatibility API, it's just not documented.

	* src/dbus/gpm-dbus-inhibit.xml:
	* src/dbus/gpm-dbus-statistics.xml:
	Add some more comments, no functional changes.

2007-01-08  Richard Hughes  <richard@hughsie.com>

	* src/dbus/gpm-dbus-brightness-lcd.xml:
	* src/gpm-srv-brightness-lcd.c:
	* src/gpm-srv-brightness-lcd.h:
	Add a BrightnessChanged signal, and convert the method names to similar
	style to DPMS.

	* src/gpm-powermanager.c:
	Use the new method names.

2007-01-07  Richard Hughes  <richard@hughsie.com>

	* data/gnome-power-manager.schemas.in:
	* src/gpm-conf.h:
	Add /apps/gnome-power-manager/show_cpufreq_ui GConf key.
	It's not something I wanted to do, as 99% of people don't need to
	ever change this, but the 1% will need to for specific systems.
	Default to hiding the control. Distros can patch this if required.

	* src/gpm-prefs-core.c:
	Add 'Do nothing' back as a valid UI object, else this policy is
	reverted to ondemand the first time the prefs tool is run.
	By default we don't show the UI. This is not a new string as we
	already use it for the action text.

2007-01-07  Richard Hughes  <richard@hughsie.com>

	* help/C/gnome-power-manager.xml:
	Fix a metric ton of spelling errors.

2007-01-04  Richard Hughes  <richard@hughsie.com>

	* src/gpm-brightness-kbd.c: (gpm_brightness_kbd_up),
	* src/gpm-brightness-lcd.c: (gpm_brightness_lcd_up),
	* src/gpm-button.c: (emit_button_pressed):
	* src/gpm-hal.c: (reattach_property_modified_in_hash),
	* src/gpm-notify.c: (notify_recall_action_cb):
	* src/gpm-power.c: (battery_kind_cache_update):
	Replace instances of g_debug with gpm_debug.

2007-01-04  Richard Hughes  <richard@hughsie.com>

	* BRANCHES:
	* README:
	Update to better reflect release dependencies.

	* src/gpm-hal.c: (proxy_status_cb):
	Emit the DAEMON_START and DAEMON_STOP signals when HAL
	disconnects or connects. This fixes the problem where the
	icon does not change when HAL is restarted.

2007-01-03  Richard Hughes  <richard@hughsie.com>

	* src/gpm-self-test.c:
	Remove all the _("foo") strings for gnome program init as
	they are not required and I don't want to be accused of
	breaking string freeze.

	* po/POTFILES.in:
	Add gpm-self-test.c - no string additions - this is a new
	test module that should not be translated and only used by
	developers.

2007-01-03  Richard Hughes  <richard@hughsie.com>

	* src/gpm-inhibit.c: (gpm_inhibit_is_valid):
	* src/gpm-self-test.c:
	Add some more self tests.

2007-01-02  Richard Hughes  <richard@hughsie.com>

	* src/Makefile.am:
	* src/gpm-self-test.c:
	Add the start of a self-test framework.

	* src/gpm-powermanager.c: (gpm_powermanager_inhibit),
	* src/gpm-powermanager.h:
	* src/dbus/gpm-dbus-inhibit.xml:
	Convert to the new API, and remove the incorrect interface.

	* src/gpm-inhibit.c: (gpm_inhibit_is_valid), (gpm_inhibit_check):
	* src/gpm-inhibit.h:
	Add IsValid method to Inhibit interface so we can test the
	inhibit status in the self-test framework.

2006-12-31  Richard Hughes  <richard@hughsie.com>

	* README.cvs:
	* README.svn:
	* autogen.sh:
	Remove some cvs'isms.

2006-12-31  Richard Hughes  <richard@hughsie.com>

	* .cvsignore:
	* applets/.cvsignore:
	* applets/brightness/.cvsignore:
	* applets/inhibit/.cvsignore:
	* data/.cvsignore:
	* data/icons/.cvsignore:
	* data/icons/16x16/.cvsignore:
	* data/icons/22x22/.cvsignore:
	* data/icons/24x24/.cvsignore:
	* data/icons/scalable/.cvsignore:
	* data/sounds/.cvsignore:
	* docs/.cvsignore:
	* help/.cvsignore:
	* help/es/.cvsignore:
	* help/hu/.cvsignore:
	* help/ru/.cvsignore:
	* help/sv/.cvsignore:
	* man/.cvsignore:
	* po/.cvsignore:
	* src/.cvsignore:
	* src/dbus/.cvsignore:
	* tools/.cvsignore:
	Remove obsolete .cvsignore files.

2006-12-31  Pascal Terjan  <pterjan@linuxfr.org>

	* src/gpm-power.c: (gpm_power_kind_to_string):
	Don't localise string as this is used internally for icon name.

2006-12-30  Christian Persch  <chpe@cvs.gnome.org>

	* applets/brightness/brightness-applet.c: (create_popup):
	Use octal UTF-8, not \uxxxx. Bug #390809.

2006-12-29  Christian Persch  <chpe@cvs.gnome.org>

	* src/gpm-tray-icon.c: (gpm_tray_icon_popup_menu_cb):
	Fix popup_menu callback signature. Bug #390172.

2006-12-29  Richard Hughes  <richard@hughsie.com>

	* applets/brightness/brightness-applet.c: (create_popup):
	Use "\u2212" rather than "-" for a bigger horizontal line,
	complementing the plus sign.

2006-12-24  Richard Hughes  <richard@hughsie.com>

	* src/gpm-control.c:
	* src/gpm-control.h:
	Add the request signal to the GpmControl class.
	This prevents a warning on startup.

2006-12-24  Richard Hughes  <richard@hughsie.com>

	* src/gpm-tray-icon.c:
	* src/gpm-tray-icon.h:
	Add the icon changed and description changed signals to the
	UI class. This prevents a warning on startup.

2006-12-24  Richard Hughes  <richard@hughsie.com>

	* src/dbus/gpm-dbus-control.xml:
	Add the file I missed off the last commit. Fixes #389121.
	Sometimes, I wish I tested things harder. Apologies.

2006-12-23  Richard Hughes  <richard@hughsie.com>

	* src/gpm-hal.c:
	Add some more debugging.

	* src/gpm-control.c:
	* src/gpm-control.h:
	* src/gpm-manager.c:
	Move some stuff from the manager to GpmControl.

	* src/gpm-sound.c:
	* src/gpm-info.c:
	* src/gpm-power.c:
	* src/gpm-srv-dpms.c:
	* src/gpm-tray-icon.c:
	Move to the signal event model of GpmControl, rather than the
	monolithic GpmManager.

	* src/gpm-screensaver.c:
	* src/gpm-screensaver.h:
	Move the defines from the C to the H. Also make a singleton.

2006-12-23  Richard Hughes  <richard@hughsie.com>

	* po/POTFILES.in:
	* src/gpm-control.c:
	* src/gpm-control.h:
	* src/gpm-policy.c:
	* src/gpm-policy.h:
	Rename GpmPolicy to GpmControl.

	* src/Makefile.am:
	* src/dbus/Makefile.am:
	* src/gpm-info.c:
	* src/gpm-info.h:
	* src/gpm-manager.c:
	* src/gpm-manager.h:
	* src/gpm-powermanager.h:
	* src/gpm-tray-icon.c:
	Use the new GpmControl interface, and start to add the
	registrations interface.

2006-12-23  Richard Hughes  <richard@hughsie.com>

	* TODO:
	* src/dbus/gpm-dbus-brightness-lcd.xml:
	* src/dbus/gpm-dbus-dpms.xml:
	* src/dbus/gpm-dbus-statistics.xml:
	* src/dbus/gpm-dbus-ui.xml:
	* src/gpm-inhibit-test.c:
	* src/gpm-powermanager.c:
	* src/gpm-powermanager.h:
	* src/gpm-srv-brightness-lcd.c:
	* src/gpm-srv-brightness-lcd.h:
	* src/gpm-statistics-core.c:
	Remove the custom suffix for each of the interfaces.
	As we have a custom path for each one, we have no need for
	indervidual interfaces.

2006-12-23  Richard Hughes  <richard@hughsie.com>

	* src/dbus/Makefile.am:
	* src/dbus/gpm-dbus-inhibit.xml:
	Add the new inhibit interface.

	* src/gpm-inhibit-test.c:
	* src/gpm-inhibit.c:
	* src/gpm-inhibit.h:
	Deal with the DBUS interface here, rather than using the
	manager class to proxy requests.

	* src/gpm-manager.c:
	Proxy the old Inhibit and UnInihibit calls to the new
	interface.

	* src/gpm-powermanager.h:
	Add the Inhibit DBUS path.

2006-12-23  Richard Hughes  <richard@hughsie.com>

	* data/gnome-power-manager.schemas.in:
	* src/gpm-conf.h:
	* src/gpm-manager.c: (battery_status_changed_primary):
	Add the notify_low_power gconf key to supress the low battery
	warnings. Fixes #350018.

2006-12-23  Richard Hughes  <richard@hughsie.com>

	* help/C/figures/applet-brightness.png:
	* help/C/figures/applet-inhibit.png:
	* help/C/gnome-power-manager.xml:
	Add a section in the help file for the applets.

	* applets/brightness/brightness-applet.c: (help_cb):
	* applets/inhibit/inhibit-applet.c: (help_cb):
	Point to the applets section in the help file.
	Should fix #388904.

2006-12-23  Richard Hughes  <richard@hughsie.com>

	* applets/brightness/Makefile.am:
	* applets/inhibit/Makefile.am:
	Make the applets look in the right place for the help file.
	Not that one exists: we need to write then or remove the
	help option. Starts fixing #388904.

	* applets/brightness/brightness-applet.c: (help_cb):
	* applets/inhibit/inhibit-applet.c: (help_cb):
	* src/gpm-tray-icon.c: (gpm_tray_icon_show_help_cb):
	Correct the name of the XML yelp file. Not sure who changed
	this, but it was wrong. Fixes #388905.

2006-12-23  Richard Hughes  <richard@hughsie.com>

	* src/gpm-manager.c:
	When running in a custom root Elijah gets:
	'gnome-keyring-1/gnome-keyring.h: No such file or directory'
	The fix is trivial, just remove the 'gnome-keyring-1/'
	from the #include line.
	I'm not sure why no body has mentioned this before, but
	it seems to work either with or without on FC6.
	Fixes #388815.

2006-12-22  Richard Hughes  <richard@hughsie.com>

	* docs/dbus-interface.html:
	* docs/faq.html:
	* docs/icon-scheme.html:
	* docs/index.html:
	* docs/sleep-names.html:
	Update with new version number.

	* src/dbus/Makefile.am:
	* src/dbus/gpm-dbus-ui.xml:
	* src/gpm-manager.c: (gpm_manager_init):
	* src/gpm-powermanager.h:
	* src/gpm-tray-icon.c: (gpm_ui_get_description), (gpm_ui_get_icon):
	* src/gpm-tray-icon.h:
	Add this new dbus interface so we can provide an alternate UI
	environment, for instance for XFCE or OLPC.

	* src/gpm-cpufreq.c: (gpm_cpufreq_get_governors):
	Use ondemand, not conservative.

2006-12-19  Richard Hughes  <richard@hughsie.com>

	* data/gnome-power-manager.schemas.in:
	Change default to be ondemand at 85 performance on AC and
	ondemand at 25 performance on battery. Ubuntu set ondemand
	by default, and have had no bad reports.
	The rationale for this change is that we should still save
	power on AC, there's no point having the processor run at
	100 percent when the system is idle.

	* src/gpm-cpufreq.c: (gpm_cpufreq_set_performance):
	Allow setting the performance for the dynamic policies.

2006-12-19  Francisco Javier F. Serrador  <serrador@openshine.com>

	* applets/inhibit/inhibit-applet.c (GPM_INHIBIT_APPLET_NAME):
	Fixed typo

2006-12-18  Richard Hughes  <richard@hughsie.com>

	* data/gpm-prefs.glade:
	Change the accesskeys to be unique.

2006-12-18  Richard Hughes  <richard@hughsie.com>

	* configure.in: Post release bump to 2.17.5

2006-12-18  Richard Hughes  <richard@hughsie.com>

	==== Version 2.17.4 ====

2006-12-18  Richard Hughes  <richard@hughsie.com>

	* applets/brightness/Makefile.am:
	* applets/inhibit/Makefile.am:
	Fix a couple of aclocal warnings.

	* help/es/.cvsignore:
	Yes, I get upset with the ? output of cvs diff.

2006-12-17  Richard Hughes  <richard@hughsie.com>

	* data/gpm-prefs.glade:
	Make grammar changes as suggested by Tino Meinen.

2006-12-17  Richard Hughes  <richard@hughsie.com>

	* src/gpm-prefs-core.c: (prefs_setup_notification):
	When on battery power remove the never option because
	there is no use case for this.

2006-12-17  Richard Hughes  <richard@hughsie.com>

	* data/gpm-prefs.glade:
	Correct the grammar in two places.

	* data/gnome-power-manager.schemas.in:
	* src/gpm-conf.h:
	* src/gpm-srv-brightness-lcd.c: (idle_changed_cb):
	Split the policy for dimming the screen, defaulting to on
	for battery power and off for on AC.

	* src/gpm-srv-cpufreq.c: (gpm_srv_cpufreq_new):
	Remove double ;;.

2006-12-17  Richard Hughes  <richard@hughsie.com>

	* data/gnome-power-manager.schemas.in:
	* src/gpm-conf.h:
	* src/gpm-manager.c:
	Don't use our own custom key for saving the session on
	shutdown, instead use the gnome-session "auto-save" key.
	Based on a patch from Bernat Tallaferro, many thanks.
	Fixes #375682

2006-12-16  Richard Hughes  <richard@hughsie.com>

	* help/C/figures/gpm-prefs-ac.png:
	* help/C/figures/gpm-prefs-actions.png:
	* help/C/figures/gpm-prefs-battery.png:
	* help/C/figures/gpm-prefs-display.png:
	* help/C/figures/gpm-prefs-general.png:
	* help/C/figures/gpm-prefs-notification.png:
	* help/C/figures/gpm-prefs-processor.png:
	* help/C/figures/gpm-prefs-sleep.png:
	* help/C/gnome-power-manager.xml:
	Update the help files and figures to reflect the new
	gnome-power-preferences UI.

2006-12-16  Richard Hughes  <richard@hughsie.com>

	* data/gpm-prefs.glade:
	Merge the preferences and general tab into a single general
	tab. Having one or two options in an empty tab looked bad.

	* tools/gnome-power-bugreport.sh:
	Typos and little optimizations.

2006-12-10  Richard Hughes  <richard@hughsie.com>

	* Makefile.am:
	* configure.in:
	* data/gnome-power-manager.desktop.in:
	* data/gnome-power-preferences.desktop.in:
	* tools/.cvsignore:
	* tools/Makefile.am:
	* tools/gnome-power-bugreport.sh:
	Add gnome-power-bugreport.sh so we can automatically make my
	life easier using X-GNOME-Bugzilla-ExtraInfoScript.

2006-12-09  Richard Hughes  <richard@hughsie.com>

	* src/dbus/Makefile.am:
	* src/dbus/gpm-dbus-dpms.xml:
	* src/dbus/gpm-dbus-manager.xml:
	* src/gpm-dpms.c:
	* src/gpm-dpms.h:
	* src/gpm-manager.c:
	* src/gpm-manager.h:
	* src/gpm-powermanager.h:
	* src/gpm-srv-dpms.c:
	* src/gpm-srv-dpms.h:
	* src/gpm-srv-screensaver.c:
	Move the DBUS interface from the manager to
	/org/gnome/PowerManager/Dpms so we can start to modularize
	the interface for standardization.

2006-12-09  Richard Hughes  <richard@hughsie.com>

	* help/C/gnome-power-manager.xml:
	Fix a few spellings of timeout, fixes #383116.

2006-12-08  Richard Hughes  <richard@hughsie.com>

	* data/gpm-prefs.glade:
	* src/gpm-prefs-core.c:
	Covert the glade file to be On Ac Power and On Battery Power
	as we can now fit them in the single panes.
	Also make more HIG compliant and add accesskeys.

2006-12-06  Richard Hughes  <richard@hughsie.com>

	* data/gnome-power-manager.schemas.in:
	* data/gpm-prefs.glade:
	* src/gpm-manager.c:
	* src/gpm-prefs-core.c:
	Remove the auto-sleep type from the UI. If on battery we
	default to hibernation and if on AC then we suspend.
	If one sleep mode is not available, then the other is tried.
	The defaults can be changed in gconf if required.

2006-12-06  Richard Hughes  <richard@hughsie.com>

	* src/gpm-prefs-core.c:
	Add back the 'move slider to none' functionality we had in
	2.16.x - the drop down is too complicated.

2006-12-06  Richard Hughes  <richard@hughsie.com>

	* data/gpm-prefs.glade:
	* src/gpm-cpufreq.c: (gpm_cpufreq_get_governors):
	* src/gpm-prefs-core.c:
	Remove all traces of userspace cpufrequency governer from
	the UI. You can still set this in gconf if you wish.

2006-12-05  Richard Hughes  <richard@hughsie.com>

	* help/C/gnome-power-manager.xml:
	Apply another fix by Jorge Gonzalez, many thanks. #380920

2006-12-05  Richard Hughes  <richard@hughsie.com>

	* help/C/gnome-power-manager.xml:
	Apply a couple of fixes by Jorge Gonzalez, many thanks.
	Fixes #381928 and #381930.

2006-12-05  Richard Hughes  <richard@hughsie.com>

	* applets/inhibit/inhibit-applet.c:
	* data/icons/16x16/Makefile.am:
	* data/icons/16x16/gpm-inhibit.png:
	* data/icons/22x22/Makefile.am:
	* data/icons/22x22/gpm-inhibit.png:
	* data/icons/24x24/Makefile.am:
	* data/icons/24x24/gpm-inhibit.png:
	* data/icons/scalable/Makefile.am:
	* data/icons/scalable/gpm-inhibit.svg:
	Add gpm-inhibit icon kindly drawn by Lapo Calamandrei.
	Many thanks for this fantastic artwork.

2006-12-04  Richard Hughes  <richard@hughsie.com>

	* configure.in: Post release bump to 2.17.4

2006-12-04  Richard Hughes  <richard@hughsie.com>

	==== Version 2.17.3 ====

2006-12-01  Richard Hughes  <richard@hughsie.com>

	* TODO:
	Update info about interfaces.

	* src/gpm-manager.c: (gpm_manager_is_inhibit_valid):
	Add another string I'll need translating soon.

2006-11-30  Stuart Hood  <stuhood@gmail.com>

	* src/gpm-power.c:
	Instead of showing "missing" as the catchall, show "discharging".
	Fixes #364450

2006-11-30  Stuart Hood  <stuhood@gmail.com>

	* src/gpm-power.c:
	* src/gpm-power.h:
	Calculate the smoothed rate from device caches,
	instead of devices. Fixes #361583

2006-11-27  Richard Hughes  <richard@hughsie.com>

	* applets/Makefile.am:
	* applets/inhibit/.cvsignore:
	* applets/inhibit/GNOME_InhibitApplet.server.in.in:
	* applets/inhibit/GNOME_InhibitApplet.xml:
	* applets/inhibit/Makefile.am:
	* applets/inhibit/inhibit-applet.c:
	* applets/inhibit/inhibit-applet.h:
	* configure.in:
	* po/POTFILES.in:
	Add the initial version of the inhibit applet. Needs work.

2006-11-27  Richard Hughes  <richard@hughsie.com>

	* configure.in:
	* src/Makefile.am:
	* src/gpm-interface-brightness-lcd.xml:
	* src/gpm-interface-manager.xml:
	* src/gpm-interface-statistics.xml:
	* src/gpm-main.c:
	* src/gpm-manager.c:
	* src/dbus/.cvsignore:
	* src/dbus/Makefile.am:
	* src/dbus/gpm-dbus-brightness-lcd.xml:
	* src/dbus/gpm-dbus-manager.xml:
	* src/dbus/gpm-dbus-statistics.xml:
	Move the interface files into thier own directory.

2006-11-27  Richard Hughes  <richard@hughsie.com>

	* TODO:
	Add some notes about the new DBUS API.

	* applets/brightness/brightness-applet.c: (retrieve_icon):
	Fix comment style.

	* src/gpm-powermanager.c:
	* src/gpm-powermanager.h:
	Add the inhibit methods needed for the new applet.

2006-11-26  Richard Hughes  <richard@hughsie.com>

	* docs/faq.html:
	* docs/faq.xml:
	* docs/index.html:
	Add a new FAQ from Olivier Berger about debian etch.
	Also remove the obsolete entries that no longer apply.

2006-11-26  Richard Hughes  <richard@hughsie.com>

	* applets/brightness/.cvsignore:
	* applets/brightness/brightness-applet.c:
	Apply a patch from Benjamin Canou:
	Correct the bonobo leak and the crash when removing the
	applet from the panel.

2006-11-25  Richard Hughes  <richard@hughsie.com>

	* applets/brightness/brightness-applet.c:
	A few minor changes:
	- Use the global g-p-m version, not 0.1
	- Use the gnome-power-manager yelp file.
	- Set the applet name prefix to be 'Power Manager' to
	indicate it's part of the same package.
	- Make some localised text a little nicer.

2006-11-25  Richard Hughes  <richard@hughsie.com>

	* applets/brightness/GNOME_BrightnessApplet.server.in.in:
	* applets/brightness/brightness-applet.c:
	Use the correct icon name so we show up in the panel.

2006-11-25  Richard Hughes  <richard@hughsie.com>

	* AUTHORS:
	* applets/Makefile.am:
	* applets/brightness/.cvsignore:
	* applets/brightness/GNOME_BrightnessApplet.server.in.in:
	* applets/brightness/GNOME_BrightnessApplet.xml:
	* applets/brightness/Makefile.am:
	* applets/brightness/brightness-applet.c:
	* applets/brightness/brightness-applet.h:
	* configure.in:
	Apply patch from Benjamin Canou <bookeldor@gmail.com> to add
	the new brightness applet. Many thanks for this great new
	feature, and really good chunk of code.

2006-11-25  Richard Hughes  <richard@hughsie.com>

	* src/gpm-powermanager.h:
	Move all the duplicated DBUS defines here.

	* src/Makefile.am:
	* src/gpm-manager.c:
	* src/gpm-prefs-core.c:
	* src/gpm-statistics-core.c:
	Use gpm-powermanager.h rather than defining them ourselves.

	* src/gpm-powermanager.c:
	Provide a simple accessor class so that the brightness applet
	can easily talk to g-p-m. Just create an instance of this
	class, and then don't worry about DBUS. ;-)

2006-11-25  Richard Hughes  <richard@hughsie.com>

	* src/.cvsignore:
	* src/Makefile.am:
	* src/gpm-interface-brightness-lcd.xml:
	* src/gpm-manager.c: (gpm_manager_init):
	* src/gpm-srv-brightness-lcd.c:
	* src/gpm-srv-brightness-lcd.h:
	Add the DBUS service org.gnome.PowerManager.BrightnessLcd
	This name might change, as might the method names, so don't
	use this outside of gnome-power-manager for now.

2006-11-25  Richard Hughes  <richard@hughsie.com>

	* Makefile.am:
	* applets/.cvsignore:
	* applets/Makefile.am:
	* applets/brightness-applet/.cvsignore:
	* configure.in:
	Add some initial build files for the new applet stuff.
	This is half of a patch from Benjamin Canou, and the other
	bits will be merged tomorrow. Many thanks Benjamin!

2006-11-24  Richard Hughes  <richard@hughsie.com>

	* configure.in:
	Add --enable-applets. Currently disabled.

2006-11-24  Pascal Terjan  <pterjan@linuxfr.org>

	* src/gpm-button.c: (emit_button_pressed):
	don't crash if hal tell us that a button was pressed but then can
	not give the type.

2006-11-24  Richard Hughes  <richard@hughsie.com>

	* src/gpm-prefs-core.c: (prefs_setup_notification):
	Hide the 'When battery present' option when there is no
	primary batteries or UPS's in the system.
	This does mean neither option will be selected in the GUI for
	desktop PC's from first-install, which is why a better
	solution should probably be found. Fixes #363757

2006-11-24  Richard Hughes  <richard@hughsie.com>

	* src/gpm-prefs-core.c: (gpm_prefs_enable_widget),
	As per GNOME HIG, don't hide the disabled sliders, but
	grey them out instead.

2006-11-24  Richard Hughes  <richard@hughsie.com>

	* src/gpm-debug.c:
	Don't try to use the global buffer recursively. Fixes #378171

	* src/gpm-hal.c: (gpm_hal_filter_error):
	Don't filter remote exceptions. Fixes #378179

	* src/gpm-manager.c:
	Save to syslog when suspend or hibernate failed.

2006-11-19  Richard Hughes  <richard@hughsie.com>

	* src/gpm-hal.c: (gpm_hal_filter_error):
	Fix a crasher when suspend or hibernate failed.

2006-11-19  Richard Hughes  <richard@hughsie.com>

	* src/gpm-graph-widget.c:
	* src/gpm-graph-widget.h:
	* src/gpm-info.c:
	* src/gpm-info.h:
	* src/gpm-manager.c:
	* src/gpm-statistics-core.c:
	Complete the GpmGraphWidget separation, so now event policy is
	not enforced in the graph, but in the object that initializes
	the graph. This means we can have a dynamic key that only
	displays relevant entries, which I've done as well.
	Added DPMS state change entries also, so we now display all
	the events on the graph.

2006-11-18  Richard Hughes  <richard@hughsie.com>

	* src/gpm-ac-adapter.c: (gpm_ac_adapter_new):
	* src/gpm-battery.c: (gpm_battery_new):
	* src/gpm-brightness-lcd.c: (gpm_brightness_lcd_new):
	* src/gpm-button.c: (gpm_button_new):
	* src/gpm-conf.c: (gpm_conf_new):
	* src/gpm-cpufreq.c: (gpm_cpufreq_new):
	* src/gpm-dbus-monitor.c: (gpm_dbus_monitor_new):
	* src/gpm-dpms.c: (gpm_dpms_new):
	* src/gpm-hal.c: (gpm_hal_init), (gpm_hal_new):
	* src/gpm-idle.c: (gpm_idle_new):
	* src/gpm-power.c: (gpm_power_new):
	Convert all singletons to use a local static.

	* src/gpm-manager.c: (gpm_manager_init):
	Make sure we don't warn we on battery at startup.

2006-11-15  Richard Hughes  <richard@hughsie.com>

	* configure.in:
	* help/C/gnome-power-manager.xml:
	* src/gpm-manager.c:
	Add gnome-keyring functionality to lock keyrings when
	sleeping. This fixes #375681 - but means gnome-power-manager
	must have gnome-keyring development files to build from
	now on.

	* src/gpm-notify.c: (power_perhaps_recall_cb):
	Change 'don't' to 'do not'.

	* src/gpm-srv-dpms.c: (gpm_srv_dpms_sync_policy):
	Fix a typo in a comment.

	* src/gpm-manager.c: (battery_status_changed_primary):
	Fix a race where percentage_charge can be momentarily zero
	at startup. This fixes an incorrect 'fully charged'
	notification on startup.

2006-11-15  Richard Hughes  <richard@hughsie.com>

	* help/C/gnome-power-manager.xml:
	Add missing abstract. Fixes #374780

2006-11-15  Richard Hughes  <richard@hughsie.com>

	* po/POTFILES.in:
	* src/Makefile.am:
	* src/gpm-notify.c:
	* src/gpm-notify.h:
	Create this notification abstraction class and add the code
	needed for the battery recall buttons.

	* src/gpm-manager.c:
	* src/gpm-tray-icon.c:
	* src/gpm-tray-icon.h:
	Remove duplicated and muddled code.

2006-11-15  Richard Hughes  <richard@hughsie.com>

	* help/C/gnome-power-manager.xml:
	Fix the maintainers field.

	* .cvsignore:
	* src/gpm-tray-icon.c: (libnotify_event):
	Add *.log, and a demo of what I want.

2006-11-15  Richard Hughes  <richard@hughsie.com>

	* data/gnome-power-manager.schemas.in:
	* src/gpm-conf.h:
	* src/gpm-manager.c: (power_battery_status_perhaps_recall_cb):
	* src/gpm-power.c:
	Allow the distribution or user to turn off the recall warning.

2006-11-14  Richard Hughes  <richard@hughsie.com>

	* src/gpm-prefs.c: (gtkuniqueapp_command_cb):
	* src/gpm-statistics.c: (gtkuniqueapp_command_cb):
	Another s/libguniqueapp/GtkUnique.

2006-11-14  Richard Hughes  <richard@hughsie.com>

	* configure.in:
	* src/Makefile.am:
	* src/gpm-prefs.c: (gtkuniqueapp_command_cb):
	* src/gpm-statistics.c: (gtkuniqueapp_command_cb):
	Use GtkUnique rather than libguiqueapp.

2006-11-14  Richard Hughes  <richard@hughsie.com>

	* src/gpm-graph-widget.c: (gpm_graph_widget_key_add):
	* src/gpm-graph-widget.h:
	* src/gpm-statistics-core.c: (gpm_statistics_init):
	Begin to abstract out the events from the graph code.
	No functional changes.

2006-11-12  Richard Hughes  <richard@hughsie.com>

	* docs/dbus-interface.html:
	* docs/faq.html:
	* docs/icon-scheme.html:
	* docs/index.html:
	* docs/sleep-names.html:
	Regenerate.

	* src/.cvsignore:
	* src/run-gpm.sh:
	* src/valgrind-gpm.sh:
	Save the output in .log files.

	* src/gpm-ac-adapter.c:
	Tab fixes.

	* src/gpm-brightness-kbd.c:
	* src/gpm-brightness-kbd.h:
	* src/gpm-brightness-lcd.c:
	* src/gpm-brightness-lcd.h:
	Send a signal when the brightness is manually changed.

	* src/gpm-hal.c:
	Only try to clear the error if we are using a new HAL.

	* src/gpm-manager.c:
	Don't re-use the manager object on atexit as it produces an
	invalid read using valgrind.

	* src/gpm-srv-brightness-kbd.c:
	* src/gpm-srv-brightness-lcd.c:
	* src/gpm-srv-brightness-lcd.h:
	Add back the brightness changed UI by connecing to the
	brightness-changed signal.

	* src/gpm-srv-cpufreq.c:
	Set the policy before the nice, else we get a warning.

2006-11-10  Richard Hughes <richard@hughsie.com>

	* po/POTFILES.in:
	* src/Makefile.am:
	* src/README:
	* src/gpm-sound.c:
	* src/gpm-sound.h:
	Make a new GpmSound class.

	* src/gpm-common.c:
	* src/gpm-common.h:
	* src/gpm-manager.c:
	Use the GpmSound class.

2006-11-10  Richard Hughes <richard@hughsie.com>

	* po/POTFILES.in:
	* src/Makefile.am:
	* src/gpm-policy.c:
	* src/gpm-policy.h:
	Create a policy class so we can get at it from other than
	the manager class.

	* src/gpm-manager.c:
	* src/gpm-tray-icon.c:
	Use GpmPolicy. More code out of manager. Yay.

2006-11-10  Richard Hughes <richard@hughsie.com>

	* po/POTFILES.in:
	* src/Makefile.am:
	* src/README:
	* src/gpm-brightness-kbd.c:
	* src/gpm-brightness-kbd.h:
	* src/gpm-brightness-lcd.c:
	* src/gpm-brightness-lcd.h:
	* src/gpm-cpufreq.c:
	* src/gpm-cpufreq.h:
	* src/gpm-dpms.c:
	* src/gpm-dpms.h:
	* src/gpm-manager.c:
	* src/gpm-screensaver.c:
	* src/gpm-screensaver.h:
	* src/gpm-srv-brightness-kbd.c:
	* src/gpm-srv-brightness-kbd.h:
	* src/gpm-srv-brightness-lcd.c:
	* src/gpm-srv-brightness-lcd.h:
	* src/gpm-srv-cpufreq.c:
	* src/gpm-srv-cpufreq.h:
	* src/gpm-srv-dpms.c:
	* src/gpm-srv-dpms.h:
	* src/gpm-srv-screensaver.c:
	* src/gpm-srv-screensaver.h:
	Split the policy and the action of each state machine.
	GpmSrv* is the policy, and Gpm* is the action.
	src/README will explain more.
	I've also broken the brightness UI in the process.
	I'll fix that real soon, I promise.

2006-11-10  Richard Hughes <richard@hughsie.com>

	* src/screensaver.c (gpm_screensaver_auth_begin):
	Fix a crasher when unlocking the screen. #373278

2006-11-10  Richard Hughes <richard@hughsie.com>

	Adapted from a patch from David Zeuthen <david@fubar.dk>:

	* src/gpm-hal.c:
	* src/gpm-hal.h:
	Add gpm_hal_has_suspend_error, gpm_hal_has_hibernate_error
	gpm_hal_clear_suspend_error, gpm_hal_clear_hibernate_error
	to support the new suspend error reporting.

	* src/gpm-main.c: (main):
	Don't register the dbus interface twice.

	* src/gpm-manager.c:
	Add in logic and translations for detecting a resume failure.

	* src/gpm-screensaver.c:
	Cosmetic changes.

2006-11-09  Richard Hughes <richard@hughsie.com>

	* src/gpm-graph-widget.c:
	* src/gpm-graph-widget.h:
	* src/gpm-info.c: (idle_changed_cb):
	Don't refer to screen dim when we are talking about session
	idle and resume.

2006-11-09  Richard Hughes <richard@hughsie.com>

	* src/gpm-proxy.h:
	* src/gpm-proxy.c: (gpm_proxy_is_connected):
	Add this new method to see if the proxy if connected.

	* src/gpm-statistics-core.c: (gpm_statistics_init):
	Check if the proxy is valid, and if not warn the user.

	* src/gpm-statistics-core.c: (gpm_statistics_refresh_data):
	Only get the data for non-null data. Should fix #372703.

2006-11-09  Richard Hughes <richard@hughsie.com>

	* po/POTFILES.in:
	* src/Makefile.am:
	* src/gpm-manager.c:
	* src/gpm-warning.c:
	* src/gpm-warning.h:
	Abstract some of the warning code to GpmWarning - we can make
	a few optimisations while we are here also.

2006-11-08  Richard Hughes <richard@hughsie.com>

	* src/gpm-manager.c: (ac_adapter_changed_cb):
	Reset the event time only after we have checked for
	event_when_closed so we actually perform the action rather
	than fail the check. Should fix #366526.

2006-11-08  Richard Hughes <richard@hughsie.com>

	* src/Makefile.am:
	* src/gpm-brightness-kbd.c:
	* src/gpm-brightness-lcd.c:
	* src/gpm-dpms.c:
	* src/gpm-info.c:
	* src/gpm-manager.c:
	Move more of the idle functionality into gpm-dpms and make
	a few other cosmetic changes. I should have done this
	state machine stuff ages ago, it's made the code much easier
	for my little brain to comprehend.

2006-11-08  Richard Hughes <richard@hughsie.com>

	* src/gpm-idle.c:
	* src/gpm-idle.h:
	Change the signal name from 'changed' to 'idle-changed'.

	* src/gpm-brightness-kbd.c:
	* src/gpm-manager.c:
	Move the keyboard dim functionality into the GpmBrightnessKbd
	module where it belongs.

2006-11-08  Richard Hughes <richard@hughsie.com>

	* src/gpm-screensaver.c:
	* src/gpm-screensaver.h:
	Emit an event when idle mode is changed.

	* src/gpm-idle.c:
	* src/gpm-idle.h:
	Use a GpmScreensaver object rather than trying (wrongly) to
	handle the dbus connection ourselves.
	Also make into singleton, and tidy up.

	* src/gpm-manager.c:
	Small tidy-up.

	* src/gpm-tray-icon.c:
	Use gpm_debug in one case rather than g_debug.

2006-11-08  Richard Hughes <richard@hughsie.com>

	* data/gnome-power-manager.schemas.in:
	* src/gpm-conf.h:
	* src/gpm-manager.c: (idle_changed_cb):
	* src/gpm-screensaver.c: (update_lid_throttle):
	Apply a patch from Johannes Hansen (slightly tweaked by me)
	to better support using a laptop with an external monitor and
	keyboard connected. This uses a gconf key for now, but support
	should be added to HAL in the future to detect this docked
	case automatically. Fixes #365016.

2006-11-07  Richard Hughes <richard@hughsie.com>

	* src/gpm-screensaver.c:
	When we add a DPMS state throttle, remove the last one if set.
	This fixes the bug where the screensaver would not show if
	DPMS had been allowed to activate. Fixes #355279.

2006-11-07  Richard Hughes <richard@hughsie.com>

	* data/gpm-prefs.glade:
	Fix the duplicated action table name that was causing the
	battery item to show on desktops.

2006-11-07  Richard Hughes <richard@hughsie.com>

	* data/gnome-power-manager.schemas.in:
	Make the shutdown when critical levels a little less critical.

	* data/gpm-prefs.glade:
	Fix the duplicated table names that was causing the battery
	items to show on desktops.

	* src/gpm-manager.c:
	* src/gpm-tray-icon.c:
	Move the tray sync on HAL restart code into GpmTrayIcon.

	* src/gpm-info-data.c:
	* src/gpm-info-data.h:
	Move the gonject init stuff to the end of the file.

2006-11-02  Richard Hughes <richard@hughsie.com>

	* src/gpm-manager.c: (power_battery_status_perhaps_recall_cb)
	Add a translated string that I'll be using soon.

	* src/gpm-power.c:
	* src/gpm-power.h:
	Don't proxy the battery removed signal, we should use the GpmBattery
	class directly.

	* src/gpm-manager.c:
	* src/gpm-tray-icon.c:
	Use the GpmBattery class directly, and move funcionality from
	GpmManager class.

2006-11-02  Richard Hughes <richard@hughsie.com>

	* src/gpm-battery.c:
	Only add and remove batteries if sane. This uses a hashtable to keep
	track of what batteries we are watching and should fix #369488.

	* src/gpm-refcount.c: (gpm_refcount_set_timeout):
	In an error, just assume 1000ms else we don't get refcount timeouts.

2006-11-02  Richard Hughes <richard@hughsie.com>

	* data/gnome-power-manager.schemas.in:
	Use /apps/gnome-power-manager/enable_sounds rather than mentioning
	the pc beeper as we are now using gstreamer.

	* data/gnome-power-manager.schemas.in:
	* src/gpm-conf.h:
	* src/gpm-power.c: (gpm_power_init):
	Add /apps/gnome-power-manager/invalid_timeout as some machines take
	a massive amount of time to settle down after an ac adapter event.
	I don't want to penalise correct machines with a lag when it's only
	a small proportion that have this problem.

	* src/gpm-refcount.c: (gpm_refcount_set_timeout):
	Check for a refcount of zero, and warn if set.

2006-11-02  Richard Hughes <richard@hughsie.com>

	* po/POTFILES.in:
	* src/Makefile.am:
	* src/gpm-battery.c:
	* src/gpm-battery.h:
	* src/gpm-hal-monitor.c:
	* src/gpm-hal-monitor.h:
	* src/gpm-manager.c:
	* src/gpm-power.c:
	Rename GpmHalMonitor to GpmBattery as this is all we do now.
	My renaming spree has ended now, the sanity can continue.

	* src/gpm-tray-icon.c:
	Set the libnotify to NULL after we unref it, which will probably fix
	the crash in #365279

2006-11-02  Richard Hughes <richard@hughsie.com>

	* src/gpm-button.c:
	* src/gpm-hal-monitor.c:
	* src/gpm-power.c:
	Move the HAL button code from gpm-hal-monitor to gpm-button.

2006-11-02  Richard Hughes <richard@hughsie.com>

	* po/POTFILES.in:
	* src/Makefile.am:
	* src/gpm-ac-adapter.c:
	* src/gpm-ac-adapter.h:
	Create a new class for the AC adapter. Simple and easy.

	* src/gpm-brightness-kbd.c:
	* src/gpm-brightness-lcd.c:
	* src/gpm-cpufreq.c:
	* src/gpm-dpms.c:
	* src/gpm-info.c:
	* src/gpm-manager.c:
	* src/gpm-screensaver.c:
	* src/gpm-tray-icon.c:
	Use the new GpmAcAdapter class and get rid of the GpmPower dep.

	* src/gpm-hal.c:
	* src/gpm-hal.h:
	Remove the silly hardcoded function.

	* src/gpm-hal-monitor.c:
	* src/gpm-hal-monitor.h:
	* src/gpm-power.c:
	* src/gpm-power.h:
	Rip out the *three-times-layered* ac-adapter handling.

	* src/gpm-power.c:
	Change the settling timeout to be 500ms so we don't get so much of
	a delay on unplug before we hear the click.

	* src/gpm-tray-icon.c:
	Make sure we actually get rid of any notification on AC.

2006-10-30  Richard Hughes <richard@hughsie.com>

	* src/gpm-common.c: (gpm_event_sound):
	* src/gpm-common.h:
	* src/gpm-manager.c:
	Only make a sound if we are allowed to in gconf.

	* src/gpm-tray-icon.c: (libnotify_event):
	Set the notification NULL if we cleared if to avoid an error if the
	user clicks two notifications at once.

2006-10-30  Richard Hughes <richard@hughsie.com>

	* data/sounds/Makefile.am:
	* data/sounds/gpm-critical-power.wav:
	* data/sounds/gpm-suspend-failure.wav:
	* data/sounds/gpm-unplugged.wav:
	Add some sample sounds done by me.

2006-10-30  Richard Hughes <richard@hughsie.com>

	* configure.in:
	* data/Makefile.am:
	* data/sounds/.cvsignore:
	* data/sounds/Makefile.am:
	* src/gpm-common.c:
	* src/gpm-common.h:
	* src/gpm-manager.c:
	Add really basic support for gpm_event_sound() so we can make a sound
	when critical events happen.

2006-10-30  Richard Hughes <richard@hughsie.com>

	* src/gpm-hal.c:
	Make suspend and hibernate work by using the correct power interface
	rather than the manager interface.
	Find/replace can bite you in the ass sometimes. :-)

2006-10-28  Richard Hughes <richard@hughsie.com>

	* src/gpm-button.c:
	* src/gpm-button.h:
	* src/gpm-info.c:
	* src/gpm-manager.c:
	* src/gpm-screensaver.c:
	Move the lid detection into the button class.

2006-10-28  Richard Hughes <richard@hughsie.com>

	* src/gpm-info.c:
	* src/gpm-manager.c:
	Move some logging out of the manager and into the GpmInfo class.

2006-10-28  Richard Hughes <richard@hughsie.com>

	* po/POTFILES.in:
	* src/Makefile.am:
	* src/gpm-dpms.c:
	* src/gpm-hal-monitor.c:
	* src/gpm-hal-power.c:
	* src/gpm-hal-power.h:
	* src/gpm-hal.c:
	* src/gpm-hal.h:
	* src/gpm-info.c:
	* src/gpm-manager.c:
	* src/gpm-power.c:
	Remove GpmHalPower and add the functionality to GpmHal - there's no
	point having two gobjects doing basically the same thing.

2006-10-28  Richard Hughes <richard@hughsie.com>

	* src/gpm-hal-brightness-sensor.c:
	* src/gpm-hal-brightness-sensor.h:
	Remove these spare files that escaped the cvs rm session.

2006-10-28  Richard Hughes <richard@hughsie.com>

	* src/gpm-manager.c:
	* src/gpm-tray-icon.c:
	* src/gpm-tray-icon.h:
	Move some stuff out of the manager into the tray icon class.
	This one was easy. :-)

2006-10-28  Richard Hughes <richard@hughsie.com>

	* src/gpm-dpms.c:
	Make into singleton.

	* src/Makefile.am:
	* src/gpm-manager.c:
	* src/gpm-screensaver.c:
	Move some more functionality away from the manager class into the
	screensaver class. The idea is that GpmScreensaver should handle
	all interactions with the screensaver, even dimming and undimming the
	screen when the screensaver wants.

	* src/gpm-brightness-lcd.c:
	Make into a singleton so we can use this in the screensaver class.

2006-10-28  Richard Hughes <richard@hughsie.com>

	* src/Makefile.am:
	* src/gpm-brightness-kbd.c:
	* src/gpm-brightness-lcd.c:
	* src/gpm-button.c:
	* src/gpm-button.h:
	Abstract the button class further so that we don't need to setup
	callbacks on GpmPower to get hal buttons.

	* src/gpm-manager.c:
	* src/gpm-screensaver.c:
	* src/gpm-screensaver.h:
	Detect the lock button here, not in the manager.

2006-10-28  Richard Hughes <richard@hughsie.com>

	* src/gpm-dpms.c:
	* src/gpm-dpms.h:
	* src/gpm-manager.c:
	Actually handle the DPMS policy in the dpms class. Removes a chunk of
	code from the manager.

2006-10-28  Richard Hughes <richard@hughsie.com>

	* src/Makefile.am:
	Add a couple of modules to the prefs program for deps.

	* po/POTFILES.in:
	* src/gpm-brightness-kbd.c:
	* src/gpm-brightness-kbd.h:
	* src/gpm-brightness-lcd.c:
	* src/gpm-brightness-lcd.h:
	* src/gpm-cpufreq.c:
	* src/gpm-cpufreq.h:
	* src/gpm-inhibit.c:
	* src/gpm-light-sensor.c:
	* src/gpm-light-sensor.h:
	* src/gpm-prefs-core.c:
	Remove the HAL prefix from these classes.

	* src/gpm-manager.c:
	Move some of the state functionality from the manager into the
	objects. The manager is a mess and stuff needs to be better contained
	in thier own classes.
	The idea is that a class, say for instance the cpufreq class, is aware
	of what to do on ac-state-change and does it itself. Therefore all the
	functionality is in this module rather than half in the module and half
	in the manager.
	All the multiply used classes are singletons and so we don't use any
	more memory.

2006-10-28  Richard Hughes <richard@hughsie.com>

	* src/gpm-main.c: (main):
	Daemonize earlier than we connect to the system messagebus to fix
	#366057 so we can support PolicyKit and ConsoleKit.

	* .cvsignore:
	Add NEWS.new, the way I keep track of changes internally.

	* configure.in:
	Bump to 2.17.3, this was never done after the bodge release.

	* src/gpm-button.c: (gpm_button_new):
	Make into a singleton for future work.

2006-10-24  Harry Lu  <harry.lu@sun.com>

	* configure.in: enable '-Wall' only for gcc. Add '-lresolv -lXext'
	to GPM_EXTRA_LIBS.
	* src/Makefile.am: Add GPM_EXTRA_LIBS to gnome_power_manager_LDADD.

2006-10-24  Richard Hughes <richard@hughsie.com>

	* data/icons/16x16/gpm-primary-100-charging.png:
	Add charging flash to match the other charging icons. Fixes #364574.

2006-10-24  Richard Hughes <richard@hughsie.com>

	* docs/faq.xml:
	Add note mentioning that 2.6.19-rc3 does not need experimental flag.
	Many thanks to Stefan Schmidt for the info.

2006-10-23  Richard Hughes <richard@hughsie.com>

	* src/gpm-feedback-widget.c:
	* src/gpm-hal-brightness-kbd.c:
	* src/gpm-hal-brightness-lcd.c:
	* src/gpm-hal-light-sensor.c:
	* src/gpm-inhibit.c:
	* src/gpm-refcount.c:
	Remove a few non-required includes.

	* src/gpm-prefs-core.c: (gpm_prefs_init):
	Warn if glade file not found.

2006-10-23  Richard Hughes <richard@hughsie.com>

	* data/gpm-prefs.glade:
	Change the checkbox text to 'Dim the display when the computer is idle'
	to fix #363765.

2006-10-22  Richard Hughes <richard@hughsie.com>

	* src/gpm-manager.c: (battery_status_changed_primary):
	Don't do *any* action until the battery data is marked as valid.
	Patch from Stu Hood <stuhood@gmail.com>, many thanks.

	* src/gpm-info.c: (gpm_info_log_do_poll):
	Sanity check the rate and time values in case the hardware really
	goes screwy for a few seconds, and gets the values wrong.

2006-10-22  Richard Hughes <richard@hughsie.com>

	* data/gpm-graph.glade:
	Update The window title to be Power History rather than Power Graphs
	to match the drop down menu. Fixes #364200.

2006-10-22  Richard Hughes <richard@hughsie.com>

	* src/gpm-debug.c:
	Only allocate the var_args buffer once, globally. This stops us
	allocating and then deallocating 1024 byte chunks on each debug line.
	Fixes #363991, many thanks to Stu Hood.

2006-10-19  Richard Hughes <richard@hughsie.com>

	* src/gpm-tray-icon.c: (gpm_tray_icon_init):
	Oops. Fix compilation without libnotify. I hate #ifdefs.

2006-10-19  Richard Hughes <richard@hughsie.com>

	* src/gpm-tray-icon.c: (gpm_tray_icon_init):
	Properly initialise icon->priv->notify in the tray icon.
	This might fix #363446.

2006-10-18  Richard Hughes <richard@hughsie.com>

	* data/gpm-prefs.glade:
	Add a 'Make default' button in readyness for changing the system wide
	policy for all users.

	* po/POTFILES.in:
	* src/Makefile.am:
	* src/gpm-conf.c:
	* src/gpm-conf.h:
	* src/gpm-gconf.h:
	Replace the statatic header with a new GpmConf gobject to abstract
	getting and setting values from gconf.
	We'll need this for headless use where we might not have gconf
	available running as root.

	* src/gpm-common.c:
	* src/gpm-common.h:
	* src/gpm-hal-power.c:
	* src/gpm-info.c:
	* src/gpm-manager.c:
	* src/gpm-networkmanager.c:
	* src/gpm-polkit.c:
	* src/gpm-power.c:
	* src/gpm-prefs-core.c:
	* src/gpm-prefs.h:
	* src/gpm-screensaver.c:
	* src/gpm-statistics-core.c:
	* src/gpm-statistics.c:
	Looks a lot of changes, but basically use the GpmConf singleton rather
	than create a new copy of gconf_client for each object.
	This probably saves a little bit of memory, but it also makes the code
	look a lot better. ;-)

2006-10-18  Richard Hughes <richard@hughsie.com>

	* configure.in
	Change release to 2.17.2.1 so we can be included in the GNOME
	development release. See #363169 for details.

	* docs/dbus-interface.html:
	* docs/faq.html:
	* docs/icon-scheme.html:
	* docs/index.html:
	* docs/sleep-names.html:
	Regenerate with xmlto.

	* src/gpm-tray-icon.c: (gpm_tray_icon_finalize):
	Allow building without libnotify. My bad. Fixes #363169

2006-10-18  Richard Hughes  <richard@hughsie.com>

	==== Version 2.17.2 ====

2006-10-17  Richard Hughes <richard@hughsie.com>

	* src/gpm-hal-cpufreq.c: (gpm_hal_cpufreq_get_governor)
	Free the return string.

	* src/gpm-hal-cpufreq.c: (gpm_hal_cpufreq_finalize):
	Free any gobjects in use.

	* src/gpm-info-data.c: (gpm_info_data_free):
	Correct a typo that was stopping the info data being freed.

	* src/gpm-proxy.c: (gpm_proxy_finalize):
	Only unref if the object is not null. Paranoia.

	* src/gpm-tray-icon.c: (gpm_tray_icon_finalize):
	Free the strings in use by the gobject.

2006-10-17  Richard Hughes <richard@hughsie.com>

	* src/gpm-manager.c: (power_button_pressed_cb):
	Don't poke the screen when we shut the lid. This should stop the
	display going off, on, off when the lid is closed. Should fix #362694.

	* src/gpm-power.c: (battery_kind_cache_update):
	When we fall back to using the ac-adapter, we check the percentage.
	The percentage was set below the check, and thus always failed.
	Pointed out in #361583, and will probably affect multibattery laptops.

2006-10-17  Richard Hughes <richard@hughsie.com>

	* src/gpm-button.c: (gpm_button_grab_keystring), (gpm_button_init):
	Only allow single keys to be grabbed. It makes our life simpler.

	* src/gpm-tray-icon.c: (gpm_tray_icon_add_device):
	Use the localised general string to describe the battery device in the
	dropdown. This fixes #362690.

	* data/gnome-power-manager.schemas.in:
	* data/gpm-prefs.glade:
	* src/gpm-gconf.h:
	* src/gpm-manager.c: (idle_changed_cb):
	* src/gpm-prefs-core.c: (gpm_prefs_format_time_cb),
	Make the sleep options drop-downs like the other options, as feedback
	from a typical non-technical user (my girlfriend) was that is wasn't
	clear how to disable.

2006-10-16  Richard Hughes <richard@hughsie.com>

	* src/gpm-button.c: (gpm_button_init):
	Added another accesskey. Will fix up the X stuff in a few mins.

	* src/gpm-power.c: (gpm_power_get_battery_device_entry):
	* src/gpm-tray-icon.c: (gpm_tray_icon_add_device):
	Only add a battery to the drop down if present. Fixes #362690

2006-10-14  Richard Hughes <richard@hughsie.com>

	* configure.in:
	* po/POTFILES.in:
	* src/Makefile.am:
	* src/gpm-button.c:
	* src/gpm-button.h:
	* src/gpm-manager.c:
	Add XEVENTS functionality. This allows g-p-m to respond to events sent
	by X, as soon the kernel is going to be outputting INPUT events.
	Disabled by default. Very lightly tested.

2006-10-12  Richard Hughes <richard@hughsie.com>

	* data/gpm-prefs.glade:
	* src/gpm-prefs-core.c:
	Make the glade file spacing more correct. The extra hbox's also allow
	us to use a smaller amount of code to enable and disable rows.

2006-10-12  Richard Hughes <richard@hughsie.com>

	* src/gpm-hal-cpufreq.c: (gpm_hal_cpufreq_get_governors):
	When we have conservative and ondemand available, only expose
	conservative in the UI. They are too similar.

2006-10-12  Richard Hughes <richard@hughsie.com>

	* Makefile.am:
	Add a couple of fixes to make sure we can trivially build on debian.

	* src/gpm-power.c: (gpm_power_status_for_device_more):
	Change rate to be unit W, and capacity to be unit Wh.

2006-10-11  Richard Hughes <richard@hughsie.com>

	* .cvsignore:
	Add the .lineno files debian likes to chuck out.

	* configure.in:
	Check for HAL 0.5.8 and warn the user if they are using an old HAL.
	NOTE: The required dependency has not changed, but the recommended
	one has. You can still build with 0.5.6

	* src/gpm-power.c:
	Small whitespace fix.

2006-10-11  Richard Hughes <richard@hughsie.com>

	* po/POTFILES.in:
	* src/Makefile.am:
	* src/gpm-refcount.c:
	* src/gpm-refcount.h:
	Create this new object to be a general purpose refcounting object now
	that we are doing a similar thing in two places.

	* src/gpm-feedback-widget.c:
	Use the new beautiful GpmRefcount object rather than doing our own
	clunky thing.

	* src/gpm-hal-power.c:
	Make into a singleton as two things are using this in g-p-m.
	This fixes a pretty random crash in the SetLowMowerMode code. Oops.

	* src/gpm-manager.c:
	* src/gpm-power.c:
	* src/gpm-power.h:
	Add GpmRefcount functionality so that the data is tainted for a few
	seconds after a	power event.
	This means that we should not be shutting down or warning after just
	pulling the plug or starting up and waiting for HAL to update the
	battery charge values. This should fix #350374.

2006-10-10  Richard Hughes <richard@hughsie.com>

	* src/gpm-hal-cpufreq.c:
	* src/gpm-hal-cpufreq.h:
	* src/gpm-prefs-core.c:
	Get rid of gpm_hal_cpufreq_has_hardware and use the singleton method
	like we do for the brightness classes. This fixes a warning in the
	preferences code when you have a HAL not capable of cpufreq_control.

2006-10-10  Richard Hughes <richard@hughsie.com>

	* data/icons/scalable/gpm-keyboard-030.svg:
	* data/icons/scalable/gpm-mouse-030.svg:
	Make these icons have the correct 'fill' colour. Fixes #352416.

2006-10-10  Richard Hughes <richard@hughsie.com>

	* src/gpm-inhibit.c:
	* src/gpm-power.c:
	Apply a patch from Elijah Newren to remove markup in translatable
	messages. This fixes #360464.

	* configure.in:
	* src/gpm-tray-icon.c: (libnotify_event):
	OOps. Make this build.

2006-10-10  Richard Hughes <richard@hughsie.com>

	* src/gpm-graph-widget.c:
	* src/gpm-graph-widget.h:
	* src/gpm-info.c:
	* src/gpm-power.c:
	* src/gpm-power.h:
	* src/gpm-statistics-core.c:
	Display a graph for battery voltage. This is interesting for power
	people that want to calculate hysteresis. Like me.

	* configure.in:
	* src/gpm-tray-icon.c: (libnotify_event):
	Detect a new enough libnotify and enable the pointing code if new
	enough. This fixes #356431
	Distros should comment this check out if libnotify 0.4.2 has been
	patched from CVS.

2006-10-09  Gabor Kelemen  <kelemeng@gnome.hu>

	* src/gpm-graph-widget.c:
	Mark time measurement units for translation. Fix for bug #359089.

2006-10-06  Richard Hughes  <richard@hughsie.com>

	* src/gpm-manager.c:
	Now react immediatly when the user changes the cpufreq policy.
	Also clean up this the actions, and split the sync routine into
	it's seporate parts. It's more manageable this way, and reduces CPU
	load when you start changing bazzillions of gconf keys.

2006-10-05  Frederic Peters  <fpeters@0d.be>

	* configure.in:
	Don't define HAVE_LIBNOTIFY when libnotify is not found.

2006-10-01  Richard Hughes  <richard@hughsie.com>

	* po/POTFILES.in:
	Add a missing file (Marcel Telka)

	* src/Makefile.am:
	* src/gpm-hal-brightness-kbd.c:
	* src/gpm-hal-brightness-kbd.h:
	* src/gpm-hal-light-sensor.c:
	* src/gpm-hal-light-sensor.h:
	* src/gpm-manager.c:
	Merge some new light-sensor stuff based on a patch from David Zeuthen.
	This isn't finished yet - I need to take some more ideas from David's
	patch and merge them - along with some more ideas of my own on the
	feedback mechanism for the LCD and keyboard backlight.
	I've been busy this weekend - so coding will resume some point this
	week.

2006-09-29  Richard Hughes  <richard@hughsie.com>

	* src/gpm-hal-brightness-sensor.c:
	* src/gpm-hal-brightness-sensor.h:
	Add initial light sensor class that does nothing and isn't even connected
	up to make. This might give DavidZ something to work with.

2006-09-28  Richard Hughes  <richard@hughsie.com>

	* help/C/figures/gpm-info-devices.png:
	* help/C/figures/gpm-info-event-log.png:
	* help/C/figures/gpm-info-percentage.png:
	* help/C/figures/gpm-info-rate.png:
	* help/C/figures/gpm-info-time.png:
	* help/C/gnome-power-manager.xml:
	* help/Makefile.am:
	Remove the old info images and re-organise the help file a little bit.

2006-09-28  Richard Hughes  <richard@hughsie.com>

	* help/C/figures/gpm-mouse-left.png:
	* help/C/figures/gpm-mouse-right.png:
	* help/C/figures/gpm-prefs-ac.png:
	* help/C/figures/gpm-prefs-actions.png:
	* help/C/figures/gpm-prefs-battery.png:
	* help/C/figures/gpm-prefs-display.png:
	* help/C/figures/gpm-prefs-notification.png:
	* help/C/figures/gpm-prefs-options.png:
	* help/C/figures/gpm-prefs-processor.png:
	* help/C/figures/gpm-prefs-sleep.png:
	* help/C/figures/gpm-stats-graph.png:
	* help/C/gnome-power-manager.xml:
	* help/Makefile.am:
	Update the yelp pictures to reflect reality.

2006-09-28  Richard Hughes  <richard@hughsie.com>

	* src/gpm-feedback-widget.c:
	Fix the display of the feedback icon.

2006-09-28  Richard Hughes  <richard@hughsie.com>

	* src/gpm-manager.c:
	* src/gpm-polkit.c:
	Move the HAVE_POLKIT stuff into the GpmPolkit module and just return
	NULL if support is not compiled in.
	This means we get ridof some ugly ifdefs from the manager class.

2006-09-28  Richard Hughes  <richard@hughsie.com>

	* src/gpm-hal-brightness-kbd.c: (gpm_hal_brightness_kbd_new):
	* src/gpm-hal-brightness-lcd.c: (gpm_hal_brightness_lcd_new):
	Return NULL for no hardware, not FALSE;

	* src/gpm-hal-cpufreq.c: (gpm_hal_cpufreq_has_hw):
	Only load the gobject if we have the cpufreq_control hardware.

	* src/gpm-hal.h:
	Define org.freedesktop.Hal.Device.LightSensor for some crazy new
	experimental stuff on the horizon.

2006-09-28  Richard Hughes  <richard@hughsie.com>

	* docs/icon-scheme.xml:
	Add gpm-brightness-lcd and gpm-brightness-kbd.

	* src/gpm-power.c:
	* src/gpm-power.h:
	Now we have gpm_hal_device_get_uint, use it.

2006-09-28  Richard Hughes  <richard@hughsie.com>

	* data/icons/16x16/Makefile.am:
	* data/icons/16x16/gpm-brightness-kbd.png:
	* data/icons/16x16/gpm-brightness-lcd.png:
	* data/icons/16x16/gpm-brightness.png:
	* data/icons/16x16/gpm-primary-missing.png:
	* data/icons/16x16/gpm-ups-100-charging.png:
	* data/icons/22x22/Makefile.am:
	* data/icons/22x22/gpm-brightness-kbd.png:
	* data/icons/22x22/gpm-brightness-lcd.png:
	* data/icons/22x22/gpm-brightness.png:
	* data/icons/24x24/Makefile.am:
	* data/icons/24x24/gpm-brightness-kbd.png:
	* data/icons/24x24/gpm-brightness-lcd.png:
	* data/icons/24x24/gpm-brightness.png:
	* data/icons/scalable/Makefile.am:
	* data/icons/scalable/gpm-brightness-kbd.svg:
	* data/icons/scalable/gpm-brightness-lcd.svg:
	* data/icons/scalable/gpm-brightness.svg:
	Rename gpm-brightness to gpm-brightness-lcd and add gpm-brightness-kbd.
	This is for the feedback widget for keyboard backlight feedback.

	* data/gnome-power-manager.schemas.in:
	* po/POTFILES.in:
	* src/Makefile.am:
	* src/gpm-hal-brightness.c:
	* src/gpm-hal-brightness.h:
	* src/gpm-hal-brightness-lcd.c:
	* src/gpm-hal-brightness-lcd.h:
	Rename as we have a new kid on the block, namely kbd.

	* src/gpm-hal-brightness.c:
	* src/gpm-hal-brightness.h:
	When stepping down, actually use the step value. (David Zeuthen)
	Check for overflow / underflow when step value > 1.
	Used signed integers when stepping down as we may underflow.
	Should fix #358067.

	* src/gpm-common.c:
	* src/gpm-common.h:
	Add gpm_percent_to_discrete() and gpm_discrete_to_percent() generic
	functions.

	* src/gpm-feedback-widget.c:
	* src/gpm-feedback-widget.h:
	* src/gpm-stock-icons.h:
	Add gpm_feedback_set_icon_name() so we can set different icons on the
	feedback widget.
	Also load the feedback widget here and get rid of the manager signal -
	this allows us to save memory if we don't have the hardware.

	* src/gpm-hal.c:
	* src/gpm-hal.h:
	Add a dummy function gpm_hal_device_get_uint() so we don't have to muck
	about with casting.

	* src/gpm-gconf.h:
	* src/gpm-manager.c:
	* src/gpm-hal-brightness-kbd.c:
	* src/gpm-hal-brightness-kbd.h:
	Add a heavily modified patch from David Zeuthen to add keyboard
	backlight (write) support to gnome-power-manager. Many thanks!

2006-09-27  Richard Hughes  <richard@hughsie.com>

	* data/icons/16x16/gpm-keyboard-030.png:
	* data/icons/16x16/gpm-keyboard-060.png:
	* data/icons/16x16/gpm-keyboard-100.png:
	* data/icons/16x16/gpm-mouse-030.png:
	* data/icons/16x16/gpm-mouse-060.png:
	* data/icons/16x16/gpm-mouse-100.png:
	Update the icons to have the right colours and levels.
	This partially fixes #352416

	* src/gpm-hal-monitor.c:
	* src/gpm-manager.c:
	Better detect hotplugged wireless mice.

	* src/gpm-hal.c:
	* src/gpm-hal.h:
	Add gpm_hal_device_has_capability().

2006-09-26  Richard Hughes  <richard@hughsie.com>

	* src/gpm-power.c: (gpm_power_get_device_from_udi),
	* src/gpm-power.h:
	Export this, we need it in the tray icon class.

	* src/gpm-info.c: (gpm_info_log_do_poll):
	* src/gpm-manager.c: (gpm_manager_init):
	* src/gpm-tray-icon.c:
	Remove the info code and place into a notification. This will change to
	a modal dialogue at some stage, to conform more to the HIG.
	Ooop. There goes another 200Kb writable from the daemon now we are
	not loading all the glade and GTK stuff.

	* data/Makefile.am:
	* data/gpm-info.glade:
	* po/POTFILES.in:
	Remove the glade file now we are not using it.

2006-09-26  Richard Hughes  <richard@hughsie.com>

	* data/gpm-prefs.glade:
	* src/gpm-prefs-core.c: (prefs_setup_actions), (gpm_prefs_init):
	Added policy in the UI for the suspend button action due to a distro
	beginning with U changing the default action to 'nothing'.

2006-09-26  Francisco Javier F. Serrador  <serrador@openshine.com>

	* data/gpm-prefs.glade: Fixed typo which made a duplicate string.

2006-09-26  Richard Hughes  <richard@hughsie.com>

	* data/gnome-power-statistics.desktop.in:
	Actually use a valid category so it shows up in the menus.

2006-09-26  Richard Hughes  <richard@hughsie.com>

	* data/icons/16x16/Makefile.am:
	* data/icons/16x16/gpm-statistics.png:
	* data/icons/22x22/Makefile.am:
	* data/icons/22x22/gpm-statistics.png:
	* data/icons/24x24/Makefile.am:
	* data/icons/24x24/gpm-statistics.png:
	* data/icons/scalable/Makefile.am:
	* data/icons/scalable/gpm-statistics.svg:
	* src/gpm-stock-icons.h:
	* src/gpm-tray-icon.c:
	Add a proper gpm-statistics tango icon. (Jakub Steiner)

2006-09-25  Richard Hughes  <richard@hughsie.com>

	* src/gpm-manager.c:
	* src/gpm-power.c:
	* src/gpm-power.h:
	Use perhaps_recall rather than might_explode to prevent angry calls
	from big legal teams. Also tone down the warning a little.

2006-09-23  Richard Hughes  <richard@hughsie.com>

	* src/gpm-manager.c:
	* src/gpm-power.c:
	* src/gpm-power.h:
	Add in preliminary support for detecting batteries that might explode.
	See http://hughsient.livejournal.com/4240.html for more details.

2006-09-23  Richard Hughes  <richard@hughsie.com>

	* src/Makefile.am:
	* src/gpm-statistics-core.c: (gpm_statistics_activate_window):
	* src/gpm-statistics-core.h:
	* src/gpm-statistics.c: (guniqueapp_command_cb):
	Add guniqueapp support to gnome-power-statistics.

2006-09-23  Richard Hughes  <richard@hughsie.com>

	* data/gnome-power-manager.schemas.in:
	* src/gpm-gconf.h:
	* src/gpm-statistics-core.c:
	Add /apps/gnome-power-manager/statistics_graph_type so that
	gnome-power-statistics remembers the graph type for startup.

2006-09-22  Richa/apps/gnome-power-manager/statistics_graph_typerd Hughes  <richard@hughsie.com>

	* src/gpm-graph-widget.h:
	Make charging line a lighter blue.

2006-09-22  Richard Hughes  <richard@hughsie.com>

	* src/gpm-graph-widget.c:
	* src/gpm-graph-widget.h:
	Draw different shapes for the event for colour-blind support.

	* src/gpm-statistics-core.c:
	* src/gpm-info.c:
	Send the *event* rather than the colour of the event.

	* src/gpm-manager.c:
	Remove the DPMS events, they never really belonged anyway.

2006-09-22  Richard Hughes  <richard@hughsie.com>

	* src/gpm-graph-widget.c:
	* src/gpm-graph-widget.h:
	Add in initial code to be able to draw dots of differing shape:
	circle, square, diamond and triangle.
	This is to make the graph output more suitable for colour-blind
	people as pointed out in my blog.

2006-09-22  Richard Hughes  <richard@hughsie.com>

	* data/gpm-info.glade:
	* src/gpm-info.c:
	Remove the infrequently used event log from the UI.
	There goes another 200Kb of writable memory. I plan to add tooltip
	support for the text points in the statistics tool.

2006-09-22  Richard Hughes  <richard@hughsie.com>

	* src/gpm-info.c: (gpm_info_init):
	Fix simple comment typo.

	* src/gpm-prefs.c:
	Make Elijah's patch compile with -Werror. :-)

	* src/gpm-tray-icon.c:
	Remove the gtk_ui_manager-style dropdown menus in favour of something
	simpler. We need to be able to add arbitary number of entries with
	custom icons for devices and so we need more control of the menu.
	Move Help, About, Statistics and Preferences to right mouse button
	action to fix #347913.

2006-09-22  Elijah Newren  <newren gmail com>

	* src/gpm-prefs.c (main): Make sure to obtain the
	DESKTOP_STARTUP_ID environment variable before gtk_init() is
	called since gtk_init() clears it.  #357128.

2006-09-22  Richard Hughes  <richard@hughsie.com>

	* help/C/figures/gpm-stats-graph.png:
	* help/C/gnome-power-manager.xml:
	* help/Makefile.am:
	Add this new image so I can blog about it.

	* src/gpm-hal-brightness.c:
	* src/gpm-hal-power.c:
	Convert the last two (insane) users of dbus_g_proxy_call to something
	a bit more standard.

	* src/gpm-hal.c:
	Be less verbose about missing keys, sometimes it's legitimate.

2006-09-21  Richard Hughes  <richard@hughsie.com>

	* src/gpm-hal-brightness.c:
	* src/gpm-hal-cpufreq.c:
	* src/gpm-hal-power.c:
	* src/gpm-hal.c:
	* src/gpm-info.c:
	* src/gpm-main.c:
	* src/gpm-manager.c:
	* src/gpm-polkit.c:
	* src/gpm-prefs-core.c:
	* src/gpm-screensaver.c:
	* src/gpm-statistics-core.c:
	Convert all the wacky invokations of dbus_g_proxy_call to use
	a common format. Also convert all the g_warnings into gpm_warnings
	so we can log them properly. Lots more GError love too.

2006-09-21  Richard Hughes  <richard@hughsie.com>

	* data/gpm-info.glade:
	* src/gpm-info.c:
	Remove the graphs from the info window.
	This saves over 500kb of writable memory from each
	gnome-power-manager daemon process. More to be cut soon.

	* src/gpm-tray-icon.c:
	Enable the statistics option in the right mouse button menu.

2006-09-21  Richard Hughes  <richard@hughsie.com>

	* po/POTFILES.in:
	* src/Makefile.am:
	* src/gpm-gconf.h:
	* src/gpm-info.c:
	* src/gpm-manager.c:
	* src/gpm-power.c:
	* src/gpm-prefs-core.c:
	* src/gpm-prefs.h:
	* src/gpm-statistics-core.c:
	* src/gpm-statistics.c:
	Move the gconf keys out of gpm-prefs.h into a new file gpm-gconf.h
	There are no good reasons to have the keys in the prefs header.

2006-09-21  Richard Hughes  <richard@hughsie.com>

	* src/gpm-prefs.h:
	* data/gnome-power-manager.schemas.in:
	Add statistics_show_legend and statistics_show_events so we have
	persistent settings for the statistics program.

	* src/Makefile.am:
	* src/gpm-info-data.c:
	* src/gpm-info-data.h:
	* src/gpm-statistics-core.c:
	Add gpm_info_data_clear() so we can re-init the data.
	Use GpmInfoData as a datastore in the statistics module so we leak
	a lot less memory. Also clean up this module.
	gnome-power-statistics now works as well as the 'Information' screen
	that we used before and is out of process.

	* src/gpm-info.c:
	Send the correct format information for the event log dbus method.

2006-09-21  Richard Hughes  <richard@hughsie.com>

	* TODO:
	Remove dbus-send cruft.

	* src/gpm-graph-widget.c:
	* src/gpm-graph-widget.h:
	Add a new function gpm_graph_widget_string_to_axis_type().

	* src/gpm-hal-power.c: (gpm_hal_handle_error):
	Check another possible execption. It may make the suspend-failed
	warning go away.

	* src/gpm-info.c:
	* src/gpm-info.h:
	* src/gpm-interface-statistics.xml:
	* src/gpm-statistics-core.c:
	* src/gpm-statistics-core.h:
	Do some more to the statistics interface. It actually sort-of runs
	but it's pretty rough code. And it leaks memory like a bitch.

2006-09-19  Richard Hughes  <richard@hughsie.com>

	* po/POTFILES.in:
	* src/Makefile.am:
	* src/gpm-graph-core.c:
	* src/gpm-graph-core.h:
	* src/gpm-graph.c:
	* src/gpm-statistics-core.c:
	* src/gpm-statistics-core.h:
	* src/gpm-statistics.c:
	Rename graph->statistics as it's too confusing with the graph-widget.

2006-09-19  Richard Hughes  <richard@hughsie.com>

	* help/C/figures/gpm-charged.png:
	Update with the new tango icons and the 2-16 colours.

2006-09-19  Richard Hughes  <richard@hughsie.com>

	* configure.in:
	Remove -Wshadow as it causes compilation failure on YDL-4.1.
	Fixes #356667.

2006-09-19  Richard Hughes  <richard@hughsie.com>

	* src/gpm-hal-monitor.c:
	* src/gpm-hal.c:
	* src/gpm-hal.h:
	Bullet-proof the hal interface so we automatically connect up the
	device DeviceCondition and PropertyChanged on HAL restart.
	This fixes #349842 where HAL wasn't detecting the charge correctly
	on resume. Thanks to Pascal Terjan for help with the bug.

	* src/gpm-proxy.c:
	Fix a silly typo where we were emmiting PROXY_STATUS FALSE on
	both connection and disconnection.

2006-09-19  Richard Hughes  <richard@hughsie.com>

	* src/gpm-dbus-monitor.c:
	Reduce the debugging level, it's a bit verbose.

	* src/gpm-main.c:
	Remove a potential null-dereference, spotted by Joseph Sacco.
	This fixes #356667 where g-p-m would crash on startup.

2006-09-18  Richard Hughes  <richard@hughsie.com>

	* src/gpm-hal-power.c:
	Remove erroneous HALD_SERVICE definitions.

	* src/gpm-manager.c:
	Don't watch to see if the tray icon is destroyed; it can't happen with
	GtkStatusIcon.
	Don't get the difference in charge and add it to the event log on
	resume as HAL has not refreshed and this will never succeed.

2006-08-20  Richard Hughes  <richard@hughsie.com>

	* configure.in: Post release bump to 2.17.2

2006-09-18  Richard Hughes  <richard@hughsie.com>

	==== Version 2.17.1 ====

2006-09-18  Richard Hughes  <richard@hughsie.com>

	* po/POTFILES.in:
	* src/Makefile.am:
	* src/gpm-dpms-x11.c:
	* src/gpm-dpms.c:
	Rename this file, to match the other module syntax names.

	* src/gpm-dpms.h:
	* src/gpm-dpms.c: (gpm_dpms_method_from_string)
	* src/gpm-manager.c: (sync_dpms_policy):
	Add gpm_dpms_method_from_string(), and try to do more sane things for
	laptop hardware to try to fix bug #354726.

	* src/gpm-hal-power.c: (gpm_hal_power_is_laptop):
	Remove fixme that applied to an old version of HAL.

	* src/gpm-tray-icon.c: (gpm_tray_icon_popup_menu_cb)
	Don't error when we right click. Also disable the statistics thing
	for now as it doesn't do much.

2006-09-18  Richard Hughes  <richard@hughsie.com>

	* src/gpm-prefs-core.c: (prefs_setup_processor):
	Setup the sliders before the combo-bosex else we re-enable the sliders
	for the non-custom policy.

2006-09-17  Richard Hughes  <richard@hughsie.com>

	* configure.in:
	* src/Makefile.am:
	* src/gpm-prefs-core.c:
	* src/gpm-prefs-core.h:
	* src/gpm-prefs.c:
	Add guniqueapp shared library support. This is optional.

2006-09-17  Richard Hughes  <richard@hughsie.com>

	* src/gpm-debug.c:
	* src/gpm-hal-cpufreq.c:
	* src/gpm-hal.c:
	* src/gpm-info.c:
	* src/gpm-prefs-core.c:
	Remove duplicate includes thanks to the checkincludes.pl script.

2006-09-17  Richard Hughes  <richard@hughsie.com>

	* NEWS:
	Add in 2.16.0 info.

	* configure.in:
	Oops. We only want dbus 0.70 for the glib bindings.

	* src/Makefile.am:
	Don't ship the inhibit test application.

	* src/gpm-hal.c:
	Only include config.h once.

	* src/gpm-manager.c:
	Fix another icon name g_free.

	* src/run-valgrind-gpm.sh:
	* src/valgrind-gpm.sh:
	Rename.

2006-09-17  Richard Hughes  <richard@hughsie.com>

	* configure.in:
	Update dbus dep to 0.92.

	* src/gpm-hal.c:
	Remove obsolete dbus < 0.62 ifdef code.

	* src/gpm-info-data.c: (gpm_info_data_add_always):
	guint can never be negative. Instead check for zero.

2006-09-17  Richard Hughes  <richard@hughsie.com>

	* src/gpm-manager.c:
	Fix a couple of small memory leaks where we don't free the icon name.

2006-09-17  Richard Hughes  <richard@hughsie.com>

	* help/C/figures/gpm-critical.png:
	* help/C/figures/gpm-low.png:
	* help/C/figures/gpm-tooltip.png:
	* help/C/figures/gpm-unplugged.png:
	* help/C/figures/gs-prefs.png:
	Update to reflect 2-16.

	* src/gpm-tray-icon.c: (libnotify_event):
	Add in a note about the non-pointing libnotify bubbles.

2006-09-17  Richard Hughes  <richard@hughsie.com>

	* data/gnome-power-manager.schemas.in:
	* data/gpm-prefs.glade:
	* src/gpm-hal-brightness.c:
	* src/gpm-manager.c:
	* src/gpm-prefs-core.c:
	* src/gpm-prefs.h:
	Add elements in the UI to prevent g-p-m from modifying the brightness
	on AC state change. Also add in the UI for the keyboard light sensor
	but disable it for now. Fixes #356085

2006-09-17  Richard Hughes  <richard@hughsie.com>

	* src/gpm-manager.c: (gpm_manager_init):
	Don't rescan buttons every minute. This belongs in HAL. Fixes #356170.
	The HAL patch will be submitted this week.

2006-09-17  Richard Hughes  <richard@hughsie.com>

	* configure.in:
	* po/POTFILES.in:
	* src/Makefile.am:
	* src/eggtrayicon.c:
	* src/eggtrayicon.h:
	* src/gpm-tray-icon.c:
	* src/gpm-tray-icon.h:
	Remove eggtrayicon support. This means we depend on GTK+ 2.10.0
	This fixes #356150.

2006-09-14  Richard Hughes  <richard@hughsie.com>

	* src/gpm-hal-monitor.c:
	Fix hotplug add and remove of wireless mice.

	* src/gpm-power.c:
	Don't express the decimal point for the / 7 csr scale.

2006-09-14  Richard Hughes  <richard@hughsie.com>

	* man/gnome-power-manager.sgml:
	* src/gpm-debug.c:
	* src/gpm-debug.h:
	Add in the debug option so we can easier debug g-p-m.
	Now adding the options --debug=power --debug=manager will only display
	the gpm-power and gpm-manager debug output.

	* src/gpm-graph-core.c:
	* src/gpm-hal.c:
	* src/gpm-info.c:
	* src/gpm-main.c:
	* src/gpm-manager.c:
	* src/gpm-tray-icon.c:
	Convert some more g_debug's to gpm_debug so we can use the above.

2006-09-12  Richard Hughes  <richard@hughsie.com>

	* configure.in: Increase dep of libgnome to 2.14.0 because we are using
	GNOME_PARAM_GOPTION_CONTEXT, which was introduced in 2.14.0
	Spotted by Mart Raudsepp, to fix #355437, many thanks.

2006-09-09  Richard Hughes  <richard@hughsie.com>

	* data/.cvsignore:
	* data/gnome-power-statistics.desktop.in:
	Add the missing desktop file. OOps.

	* data/gnome-power-manager.schemas.in:
	* src/gpm-prefs-core.c: (prefs_setup_actions):
	* src/gpm-prefs.h:
	Add the low power policy key to complete the UPS prefs dialogue.
	Default to nothing for low, and shutdown for critical.

2006-09-08  Richard Hughes  <richard@hughsie.com>

	* data/Makefile.am:
	Fix make distcheck. OOps.

2006-09-08  Richard Hughes  <richard@hughsie.com>

	* BRANCHES:
	Create, and list all the cool stuff that happened in each branch.

	* docs/dbus-interface.html:
	Regenerate.

	* data/Makefile.am:
	* src/Makefile.am:
	* src/gpm-tray-icon.c: (gpm_tray_icon_show_statistics_cb):
	Make a clickable icon for the statistics option if we don't
	have the icon displayed.

2006-09-08  Richard Hughes  <richard@hughsie.com>

	* src/gpm-power.c:
	Remove the FIXME to fix #334212. It's breaking more laptops that it
	was intended to fix and also breaks my (already broken) iBook.

2006-09-08  Richard Hughes  <richard@hughsie.com>

	* src/gpm-proxy.c: (gpm_proxy_assign), (gpm_proxy_init):
	Make sure that priv->connection is NULL at startup, and check
	for a non-null value when we try to get the daemon.
	May fix #353769.

2006-09-08  Richard Hughes  <richard@hughsie.com>

	* docs/dbus-interface.xml:
	Move away from power measurements in Watts to percentages to better
	suit low power laptops and OLPC.
	Now we have 'on = 100%, standby < 50%, suspend < 20%, off < 5%'

2006-09-08  Richard Hughes  <richard@hughsie.com>

	* src/gpm-inhibit-test.c: (dbus_inhibit_gpm), (dbus_uninhibit_gpm):
	Don't treat error like a boolean.
	Also check for a NULL proxy and warn. From a comment in #344979

2006-09-03  Richard Hughes  <richard@hughsie.com>

	* po/POTFILES.in:
	Add a few missing files. Noticed by Marcel Telka <marcel@telka.sk>

2006-08-31  Richard Hughes  <richard@hughsie.com>

	* help/C/gnome-power-manager.xml:
	Make listitem entries actually different bullet points.

2006-08-30  Richard Hughes  <richard@hughsie.com>

	* src/gpm-graph-core.c:
	Make sure we hide all the battery panes when we are on AC.

	* src/gpm-graph-widget.c:
	* src/gpm-graph-widget.h:
	* src/gpm-info-data.h:
	* src/gpm-info.c:
	Impliment more of the graph interface, and add the line colour to the
	legend to fix #353583.

2006-08-30  Richard Hughes  <richard@hughsie.com>

	* data/gnome-power-manager.schemas.in:
	* src/gpm-manager.c:
	* src/gpm-prefs.h:
	Apply a patch to allow users to turn off the disconnect and reconnect
	of NetworkManager on sleep and resume.
	Patch from Khashayar Naderehvandi <khashayar_naderehvandi@yahoo.co.uk>,
	many thanks. Fixes #353431

2006-08-30  Richard Hughes  <richard@hughsie.com>

	* TODO:
	* help/C/gnome-power-manager.xml:
	Better format some of the text, and move some stuff about.

2006-08-29  Richard Hughes  <richard@hughsie.com>

	* TODO:
	Update, removing the cpufreq and ansi->gtype comments.

	* src/gpm-common.c:
	* src/gpm-common.h:
	* src/gpm-dbus-monitor.c:
	* src/gpm-dbus-monitor.h:
	* src/gpm-debug.c:
	* src/gpm-debug.h:
	* src/gpm-dpms-x11.c:
	* src/gpm-dpms.h:
	* src/gpm-feedback-widget.c:
	* src/gpm-feedback-widget.h:
	* src/gpm-graph-core.c:
	* src/gpm-graph-widget.c:
	* src/gpm-graph-widget.h:
	* src/gpm-hal-brightness.c:
	* src/gpm-hal-brightness.h:
	* src/gpm-hal-cpufreq.c:
	* src/gpm-hal-cpufreq.h:
	* src/gpm-hal-monitor.c:
	* src/gpm-hal-monitor.h:
	* src/gpm-hal-power.c:
	* src/gpm-hal-power.h:
	* src/gpm-hal.c:
	* src/gpm-hal.h:
	* src/gpm-info-data.c:
	* src/gpm-info-data.h:
	* src/gpm-info.c:
	* src/gpm-info.h:
	* src/gpm-inhibit-test.c:
	* src/gpm-inhibit.c:
	* src/gpm-inhibit.h:
	* src/gpm-manager.c:
	* src/gpm-manager.h:
	* src/gpm-polkit.c:
	* src/gpm-polkit.h:
	* src/gpm-power.c:
	* src/gpm-power.h:
	* src/gpm-prefs-core.c:
	* src/gpm-proxy.c:
	* src/gpm-proxy.h:
	* src/gpm-screensaver.c:
	* src/gpm-screensaver.h:
	* src/gpm-stock-icons.c:
	* src/gpm-tray-icon.c:
	* src/gpm-tray-icon.h:
	Convert lots of code to glib types, and making some more specific
	marking as constant or unsigned.
	I still want to make some more varibles more explit to optimise them,
	for instance having a percentage stored in a 32 bit guint32 makes
	no sense at all.

2006-08-29  Richard Hughes  <richard@hughsie.com>

	* help/C/gnome-power-manager.xml:
	* src/gpm-manager.c:
	Add some more entries to the yelp file for people without internet
	access and remove the URL. Fixes #337721

2006-08-28  Richard Hughes  <richard@hughsie.com>

	* src/.cvsignore:
	Add new generated files to keep cvs happy.

	* src/gpm-tray-icon.c:
	Rename graph to statistics in a few places.

2006-08-28  Richard Hughes  <richard@hughsie.com>

	* src/Makefile.am:
	Don't call files -glue, it confuses waf.

	* data/gnome-power-manager.schemas.in:
	* src/gpm-main.c:
	* src/gpm-manager.c:
	* src/gpm-prefs.h:
	Add /apps/gnome-power-manager/session_request_save so distros like
	Ubuntu can just switch a gconf key rather than patch the source.

2006-08-28  Richard Hughes  <richard@hughsie.com>

	* .cvsignore:
	* src/gpm-info.c:
	* src/gpm-info.h:
	* src/gpm-proxy.c:
	Implement the struct passing code for new DBUS versions for the
	statistics interface.

2006-08-28  Richard Hughes  <richard@hughsie.com>

	* TODO:
	Add more detail about the out of process interface.

	* help/C/gnome-power-manager.xml:
	Fix make distcheck. TODO: Find out why abstract doesn't work!

	* src/Makefile.am:
	* src/gpm-interface-manager.xml:
	* src/gpm-interface-statistics.xml:
	* src/gpm-main.c:
	* src/gpm-manager.c:
	* src/gpm-manager.xml:
	* src/gpm-statistics.xml:
	Rename the interface files so we can build with waf without overwriting
	existing .h files.

2006-08-28  Richard Hughes  <richard@hughsie.com>

	* src/gpm-info.c:
	* src/gpm-info.h:
	* src/gpm-statistics.xml:
	Start to implement org.gnome.PowerManager.Statistics.GetData.

2006-08-28  Richard Hughes  <richard@hughsie.com>

	* help/C/gnome-power-manager.xml:
	* help/gnome-power-manager.omf.in:
	Apply patch from Brent Smith <gnome@nextreality.net>:
	Change category from GNOME|Core Desktop to GNOME|System.
	Also, per the instructions at
	http://live.gnome.org/GnomeDocUtilsMigrationHowTo there should be
	elements within the docbook file with the attribute 'role' and
	the value 'maintainer' on one of the author tags. Fixes #353123

2006-08-28  Richard Hughes  <richard@hughsie.com>

	* src/Makefile.am:
	* src/gpm-graph-core.c:
	Remove dep on InfoData as we are splitting this now.

	* src/gpm-hal-power.c:
	Don't unref the proxy else subsequent actions fail.

	* src/gpm-info.c:
	* src/gpm-info.h:
	* src/gpm-statistics.xml:
	Add some more bits of the interface.

2006-08-25  Richard Hughes  <richard@hughsie.com>

	* src/gpm-power.c: (gpm_power_status_for_device_more):
	* src/gpm-tray-icon.c: (gpm_tray_icon_show_about_cb):
	* src/run-valgrind-gpm.sh:
	Patch from Paolo Borelli <pborelli@katamail.com> to cure some
	small memory leaks. Many Thanks. Fixes #352858.

2006-08-25  Richard Hughes  <richard@hughsie.com>

	* data/gnome-power-manager.desktop.in:
	* data/gnome-power-preferences.desktop.in:
	Manually hardcode the version to 2.17.x to fix #352840.

2006-08-25  Richard Hughes  <richard@hughsie.com>

	* src/gpm-power.c: (gpm_power_status_for_device_more):
	Be more specific for our device checks in the expanded device
	information to fix the display of CSR properties. Fixes rh:203849

2006-08-25  Richard Hughes  <richard@hughsie.com>

	* src/Makefile.am:
	* src/gpm-info.c: (gpm_statistics_moo):
	* src/gpm-info.h:
	* src/gpm-manager.c: (gpm_manager_init):
	* src/gpm-statistics.xml:
	Add in the initial work for the org.gnome.PowerManager.Statistics
	interface so we can push the data formatting out of process.

2006-08-25  Richard Hughes  <richard@hughsie.com>

	* src/Makefile.am:
	* src/gpm-info.c: (gpm_statistics_moo):
	* src/gpm-info.h:
	* src/gpm-manager.c: (gpm_manager_init):

2006-08-25  Richard Hughes  <richard@hughsie.com>

	* configure.in:
	Add some extra compiler warnings.

	* data/Makefile.am:
	* data/gpm-graph.glade:
	Add the glade file for the new graph application.

	* src/Makefile.am:
	* src/gpm-graph-core.c:
	* src/gpm-graph-core.h:
	* src/gpm-graph.c:
	Add the beginnings of the new graph application.

	* src/gpm-graph-widget.c:
	* src/gpm-graph-widget.h:
	* src/gpm-info-data.c:
	* src/gpm-info-data.h:
	* src/gpm-info.c:
	* src/gpm-info.h:
	* src/gpm-manager.c:
	Rename GpmGraph to GpmGraphWidget so we can do some other graphing
	stuff. Changes lots of code ;-)

	* src/gpm-tray-icon.c:
	Add an extra item to the menu for the out of process graph.

2006-08-24  Richard Hughes  <richard@hughsie.com>

	* configure.in:
	Add in the datadir in the final output.

	* data/gnome-power-manager.schemas.in:
	* src/gpm-prefs-core.c:
	* src/gpm-prefs.h:
	* src/gpm-manager.c:
	Split the panel dim into ac and battery halves.

	* help/C/gnome-power-manager.xml:
	* help/C/figures/gpm-cell-capacity.png
	* help/Makefile.am:
	Add a graph for explanation and comment about cell capacity over time.

	* src/gpm-hal-cpufreq.c:
	Get rid of the commented out code that doesn't apply now the addon
	as been merged to hal HEAD.

	* src/gpm-power.c:
	Add the new hal names for the battery descriptions now my patch has
	been merged. This need backporting for 2.16.1

2006-08-24  Richard Hughes  <richard@hughsie.com>

	* TODO:
	* configure.in:
	* data/gpm-prefs.glade:
	* docs/dbus-interface.html:
	* docs/faq.html:
	* docs/icon-scheme.html:
	* docs/index.html:
	* docs/sleep-names.html:
	* po/POTFILES.in:
	Somehow these missed the last commit. Oddball.

2006-08-23  Richard Hughes  <richard@hughsie.com>

	* configure.in:
	Update for the new branch, and add some more compiler flags for extra
	warnings.

	* data/gpm-prefs.glade:
	* src/gpm-prefs-core.c:
	Update the UI to be task-centric, rather than state centric.

	* src/gpm-brightness.c:
	* src/gpm-brightness.h:
	* src/gpm-hal-brightness.c:
	* src/gpm-hal-brightness.h:
	Rename.

	* src/gpm-dbus-session-monitor.c:
	* src/gpm-dbus-session-monitor.h:
	* src/gpm-dbus-system-monitor.c:
	* src/gpm-dbus-system-monitor.h:
	* src/gpm-dbus-monitor.c:
	* src/gpm-dbus-monitor.h:
	Move system and session functionality into one module.

	* src/gpm-hal-cpufreq.c:
	* src/gpm-hal-cpufreq.h:
	Add cpu freq support. Requires CVS HAL and Holgers patch.

	* src/gpm-hal-power.c:
	* src/gpm-hal-power.h:
	Abstract the power saving code from the hal module.

	* src/gpm-proxy.c:
	* src/gpm-proxy.h:
	Create a new class to handle a managed proxy, i.e. a DBusGProxy that
	copes with bus disconnects, and service restarts.

	* src/gpm-hal-monitor.c:
	* src/gpm-hal.c:
	* src/gpm-hal.h:
	* src/gpm-idle.c:
	* src/gpm-info-data.c:
	* src/gpm-info.c:
	* src/gpm-inhibit.c:
	* src/gpm-inhibit.h:
	* src/gpm-manager.c:
	* src/gpm-polkit.c:
	* src/gpm-power.c:
	* src/gpm-power.h:
	* src/gpm-screensaver.c:
	* src/gpm-screensaver.h:
	Use the new managed proxy class, rather than manually reconnecting each
	proxy. This means that all the bus reconnection code is common, as
	before each class did this it's own way.

	* po/POTFILES.in:
	* src/Makefile.am:
	Update with all the file changes.

2006-08-22  Richard Hughes  <richard@hughsie.com>

	* configure.in:
	Bump to 2.17.1 to signify we are now on the bleeding edge.

	* src/gpm-prefs.h:
	* data/gnome-power-manager.schemas.in:
	Add a whole load of new keys for the cpufreq stuff.

	* help/C/gnome-power-manager.xml:
	Start to document the cpufreq stuff (even tho nothing has hit CVS yet)

	* src/gpm-common.c:
	* src/gpm-power.c:
	* src/gpm-prefs-core.c:
	* src/gpm-screensaver.c:
	Fix some scope problems the compiler found with Wextra.

2006-08-22  Richard Hughes  <richard@hughsie.com>

	* TODO:
	Update to test the branching has gone okay.

2006-08-22  Richard Hughes  <richard@hughsie.com>

	* configure.in:
	Turn off Werror for the impending release. Fixes #352448.

2006-08-20  Richard Hughes  <richard@hughsie.com>

	* configure.in: Post release bump to 2.16.0

2006-08-20  Richard Hughes  <richard@hughsie.com>

	==== Version 2.15.92 ====

2006-08-20  Richard Hughes  <richard@hughsie.com>

	* TODO: Update.
	* src/gpm-idle.c:
	Work round a compiler bug which caused g-p-m compilation to fail when
	using a high optimising setting.
	Patch from Ed Catmur <ed@catmur.co.uk> many thanks. Fixes #352104.

2006-08-17  Richard Hughes  <richard@hughsie.com>

	* src/gpm-brightness.c:
	* src/gpm-brightness.h:
	* src/gpm-inhibit.c:
	* src/gpm-inhibit.h:
	Add some more gobject checks to make these objects more robust.

2006-08-15  Richard Hughes  <richard@hughsie.com>

	* src/gpm-hal.c:
	* src/gpm-manager.c:
	Beep to warn if the suspend or hibernate failed. Should fix #346542

2006-08-13  Richard Hughes  <richard@hughsie.com>

	* data/gnome-power-manager.desktop.in:
	* data/gnome-power-preferences.desktop.in:
	Fix up the desktop files with the version number.

2006-08-10  Richard Hughes  <richard@hughsie.com>

	Apply patch from Bruce Cowan <bruce.cowan@dsl.pipex.com>
	to change my incorrect spelling of loose to lose throughout the
	project. Many thanks.

	* help/C/gnome-power-manager.xml:
	* help/hu/hu.po:
	* help/ru/ru.po:
	* help/sv/sv.po:
	* src/gpm-debug.c:

2006-08-09  Richard Hughes  <richard@hughsie.com>

	* data/icons/24x24/.cvsignore:
	Keep CVS happy.

2006-08-08  Richard Hughes  <richard@hughsie.com>

	* configure.in:
	* data/icons/22x22/Makefile.am:
	* data/icons/24x24/Makefile.am:
	* data/icons/24x24/gpm-ac-adapter.png:
	* data/icons/24x24/gpm-brightness.png:
	* data/icons/24x24/gpm-hibernate.png:
	* data/icons/24x24/gpm-keyboard-000.png:
	* data/icons/24x24/gpm-keyboard-030.png:
	* data/icons/24x24/gpm-keyboard-060.png:
	* data/icons/24x24/gpm-keyboard-100.png:
	* data/icons/24x24/gpm-mouse-000.png:
	* data/icons/24x24/gpm-mouse-030.png:
	* data/icons/24x24/gpm-mouse-060.png:
	* data/icons/24x24/gpm-mouse-100.png:
	* data/icons/24x24/gpm-primary-000-charging.png:
	* data/icons/24x24/gpm-primary-000.png:
	* data/icons/24x24/gpm-primary-020-charging.png:
	* data/icons/24x24/gpm-primary-020.png:
	* data/icons/24x24/gpm-primary-040-charging.png:
	* data/icons/24x24/gpm-primary-040.png:
	* data/icons/24x24/gpm-primary-060-charging.png:
	* data/icons/24x24/gpm-primary-060.png:
	* data/icons/24x24/gpm-primary-080-charging.png:
	* data/icons/24x24/gpm-primary-080.png:
	* data/icons/24x24/gpm-primary-100-charging.png:
	* data/icons/24x24/gpm-primary-100.png:
	* data/icons/24x24/gpm-primary-charged.png:
	* data/icons/24x24/gpm-primary-missing.png:
	* data/icons/24x24/gpm-suspend.png:
	* data/icons/24x24/gpm-ups-000-charging.png:
	* data/icons/24x24/gpm-ups-000.png:
	* data/icons/24x24/gpm-ups-020-charging.png:
	* data/icons/24x24/gpm-ups-020.png:
	* data/icons/24x24/gpm-ups-040-charging.png:
	* data/icons/24x24/gpm-ups-040.png:
	* data/icons/24x24/gpm-ups-060-charging.png:
	* data/icons/24x24/gpm-ups-060.png:
	* data/icons/24x24/gpm-ups-080-charging.png:
	* data/icons/24x24/gpm-ups-080.png:
	* data/icons/24x24/gpm-ups-100-charging.png:
	* data/icons/24x24/gpm-ups-100.png:
	* data/icons/24x24/gpm-ups-charged.png:
	* data/icons/24x24/gpm-ups-missing.png:
	* data/icons/Makefile.am:
	* data/icons/generate_24x24_icons.sh:
	Add a copy of the 24x24 icons instead of generating them at install
	time. Doing clever tricks with imagemagick didn't work very well.
	Fixes #350321

2006-08-08  Richard Hughes  <richard@hughsie.com>

	* src/gpm-main.c:
	* src/run-valgrind-gpm.sh:
	Add a timed exit option to the daemon (--timed-exit).
	This helps running g-p-m under valgrind and was suggested by Jon.
	The HAL daemon has something similar. Fixes #350334

2006-08-08  Richard Hughes  <richard@hughsie.com>

	* TODO:
	Re-organize, and add a note about a GError audit.

	* src/gpm-manager.c: (screensaver_auth_request_cb):
	Apply a patch from William Jon McCann to fix a double free
	on the new smartcard code. Many thanks. #350436

2006-08-07  Richard Hughes  <richard@hughsie.com>

	* configure.in: Post release bump to 2.15.92

2006-08-07  Richard Hughes  <richard@hughsie.com>

	==== Version 2.15.91 ====

2006-08-07  Richard Hughes  <richard@hughsie.com>

	* src/gpm-manager.c: (screensaver_auth_request_cb):
	Turn on the monitor unconditionally, as we may be using a smartcard
	to authenticate and DPMS might still be on. Should fix #350291.

2006-08-07  Richard Hughes  <richard@hughsie.com>

	* docs/Makefile.am:
	Fix the build, by removing the roadmap stuff. OOps.

2006-08-07  Richard Hughes  <richard@hughsie.com>

	* src/gpm-info.c: (gpm_info_show_window):
	Hide the 'Device Information' window if we have no devices.

2006-08-07  Richard Hughes  <richard@hughsie.com>

	* src/.cvsignore:
	* src/run-gpm.sh:
	* src/run-valgrind-gpm.sh:
	Add these debugging files (not installed) as it makes starting g-p-m
	easier from CVS.

2006-08-07  Richard Hughes  <richard@hughsie.com>

	* src/gpm-manager.c:
	Add in an extra battery charged check to avoid repetition in the
	battery charged notification. Should fix #348938

2006-08-07  Richard Hughes  <richard@hughsie.com>

	* src/gpm-brightness.c:
	* src/gpm-brightness.h:
	Add gpm_brightness_has_hardware() so we can find out if we have lcd
	hardware.
	Also do some more error checking here like we did for the screensaver.

	* src/gpm-debug.c: (gpm_syslog):
	Reduce the log level from LOG_ALERT to LOG_NOTICE.
	We'll leave this hardcoded for now, as syslog is meant to be a simple
	debugging aid, not a full blown logging system.
	Also add the username into the syslog to fix #349971

	* src/gpm-manager.c:
	Only try to change the LCD if we have the hardware.

2006-08-07  Richard Hughes  <richard@hughsie.com>

	* src/gpm-debug.c: (gpm_syslog):

2006-08-07  Richard Hughes  <richard@hughsie.com>

	* src/gpm-manager.c:
	Make sure we check input for NULL (that Jon found in #350058).
	This should stop a g-p-m segfault with a misconstructed dbus packet.

2006-08-07  Richard Hughes  <richard@hughsie.com>

	* src/gpm-brightness.c:
	* src/gpm-debug.c:
	* src/gpm-graph-widget.c:
	* src/gpm-info.c:
	* src/gpm-inhibit.c:
	* src/gpm-manager.c:
	* src/gpm-power.c:
	* src/gpm-prefs-core.c:
	* src/gpm-tray-icon.c:
	This should fix all cases reported by sparse/gcc.
	This should make gnome-power-manager compile on gcc 2.95 and earlier.
	Patch from Kjartan Maraas, many thanks. Fixes #350058

2006-08-06  Richard Hughes  <richard@hughsie.com>

	* TODO:
	* docs/gnome-power-manager.xml.in:
	* docs/roadmap.html:
	* docs/roadmap.xml:
	Move the TODO to the file TODO to be more inline with other projects.
	You may have to re-configure afte this change.

2006-08-04  Richard Hughes  <richard@hughsie.com>

	* src/gpm-screensaver.c:
	* src/gpm-screensaver.h:
	Apply fix so that we do not crash when g-s is stopped and we change
	power source (and thus unthrottling).
	The fix makes the g-s module much more resilient to screensaver or
	proxy becoming NULL and handling the error. Should fix #349794.

2006-08-03  Richard Hughes  <richard@hughsie.com>

	* src/gpm-manager.c: (sync_dpms_policy):
	Make sure we free the error and be much more robust. Pointed out by
	William Jon McCann <mccann@jhu.edu>, many thanks.

2006-07-30  Richard Hughes  <richard@hughsie.com>

	* src/gpm-manager.c:
	Add manager_rescan_buttons() to poll all the buttons every minute.
	This should fix #346082

2006-07-30  Richard Hughes  <richard@hughsie.com>

	* src/gpm-manager.c:
	Reset the action timer after an ac_adapter event has been recieved.
	This should fix #348201

2006-07-30  Richard Hughes  <richard@hughsie.com>

	Commit a slightly modified patch from
	William Waghorn <willw@litany.me.uk> many thanks.

	* data/gnome-power-manager.schemas.in:
	* src/gpm-manager.c:
	* src/gpm-prefs.h:
	Add in two new gconf keys battery_dpms_sleep_method and
	ac_dpms_sleep_method to support systems that only support a specific
	DPMS sleep mode.

	* docs/faq.xml:
	Add a entry about the dpms sleep modes and broken monitors.

2006-07-30  Richard Hughes  <richard@hughsie.com>

	* data/gnome-power-manager.schemas.in:
	Make a difficult to translate string easier to understand.

2006-07-30  Richard Hughes  <richard@hughsie.com>

	* data/icons/22x22/Makefile.am:
	Fix 'make distcheck' by deleting the correct directory and also using
	destdir for the install location.

2006-07-30  Richard Hughes  <richard@hughsie.com>

	* docs/calculate-video-fdi.sh:
	Correct a typo in the header.

	* src/gpm-power.c:
	Reduce the precision to 100mW as the big numbers are too clumsy.
	The new format will be '24.5 W' rather than '24520mWh'

2006-07-29  Richard Hughes  <richard@hughsie.com>

	* help/sv/.cvsignore:
	Add to keep CVS happy.

2006-07-29  Richard Hughes  <richard@hughsie.com>

	* src/gpm-power.c:
	* src/gpm-stock-icons.h:
	Fix a typo where we were trying to assign the wrong icon names so
	the missing icon didn't show up (instead showed a gtk-broken-image)
	Fixes #348710

2006-07-29  Richard Hughes  <richard@hughsie.com>

	* configure.in:
	* data/icons/22x22/Makefile.am:
	Generate the 24x24 icons by using imagemagick to add a 1px border
	around the installed icons.
	This makes gnome generally happier, and should fix the fuzzyness for
	some people. Fixes #348994

2006-07-28  Richard Hughes  <richard@hughsie.com>

	* src/gpm-hal.c:
	Add some more error checking, and module sanity checking.

	* src/gpm-prefs-core.c:
	Fix a crasher where the g-s timeout is larger than the max range for
	gnome-power-preferences. #347932

2006-07-23  Richard Hughes  <richard@hughsie.com>

	* configure.in: Post release bump to 2.15.91

2006-07-23  Richard Hughes  <richard@hughsie.com>

	==== Version 2.15.90 ====

2006-07-22  Richard Hughes  <richard@hughsie.com>

	* src/gpm-hal.c: (gpm_hal_new_capability_cb):
	Fix a crash where we incorrectly g_error when we plug in a wireless
	mouse. My silly mistake...

2006-07-21  Richard Hughes  <richard@hughsie.com>

	* configure.in:
	Default to policykit being default off as most people will just be
	running configure with a prefix and not care about all the extra stuff.

2006-07-20  Richard Hughes  <richard@hughsie.com>

	* docs/dbus-interface.html:
	* docs/faq.html:
	* docs/icon-scheme.html:
	* docs/index.html:
	* docs/roadmap.html:
	* docs/sleep-names.html:
	Regenerate.

	* src/gpm-hal.c:
	Make sure we use the correct HAL method names (although HAL doesn't
	currently care) so we can work with an introspectable daemon.

	* src/gpm-manager.c:
	Watch for the 'daemon start' and 'daemon stop' signals so we update the
	tray icon when HAL is stopped or started.

2006-07-14  Richard Hughes  <richard@hughsie.com>

	* data/icons/22x22/gpm-primary-000-charging.png:
	* data/icons/22x22/gpm-primary-020-charging.png:
	Make icons green, as a charging battery shouldn't convey bad things.

	* src/Makefile.am:
	Add dbus-system to gpm-prefs for the new hal stuff.

	* src/gpm-brightness.c:
	* src/gpm-hal-monitor.c:
	* src/gpm-hal-monitor.h:
	* src/gpm-hal.c:
	* src/gpm-hal.h:
	* src/gpm-info-data.c:
	* src/gpm-info.c:
	* src/gpm-manager.c:
	* src/gpm-marshal.list:
	* src/gpm-power.c:
	* src/gpm-prefs-core.c:
	Rewrite the GpmHal and GpmHalMonitor as the old versions made me very
	confused. Now GpmHal acts as an interface to HAL, and the monitor stuff
	just manages the abstraction suitable for GpmPower class.
	Also convert a metric boat-load of doxygen comments to gtk-doc comments
	and add a whole load more. No string changes.

	* src/gpm-polkit.c:
	* src/gpm-polkit.h:
	* src/gpm-screensaver.c:
	* src/gpm-screensaver.h:
	Emit an event when the daemon starts or stops. No string changes.

	* src/gpm-manager.xml:
	Comment out signal 'low_power_mode_changed' for now to prevent a
	warning. Fixes #347363.

2006-07-09  Richard Hughes  <richard@hughsie.com>

	* configure.in: Post release bump to 2.15.90

2006-07-09  Richard Hughes  <richard@hughsie.com>

	==== Version 2.15.4 ====

2006-07-08  Richard Hughes  <richard@hughsie.com>

	* data/gpm-prefs.glade:
	Add the hidden checkbox 'Always sleep when the lid is closed' so we can
	add this string before the string freeze. We can connect it up next
	week so it does something useful.

2006-07-08  Richard Hughes  <richard@hughsie.com>

	* data/gnome-power-manager.schemas.in:
	Change /apps/gnome-power-manager/check_type_cpu default to false after
	discussion in #326742. Power users doing legacy simulations are able
	to change this setting themselves.
	This should probably go into the FAQ.

2006-07-08  Richard Hughes  <richard@hughsie.com>

	* src/gpm-prefs-core.c:
	Replace the word 'Interactive' in the UI with 'Ask me' to fix #345960

2006-06-28  Richard Hughes  <richard@hughsie.com>

	* src/gpm-hal.h:
	* src/gpm-hal.c:
	Add gpm_hal_device_rescan() and gpm_hal_device_rescan_capability()
	so we can start to fix #346082.
	I've still got to plumb this into the power or manager classes, but I'm
	not sure how best to do this yet. Give me a few hours.

2006-06-28  Richard Hughes  <richard@hughsie.com>

	* data/gnome-power-manager.schemas.in:
	Increase the graph time size to 6 hours.

	* src/gpm-brightness.c:
	Support MacBook Pro with it's crazy number of brightness states.
	Might fix #346080

	* src/gpm-dbus-session-monitor.c:
	* src/gpm-dbus-system-monitor.c:
	* src/gpm-power.c:
	Make singleton classes to save memory and CPU.

	* src/gpm-info.c:
	* src/gpm-info.h:
	* src/gpm-manager.c:
	Remove the bodge of passing the pointer to the power class now we are
	using singletons.

2006-06-26  Richard Hughes  <richard@hughsie.com>

	* help/C/gnome-power-manager.xml:
	Correct a figure title to match the screenshot.

	* configure.in:
	* src/Makefile.am:
	* src/gpm-manager.c:
	* src/gpm-polkit.c:
	* src/gpm-polkit.h:
	Add in initial support to check with PolicyKit over dbus. Fixes #344171

2006-06-23  Richard Hughes  <richard@hughsie.com>

	* configure.in:
	* data/Makefile.am:
	* data/gnome-power-manager.spec.in:
	Remove the Fedora spec file from CVS. It's outdated, and doesn't work.

	* help/C/gnome-power-manager.xml:
	Better logically seporate the help file, and add some new content.
	More to come...

2006-06-23  Richard Hughes  <richard@hughsie.com>

	* data/gnome-power-manager.schemas.in:
	* src/gpm-manager.c:
	* src/gpm-prefs.h:
	In hindsight, not everyone likes beeping as commented on in #345595.
	Add a gconf variable /apps/gnome-power-manager/enable_pcskr_beeping
	to enable the user or distro to turn this off and on. Default on.

	* data/gnome-power-manager.schemas.in:
	* src/gpm-manager.c:
	* src/gpm-prefs.h:
	Allow the user to ignore the inhibit requests from stopping a policy
	action. The key /apps/gnome-power-manager/ignore_inhibit_requests can
	be set to true, and the action will still go ahead. Default off.

2006-06-23  Richard Hughes  <richard@hughsie.com>

	* src/gpm-manager.c: (battery_status_changed_primary):
	Use the same logic as the tooltip for the notification.
	This has caused a lot of problems, see #345698 for all the gory details.
	This means if the policy is set to 'show icon when charging' then the
	icon removes itself and the 'fully charged' notification is shown in
	the bottom right of the screen, which I think is sane.

	* help/C/gnome-power-manager.xml:
	Add a note mentioning the battery has to go down to 95% before a repeat
	notification will be shown.

	* src/gpm-hal-monitor.c: (watch_device_property_modified),
	(watch_device_properties_modified):
	* src/gpm-hal-monitor.h:
	Add a boolean 'finally' for the battery_property_modified so we know
	when a split PropertyModified HAL event has finished, and we can update
	the caches and recompute only when we have all the information.
	This seems like a pain in the arse, but actually reduces our CPU usage
	by nearly *5* times on a typical /org/freedesktop/Hal/devices/acpi_BAT1
	type event update so was worth doing.

	* src/gpm-power.c: (hal_battery_property_modified_cb):
	Only refresh the caches on the last PropertyModified split event.

2006-06-22  Richard Hughes  <richard@hughsie.com>

	* data/gpm-prefs.glade:
	Increase the spacing between vertical spacing of groups of components
	to better follow the GNOME HIG.
	Also fix the issue where the space between 'Running on AC/Battery' and
	'Put display to sleep...' is different between the AC and Battery tabs.
	Pointed out by Ian McIntosh <ian@openanswers.org>, many thanks.
	Fixes #345693, (no string changes)

2006-06-22  Richard Hughes  <richard@hughsie.com>

	* help/C/figures/gpm-info-event-log.png:
	* help/C/figures/gpm-info-percentage.png:
	* help/C/figures/gpm-info-rate.png:
	* help/C/figures/gpm-info-time.png:
	* help/C/gnome-power-manager.xml:
	* help/Makefile.am:
	Add four new figures for the documentation.

2006-06-21  Richard Hughes  <richard@hughsie.com>

	* src/gpm-common.c:
	* src/gpm-common.h:
	Add gpm_warning_beep () to allow us to make a sound when an important
	event has occurred.

	* src/gpm-manager.c: (gpm_manager_is_inhibit_valid):
	Beep if we stopped the action due to an inhibit to warn the user.
	Also beep if we are low on power for primary, UPS or mouse as these are
	important. This fixes bug #345595

2006-06-19  Richard Hughes  <richard@hughsie.com>

	* src/gpm-graph-widget.c: (gpm_graph_auto_range):
	Fix the horizontal time scaling now we have the max time gconf stuff.

2006-06-19  Richard Hughes  <richard@hughsie.com>

	* data/gpm-info.glade:
	Add more sensible names for the widgets.

	* docs/calculate-video-fdi.sh:
	Add this file as an experimental fdi generator. Don't send results to
	me or hal@fd.o as it's still very immature and gets stuff wrong.

2006-06-19  Richard Hughes  <richard@hughsie.com>

	* data/gpm-info.glade:
	* src/gpm-info.c:
	For non-laptops, hide the new power graphs and do not keep polling the
	values.

2006-06-18  Richard Hughes  <richard@hughsie.com>

	* docs/Makefile.am:
	Fix build by including every html file. Oops.

2006-06-18  Richard Hughes  <richard@hughsie.com>

	* src/gpm-brightness.c (gpm_brightness_dim_hw):
	Make sure machines that do their own dimming get special cased and
	just set the brightness once.
	This really *ought* to be a HAL propery. Fixes #345258.

2006-06-18  Richard Hughes  <richard@hughsie.com>

	* docs/faq.html:
	* docs/faq.xml:
	* docs/index.html:
	* docs/sleep-names.html:
	Update a few xml things, and move the FAQ here from the wiki entries.

	* src/gpm-manager.c:
	* src/gpm-power.c:
	Patch from Paweł Marciniak <pmarciniak@lodz.home.pl> to fix missing _()
	macros on some strings, so they can be translated.

2006-06-18  Richard Hughes  <richard@hughsie.com>

	* docs/gnome-power-manager.html:
	Remove this as I've split up the documentation

	* docs/Makefile.am:
	* docs/config.xsl:
	Chunk the output files indervidually.

	* docs/gnome-power-manager.xml.in:
	* docs/faq.xml:
	* docs/icon-scheme.xml:
	* docs/roadmap.xml:
	* docs/sleep-names.xml:
	Add the newest data, taking it from the wiki.

	* docs/index.html:
	* docs/icon-scheme.html:
	* docs/roadmap.html:
	* docs/sleep-names.html:
	* docs/dbus-interface.html:
	* docs/faq.html:
	Add these generated files.

2006-06-18  Crispin Flowerday  <gnome@flowerday.cx>

	* src/gpm-info.c (gpm_info_init):
	Read the correct gconf key to get the graph data max time (fixes
	bug #345256)

2006-06-18  Richard Hughes  <richard@hughsie.com>

	* docs/dbus-interface.xml:
	* docs/gnome-power-manager.html:
	* src/gpm-manager.c:
	* src/gpm-manager.h:
	* src/gpm-manager.xml:
	Add gpm_manager_get_low_power_mode and the dbus method GetLowPowerMode
	for #340355. Still need to do the signal, but that needs some more
	refactoring of the state code.

	* src/gpm-info-data.c: (gpm_info_data_set_max_time):
	Only allow greater than 10 minutes as a sanity check.

2006-06-18  Richard Hughes  <richard@hughsie.com>

	* data/gnome-power-manager.schemas.in:
	* src/gpm-prefs.h:
	Add in /apps/gnome-power-manager/graph_data_max_time so we can specify
	the amount of time to show on the graph.

	* src/gpm-info-data.h:
	* src/gpm-info-data.c:
	Add the functions gpm_info_data_set_max_points and
	gpm_info_data_set_max_time so we can set this externally.

	* src/gpm-info.c:
	Use graph_data_max_time to limit the GpmInfoData.

2006-06-18  Richard Hughes  <richard@hughsie.com>

	* src/gpm-graph-widget.c:
	* src/gpm-graph-widget.h:
	* src/gpm-info.c:
	Use the GpmInfoData pointer rather than the list pointer so we can keep
	track of the list and free when not required anymore.

	* src/gpm-info-data.c:
	Big re-write, which should squash some bugs. Switch to using GPtrArray
	rather than a GList as it makes things much simpler.
	I've also added the initial support for limiting the time shown on the
	graph, configuration to come in a little bit.

2006-06-18  Richard Hughes  <richard@hughsie.com>

	* po/POTFILES.in:
	Add the new inhibit stuff. Poked by Marcel Telka <marcel@telka.sk>

	* src/gpm-inhibit.c: (gpm_inhibit_get_message):
	Removed the joining word 'because' and replaced it with ':' as it was
	difficult to translate.

2006-06-17  Richard Hughes  <richard@hughsie.com>

	* src/gpm-inhibit-test.c:
	Make less stuff less global, and add better comments.

2006-06-14  Richard Hughes  <richard@hughsie.com>

	* src/gpm-manager.xml:
	* docs/dbus-interface.xml:
	* docs/gnome-power-manager.html:
	Change dbus Inhibit and UnInhibit methods to use a UINT32, as this is
	already specified in the spec. Using a INT32 is wrong.

	* data/Makefile.am:
	* data/gpm-inhibit-test.glade:
	* src/Makefile.am:
	* src/gpm-inhibit-test.c:
	Add a test program that allows us to test the multiple inhibit stuff,
	and also to show people how easy it is adding Inhibit and UnInhibit
	calls into an existing program.

2006-06-13  Richard Hughes  <richard@hughsie.com>

	* src/gpm-manager.c: (gpm_manager_is_policy_timout_valid):
	Log the ignored policy action in the event log, rather than printing
	to the console.

2006-06-12  Richard Hughes  <richard@hughsie.com>

	* src/gpm-tray-icon.c: (libnotify_event):
	Fix a compile error when we are compiling the non-libnotify sections of
	the code, which probably don't happen that often.
	Noticed and reported by Elijah Newren, many thanks. #344674

2006-06-12  Richard Hughes  <richard@hughsie.com>

	* data/Makefile.am:
	Apply a patch from Tomasz Kłoczko <kloczek@rudy.mif.pg.gda.pl>
	In src/Makefile.am unconditionaly are registered GConf schemas.
	In case installing GPM from non-root account (for example during
	prepare rpm from non-root account) it produces tons warning.
	In attachemt is simple patch which allows use --disable-schemas-install
	on autoconf level for disable registering GConf schemas.

2006-06-11  Richard Hughes  <richard@hughsie.com>

	* src/gpm-main.c:
	Fix a typo in the spelling of computer, and remove italics.
	Also remove references to messagebus. Fixes lp:46468

2006-06-11  Richard Hughes  <richard@hughsie.com>

	* configure.in: Post release bump to 2.15.4

2006-06-11  Richard Hughes  <richard@hughsie.com>

	==== Version 2.15.3 ====

2006-06-11  Richard Hughes  <richard@hughsie.com>

	* data/gnome-power-manager.schemas.in:
	Add 'nothing' to schema as it's set in the GUI: lp:48290

	* data/gpm-info.glade:
	Remove the save buttons as this is a bad idea.

	* help/C/figures/gpm-info-devices.png:
	* help/C/figures/gpm-prefs-ac.png:
	* help/C/figures/gpm-prefs-battery.png:
	* help/C/figures/gpm-prefs-options.png:
	* help/Makefile.am:
	Update, and add to the screenshots.

	* help/C/gnome-power-manager.xml:
	Update with more details on the information window.

	* src/gpm-hal.c:
	Check for NULL, although it shouldn't be...

	* src/gpm-manager.c:
	Make sure we free the gconf string as this is a little leak.

2006-06-08  Richard Hughes  <richard@hughsie.com>

	* data/gpm-prefs.glade:
	* src/gpm-prefs-core.c:
	Add the configurable action for power button press in the UI.
	Saves me explaining to another person how to change it in gconf-editor.
	Fixes #344325.

2006-06-08  Richard Hughes  <richard@hughsie.com>

	* docs/dbus-interface.xml:
	* docs/gnome-power-manager.html:
	Add to the spec the GetOnAc method and the OnAcChanged signal as it's
	not currently documented.

2006-06-07  William Jon McCann  <mccann@jhu.edu>

	* src/gpm-screensaver.c: (gpm_screensaver_check_running),
	(gpm_screensaver_poke), (gpm_screensaver_get_idle):
	Update for g-s API changes.  Fixes #344103

2006-06-07  Richard Hughes  <richard@hughsie.com>

	* docs/dbus-interface.xml:
	* docs/gnome-power-manager.html:
	Add a section on API compatibility with 2.14.x so people can easily
	convert to the new API.

2006-06-07  Richard Hughes  <richard@hughsie.com>

	* docs/dbus-interface.xml:
	* docs/gnome-power-manager.html:
	* src/gpm-manager.xml:
	According to http://dbus.freedesktop.org/doc/dbus-specification.html
	we should be using an uppercase first letter. Change the API like this:
	getOnAc			->	GetOnAc
	getDpmsMode		->	GetDpmsMode
	setDpmsMode		->	SetDpmsMode

2006-06-06  Richard Hughes  <richard@hughsie.com>

	* docs/Makefile.am:
	* docs/config.xsl:
	* docs/docbook.css:
	Add the xsl file so that we can use a css file to style the html.

	* docs/gnome-power-manager.html:
	Regenerate this file.

2006-06-06  Richard Hughes  <richard@hughsie.com>

	* src/gpm-hal.c:
	* src/gpm-hal.h:
	Add the new Reboot functionality (already present in HAL).

	* docs/dbus-interface.xml:
	* src/gpm-manager.c:
	* src/gpm-manager.h:
	* src/gpm-manager.xml:
	Add the following DBUS methods and functionality for API completeness:
	- Reboot()
	- AllowedShutdown()
	- AllowedReboot()

2006-06-06  Richard Hughes  <richard@hughsie.com>

	* docs/icon-scheme.txt:
	Remove this file as we have an xml version now.

	* docs/release-plan.txt:
	Remove as we can get the same info from the web.

	* docs/dbus-interface.xml:
	* docs/dbus-test-inhibit.py:
	* docs/gnome-power-manager.html:
	* src/gpm-inhibit.c:
	* src/gpm-manager.c:
	* src/gpm-manager.h:
	* src/gpm-manager.xml:
	* src/gpm-prefs-core.c:
	Rename a few DBUS methods from feedback on XDG list:
	CanSuspend		->	AllowedSuspend
	CanHibernate		->	AllowedHibernate
	InhibitInactiveSleep	->	Inhibit
	AllowInactiveSleep	->	UnInhibit

2006-06-05  William Jon McCann  <mccann@jhu.edu>

	* src/gpm-tray-icon.c: (gpm_tray_icon_activate_cb):
	Use the correct type of activate signal handler.

	Fixes #343957

2006-06-02  Richard Hughes  <richard@hughsie.com>

	* configure.in:
	* docs/.cvsignore:
	* docs/Makefile.am:
	* docs/dbus-interface.xml:
	* docs/gnome-power-manager.xml.in:
	* docs/gnome-power-manager.html:
	* docs/icon-scheme.xml:
	Add in new docbook documentation about the dbus interface.

	* docs/dbus-interface.txt:
	Removed as now obsolete.

2006-05-31  Richard Hughes  <richard@hughsie.com>

	* src/gpm-brightness.c:
	* src/gpm-brightness.h:
	* src/gpm-manager.c:
	Rework the brightness handling so that we only have one way of doing
	the transitions. This simplifies things greatly. Fixes #341616

2006-05-30  Jaap Haitsma  <jaap@haitsma.org>

	* src/gpm-tray-icon.c:
	Use GtkStatusIcon when GTK version >= 2.9.0

2006-05-30  Richard Hughes  <richard@hughsie.com>

	* data/gnome-power-manager.desktop.in:
	Add in XFCE so we display in the menu. From ubuntu patchset. lp:43077

	* man/gnome-power-manager.sgml:
	Fix spelling error. From ubuntu patchset.

2006-05-30  Richard Hughes  <richard@hughsie.com>

	* src/gpm-info-data.c: (gpm_info_data_limit_truncate):
	Use the GSList in a sane way.

2006-05-30  Richard Hughes  <richard@hughsie.com>

	* src/gpm-graph-widget.c: (gpm_graph_interpolate_value):
	Limit the y intersect to the last height, so we don't extend the graph
	into the unknown.

	* src/gpm-info.c: (gpm_info_log_do_poll):
	Set the correct colours of the line depending on discharging/charging
	status. Fixes #338175.

2006-05-30  Richard Hughes  <richard@hughsie.com>

	* data/gnome-power-manager.schemas.in:
	One more grammar fix that I missed in #343017.

2006-05-29  Richard Hughes  <richard@hughsie.com>

	* data/gnome-power-manager.schemas.in:
	* data/gpm-info.glade:
	Grammar fixes from Clytie Siddall <clytie@riverland.net.au> to make
	the strings a bit more sane. See #343017 for details.

2006-05-24  Øivind Hoel  <ohoel@cvs.gnome.org>

	* src/gpm-manager.c (gpm_manager_tray_icon_suspend):
	Fix a small typo (susspend -> suspend)

2006-05-24  Richard Hughes  <richard@hughsie.com>

	* src/gpm-manager.c (screensaver_auth_request_cb):
	Undim the screen when we have to unlock returning from resume.
	This should fix #333290.

2006-05-24  Richard Hughes  <richard@hughsie.com>

	* src/gpm-manager.c: (battery_status_changed_primary):
	Make sure we duplicate the message string so we don't crash on
	the action warning when we try to g_free it.

2006-05-21  Richard Hughes  <richard@hughsie.com>

	* src/gpm-power.c:
	Limit the capacity to 100% as some batteries can be a bit screwy.

2006-05-21  Richard Hughes  <richard@hughsie.com>

	* data/gnome-power-manager.schemas.in:
	* src/gpm-manager.c: (power_on_ac_changed_cb):
	* src/gpm-prefs.h:
	Add the /apps/gnome-power-manager/battery_event_when_closed gconf key
	so we can disable per-machine the action for when the lid is previously
	shut and the AC power then removed at a later time.
	This is prompting lots of confusion for users and consequently lots of
	bugzillas for me. This should let power users toggle this setting.

2006-05-21  Richard Hughes  <richard@hughsie.com>

	* src/gpm-info-data.c: (gpm_info_data_add_always):
	Limit saved values to positive numbers. From Byeong-taek Lee.

	* src/gpm-info.c: (gpm_info_specific_device_widgets):
	Warn if device NULL so we don't segfault - NOTE: This is probably a bug
	in g-p-m as we shouldn't get to this function if there is no device.
	From Byeong-taek Lee.

	* src/gpm-manager.c: (idle_changed_cb), (lid_button_pressed):
	Formatting fixes.

	* src/gpm-power.c: (gpm_power_exp_aver):
	Make sure values cannot be negative. From Byeong-taek Lee.

2006-05-17  Richard Hughes  richard@hughsie.com>

	* configure.in: Depend on intltool 0.35.0 to build.

2006-05-17  Richard Hughes  richard@hughsie.com>

	* data/icons/22x22/gpm-keyboard-030.png:
	* data/icons/22x22/gpm-keyboard-060.png:
	* data/icons/22x22/gpm-keyboard-100.png:
	* data/icons/22x22/gpm-mouse-030.png:
	* data/icons/22x22/gpm-mouse-060.png:
	* data/icons/22x22/gpm-mouse-100.png:
	* data/icons/scalable/gpm-keyboard-030.svg:
	* data/icons/scalable/gpm-keyboard-060.svg:
	* data/icons/scalable/gpm-keyboard-100.svg:
	* data/icons/scalable/gpm-mouse-030.svg:
	* data/icons/scalable/gpm-mouse-060.svg:
	* data/icons/scalable/gpm-mouse-100.svg:
	Actually show the correct levels in the pixmaps and svg's.

2006-05-15  Richard Hughes  <richard@hughsie.com>

	* configure.in: Post release bump to 2.15.3

2006-05-15  Richard Hughes  <richard@hughsie.com>

	==== Version 2.15.2 ====

2006-05-14  Richard Hughes  <richard@hughsie.com>

	* src/gpm-tray-icon.c:
	Add in the #ifdef's and new code to allow the use of GtkStatusIcon
	as eggtrayicon is depreciated. The code still defaults to use
	eggtrayicon, as quite a few distros can't use GtkStatusIcon yet.
	You can test by changing the define USE_EGGTRAYICON to FALSE in the
	file src/gpm-tray-icon.c

2006-05-14  Richard Hughes  <richard@hughsie.com>

	* src/gpm-manager.c (change_power_policy):
	Ensure we set the icon to visible for desktops, as before we had to
	toggle the state in g-p-p to get it to show.

2006-05-14  Richard Hughes  <richard@hughsie.com>

	* src/gpm-tray-icon.c (gpm_tray_icon_set_image_from_stock):
	Make sure we only set the icon if it is different to the one already
	displayed to fix the case where the icons get renamed on package
	upgrade (and because it's a good idea). Should fix #340557.

2006-05-14  Richard Hughes  <richard@hughsie.com>

	* src/gpm-brightness.c (gpm_brightness_init):
	Add support for laptop_panel.brightness_in_hardware if present. We can
	trivially rename this if the HAL name is to change, but the checks
	are in place now. This starts to fix #340231.

2006-05-14  Richard Hughes  <richard@hughsie.com>

	* src/gpm-power.c: (power_get_summary_for_battery_kind):
	Make strings printf's a bit more translation friendly. Fixes #341582.

2006-05-14  Richard Hughes  <richard@hughsie.com>

	* src/gpm-manager.c: (battery_status_changed_primary),
	(battery_status_changed_ups):
	Do not warn multiple times about the critical action by using the event
	level system we use for the other notifications. Should fix #333622.

2006-05-10  Richard Hughes  <richard@hughsie.com>

	* src/eggtrayicon.c: (egg_tray_icon_class_init),
	(transparent_expose_event), (make_transparent_again),
	(make_transparent), (egg_tray_icon_realize), (egg_tray_icon_add):
	Patch from Peter Grundström <pete@openfestis.org> to adds the ability
	to handle a transparent background in the tray icon the version of
	eggtrayicon in gnome-power-manager. Fixes #341227

2006-05-05  Richard Hughes  <richard@hughsie.com>

	* data/icons/16x16/Makefile.am:
	* data/icons/22x22/Makefile.am:
	* data/icons/scalable/Makefile.am:
	* docs/icon-scheme.txt:
	Rename the icons from gpm-suspend-to-{x} to gpm-suspend and
	gpm-hibernate as per the new recommendations:
	http://live.gnome.org/GnomePowerManager/SleepNames

	* man/gnome-power-manager.sgml:
	* src/gpm-stock-icons.c: (gpm_stock_icons_init):
	* src/gpm-stock-icons.h:
	* src/gpm-tray-icon.c:
	Remove all suspend-to-{x} terminology in the code and documentation.

2006-05-05  Richard Hughes  <richard@hughsie.com>

	* src/gpm-hal.c: (gpm_hal_enable_power_save):
	Add debugging comment.

	* src/gpm-manager.c: (change_power_policy): Respect the user policy
	enabling low power mode when required.

	* src/gpm-prefs-core.c: (setup_ac_actions): Hide the AC actions vbox
	when it is empty like we used to do.

2006-05-04  Richard Hughes  <richard@hughsie.com>

	* src/gpm-screensaver.{c|h}: Add gpm_screensaver_auth_begin() and
	gpm_screensaver_auth_end() so that we can create a signal
	'auth-request' when gnome-screensaver shows the password dialogue.
	This is needed so we can undim the screen when we resume and show the
	password box. Needed for #333290, but still need to connect this up to
	the manager stuff to solve the problem.

2006-05-02  Richard Hughes  <richard@hughsie.com>

	* data/gnome-power-manager.schemas.in, src/gpm-prefs.h:
	Add the /apps/gnome-power-manager/use_lowpower_{ac|ups|battery} keys.

	* data/gpm-prefs.glade:
	Add the checkboxes to enable the lowpower mode checkboxes.

	* src/gpm-prefs-core.c (setup_ac_actions, setup_battery_actions,
	setup_ups_actions): Support the new checkboxes and tie the values into
	gconf keys. Starting to work towards a fix for #340355.

	* src/gpm-prefs-core.c (gpm_prefs_init): Use gconf_key_changed_cb()
	to act on gconf keys changing outside of g-p-p. Should help out the
	Ubuntu guys with their modifications also.

2006-05-02  Richard Hughes  <richard@hughsie.com>

	* src/gpm-brightness.c (gpm_brightness_level_{down|up}):
	Add in initial functionality so we can support laptop panels that have
	hardware step support. Hardcoded for now, awaiting HAL property.

2006-04-30  Richard Hughes  <richard@hughsie.com>

	* src/gpm-graph-widget.c: (gpm_graph_auto_range): Make sure the
	time scale cannot be less than 10 minutes as smaller values show the
	errors in the event-logging code. Fixes #340217.

2006-04-30  Richard Hughes  <richard@hughsie.com>

	* src/gpm-manager.c: Fix the GPM_BUTTON_BRIGHT_UP_DEP and
	GPM_BUTTON_BRIGHT_DOWN_DEP values to what were shipped in the HAL 0.5.7
	tarball. This fixes the hardware brightness keys for Ubuntu Dapper.

2006-04-30  Richard Hughes  <richard@hughsie.com>

	* src/gpm-graph-widget.c (gpm_graph_draw_graph): Use the new function
	gpm_graph_legend_calculate_width() so we compute the legend width
	instead of hardcoding it. Fixes #340218.

2006-04-30  Richard Hughes  <richard@hughsie.com>

	* src/gpm-common.h: Update GPM_FAQ_URL. #330889

2006-04-30  Richard Hughes  <richard@hughsie.com>

	* src/gpm-info-data.c: (gpm_info_data_add):
	Use the correct format string so we don't crash on ppc platform.
	I'm surprised GCC didn't warn me about that. Should fix #339974

	* src/gpm-manager.c: Use the new manager_explain_reason() calls so we
	don't have to play games with the reason and actions.
	This should mean we get more description in the event log, for why we
	do particular actions.

	* src/gpm-power.c: (battery_kind_cache_update):
	Don't fallback to broken battery support if we have 0% percentage
	charge else we start on 'charging' with a full battery.

2006-04-29  Richard Hughes  <richard@hughsie.com>

	* help/C/figures/gpm-suspend-problem.png: Add missing file to CVS.

2006-04-28  William Jon McCann  <mccann@jhu.edu>

	* src/gpm-manager.c: (update_ac_throttle), (update_dpms_throttle),
	(update_lid_throttle), (change_power_policy),
	(dpms_mode_changed_cb), (lid_button_pressed),
	(screensaver_connection_changed_cb), (gpm_manager_init):
	* src/gpm-screensaver.c: (gpm_screensaver_connect),
	(gpm_screensaver_disconnect), (gpm_screensaver_add_throttle),
	(gpm_screensaver_remove_throttle), (gpm_screensaver_class_init):
	* src/gpm-screensaver.h:
	Rework the way throttling is done so that it properly ref-counted.
	Remove the compatibility with the old g-s API.  Fixes #340024

2006-04-28  Richard Hughes  <richard@hughsie.com>

	* help/C/figures/gpm-suspend-problem.png:
	* help/C/figures/gpm-unplugged.png:
	* help/C/gnome-power-manager.xml:
	* help/Makefile.am:
	Add another figure and update the documenation.

	* src/gpm-power.c (battery_kind_cache_update):
	Slightly re-work a patch from Paul Betts <paul.betts@gmail.com>
	To handle batteries that report they are neither charging or
	discharging by using ac_adaptor value instead.

2006-04-26  Richard Hughes  <richard@hughsie.com>

	* src/gpm-hal-monitor.c: (watch_device_connect_property_modified):
	* configure.in: Depend on a lower version of DBUS, as I've upset
	crispin and I need his help. #339809.

2006-04-25  Richard Hughes  <richard@hughsie.com>

	* data/gnome-power-manager.desktop.in:
	Remove the --sm-disable from the .desktop file in autostart since the
	gnome-power-manager daemon can cope with being run more than one in a
	session and it breaks the logout dialog (e.g. on powerbutton) if it
	is not run with session access. Fixes lp:31103 and #339168

	* data/gnome-power-manager.desktop.in:
	* data/gnome-power-preferences.desktop.in:
	Change the icon to be gpm-battery-charged

	* src/gpm-hal-monitor.c: (emit_button_pressed):
	Also watch the PropertyModified signal, as when HAL resumes and rescans
	the lid value it does not send a button pressed signal.
	This means the lid value can get confused *again* when we resume from
	standby on some machines. Fixes rh:187396

	* src/gpm-manager.c: (lid_button_pressed): Ignore duplicated lid button
	presses so we don't display them on the info graphs.

2006-04-24  Richard Hughes  <richard@hughsie.com>

	* src/gpm-manager.c (power_on_ac_changed_cb): Fix an operator
	precedence problem where the logic was all messed up.
	This was triggering the not-on-ac lid-closed behavior and causing
	seemingly random suspends. Big thanks to Koichi Takahashi for spotting
	the problem.

	* src/gpm-graph-widget.{c|h}: Add the new notification event type.

	* src/gpm-info-data.{c|h}, src/gpm-info.{c|h}: Add descriptions to the
	events so we can capture more data about events and key points.

	* src/gpm-manager.c: Add the extra descriptions where required.

2006-04-23  Richard Hughes  <richard@hughsie.com>

	* configure.in: Post release bump to 2.15.2

2006-04-23  Richard Hughes  <richard@hughsie.com>

	* help/C/figures/gpm-prefs-*.png: Update to a bit more recent.

2006-04-22  Jaap Haitsma  <jaap@haitsma.org>

	* configure.in, po/LINGUAS: Gnome Goal #2 PoLinguas
	See: http://live.gnome.org/GnomeGoals/PoLinguas

2006-04-22  Richard Hughes  <richard@hughsie.com>

	* docs/icon-scheme.txt: Add this file describing the logic an rationale
	of the new icon naming scheme.

	* data/icons/*/*: Rename the icons to the common syntax so we can get
	rid of some of the bodges in the source, and make everything logical.
	Also add the extra CSR icons, although they are still the low power
	icon and need to be updated.

	* src/gpm-tray-icon.c, src/gpm-stock-icons.h, src/gpm-manager.c,
	src/gpm-power.c: Update the source and get rid of the nasty bodges and
	hardcoded constants for the icons.

2006-04-21  Richard Hughes  <richard@hughsie.com>

	* src/gpm-inhibit.{c|h} (gpm_inhibit_generate_cookie): Make sure the
	cookie we generate is really unique. Fixes bug #339307.

	(gpm_inhibit_find_cookie, gpm_inhibit_cookie_compare_func): Create
	these functions so we can easily find data in the list from another
	cookie.

	* src/gpm-common.c: Convert to gtk-doc format comments.

2006-04-21  Richard Hughes  <richard@hughsie.com>

	* src/gpm-info.c (gpm_info_populate_device_information): Abstract out
	the device blobs so that we can do each one in a nice way.

	* src/gpm-power.{c|h}: Rename gpm_power_kind_to_string() to
	gpm_power_kind_to_localised_string() and create a proper
	gpm_power_kind_to_string() function. N.B. The icons -battery- should
	really be renamed to -primary- for consistancy with all the other
	parts of g-p-m. I'll do this when Jakub is finished.

	* data/gpm-info.glade: Put a proper grid round the elements, and add
	the keyboard hardware blob. Should fix #339262.

2006-04-21  William Jon McCann  <mccann@jhu.edu>

	* src/gpm-screensaver.c: (gpm_screensaver_enable_throttle):
	Update for new throttle API.  Provide a fallback for now.

	Fixes #339209

2006-04-21  Rodrigo Moya <rodrigo@novell.com>

	* src/gpm-manager.c (tray_icon_destroyed, gpm_manager_init): respond
	correctly to systray crashing by readding the icon to the tray when
	destroyed.

	* src/gpm-tray-icon.c (gpm_tray_icon_show): no need to call _unrealize
	on the icon.

2006-04-21  Richard Hughes  <richard@hughsie.com>

	* src/gpm-info.c (gpm_info_populate_device_information): Fix logic so
	multi-battery code can trigger. Nearly fixes #339262.

2006-04-21  Richard Hughes  <richard@hughsie.com>

	* data/gnome-power-manager.spec.in: Fix up the spec file (Paul Ionescu)
	to fix bug #339263.

2006-04-20  Richard Hughes  <richard@hughsie.com>

	* src/gpm-graph-widget.c (gpm_graph_draw_line): Only print the event
	dots if they are going to fit on the graph.

	* src/gpm-graph-widget.c (gpm_graph_draw_line),
	(gpm_graph_interpolate_value): Put the dots back on the line by popular
	request. Doing the interpolation means the event and data are still
	separate, but we can 'link' them on the graph.

2006-04-20  Jakub Steiner <jimmac@ximian.com>

	* gpm-suspend-to-ram.svg:
	* gpm-suspend-to-disk.svg: provide artwork as SVGs
	* gpm-ups-broken: provide sharp bitmaps, few tweaks.
	* gpm-brightness: bitmaps + SVG

2006-04-20  Richard Hughes  <richard@hughsie.com>

	* data/gpm-prefs.glade, src/gpm-prefs-core.c (gpm_prefs_init): Make
	sure we only remove the correct tabs from the notebook. This fixes
	the problem where desktop systems were shown the UPS tab, but not the
	General tab.

2006-04-20  Richard Hughes  <richard@hughsie.com>

	* data/icons/*/gpm-suspend-to-*.png: Tangoify these icons, thanks again
	to Jakub Steiner.

	* src/gpm-graph-widget.c: Stack the circles with 8px, not 5px.

2006-04-19  Richard Hughes  <richard@hughsie.com>

	* src/gpm-power.{c|h}, src/gpm-manager.c, src/gpm-info.c:
	Make some of the GpmPower structure names shorter, and also expose
	a device so we can easily get more that just the battery status.

	* data/gpm-info.glade, src/gpm-info.glade, src/gpm-power.c: Get rid of
	all that array and listview mess, and now have a pretty info page with
	icons, labels and all that jazz.

2006-04-18  Richard Hughes  <richard@hughsie.com>

	* data/gpm-info.glade: Add a clear button for all graphs.

	* src/gpm-info.c (gpm_info_show_window): Connect up the new buttons.

2006-04-18  Richard Hughes  <richard@hughsie.com>

	* src/gpm-main.c (main): Don't tell the user to use dbus-launch
	as it's the wrong way to do this. rh:188972

2006-04-18  Richard Hughes  <richard@hughsie.com>

	* src/gpm-try-icon.c (gpm_tray_icon_set_image_from_stock): Use the
	named SVG icon rather than getting the icon from a pixmap.

2006-04-18  Richard Hughes  <richard@hughsie.com>

	* src/gpm-manager.c (gpm_manager_get_warning_type): Add special case
	for CSR mice, as 1/7 is still above our low warning.

2006-04-17  Richard Hughes  <richard@hughsie.com>

	* src/gpm-feedback-widget.c (gpm_feedback_init): Use the named SVG icon
	rather than getting the icon from a pixmap.

	* data/gpm-feedback-widget.glade: Add in 5px spacing as the icon
	displays correctly now.

	* data/icons/scalable/Makefile.am: Put gpm-brightness.svg in the
	tarball so we can use it above.

2006-04-17  Richard Hughes  <richard@hughsie.com>

	* data/gnome-power-manager.schemas.in: Set the default for
	/apps/gnome-power-manager/display_icon_policy to 'present' so we don't
	display by default on desktops. Fixes rh:187140.

2006-04-17  Richard Hughes  <richard@hughsie.com>

	* src/gpm-prefs-core.c (setup_ac_actions): Add the action 'Do nothing'
	so we don't do the DPMS action off for the external monitor.
	Fixes #338689.

2006-04-17  Richard Hughes  <richard@hughsie.com>

	* src/gpm-tray-icon.c (gpm_tray_icon_show_about_cb): Add Jakub Steiner
	to the artists list in the 'About' box.

2006-04-17  Richard Hughes  <richard@hughsie.com>

	* data/icons/*/*: Switch to using the Tango style.
	Thanks go to Jakub Steiner for a very nice icon set. Fixes #331761.

	* src/gpm-tray-icon.h: use gpm-battery-charged as our application icon.

2006-04-17  Kjartan Maraas  <kmaraas@gnome.org>

	* configure.in: Remove obsolete entry for no_NO
	* po/no.po: And the translation.

2006-04-17  Richard Hughes  <richard@hughsie.com>

	* src/gpm-graph-widget.c (gpm_graph_draw_line): Stack the points
	according to thier pixel position on the grid, rather than checking
	the time. Also allow < 5px diffrence to stack, as auto-ranging makes
	the points more squished-up.

2006-04-17  Richard Hughes  <richard@hughsie.com>

	* src/gpm-graph-widget.{c|h}, src/gpm-manager.c: Add an event for the
	LCD brightness resume, so we can explain why the power consumption
	has gone up.

2006-04-17  Richard Hughes  <richard@hughsie.com>

	* src/gpm-info-data.{c|h}: Add in the code to limit the data by time,
	so we can set a maximum time period. Disabled for now as the code
	crashes, but the idea is there. Working towards #338174.
	Also make adding a point *loads* quicker by cacheing the length
	and the last added point so we don't have to walk the complete GList
	every time we add a point.

	* src/gpm-graph-widget.c: Only show the events if the legend is enabled
	for the specific graph.

2006-04-16  Richard Hughes  <richard@hughsie.com>

	* src/*.c, src/*.h: Lots of whitespace fixes in nearly every file.
	No actual code change.

2006-04-16  Richard Hughes  <richard@hughsie.com>

	* src/gpm-tray-icon.c (libnotify_event): Point to the center of the
	icon so we conform to the GNOME HIG and match the behaviour of
	NetworkManager.	Fixes #338638.

2006-04-15  Richard Hughes  <richard@hughsie.com>

	* src/gpm-info.c, src/gpm-graph-widget.c: Start adding infrastructure
	so that the graphs (and data) can start at non-zero. This means the
	event log stays valid, and the graphs make more sense. This is required
	so that we can limit the data to a maximum time period without
	displaying the time 'backwards'.

2006-04-15  Richard Hughes  <richard@hughsie.com>

	* src/gpm-info.c: Only load the glade file (and all the widgets) when
	we want to show the window, rather that unconditionally at startup.
	Also destroy the widget when we are finished as it saves memory.

2006-04-15  Richard Hughes  <richard@hughsie.com>

	* src/gpm-info-data.c (gpm_info_data_finalize): set the list to NULL
	on unref, so we go boom if we try to access a unref'd object (which I
	suspect we might be doing once in a blue moon).

2006-04-15  Richard Hughes  <richard@hughsie.com>

	* src/gpm-brightness.{c|h} (gpm_brightness_level_get): Add this new
	function so we can get at the current percentage value.

	* src/gpm-manager.c (idle_changed_cb): Check that we do not set a
	higher brightness when we try to lower the brightness on idle.
	Should fix #338630.

2006-04-15  Richard Hughes  <richard@hughsie.com>

	* src/gpm-power.c (battery_kind_cache_add_device): Make sure we add
	the new device to the *end*, not the *start* of the device list.
	Should fix #338634, where the batteries are listed in the reverse order
	to what ACPI and HAL reports.

2006-04-15  Richard Hughes  <richard@hughsie.com>

	* src/gpm-manager.c (gconf_key_changed_cb): Monitor
	/apps/gnome-power-manager/laptop_panel_dim_brightness so we don't have
	to restart to get the new setting. Should fix #338628

2006-04-15  Richard Hughes  <richard@hughsie.com>

	* src/gpm-info.c (gpm_info_get_time_string): Write the event log
	text like 'Sat Apr 15, 15:35:40' rather than just a random integer.

2006-04-15  Dennis Cranston  <dennis_cranston@yahoo.com>

	* src/gpm-debug.c: (gpm_critical_error):  Error alerts should use
        an OK button.  Also, fix it so the error dialog can be dismissed.
	Fixes #336997.

2006-04-15  Richard Hughes  <richard@hughsie.com>

	* data/gpm-info.glade: Make the button names sensible.

	* src/gpm-graph-widget.c (gpm_graph_draw_line, gpm_graph_draw_graph):
	Make the graphs instantly appear, rather than waiting for the first
	update to trigger the expose event.

	* src/gpm-info.c (gpm_info_show_window, gpm_info_clear_cb):
	Add the 'Clear' button to clear the data from memory, so that the
	event log and the graphs reset. Should fix the second half of #338174.

2006-04-15  Richard Hughes  <richard@hughsie.com>

	* src/gpm-manager.c (battery_status_changed_primary): use the new
	variable done_notify_fully_charged to track whether we have already
	done the 'Fully charged' notification.
	We only re-enable the fully charged notification when the battery
	drops down to 95% as some batteries charge to 100% and then fluctuate
	from ~98% to 100%. Should fix #338281.

2006-04-14  Richard Hughes  <richard@hughsie.com>

	* src/gpm-prefs.h: Remove the obsolete GPM_PREF_USE_ICON_DESKTOPS

	* src/gpm-manager.c: Remove some superfluous debugging code.

	* help/C/gnome-power-manager.xml: Add a couple of <note>'s describing
	how we can disable certain notifications.

2006-04-13  Richard Hughes  <richard@hughsie.com>

	* src/Makefile.am, src/gpm-info.{c|h}: Added these files, abstracting
	out the complex data structures in gpm-info.c

	* data/gpm-info.glade: Added the event log tab.

	* src/gpm-manager.c, src/gpm-info.{c|h}, src/gpm-graph-widget.{c|h}:
	Use the event data rather than adding fake points. This work is
	on-going, so expect a little unstability while the new infrastructure
	settles in. Seporating was done due to the graphing formulaes becoming
	really complex, and also saving twice the information we needed to.
	Also, we make the GpmInfoData unit the one-and-only as we have enough
	confusion as there is. This should reduce the 'random' crashes, and
	sure makes things more stable for me. Plus this lets us create an
	event-log in the GUI, to keep more people happy.

2006-04-06  Richard Hughes  <richard@hughsie.com>

	* src/gpm-graph-widget.{c|h}: Add the new function
	gpm_graph_enable_legend() and start with the legend disabled.

	* src/gpm-info.c: Enable the legend only when we get a power event.

2006-04-06  Richard Hughes  <richard@hughsie.com>

	* configure.in: Post release bump to 2.15.1

2006-04-06  Richard Hughes  <richard@hughsie.com>

	==== Version 2.15.0 ====

2006-04-06  Richard Hughes  <richard@hughsie.com>

	* src/gpm-power.c (battery_device_cache_entry_update_all): Fix the
	capacity calculation so that we don't always display 100%.

2006-04-06  Richard Hughes  <richard@hughsie.com>

	* src/gpm-debug.{c|h}: Seporate bugzilla functonality, sometimes we
	just want to give the user a warning.

	* src/gpm-graph-widget.c: (gpm_graph_set_colour): Make the colours more
	correct.

	* src/gpm-info.c: (gpm_info_data_point_limit): Add this new
	functionality so that we can reduce the number of points to a pre-set
	level using a time division algorithm so we don't keep diluting the
	previous data with a conventional 1-in-x type algorithm like we were
	doing before.

2006-04-04  Richard Hughes  <richard@hughsie.com>

	* src/gpm-graph-widget.c (gpm_graph_draw_graph): Fix
	'legend_height may be used uninitialized in this function' -- this is
	incorrect and probably a GCC bug, but initialising them won't hurt.

2006-04-04  Richard Hughes  <richard@hughsie.com>

	* src/gpm-dbus-monitor.{c|h}: Remove these files.

	* src/gpm-dbus-session-monitor.{c|h}, src/gpm-dbus-system-monitor.{c|h}:
	Add these files, splitting the system and session functionality.

	* po/POTFILES.in: Update.

	* src/gpm-idle.{c|h}, src/gpm-screensaver.{c|h}, src/gpm-power.{c|h},
	src/gpm-power.c, src/Makefile.am: Move the session/system dbus n-o-c
	watchers into the correct modules so we don't have the confusing
	'proxy'ing situation we used to have, where all the class encapsulation
	rules were being broken.
	I know this means we now have two session dbus n-o-c monitors for one
	program, but the class is small, and the watch is cheap.

	* src/gpm-prefs.c, src/gpm-main.c: Free the context so we don't leak
	memory, so that valgrind stays that little bit happier.

2006-04-04  Richard Hughes  <richard@hughsie.com>

	* src/gpm-manager.c (gpm_manager_init): Pretend we just resumed when
	we start to let actions settle. Taken from the Ubuntu patchset,
	thanks to Daniel Silverstone.

2006-04-04  Richard Hughes  <richard@hughsie.com>

	* data/gpm-prefs.glade: Delete the brightness change for UPS, and make
	the UPS widgets have sensible names.

	* data/gnome-power-manager.schemas.in: Add a new GConf key
	/apps/gnome-power-manager/action_ups_critical for the ups critical
	action. Default to shutdown, but allow hibernate and nothing.

	* src/gpm-prefs.h: Add GPM_PREF_UPS_CRITICAL.

	* src/gpm-manager.c: (battery_status_changed_ups): Do the action when
	the UPS	is critical. Should fix #337116.

	* src/gpm-prefs-core.c: (setup_ups_actions, gpm_prefs_init): Setup the
	UPS action combobox.

2006-04-04  Richard Hughes  <richard@hughsie.com>

	* src/gpm-info.c: (gpm_info_graph_update, gpm_info_interest_point):
	Do more careful checks so we don't segfault on startup when we are on
	battery power.

2006-04-04  Richard Hughes  <richard@hughsie.com>

	* help/C/gnome-power-manager.xml: Add lot more content.

	* help/Makefile.am, help/C/figures/gs-prefs.png: Add this new file
	showing gnome-screensaver-preferences.

2006-04-03  Richard Hughes  <richard@hughsie.com>

	* src/gpm-info.c (gpm_info_data_point_add): Check the end of the list
	not the start as the list is not appended to.

	* src/gpm-graph-widget.c (gpm_graph_event_description): Mark the new
	strings as translatable.

2006-04-03  Richard Hughes  <richard@hughsie.com>

	* data/48x48/gpm-brightness.png, data/scalable/gpm-brightness.svg:
	Add the new icons from Diana Fong, many thanks.

2006-04-03  Richard Hughes  <richard@hughsie.com>

	* src/gpm-graph-widget.{c|h}: Add the legend facility for the graphs.

	* src/gpm-info.{c|h}: Move the graph and colour stuff to the graph
	widget, and add some more descriptions and colours.

	* src/gpm-manager.c: Add more event types that interest us.

2006-04-03  Richard Hughes  <richard@hughsie.com>

	* data/gpm-info.glade: Make shadow type 'in' for the scrolled window.

	* data/gpm-info.glade, src/gpm-graph-widget.{c|h}:
	Rename the class to graph from simple_graph as it's not simple!

	* src/gpm-graph-widget.h, src/gpm-info.{c|h}, src/gpm-manager.c:
	Add the facility to add point in time of interest using the
	gpm_info_interest_point () function. These appear on the graph and act
	as a sort of visual indicator to how certain things save power.
	Only a few types are supported, and a legend is required.

	* src/gpm-power.c: (battery_device_cache_entry_update_key): Don't set
	the remaining time zero when we change change states.

2006-04-03  Richard Hughes  <richard@hughsie.com>

	* src/gpm-info.c (gpm_info_data_point_add): change prev to next so that
	we remove the same number of points form the start of the list as from
	the end.

	* src/gpm-power.{c|h}: Remove ->rate and replace with ->rate_raw and
	->rate_smoothed as sometimes we want the exponentially averaged value
	for the time remaining, and sometimes the raw value for the graphs and
	info pages.

	* src/gpm-info.c (gpm_info_log_do_poll): Log the raw rather than the
	smoothed data points.

2006-04-03  Richard Hughes  <richard@hughsie.com>

	* src/gpm-hal-monitor.c (watch_device_properties_modified):
	Don't switch round the removed and added booleans, the order is
	'added' then 'removed'.

	* src/gpm-hal-monitor.c (watch_device_property_modified):
	Emit the signal for modified *or* new keys, not just modified keys.
	This fixes the problem where HAL is slow creating the keys, which can
	happen with the CSR mouse and keyboard addon. This is a HAL bug, but
	there's no reason we can't make the mice work after a little delay.

2006-04-03  Richard Hughes  <richard@hughsie.com>

	* src/gpm-feedback-widget.c (gpm_feedback_init): Not everybody installs
	the glade file to /home/hughsie.... so don't hardcode this. Ugh.
	Found by Alejandro Vera, many thanks.

2006-04-02  Richard Hughes  <richard@hughsie.com>

	* src/gpm-manager.c, src/gpm-power.{c|h}: Add gpm_power_update_all so
	we update our caches when we resume from suspend or hibernate.

2006-04-02  Richard Hughes  <richard@hughsie.com>

	* src/gpm-prefs-core.c, src/gpm-screensaver.{c|h}, src/gpm-manager.c,
	src/Makefile.am: Use an instance of GpmScreensaver in g-p-p so we can
	connect to the g-s-p idle delay settings.
	Move the slider so that it starts at the g-s-p setting.
	Should fix #336061

	* src/gpm-screensaver.c (gpm_screensaver_connect,
	gpm_screensaver_enable_throttle): Cache the 'throttle' value.
	This is needed if g-p-m is started before g-s; we apply the setting
	when g-s is eventually started. Fixes #332366

2006-04-02  Richard Hughes  <richard@hughsie.com>

	* src/gpm-screensaver.{c|h}, src/manager.c: Allow gnome-screensaver to
	connect and disconnect from the messagebus at runtime. This fixes
	the bug where gnome-screensaver is updated, and locking stops working.
	Using this method also stops us continually getting the GProxy and DBUS
	session connection for every call to gnome-screensaver and is more
	efficient.

2006-04-02  Richard Hughes  <richard@hughsie.com>

	* src/gpm-screensaver.{c|h}, src/manager.c: make gpm-screensaver into
	a module, so we can start to deal with the issues with restarting g-s
	and g-s starting after g-p-m.

2006-04-02  Richard Hughes  <richard@hughsie.com>

	* src/gpm-prefs-core.{c|h}, src/gpm-prefs.c, src/Makefile.am:
	Modularize the key functionality into this new module, so we can
	start connecting it to other modules.
	We need tighter links with g-s if we are going to do clever things with
	the idle sliders.
	Also comment, and do a massive tidy-up.

2006-04-01  Richard Hughes  <richard@hughsie.com>

	* src/gpm-power.c (gpm_power_get_description_array): Shorten desc.

	* src/gpm-graph-widget.c (gpm_get_axis_label): Don't display 'm'
	when we show hours.

	* data/gpm-info.glade: Set HScroll to auto as sometimes the info doesn't
	fit on my little iBook screen.

2006-03-31  Richard Hughes  <richard@hughsie.com>

	* configure.in, docs/Doxyfile.in, docs/.cvsignore, docs/Makefile.am:
	Remove the remains of doxygen support.

2006-03-31  Richard Hughes  <richard@hughsie.com>

	* src/gpm-feedback-widget.c: Change timeout to be one second so it
	matches the volume widget.

2006-03-31  Richard Hughes  <richard@hughsie.com>

	* src/gpm-manager.c, src/gpm-brightness.{c|h}, src/gpm-marshall.list:
	Emit a signal when we are stepped up or down, catch this signal and
	show the new feeback widget.

	* src/gpm-feedback-widget.c: Do some simple refcounting on the timeouts
	so we only close the widget on the last timeout.

	* data/icons/48x48/Makefile.am, data/icons/48x48/gpm-brightness.png,
	src/gpm-stock-icons.h:
	Add this new file as a logo for the brightness popup. Waiting for a new
	SVG from Diana at the moment, so I've re-used the old g-s-d one.

2006-03-30  Richard Hughes  <richard@hughsie.com>

	* src/gpm-feedback-widget.{c|h}, src/Makefile.am, src/gpm-manager.c:
	Add new class for a feedback widget just like gnome-settings-daemon
	used to do. This still needs to be tied up into the lcd events and
	also needs to be made sane. Make no comment yet, it's all unfinished.

	* data/gpm-feedback-widget.glade, data/Makefile.am: Add the UI, taken
	from the acme part of gnome-settings-daemon.

	* po/POTFILES.in: Add these new files to be translated.

2006-03-30  Richard Hughes  <richard@hughsie.com>

	* man/gnome-power-manager.sgml: Apply patch from Ow Mun Heng
	<nikeow@yahoo.com> to add the --daemon option. Many thanks.

2006-03-30  Richard Hughes  <richard@hughsie.com>

	* src/gpm-graph-widget.c: Make sure the labels are centered, and also
	that the grid is even. Also make the text consistent and shorter.

	* src/gpm-power.c: Factor out the exponential average so it's clearer
	what we are trying to achieve.

2006-03-30  Richard Hughes  <richard@hughsie.com>

	* data/gnome-power-manager.schemas.in, src/gpm-prefs.h: Add
	/apps/gnome-power-manager/rate_exponential_average_factor so that we
	can play with the rate smoothing code, and temporarily disable it when
	we profile/play-with the battery.
	Also fix a typo in the spec to fix #336603.

	* src/gpm-power.{c|h}, src/gpm-brightness.{c|h},
	src/gpm-networkmanager.{c|h}:Add a few comments to make things
	clearer for me. I like comments.

2006-03-27  Richard Hughes  <richard@hughsie.com>

	* data/gpm-info.glade: Make the 3rd tab 'Power', not 'Rate'.

	* src/gpm-graph-widget.c: Make the Y axis 'W' rather than 'Wh' as we
	are projecting power over time rather than rate over time.

2006-03-27  William Jon McCann  <mccann@jhu.edu>

	* data/gpm-info.glade: Change info layout to be vertical
	in a scrolled window instead of 2x2 so that it doesn't get
	too wide.  Fixes #336207.

2006-03-27  Richard Hughes  <richard@hughsie.com>

	* src/gpm-manager.c (gpm_manager_suspend, gpm_manager_hibernate):
	Add a call to sync_dpms_policy () so we can recover the DPMS settings
	after a suspend or hibernate.
	Should fix #336081

2006-03-27  Richard Hughes  <richard@hughsie.com>

	* data/icons/Makefile.am: Add gtk-update-icon-cache when we install.
	Should fix #336067

2006-03-26  Richard Hughes  <richard@hughsie.com>

	* configure.in: Add el and ka that got missed from this file.

	* po/POTFILES.in: Add missing files.

	* po/*.po: Do a intltool-update --pot && make update-po to
	freshen up the translations.

2006-03-26  Richard Hughes  <richard@hughsie.com>

	* src/gpm-tray-icon.c (gpm_tray_icon_set_image_from_stock),
	src/gpm-prefs.c (gpm_prefs_setup_action_combo),
	src/gpm-manager.c (gpm_manager_init),
	src/gpm-main.c (main):
	Use gpm_critical_error with a descriptive report rather than g_error.

2006-03-26  Richard Hughes  <richard@hughsie.com>

	* src/gpm-main.c, src/gpm-debug.c, src/gpm-tray-icon.c: Add a few
	comments to make things clearer for me.

	* src/gpm-tray-icon.c (gpm_tray_icon_set_image_from_stock):
	Unref the icon so we don't waste memory.

	* src/gpm-debug.c: Move gpm_critical_error() here so we can start
	warning for other stuff too, rather than just g_error'ing. I'm trying
	to reduce the number of bugzilla's I get.

2006-03-26  Richard Hughes  <richard@hughsie.com>

	* data/gpm-main.c (gpm_object_register): Remove DBUS < 0.61
	compatibility ifdefs as we now require DBUS 0.61.

2006-03-25  Richard Hughes  <richard@hughsie.com>

	* data/icons/scalable/*: Add the svg icons.

	* data/icons/48x48/*, configure.in, data/icons/Makefile.am: Add this
	new directory with the few 24x24 icons we need.

	* data/icons/16x16/Makefile.am, data/icons/24x24/Makefile.am:
	Install these icons to /usr/share/icons/hicolor as we now need icons of
	different sizes, that we also need to use external to the application
	in libnotify. This also makes theming trivial as the current icons
	will be used by redhat in the bluecurve theme when we switch to tango.
	This means you have to install the icons to hicolor, and then do:
	gtk-update-icon-cache -q /usr/share/icons/hicolor

	* data/gnome-power-manager.spec.in: Update the icon cache so we can
	get the new icons registered.

	* data/icons/Makefile.am, src/gpm-stock-icons.h: Don't ship
	gnome-power.png, but instead ship an application icon in each size.

	* data/icons/16x16/gpm-power-information.png: Remove, as now we can
	use GTK_STOCK_INFO which is pretty much the same icon.

	* src/gpm-info.c, src/gpm-prefs.c, src/gpm-tray-icon.c: Set the window
	icons with the new icon locations.

	* src/gpm-manager.c: Use all the new 48x48 icons for the libnotify
	dialogues.

	* src/gpm-stock-icons.c: Trim down to just the two s-t-d and s-t-r
	icons, as the others we can use as named icons.

	* src/gpm-tray-icon.c (gpm_tray_icon_set_image_from_stock): Open from
	the theme, rather than the stock set.

2006-03-25  Jaap Haitsma  <jaap@haitsma.org>

	* data/gpm-prefs.glade: Change 'Running on Battery' and 'Running on AC'
	labels inside the tab to 'Sleep' as they are already on the tabs.
	Add a Brightness label to the brightness sliders. Fixes bug #335991
	Change all the widget names to *battery* i.s.o. *batteries*
	* src/gpm-prefs.c: Update because of changes in gpm-prefs.glade and some
	refactoring

2006-03-25  Richard Hughes  <richard@hughsie.com>

	* data/icons/svg/*: Remove, as directory name is incorrect.

	* data/icons/{16x16|24x24}/*, src/gpm-manager.c:
	Make all icons prefix with gpm-*

2006-03-25  Richard Hughes  <richard@hughsie.com>

	* src/gpm-manager.c, src/gpm-tray-icon.{c|h}:
	Make the order of the arguments to the icon message sane, and
	consistent thoughout g-p-m. Also add in the urgency field, and mark
	each notification with it's type, e.g. GPM_NOTIFY_URGENCY_CRITICAL
	for the critical action notification, as now libnotify changes it's
	message side colour depending on the urgency level.
	Also start adding in functionality so we change the icon in the
	libnotify window, but for now default to our application icon.

2006-03-25  Richard Hughes  <richard@hughsie.com>

	* src/gpm-manager.c, configure.in, data/gnome-power-manager.schemas.in:
	Remove the configure option ACTIONS_MENU_ENABLED and replace with the
	gconf key /apps/gnome-power-manager/show_actions_in_menu so that we
	can change the behaviour at runtime, rather than having to recompile.
	This defaults to true, where the actions are listed in the menu.
	Fixes #335415.

2006-03-25  Richard Hughes  <richard@hughsie.com>

	* src/gpm-manager.c (gpm_manager_get_warning_type): Don't return
	GPM_WARNING_ACTION when the battery value is 0% as this *may* happen
	with broken acpi laptops. Instead warn on the console.

	* src/gpm-power.c (battery_device_cache_entry_update_key):
	Invalidate the rate when we are declared charging/discharging. This
	was noticed with the new graphs were static at non zero when charged.

2006-03-25  Jaap Haitsma  <jaap@haitsma.org>

	* src/gpm-main.c, src/gpm-prefs.c: Use g_option i.s.o. popt

2006-03-24  Richard Hughes  <richard@hughsie.com>

	* CodingStyle: Remove as not required and out of date.

	* SConstruct, sconstools/*: Remove alternate build system while we
	consider alternatives.

2006-03-24  Richard Hughes  <richard@hughsie.com>

	* src/gpm-idle.{c|h}: Comment the file, and also get rid of the ugly
	cpudata struct. Make things a bit more friendly so people understand
	what's going on.

2006-03-24  Richard Hughes  <richard@hughsie.com>

	* src/gpm-info.c: Comment the file, and also remember to g_slice_free
	the elements when we strip the data when we have too many points.

	* src/gpm-graph-widget.{c|h}: Apply a patch from Crispin Flowerday
	<crispin@gnome.org> to fix the expose event handling. Many thanks.
	Add correct licensing and copyright header to file.
	Also add comments to the functions, so I know what's happening where.

	* src/gpm-manager.c: Remove oodles of trailing whitespace.

2006-03-23  Richard Hughes  <richard@hughsie.com>

	* src/gpm-info.c: Use the new g_slice functions to allocate and
	deallocate the small chucks of memory.

2006-03-23  Richard Hughes  <richard@hughsie.com>

	* src/gpm-manager.c: As things are getting complicated now, comment
	each function using gtkdoc format. I don't intend on generating gtkdoc
	output, I want it for my own understanding.

2006-03-23  Richard Hughes  <richard@hughsie.com>

	* src/gpm-brightness.c, src/gpm-dbus-monitor.c, src/gpm-dpms-x11.c,
	src/gpm-hal-monitor.c, src/gpm-idle.c, src/gpm-info.c,
	src/gpm-inhibit.c, src/gpm-power.c, src/gpm-tray-icon.c:

	From a suggestion from Paolo Borelli <pborelli@katamail.com>, more
	details available on #335369.

	Remove the parent_class declaration and the peek_parent() function call
	and replace all the uses of parent_class with gpm_x_parent_class.

2006-03-23  Richard Hughes  <richard@hughsie.com>

	* configure.in, src/gpm-tray-icon.c, data/gnome-power-manager.spec.in:
	Enable the experimental features, these belong in 2.15.x

2006-03-23  Richard Hughes  <richard@hughsie.com>

	* configure.in: Post release bump to 2.15.0

2006-03-23  Richard Hughes  <richard@hughsie.com>

	* src/gpm-info.c: Apply a fix from Ray Strode to fix the [x] close
	behaviour of the info window. Many thanks.

2006-03-22  Richard Hughes  <richard@hughsie.com>

	* src/gpm-graph-widget.{c|h}, src/gpm-info.c: Spend another two hours
	on these files, to get rid of the list-allocation, and make it work ok.
	Still some funnies, but I'm working on those.

2006-03-22  Richard Hughes  <richard@hughsie.com>

	* src/gpm-hal-monitor.c, src/gpm-manager.c, configure.in: Drop support
	for < DBUS 0.61 as we need the new 0.61 API calls, and also we can
	get rid of some compatability cruft.

2006-03-22  Richard Hughes  <richard@hughsie.com>

	* src/gpm-tray-icon.c, configure.in: Drop support for libnotify 0.2.x
	and depend on version 0.3.0 -- to do cool stuff we need to use the new
	glib api.

2006-03-22  Richard Hughes  <richard@hughsie.com>

	* src/gpm-graph-widget.c, configure.in: Make cairo required, rather
	than an optional module.

2006-03-22  Richard Hughes  <richard@hughsie.com>

	* src/gpm-manager.c, src/gpm-screensaver.{c|h}: Don't inhibit, just
	throttle. Pointed out in #332576.

2006-03-22  Richard Hughes  <richard@hughsie.com>

	* src/gpm-manager.c: Use the button 'battery' rather than 'www' to show
	the battery status. This depends on mjg59's kernel addition and the
	use of a HAL with the new button patched in.

2006-03-22  Richard Hughes  <richard@hughsie.com>

	* src/gpm-info.c: Make data go to the right graph.

	* src/gpm-graph-widget.c: Make sure both 0% and 100% are within the
	black outline box.

	* src/gpm-stock-icons.{c|h}, src/gpm-manager,
	data/icons/24x24/battery-broken.png, data/icons/24x24/ups-broken.png:
	Add broken battery icons so we can easily get bug reports from broken
	hardware. At the moment we just show 0% charging, which is interpreted
	as 'g-p-m gets the value wrong' rather than 'the hardware is broken'.

2006-03-21  Richard Hughes  <richard@hughsie.com>

	* data/gnome-power-preferences.desktop.in: Apply patch from
	Vincent Fretin <vincent.fretin@gmail.com> to add X-GNOME-Bugzilla keys
	for use with bug buddy.
	Category 'Application' is not a freedesktop.org registred category and
	should be removed.

2006-03-21  Rodrigo Moya <rodrigo@novell.com>

	* src/gpm-screensaver.c (gpm_screensaver_lock):
	* src/gpm-manager.c (gpm_manager_blank_screen): added debug messages
	for error conditions.

2006-03-20  JP Rosevear <jpr@novell.com>

	* src/gpm-hal-monitor.c: fixed response to HAL stops/restarts.
	(watch_device_disconnect_condition,
	watch_device_disconnect_proxy_modified, watch_device_remove): removed.
	(watch_remove_battery): disconnect from signals and free removed
	data from the hash table.

2006-03-19  Richard Hughes  <richard@hughsie.com>

	* src/gpm-hal-monitor.{c|h}: Remove the DBUS n-o-c functionality.

	* src/gpm-dbus-monitor.{c|h}, src/Makefile.am, src/gpm-marshall.list:
	Add these files as this functionality has been refactored from
	gpm-hal-monitor.
	Add the facility to monitor session name-owner-change as well as
	system, as we need this for the auto-remove inhibits when the caller
	crashes or forgets to remove the inhibit request.

	* src/gpm-inhibit.{c|h}: Add gpm_inhibit_remove_dbus which does a
	forced removal if already existing in the inhibit database.

	* src/gpm-manager.c: Watch the session dbus, and call
	gpm_inhibit_remove_dbus when a application quits from the session bus.

	* src/gpm-power.{c|h}: Proxy the dbus n-o-c, so we can deal with hal's
	disappearance from the system bus like we used to.

2006-03-19  Richard Hughes  <richard@hughsie.com>

	* data/gnome-power-manager.schemas.in, src/gpm-prefs.h: Rework the key
	names a little, so they are in the same area in gconf.

	* data/gnome-power-manager.spec.in: Build the experimental stuff.

2006-03-19  Richard Hughes  <richard@hughsie.com>

	* data/gnome-power-manager.schemas.in, src/gpm-prefs.h: Add:
	/apps/gnome-power-manager/battery_low_percentage
	/apps/gnome-power-manager/battery_very_low_percentage
	/apps/gnome-power-manager/battery_critical_percentage
	/apps/gnome-power-manager/battery_action_percentage
	/apps/gnome-power-manager/battery_low_time
	/apps/gnome-power-manager/battery_very_low_time
	/apps/gnome-power-manager/battery_critical_time
	/apps/gnome-power-manager/battery_action_time
	/apps/gnome-power-manager/laptop_panel_dim_brightness

	* src/gpm-manager.c (gpm_manager_init): Read in the values set in gconf
	so that we can change the hardcoded values if required. Fixes a problem
	reported by Ralf Mörler, where the battery critical was set impossibly
	low. Also get the LCD brightness on idle from gconf, as we are in the
	area, and might want to be tweaked by distros/users.

2006-03-18  Richard Hughes  <richard@hughsie.com>

	* src/gpm-inhibit.{c|h}: Add gpm_inhibit_check() so we can see if it's
	okay to do the action. Also add gpm_inhibit_get_message() to get a
	full description of why the action was inhibited.

	* src/gpm-manager.c: Add a helper function,
	gpm_manager_is_inhibit_valid () that checks validity, and shows a
	libnotify type window explaining the problem. Add this helper where we
	currently use gpm_manager_is_policy_timout_valid(), except the low
	power battery condition which must be done regardless of any veto.

2006-03-17  Richard Hughes  <richard@hughsie.com>

	* src/gpm-manager.{c|h}, docs/dbus-interface.txt, src/gpm-manager.xml,
	src/Makefile.am: Update with the new code for the inhibit action.

	* src/gpm-inhibit.{c|h}, docs/dbus-test-inhibit.py: Add these new files
	so we can start to write the inhibit framework further described in
	#334809. InhibitInactiveSleep and AllowInactiveSleep work, but don't
	do anything in the current setup. More to come...

2006-03-17  Richard Hughes  <richard@hughsie.com>

	* src/gpm-manager.{c|h}, docs/dbus-interface.txt, src/gpm-manager.xml:
	Add templates of InhibitInactiveSleep and AllowInactiveSleep to begin
	to add support for #334809. At the moment they don't do much.

2006-03-16  Richard Hughes  <richard@hughsie.com>

	* data/gpm-prefs.glade, src/gpm-prefs.c (gpm_prefs_create): Add a
	'Running on UPS' tab so we can start to add some policy actions.
	Only show when UPS hardware is detected.

2006-03-14  Richard Hughes  <richard@hughsie.com>

	* configure.in: Post release bump to 2.14.1

2006-03-14  Richard Hughes  <richard@hughsie.com>

	==== Version 2.14.0 ====

2006-03-13  Richard Hughes  <richard@hughsie.com>

	* data/gnome-power-manager.schemas.in, src/gpm-prefs.h: Add
	/apps/gnome-power-manager/policy_suppression_timeout so we can start to
	ignore events after we have returned from suspend/hibernate.

	* src/gpm-manager.c (gpm_manager_is_policy_timout_valid): Add
	functionality so we can ignore events from resume.
	This is adapted from the ubuntu mega-patch by Daniel Silverstone.
	This should fix rh:185273.

	* src/gpm-prefs.c (gpm_has_batteries): Only match primary batteries.
	This is to fix the battery tab appearing when a CSR mouse is inserted.

2006-03-12  Dennis Cranston  <dennis_cranston@yahoo.com>

	* data/gpm-prefs.glade:  HIG fixes:  spacing and capitalization

2006-03-12  Jaap Haitsma  <jaap@haitsma.org>

	* src/gpm-manager.c: (battery_status_changed_primary) Remove unecessary
	if statement

2006-03-12  Richard Hughes  <richard@hughsie.com>

	* help/C/gnome-power-manager.xml: Remove trailing whitespace throughout
	the file.
	Also add a description of suspend and hibernate. Fixes lp:34153.

	* po/POTFILES.in: Add gpm-info.{c|h} and gpm-info.glade.
	Thanks to Marcel Telka for the email.

	* src/gpm-power.c (gpm_power_get_description_array): Add another
	description 'lion' to the translation table. Thanks to Fabian Zeindl.

2006-03-11  Richard Hughes  <richard@hughsie.com>

	* data/gpm-info.glade: Fix ups frame name.

	* src/gpm-power.c: Add an enumeration for the unit for each device,
	as it makes sense to show some values for each unit type and not others

	* src/gpm-power.c: Begin the translate the technology field into known
	parameters.
	Ultimately we can feed this information back to HAL, so that hal has a
	fixed list of types (e.g. 'fuel-cell', 'lithium', 'lead', or 'nickel')
	that it can report as part of the spec. At the moment it's just
	displaying the internal ACPI name which is varied between manufacturers.

	* src/gpm-power.c: Don't calculate capacity when the last_full is equal
	to the design value as this just computes useless information.

2006-03-11  Richard Hughes  <richard@hughsie.com>

	* src/gpm-power.c: Better describe capacity, and mark new strings as
	translatable.

2006-03-10  Richard Hughes  <richard@hughsie.com>

	* data/gnome-power-manager.schemas.in: Remove policy for desktops key,
	it was just working round missing preferences and nobody knew how to
	change the value to do what it should do.

	* src/gpm-prefs.(h|c) (setup_icon_policy): Use a key radio button,
	'Display when battery present' and connect to GUI.
	Restore the old text for always as it better reflects what the icon
	policy is. I know we have lots of options now, but people all want
	different things, and distros keep changing the defaults :-)

	* src/gpm-manager.c (get_stock_id): make logic more sane by using the
	new 'present' key value. Fixes lp:33388

2006-03-10  Richard Hughes  <richard@hughsie.com>

	* src/gpm-info.c, src/gpm-power.{c|h}: Add capacity, vendor, model,
	serial number, technology and product into the device information
	fields. We get this from HAL when the device is added or coldplugged.

	* src/gpm-hal.c: Make the missing keys warning a bit quieter.

2006-03-10  Richard Hughes  <richard@hughsie.com>

	* src/gpm-info.c: Do some fixing, and make autoupdate.

2006-03-09  Richard Hughes  <richard@hughsie.com>

	* data/gpm-info.glade: Add some information treeviews.

	* src/gpm-info.c: Create a treeview for each device type so we can
	display detailed information for each device instance. They need some
	fixing and love, but I can do that later. They also don't autoupdate.

	* src/gpm-power.{c|h}: Add gpm_power_get_num_devices_of_kind,
	gpm_power_free_description_array, gpm_power_get_description_array
	so we can get the detailed information for each device, rather than
	per class.

2006-03-08  Richard Hughes  <richard@hughsie.com>

	* data/gpm-info.glade: Add the rate and time remaining tabs that use
	the new graphs. These maybe too much in the UI, but seeing as we get
	them for free I guess they can't hurt. And they'll be useful for
	debugging odd machines.

	* src/gpm-graph-widget.{c|h}: Allow the axes to be changed, and expose
	these as part of the public API. Also make sure that lines stay within
	the bounding box.

	* src/gpm-info.c: Add in infrastructure so we can monitor more than one
	data source, and display on multiple graphs. Loads of fixes, additional
	comments and cleanups. Also use the new window 16x16 icon.

2006-03-08  Richard Hughes  <richard@hughsie.com>

	* data/icons/16x16/gnome-power-manager.png: Add this small icon so we
	can use it for the window icon for the g-p-p and 'About' windows.

	* src/gpm-prefs.c, src/gpm-tray-icon.c: Use the new 16x16 window icon.
	Fixes #333675.

2006-03-07  William Jon McCann  <mccann@jhu.edu>

	* data/gpm-info.glade: Don't use mnemonics in notebook labels.
	Rename second tab to 'Charge History'.  Use HIG border spacing.

2006-03-07  Richard Hughes  <richard@hughsie.com>

	* configure.in: Check for cairo. This is an optional dependency if you
	want to build the experimental graph support.

	* data/gpm-info.glade: Don't set the size of the graph in the glade
	file, instead use the source.

	* src/gpm-graph-widget.c: Add the patch from Alexander Larsson so we
	don't antialias the gridlines. Also do lots of misc fixes to make this
	grid-thing work as it should.

	* src/gpm-info.c: Make some more stuff generic, and make the graph
	update every hardware interval. Also free our dynamically allocated
	memory when the [x] is clicked.

	This means that is you compile with --enable-experimental-features
	then you will get the graph. Do not do this on production systems as
	it's crashed once or twice, probably has spelling errors, and certainly
	the glade file could do with some HIG love. But it looks way cool.

2006-03-07  Richard Hughes  <richard@hughsie.com>

	* src/gpm-graph-widget.{c|h}, src/Makefile.am: Add a simple graph
	widget drawn using cairo. Disabled by default so we can build on FC4.
	This is for #333146 so we can draw cool graphs of power stuff. It's all
	very simple now, but the framework is very easy to expand.

	* src/gpm-info.c: Load the custom widget.

	* data/gpm-info.glade: Use the correct creation function name.

2006-03-06  Richard Hughes  <richard@hughsie.com>

	* data/gpm-prefs.glade: s/Options/General for the third tab option.

2006-03-06  Richard Hughes  <richard@hughsie.com>

	* src/gpm-idle.{c|h}: Whitespace fixes.

	* src/gpm-info.{c|h}, src/Makefile.am: Add the beginnings of a
	logging and statistics module.

	* src/gpm-manager.c: Initialise and finalise the info module.

	* data/gpm-info.glade, data/Makefile.am: Add the outline information UI,
	showing batteries status, UPS's status, and the various charging graphs.
	This does not work correctly yet. And you can only activate this new UI
	with the experimental compile option as it's buggy, and nothing really
	works how it should yet.

2006-03-06  Richard Hughes  <richard@hughsie.com>

	* src/gpm-tray-icon.c: Add the information icon if
	experimental-features is enabled in configure. Currently it just
	sends a signal to the manager.

	* data/icons/16x16/power-information.png, data/icons/16x16/Makefile.am,
	src/gpm-stock-icons.{c|h}: Add this icon for the power information item.

2006-03-06  Richard Hughes  <richard@hughsie.com>

	* src/gpm-manager.c (power_button_pressed_cb, power_on_ac_changed_cb):
	Poke the screensaver to simulate user input. This is what Windows XP
	does, and should solve the problems with the timer event happening
	shortly after the ac_adapter is removed. See #333525 for details.

2006-03-06  Richard Hughes  <richard@hughsie.com>

	* configure.in: Add the --enable-experimental-features flag so that
	I can start putting cool new (unfinished) stuff into CVS, such as
	#326741 and #333146

2006-03-06  Richard Hughes  <richard@hughsie.com>

	* src/gpm-hal.c (gpm_hal_handle_error): Create this function, and use
	it for all the HAL error handling. This lets us do clever things like
	ignoring DBUS timeouts. Original patch from Ray Strode, many thanks.

2006-03-05  Richard Hughes  <richard@hughsie.com>

	* src/gpm-tray-icon.c (gpm_tray_icon_show): gtk_widget_unrealize the
	icon when we hide it, else it leaves a 1px line on the notification
	tray. Fixes uses gnome-power-manager when using a transparent panel.
	Fixes #333515.

2006-03-05  Richard Hughes  <richard@hughsie.com>

	* src/gpm-screensaver.c (gpm_screensaver_lock): Don't try to lock if
	gnome-screensaver is not running or not installed as we not retry
	50 times, which delays the suspend.

2006-03-03  Richard Hughes  <richard@hughsie.com>

	* configure.in: Post release bump to 2.13.94

2006-03-03  Richard Hughes  <richard@hughsie.com>

	==== Version 2.13.93 ====

2006-03-03  Richard Hughes  <richard@hughsie.com>

	* src/gpm-manager.c (idle_changed_cb): Really ignore idle state changes
	when the lid is shut, so we don't turn on the display.

2006-03-03  Richard Hughes  <richard@hughsie.com>

	* src/gpm-manager.c (power_button_pressed_cb): Support the new names
	for brightness up and brightness down as the HAL API has changed.
	NOTE: we also support the old names, and should remove the *_DUP
	defines when we depend on HAL 0.5.8.

2006-03-03  Richard Hughes  <richard@hughsie.com>

	* configure.in: Get the DBUS version, as now we have do stuff
	differently depending on whether we are using dbus 0.60 or dbus 0.61.
	Yay. I love API breakages. Sjoerd Simons found the bug, did the
	research, found the solution, and wrote a patch to fix, for which I
	thank him greatly:

	In dbus <= 0.60 dbus struct weren't really typed from dbus-glib's pov.
	In dbus >= 0.61 they are, so when defining a signal you need to be
	more precise then before.

	* src/gpm-hal-monitor.c (watch_device_connect_property_modified):
	get the correct struct type if we are using >= DBUS 0.61.

2006-03-03  Richard Hughes  <richard@hughsie.com>

	* src/gpm-manager.c (battery_status_changed_primary): Remove the extra
	return that sneaked in to the notification path. This caused people to
	get repeated 'battery is fully charged' messages if thier hardware was
	a little wonky.	Should fix lp:32650 and rh:183612

2006-03-03  Richard Hughes  <richard@hughsie.com>

	* src/gpm-tray-icon.c (libnotify_event, gpm_tray_icon_notify): set
	the timeout parameter unit to be seconds, so we can still work with
	the old (ms) and new (s) libnotify versions.

	* src/gpm-manager.c: convert all the users of gpm_tray_icon_notify
	to send timeouts in seconds, and also define the defines
	GPM_NOTIFY_TIMEOUT_LONG (20 seconds) and GPM_NOTIFY_TIMEOUT_SHORT
	(5 seconds) so we can change the values to a sensible default in one
	place only. Should start to fix lp:33411.

2006-03-03  Richard Hughes  <richard@hughsie.com>

	* src/gpm-prefs.h: Add ACTION_INTERACTIVE and GPM_PREF_BUTTON_POWER.

	* src/gpm-manager.c (manager_policy_do): Add a ACTION_INTERACTIVE
	handler so we can show the logout box by doing an interactive logout.

	* data/gnome-power-manager.schemas.in: Add
	/apps/gnome-power-manager/action_button_power so we can reconfigure
	the power button. This was a requested function by email, and makes
	sense, as it allows me to reconfigure my powerbook power button to
	suspend, as I only have the one button. Defaults to interactive, which
	is what we have now. Also add the extended description to the other
	/apps/gnome-power-manager/action_button_* keys.

2006-03-02  Richard Hughes  <richard@hughsie.com>

	* src/gpm-power.{c|h} (gpm_power_battery_is_charged): Create this new
	function so we can put all the logic to determine if the battery is
	charged in one place, as now sometimes the icon and the tooltip
	disagree. Should fix bug #333169

	* src/gpm-power.c (power_get_summary_for_battery_kind): Use the new
	gpm_power_battery_is_charged functionality so that we match the logic
	used for the icon.

	* src/gpm-manager.c (get_stock_id_helper): Use the new
	gpm_power_battery_is_charged functionality that we have abstracted out.

2006-03-02  Richard Hughes  <richard@hughsie.com>

	* src/gpm-power.c (battery_kind_cache_update): clamp the percentage
	charge to between 0..100 as sometimes we get the internally averaged
	and computed value wrong. I blame HAL, but this fixes the problem. :-)

2006-03-02  Richard Hughes  <richard@hughsie.com>

	* src/gpm-screensaver.{c|h}: Add the functions:
	gpm_screensaver_inhibit_activation() and
	gpm_screensaver_allow_activation ().

	* src/gpm-manager.c (lid_button_pressed): Inhibit activation of the
	screensaver when the lid is closed, and allow activation when the
	lid is opened. This prevents the screensaver starting when the panel
	is closed, and the action is to turn off the screen or do nothing.

2006-03-02  Richard Hughes  <richard@hughsie.com>

	* configure.in, icons/Makefile.am, icons/16x16/*: Move the
	suspend-to-disk and suspend-to-ram icons to a proper place, considering
	they are not 24x24. Also update with the new bluecurve icons from
	Diana Fong, to match the theme, many thanks. Fixes #332631.

	* src/gpm-manager.c: Ignore timeout events when the lid is closed,
	as the DPMS is already off, and we don't want to perform policy actions
	or re-enable the screen when the user moves the mouse on systems that
	do not support hardware blanking.
	Details are here: https://launchpad.net/malone/bugs/22522

2006-03-01  Richard Hughes  <richard@hughsie.com>

	* src/gpm-main.c (gpm_critical_error): Create this function and use it
	in main to deal with critical warnings for missing dbus. I probably get
	one bug report a week of g-p-m 'crashing' on startup where the dbus
	system or session server is missing. Display a BIG FAT warning in a
	message box with all the details and exit nicely with error code 1.

006-03-01  Richard Hughes  <richard@hughsie.com>

	* src/gpm-screensaver.c (gpm_screensaver_lock): When we send the Lock
	signal to g-ss it takes maybe a second or so to fade the screen and
	lock. If we suspend mid fade then on resume the X display is still
	present for a split second (since fade is gamma) and as such it can
	leak information. Instead we wait until g-ss reports running and thus
	blanked solidly before we continue from the screensaver_lock action.
	The interior of g-ss is async, so we cannot get the dbus method to
	block until lock is complete. From the ubuntu mega-patch, thanks to
	Daniel Silverstone for the help explaining the situation.

2006-02-28  Richard Hughes  <richard@hughsie.com>

	* data/gpm-prefs.glade: Add an option to disable the dim on idle as I
	needed to change this during a demo today, and I had to grapple with
	gconf. Also change the always icon option to 'Always display icon when
	battery present' as this represents better what it does.

	* help/C/gnome-power-manager.xml: remove duplicate lock option.

2006-02-28  Richard Hughes  <richard@hughsie.com>

	* src/gpm-manager.c: Make the logging interface a whole lot more sane
	without just poking around in the manager->priv struct.

	* src/gpm-manager.h, src/gpm-manager.h: Change the dbus method names to
	include xxxx_dbus_method so we know (for logging purposes) whether a
	suspend was triggered from the external method, or if we did it
	internally from one of the handlers.

2006-02-28  Richard Hughes  <richard@hughsie.com>

	* src/gpm-debug.{c|h}: Get rid of the to_file stuff, nobody ever used
	it, me included. Add functionality to log to syslog, to try and start
	to fix #332760. Also reformat file and make more structured.

	* src/gpm-manager.c: Use define names to hold the key names, in case
	they ever change in HAL. Which they might do, when we start adding
	a few more.

	* src/gpm-manager.c: Start to add a logging interface so that we can
	log *why* a specific action was taken, to also try to fix #332760.
	This needs to be expanded, giving values and more precise reasons.
	Log to syslog, so that we get messages such as:
	'Feb 28 19:19:07 localhost gnome-power-manager: Suspending system
	because user clicked suspend in tray menu' in /var/log/messages.
	This should help debugging all those weird bugzillas.

	* src/gpm-manager.c (battery_button_pressed): Display a libnotify
	window containing all the device charges when the user presses the
	battery status key. From the ubuntu mega-patch.

2006-02-28  Richard Hughes  <richard@hughsie.com>

	* src/gpm-prefs.h: Add GPM_PREF_BUTTON_HIBERNATE

	* data/gnome-power-manager.schemas.in: Add the new key:
	/apps/gnome-power-manager/action_button_hibernate so we can set the
	policy when the hibernate button is pressed. Defaults to hibernate.
	From the ubuntu mega-patch.

	* src/gpm-manager.c (callback_gconf_key_changed): Do instant apply for
	CAN_SUSPEND and CAN_HIBERNATE. From the ubuntu mega-patch.

	* src/gpm-hal-monitor.{c|h}, src/gpm-marshal.list, src/gpm-power.{c|h}
	The battery name, details mess should not be emitted internally, as we
	should do all this processing in the hal-monitor. Get rid of the
	details field, and make this from VOID__STRING_STRING_BOOLEAN to
	VOID__STRING_BOOLEAN.

	* src/gpm-manager.c (power_button_pressed_cb): get rid of the 'virtual'
	mess as the only thing to use it is my toshiba addon, which now does
	the button events a standard way.

	* src/gpm-hal-monitor.c (watch_device_condition): Do not filter the
	allowed buttons here, as we are currently doing it in two places.
	It make more sense for the manager to do it.

	* src/gpm-manager.c (battery_status_changed_primary): Don't do the
	notification if the message is blank. From the ubuntu mega-patch.

	* src/gpm-hal.c (gpm_hal_num_devices_of_capability_with_value): Fix
	theoretical NULL dereference. From the ubuntu mega-patch.

2006-02-27  Richard Hughes  <richard@hughsie.com>

	* src/gpm-manager.c (get_stock_id_helper): use the prefix, rather than
	hardcoding 'battery' for the charged icon. Fixes #332761.

2006-02-27  Rodrigo Moya <rodrigo@novell.com>

	* data/Makefile.am: install autostart files to new (definitive) place.

2006-02-27  Richard Hughes  <richard@hughsie.com>

	* src/gpm-manager.c (battery_low_get_title): Include GPM_WARNING_ACTION
	to fix a crash when a very low power (0%) mouse is inserted. This
	should fix RH#183127.

2006-02-26  Richard Hughes  <richard@hughsie.com>

	* configure.in: Post release bump to 2.13.93

2006-02-26  Richard Hughes  <richard@hughsie.com>

	==== Version 2.13.92 ====

2006-02-26  Richard Hughes  <richard@hughsie.com>

	* src/gpm-manager.c (battery_status_changed_primary): Only set the
	last_primary_percentage_change after we have tested for the transition.

2006-02-26  Richard Hughes  <richard@hughsie.com>

	* src/gpm-prefs.h: Add GPM_PREF_USE_ICON_DESKTOPS

	* data/gnome-power-manager.schemas.in: Add the new key:
	/apps/gnome-power-manager/use_icon_for_desktops so we can set the icon
	policy when no hardware is present. Defaults to false.

	* src/gpm-manager.c (get_stock_id): Only use the ac_adapter fallback on
	desktops if GPM_PREF_USE_ICON_DESKTOPS is set. Fixes #332407

2006-02-25  Richard Hughes  <richard@hughsie.com>

	* src/gpm-manager.c (get_stock_id_helper): Fix another broken laptop.

2006-02-25  Richard Hughes  <richard@hughsie.com>

	* src/gpm-tray-icon.c (libnotify_event): Fix typo for libnotify 0.3.0

2006-02-25  Richard Hughes  <richard@hughsie.com>

	* data/icons/24x24/*.png, data/icons/svg/*.png,
	src/gpm-stock-icons.{c|h}, src/gpm-tray-icon.c, src/gpm-manager.c:
	Add the following icons:

	ac-adapter, keyboard-power-low, mouse-power-low
	suspend-to-disk, suspend-to-ram

	battery-charged, battery-charging-xxx, battery-discharging-xxx
	ups-charged, ups-charging-xxx, ups-discharging-xxx

	Where:
	00-10%  = 000
	10-30%  = 020
	30-50%  = 040
	50-70%  = 060
	70-90%  = 080
	90-100% = 100

	To rationise our icon naming and make the icon selection *much easier*.
	This is to address bug #331117 to add new UPS discharging and charging
	icons, and also to start to fix #331761 so we can theme the icons
	someday soon. I wanted to do this before the release so we can start
	working on a default theme.

2006-02-25  Richard Hughes  <richard@hughsie.com>

	* src/gpm-manager.c (gpm_manager_init): Fix the not on AC logic as
	we don't want to be notified on coldplug, but do want to be notified
	when we remove the ac_adpter for the first time.
	This should fix #332322

2006-02-25  Richard Hughes  <richard@hughsie.com>

	* src/gpm-prefs.h: Add GPM_PREF_IDLE_DIM_SCREEN.

	* src/gpm-brightness.c (gpm_brightness_percent_to_hw): Factor out the
	percent to hardware value calculation so we can do the error checking
	in one place.

	(gpm_brightness_level_dim_hw): Factor out the step dimming
	functionality so we can use it from other places.

	* src/gpm-brightness.{h|c} (gpm_brightness_level_save,
	gpm_brightness_level_resume): Add functionality so we can save the
	lcd brightness state and resume it from the manager.

	* src/gpm-manager.c (idle_changed_cb): Add in functionality so that we
	dim the screen to 30% when the SESSION is idle. Fixes #328564

2006-02-24  Richard Hughes  <richard@hughsie.com>

	* data/gnome-power-manager.schemas.in: Add the new keys:
	/apps/gnome-power-manager/check_type_cpu and
	/apps/gnome-power-manager/check_type_net to set the system policy for
	idle check action on CPU load. Defaults to true.

	* src/gpm-prefs.h: Add GPM_PREF_IDLE_CHECK_CPU and
	GPM_PREF_IDLE_CHECK_NET.

	* src/gpm-manager.c (gpm_manager_init): set the idle cpu load policy
	at init time. These policy keys should probably be updated while
	running, but this isn't important for now.

	* src/gpm-idle.c (poll_system_timer): only inhibit if we are set to
	check the CPU load. Networking to come.
	Fixes #332149

2006-02-24  William Jon McCann  <mccann@jhu.edu>

	* src/gpm-screensaver.c (gpm_screensaver_lock)
	(gpm_screensaver_poke): Update for revised
	gnome-screensaver DBUS method capitalization.
	Fixes #332481

2006-02-24  Richard Hughes  <richard@hughsie.com>

	* src/gpm-manager.c (power_on_ac_changed_cb): Invalidate the warning
	levels for primary battery when the AC is removed. NOTE: we still rely
	on the battery to begin discharging before we issue the warning in
	case our power source is UPS.
	Should fix #332322.

2006-02-24  Richard Hughes  <richard@hughsie.com>

	* data/gnome-power-manager.schemas.in: Add the new key:
	/apps/gnome-power-manager/use_time_for_policy to set the policy for
	per-time or per-percentage critical and low power actions.

	* src/gpm-prefs.h: Add GPM_PREF_USE_TIME_POLICY

	* src/gpm-manager.c (gpm_manager_init): set the per-time policy type
	from GPM_PREF_USE_TIME_POLICY. This still needs to be documented.
	Fixes #332055.

2006-02-24  Richard Hughes  <richard@hughsie.com>

	* data/gnome-power-manager.schemas.in: Add the new key:
	/apps/gnome-power-manager/notify_hal_error to set the policy for HAL
	failure notifications. Default true to display.

	* src/gpm-prefs.h: Add GPM_PREF_NOTIFY_HAL_ERROR

	* src/gpm-manager.c (gpm_manager_hibernate, gpm_manager_suspend):
	Only display the 'HAL failed to {action}' if set in gconf.
	Fixes #332440.

2006-02-23 Jaap Haitsma  <jaap@haitsma.org>

	* data/gnome-power-manager.schemas.in: Make the descriptions of the
	gconf values better

2006-02-23  Richard Hughes  <richard@hughsie.com>

	help/C/gnome-power-manager.xml, help/Makefile.am,
	help/figures/gpm-prefs-ac.png, help/figures/gpm-prefs-battery.png,
	help/figures/gpm-prefs-options.png:
	Update the screenshots now we have updated the UI.

2006-02-23  Richard Hughes  <richard@hughsie.com>

	src/gpm-manager.c (manager_critical_action_do): Do the critical action
	as part of a g_timeout, rather than a just a delay so we don't lock
	the GUI. Fixes #332150

	src/gpm-manager.c (battery_status_changed_primary): Describe what we
	are going to do better, so we don't say we are going to shutdown when
	we just are going to hibernate.

2006-02-22  Richard Hughes  <richard@hughsie.com>

	* data/gnome-power-manager.spec.in: Remove notification-daemon as a req
	so that we can build on FC5.

2006-02-22  Crispin Flowerday  <gnome@flowerday.cx>

	* data/gpm-prefs.glade:

	Alter some mnemonics to avoid conflicts with
	Ctrl+C (fixes bug #332192)

2006-02-22  Richard Hughes  <richard@hughsie.com>

	* src/gpm-hal-monitor.c (watch_device_condition): Fix detection
	of button objects, and add a verbose comment explaining what's going
	on. Fixes http://launchpad.net/distros/ubuntu/+source/
	gnome-power-manager/+bug/32447

2006-02-22 Jaap Haitsma  <jaap@haitsma.org>

	* data/gpm-prefs.glade: 'Running on Batteries' => 'Running on battery'
	So we are consistent with the name of the tab
	'Notification Area' => 'Notification area'
	HIG recommends Sentence capitalization

2006-02-21 Jaap Haitsma  <jaap@haitsma.org>

	* src/gpm-prefs.c: refactor the code that disables widgets if a gconf
	key is not writable

2006-02-21  Richard Hughes  <richard@hughsie.com>

	* configure.in: Post release bump to 2.13.92

2006-02-20  Richard Hughes  <richard@hughsie.com>

	==== Version 2.13.91 ====

2006-02-20  Richard Hughes  <richard@hughsie.com>

	src/gpm-manager.c (lid_button_pressed): Keep track of the lid state
	internally in the manager state.

	(power_on_ac_changed_cb): We do the lid close on battery action if
	the ac_adapter is removed when the laptop is closed and on battery.
	This should fix (#331655).

	(battery_low_get_title): Changed 'Power Warning' to 'Power Information'
	for the title when the ac_adapter is removed. Fixes (#331865).

2006-02-20  Richard Hughes  <richard@hughsie.com>

	* src/gpm-prefs.c (gpm_prefs_setup_sleep_slider,
	gpm_prefs_setup_brightness_slider, gpm_prefs_setup_action_combo,
	setup_icon_policy): Make the widgets disabled if the gconf key is
	not writeable. Fixes bug (#327893)

	* help/C/gnome-power-manager.xml: document why the widgets might be
	disabled.

2006-02-20  Richard Hughes  <richard@hughsie.com>

	* help/C/gnome-power-manager.xml: document the problems with
	Suspend on low power in a new known-bugs section.

	* src/gpm-prefs.c (setup_battery_actions): Add back option
	ACTION_SUSPEND by popular request (#330267)

2006-02-19  Richard Hughes  <richard@hughsie.com>

	* help/C/gnome-power-manager.xml: document
	/apps/gnome-power-manager/lock_use_* to fix bug #331717.
	Also tidy up this document so it can be easily changed in the future.

2006-02-19 Jaap Haitsma  <jaap@haitsma.org>

	* src/gpm-prefs.c, data/gpm-prefs.glade: remove suspend button action
	from the GUI

2006-02-19  Richard Hughes  <richard@hughsie.com>

	* configure.in, SConstruct, docs/Makefile.am: Remove doxygen build
	support as hardly any files now build. Fixes #327743.

	* data/gnome-power-manager.schemas.in, src/gpm-prefs.h,
	src/gpm-manager.c: Only use lock_on_blank_screen, lock_on_suspend,
	lock_on_hibernate as this should give us enough power for custom users
	and also simplicity so we don't have a dozen keys. We default to
	gnome-screensaver settings.

2006-02-19  Richard Hughes  <richard@hughsie.com>

	* src/gpm-manager.c (battery_status_changed_primary): Ahh! Merged a
	previous version of the (! on_ac) -> (! on_ac) patch. Fixed now.

2006-02-18  Richard Hughes  <richard@hughsie.com>

	* src/gpm-tray-icon.c (gpm_tray_icon_popup_cleared_cd): Add this
	function so we re-enable the tooltip.
	(gpm_tray_icon_button_press_cb): Disable the tooltip.
	(gpm_tray_icon_constructor): Set up the callback for the tray hide
	event. This means that the tooltip will not show when the popup menu
	is on the screen. This fixes bug (#331075).

2006-02-18  Richard Hughes  <richard@hughsie.com>

	* data/gpm-prefs.glade, src/gpm-prefs.c (gpm_prefs_setup_checkbox,
	gpm_prefs_checkbox_lock_cb): Remove the lock checkboxes. :-)

	* data/gnome-power-manager.schemas.in, src/gpm-prefs.h: Add
	lock_use_screensaver_settings to *finally* fix bug (#331164)

	* src/gpm-manager.c (manager_policy_do): Allow over-ride with
	settings from gnome-screensaver. Default to using gnome-screensaver
	settings as it's most obvious. Sabayon can be used to tweak these
	settings per domain if required.

2006-02-18  Richard Hughes  <richard@hughsie.com>

	* src/gpm-prefs.c (setup_ac_actions): Hide the ac 'Actions' box if
	there is no lib button, as it's now empty.
	(setup_battery_actions): Use the right glade name for the labels.

2006-02-18  Richard Hughes  <richard@hughsie.com>

	* src/gpm-manager.c (manager_policy_do): Add action BLANK to trigger
	a DPMS monitor off state.
	(lid_button_pressed): Don't do DPMS state unless we have blank as
	our option.

	* src/gpm-prefs.c: allow blank as an option for lid close events.
	This stops the problem of having 'No action', 'Also lock screen' in
	the GUI.

	* data/gnome-power-manager.schemas.in: Change the default action of
	action_ac_button_lid to blank.

2006-02-18  Richard Hughes  <richard@hughsie.com>

	* src/gpm-manager.c (manager_policy_do): Add a do_lock argument to this
	function so we can now specificy the lock policy according to the
	event that caused the policy to be performed. Do the locking here
	rather than gpm_manager_suspend and gpm_manager_hibernate.

	* src/gpm-manager.c (idle_changed_cb): BUGFIX: Do the idle action
	-not- the critical action. Not sure how nobody has triggered this yet.

	* src/gpm-manager.c (suspend_button_pressed, lid_button_pressed):
	Query and use the new lock gconf arguments.
	We probably need to add more arguments for stuff like DBUS calls
	and tray clicks, but I don't think these have to be in the UI.

2006-02-18  Richard Hughes  <richard@hughsie.com>

	* data/gnome-power-manager.schemas.in, src/gpm-prefs.h: Add
	lock_ac_lid, lock_battery_lid, lock_button_suspend, and
	lock_sleep_idle.

	* data/gpm-prefs.glade: Enable the new lock checkboxes.

	* src/gpm-prefs.c (gpm_prefs_checkbox_lock_cb,
	gpm_prefs_setup_checkbox): Add infrastructure so checkboxes can be tied
	to gconf keys.
	(setup_power_buttons, setup_sleep_type, setup_ac_actions,
	setup_battery_actions): Add the checkboxes into these handlers.
	NOTE, these keys get set correctly, but are not handled by the manager
	yet.

2006-02-18  David Zeuthen  <davidz@redhat.com>

	* src/gpm-hal-monitor.c (watch_device_condition): Use details if
	the button type is the empty string. Makes g-p-m do the right
	thing if I'm pressing the Sleep button on my keyboard (thanks to
	the hal patch from Matthew Garrett).

2006-02-18  Richard Hughes  <richard@hughsie.com>

	* data/gnome-power-manager.schemas.in: Make action_button_lid different
	policy values for AC and battery. Default to suspend for on battery
	and nothing for on AC.

	* src/gpm-prefs.h,
	src/gpm-prefs.c (setup_battery_actions, setup_ac_actions): Set the new
	policy keys individually.

	* src/gpm-prefs.c (gpm_prefs_setup_action_combo): Add the default
	action of nothing if gconf is missing. Stops a blank combobox, and
	makes it easier for us to debug without installing new schema each
	time.

	* src/gpm-manager.c (lid_button_pressed): do the new action when lid
	is closed and on AC power. Fixes (#331448)

2006-02-18  Richard Hughes  <richard@hughsie.com>

	* data/gpm-prefs.glade: Minor combobox id renames.

	* src/gpm-prefs.c (gpm_prefs_setup_action_combo): Pass this a widget.
	(setup_page_one, setup_page_two, setup_page_three): replace with
	setup_battery_sliders, setup_ac_sliders, setup_suspend_button,
	setup_sleep_type, setup_ac_actions, setup_battery_actions, and
	setup_icon_policy so that each function is specific to function, not
	location in the glade file.
	Also connect up the new widgets, so that it works like before. The new
	stuff I'm working on now.

2006-02-18  Richard Hughes  <richard@hughsie.com>

	* data/gpm-prefs.glade: Redesign interface. This is going to break
	g-p-p for a little while, so please bear with me.
	Also change duplicate accesskeys (#331538) and remove pointless icons
	in general tab (#331530).
	Add lots of lock checkboxes to solve (#331164) but these are disabled
	for now. We can argue about the defaults later, but I think this is
	an emotional argument with lots of different use-cases, that cannot
	be solved with just minimising the UI and making assumptions.

2006-02-18  Richard Hughes  <richard@hughsie.com>

	* src/gpm-manager.c (battery_status_changed_primary): Check the on_ac
	property before we do the action. This should ensure we don't warn, or
	do actions when removing the power lead at a short time to charge, on
	machines that lag updating the battery device. Fixes #331401.

2006-02-16  Richard Hughes  <richard@hughsie.com>

	* configure.in: Add --enable-actions-menu=foo so we can disable the
	menu at compile time. Fixes bug #331446

	* src/gpm-manager.c (gpm_manager_init): Only add actions to the tray
	icon if ACTIONS_MENU_ENABLED is enabled.

2006-02-15  Richard Hughes  <richard@hughsie.com>

	* configure.in: Post release bump to 2.13.91

2006-02-15  Richard Hughes  <richard@hughsie.com>

	==== Version 2.13.90 ====

2006-02-14  Richard Hughes  <richard@hughsie.com>

	* src/gpm-manager.c: Couple of string fixes noticed by Clytie Siddall.
	Fixes #331120.

2006-02-13  Richard Hughes  <richard@hughsie.com>

	* src/gpm-hal-monitor.c (gpm_hash_new_devices_cache,
	gpm_hash_free_devices_cache): Add these so we can simplify our memory
	management. We need to be more careful that what we were, as hal could
	be restarted many times and we could lose lots of memory.

	(hal_monitor_stop): Inline into _finalize, as not called elsewhere.

	* src/gpm-hal.c (gpm_hal_enable_power_save): valgrind (quite rightly)
	warns of use before set. Just initialise ret to zero.

	* src/gpm-power.c (battery_device_cache_entry_free) remove, as broken.

	(gpm_hash_new_kind_cache, gpm_hash_free_kind_cache,
	gpm_hash_new_device_cache, gpm_hash_free_device_cache): Add these so
	we can simplify our memory management, and not forget to free.

	(gpm_power_init): Listen for the hal-disconnected signal so we can
	clear the caches, else the devices think they are initialised.

	Fixes bug #327234.

2006-02-13  Richard Hughes  <richard@hughsie.com>

	* src/gpm-manager.c (get_stock_id): Use the fully charged, not charging
	icon like we used to do.

2006-02-13  Richard Hughes  <richard@hughsie.com>

	* src/gpm-main.c: Remove gpm_dbus_init_nlost, signalhandler_noc and
	all the accompanying n-o-c and name-lost stuff as it's not being used,
	and does not belong here. And it was rubbish code.
	This is all to begin to fix #327234, so we can restart hald without
	killing g-p-m.

	* src/gpm-hal-monitor.c: Rename proxy to proxy_hal. Add a second proxy
	called proxy_dbus that will let us get n-o-c signals.

	(gpm_hal_monitor_class_init): Add hal-connected and hal-disconnected
	signal types and descriptions.

	(hal_disconnect_signals): Free the proxy also here, as it's useless.

	(hal_connect_signals): Create the proxy, and reconnect the signals to
	the new proxy.

	(coldplug_all, un_coldplug_all): Begin to do the reconnection
	infrastructure so that devices get the signals from the new proxy.
	THIS IS WORK IN PROGRESS. Restarting hald will appear to work then
	segfault g-p-m.

	(hal_name_owner_changed): Add new callback for name-owner-changed
	signals from the new proxy_dbus objects.

	(hal_monitor_stop): call un_coldplug (), as currently we are just
	loosing memory. un_coldplug is TOFIX.

2006-02-13  Richard Hughes  <richard@hughsie.com>

	* src/gpm-main.c, src/gpm-manager.h: Remove GPM_SYSTEM_BUS as we are
	always going to use the session bus.

2006-02-13  Richard Hughes  <richard@hughsie.com>

	* src/gpm-manager.c (tray_icon_update): This function is not now
	responsible for creating and destroying the icon, it is done
	unconditionally at init, and then just hidden and shown as required.
	Rationale: we are showing notifications for lots of power stuff, and
	these break when you choose any other state than 'Always Show'.
	It also fixes the bug (#331002) as we are not relying on a complex
	chain of events to do the notifications. Most of this stuff is async,
	so it needs to be kept simple.

	(battery_status_changed_primary, battery_status_changed_ups,
	battery_status_changed_misc): Allow notifications without an icon
	showing in the tray.

	(gpm_manager_init): Set up the icon callbacks here, rather than in
	gpm_manager_setup_tray_icon() as this makes it *way* simpler.

	src/gpm-tray-icon.c: Add the is_visible flag so we can have quick
	safe access to the visible property. Bit of a bodge.
	Also convert a metric tonne of spaces to tabs in this file.
	Add the function gpm_tray_icon_show() so we can set the visiblity of
	the icon easily.

	(libnotify_event)'s: Allow notifications to be sent without the icon
	image, where we just use the system default if there is no widget
	present. This is what other program using libnotify do.

2006-02-13  Richard Hughes  <richard@hughsie.com>

	* src/gpm-common.h: Add location of FAQ page as GPM_FAQ_URL.

	* src/gpm-manager.c (gpm_manager_suspend, gpm_manager_hibernate):
	Inform the user if the HAL command failed, and point them in the
	direction of the online FAQ page. Fixes bug #330889.

2006-02-13  Richard Hughes  <richard@hughsie.com>

	* src/gpm-manager.c (gpm_manager_init): Don't do tray_icon_update here
	anymore as we havn't got the device list in order yet. This fixes the
	bug where the ac_adapter icon was being shown for a split second,
	and then changing to the required icon.

	* src/gpm-power.c (add_battery): Add in another debug statement.

	* src/gpm-prefs.c (gpm_prefs_setup_sleep_slider,
	gpm_prefs_setup_brightness_slider, setup_page_three): Only connect up
	the value-changed signal once the initial value has been set.
	This prevents the gconf keys from getting written to (if only for a
	split second), so that the icon no longer flickers when somebody
	clicks preferences or loads it from the Desktop menu.

2006-02-13  Richard Hughes  <richard@hughsie.com>

	* src/gpm-hal-monitor.c, src/gpm-manager.c, src/gpm-power.c,
	src/gpm-tray-icon.c: Add gpm_debug statements before the signal emit
	so we can trace, and see what's going on internally.

	* src/gpm-main.c (main): Do the gpm_debug_init earlier in the sequence
	else we lose the new signal messages on initialization.

2006-02-13  Richard Hughes  <richard@hughsie.com>

	* src/gpm-power.h, src/gpm-power.c (gpm_power_class_init): Add
	battery removed proxy signal so we can use it in manager.

	(add_battery): Do not query hal again, use the cached values for
	the capacity check. Also, only do this check if the battery is marked
	as present.

	(power_get_summary_for_battery_kind): Remove the complicated check
	for UPS's, as it's fragile and seems to break.
	Unconditionally display the battery type as a prefix for now, we can
	argue about the tooltip logic in a new bugzilla.

	(battery_device_cache_entry_update_all): Do more careful checking,
	(e.g. don't ask a mouse device for time_remaining) so we don't spew
	so many warnings.

	* src/gpm-manager.c (gpm_manager_init): Add hal_battery_removed_cb so
	we can update the icon and tooltip to fix #329027.

2006-02-13  Richard Hughes  <richard@hughsie.com>

	* src/gpm-manager.c (get_stock_id): Fix a typo where
	(charging || charging) should be (charging || discharging) so that we
	get the correct icon on discharging battery with UPS attached.

2006-02-13  Richard Hughes  <richard@hughsie.com>

	* src/gpm-manager.c: Add an extra state GPM_WARNING_DISCHARGING so we
	can make the UPS and primary battery stuff common in the existing
	warning framework.

	(maybe_notify_on_ac_changed): Only clear the notification now, as we
	rely on the trueness of battery.is_discharging to do the warning.

	(gpm_manager_get_warning_type): Add the check for a now-discharging
	battery_status object. Man, this generic code is easy to change.

	(battery_low_get_title): Add a string for GPM_WARNING_DISCHARGING.

	(battery_status_changed_primary): Do the warning
	'The AC Power has been unplugged.' here, for GPM_WARNING_DISCHARGING.
	(battery_status_changed_ups): Do the warning
	'Your system is running on backup power!' for GPM_WARNING_DISCHARGING.
	(battery_status_changed_misc): Ignore GPM_WARNING_DISCHARGING as this
	is not relevant for pda, mouse or keyboard devices.

	(gpm_manager_init): Set last primary warning to GPM_WARNING_DISCHARGING
	as we don't want to be notified on coldplug if we are on battery power.

2006-02-13  Richard Hughes  <richard@hughsie.com>

	* src/gpm-power.c (battery_device_cache_entry_update_key): Do a
	exponentially weighted average for the rate so that high frequency
	changes are smoothed. This should mean the time_remaining does not
	change drastically between updates.

	(battery_kind_cache_update) Also limit the time_remaining to 100 hours.
	Fixes bug #328927.

2006-02-12  Richard Hughes  <richard@hughsie.com>

	* src/gpm-manager.c (get_stock_id): Refactor the code, leaving the
	logic mostly the same as before. Now it's obvious what's happening
	in the selection, and also allows a UPS icon to be chosen.
	(battery_status_changed_primary): Slight rearrangement for logic
	optimisation.
	(battery_status_changed_ups): Add a check for discharging.

	* src/gpm-power.c (battery_kind_cache_update): Make work with UPS's
	as they do not provide rate information, but do provide time
	information.
	(power_get_summary_for_battery_kind): Simplify the logic, and make
	'Unknown time remaining until changed' a thing of the past.
	Also show the primary battery type, if we have a UPS installed in the
	system so we know what the remaining time is refering to.
	(gpm_power_get_status_summary): If we are using a discharging UPS, then
	set our state to 'Computer is running on backup power'.
	Also remove the enum structure thing as it's only used once, and it's
	easier just to use the defines directly.

	This is all to begin to fix bug : #329027

2006-02-11  Richard Hughes  <richard@hughsie.com>

	* src/gpm-brightness.c, src/gpm-common.h, src/gpm-debug.c, src/debug.h,
	src/gpm-hal-monitor.c, src/gpm-hal.c, src/gpm-idle.c, src/gpm-main.c,
	src/gpm-manager.c, src/gpm-networkmanager.c, src/gpm-power.c,
	src/gpm-prefs.c, src/gpm-screensaver.c, src/gpm-stock-icons.c,
	src/gpm-tray-icon.c: Create gpm-warning so we can also log g_warnings
	in the same way as gpm_debug. Also make a few more #defines better
	named, e.g. GPMURL -> GPM_HOMEPAGE_URL.

2006-02-11  Richard Hughes  <richard@hughsie.com>

	* src/gpm-manager.c (battery_low_get_title, battery_status_changed_ups,
	battery_status_changed_misc): gnome-power-manager didn't get into 2.14.
	Celebrate by adding lots of new translatable strings. These can be
	altered by someone with a better grip of English if required.

2006-02-11  Richard Hughes  <richard@hughsie.com>

	* help/C/figures/gpm-charged.png, help/C/figures/gpm-critical.png,
	help/C/figures/gpm-low.png, help/C/figures/gpm-unplugged.png,
	help/C/gnome-power-manager.xml, help/Makefile.am:
	Add yet more screenshots to the yelp file.

2006-02-10  Richard Hughes  <richard@hughsie.com>

	* help/C/figures/gpm-main.png: Update to something more up-to-date.

	* help/C/figures/gpm-unplugged.png, help/C/figures/gpm-options.png,
	help/C/figures/gpm-advanced.png: Add these files to enhance the yelp
	file.

	* help/C/gnome-power-manager.xml: Add the three extra files as
	screenshots, and remove the known-bugs section.

2006-02-10  Richard Hughes  <richard@hughsie.com>

	* src/gpm-debug.{c|h}: Add these files to allow us to use debugging
	that is easy to read. I spend *hours* looking at these traces.
	Copied from gnome-screensaver, (C) 2005 William Jon McCann.

	* SConstruct, src/Makefile.am: Add gpm-debug.c to be built for g-p-m
	and g-p-p.

	* src/gpm-brightness.c, src/gpm-dpms-x11.c, src/gpm-hal-monitor.c,
	src/gpm-hal.c,src/gpm-idle.c, src/gpm-main.c,src/gpm-manager.c,
	src/gpm-power.c, src/gpm-prefs.c, src/gpm-screensaver.c,
	src/gpm-tray-icon.c: Switch to the superior gpm_debug functionality.

	* src/gpm-power.c (battery_kind_cache_debug_print): Reformat so the
	debug information is more compact.

2006-02-10  Lukas Novotny  <lukasnov@cvs.gnome.org>

	* configure.in: Added cs to ALL_LINGUAS.

2006-02-10  Rodrigo Moya <rodrigo@novell.com>

	* src/gpm-hal-monitor.h: removed 'reserved' argument from
	'battery-added' signal.

2006-02-10  Richard Hughes  <richard@hughsie.com>

	* src/gpm-manager.c: Add GpmWarning struct so we can track the warning
	states of all the devices indervidually. Also add
	BATTERY_ACTION_PERCENTAGE and BATTERY_ACTION_REMAINING_TIME so we
	do the policy action some time after the last critical warning.

	(maybe_notify_battery_status_changed) Removed, as functionality was
	muddled. We need to split this per-batterytype, as we do very different
	things for each device, e.g. warn for mouse low, but policy and
	warnings for the primary battery.

	(gpm_manager_get_warning_type, battery_low_get_title): Abstract out
	the warning type and title generation from the background logic -- so
	we can start to split up the functions per-device.

	(battery_status_changed_primary, battery_status_changed_ups,
	battery_status_changed_misc): Add these different handlers that it's
	clear that these types have different actions and logic.
	These functions are a bit bodged w.r.t message strings, as we are in
	string freeze, and I can't add lots of new strings yet.

	(power_battery_status_changed_cb): Dont do policy here, leave it to the
	indervidual handlers for the type (e.g. battery_status_changed_primary)
	to do the actions. Makes logic lots clearer.

	Begins to fix #329027

2006-02-06  William Jon McCann  <mccann@jhu.edu>

	* src/gpm-manager.xml: Expose actions API.

	* src/gpm-manager.c (gpm_manager_error_quark, manager_policy_do)
	(gpm_manager_shutdown, gpm_manager_hibernate)
	(gpm_manager_suspend, power_button_pressed_cb)
	(gpm_manager_tray_icon_hibernate, gpm_manager_tray_icon_suspend):
	Add GError to public actions.

	* docs/dbus-interface.txt: Added new actions API.

	Fixes #330189.

2006-02-06  Richard Hughes  <richard@hughsie.com>

	* src/*.c, src/*.h: Fix the headers so that they are all the same,
	removing the file doxygen markup, and adding authors to some files.
	Also remove trailing whitespace from *lots* of files.
	Starting to address #327743

2006-02-06  Richard Hughes  <richard@hughsie.com>

	* src/gpm-manager.c (lid_button_pressed): Only do lid sleep action
	when on battery power. Fixes bug #329512

2006-02-05  Richard Hughes  <richard@hughsie.com>

	* src/gpm-manager.c (maybe_notify_battery_power_changed):
	We need to add the check for charging for the 100% charge
	notification else we get a 100% charged notifications (plural) a few
	times when on battery power (as the flag is cleared) and we are at
	state 100%.

	This is not possible as the is_charging state changes before the
	percentage change goes 99->100. This works this way intermittently on
	my Toshiba, and never works on my iBook. This new code seems to work
	for me in all cases. Plus we don't have to faff around and invalidate
	the 'show notification' flag as we are testing the change up always.

2006-01-31 Jaap Haitsma  <jaap@haitsma.org>

	* gpm-power.{c|h}: Introduce an enum GpmPowerBatteryType to denote the
	type of battery i.s.o. a string

	Introduce a struct GpmPowerBatteryStatus that holds all the battery
	data.
	This will make future inclusion of extra data that we can process in
	GpmManager trivial

	BATTERY_POWER_CHANGED signal changed to BATTERY_STATUS_CHANGED and now
	only indicates battery_type. User can obtain battery status by calling
	gpm_power_get_battery_status.

	Change the other code to reflect these changes

	* gpm-manager.c gpm-marshal.list: Use the new data types of gpm-power

	* gpm-manager.c (power_battery_status_changed_cb)
	Critical action now can also be time based

	(maybe_notify_battery_status_changed) make sure we only notify if
	remaining_time > 0

2006-02-02 Leonid Kanter <leon@asplinux.ru>

	* * configure.in: Added ru to ALL_LINGUAS

2006-01-29 Jaap Haitsma  <jaap@haitsma.org>

	* gpm-power.c: (power_get_summary_for_kind) fully charged is more
	important than charging

	(battery_device_cache_entry_update_all)
	(battery_device_cache_entry_update_key) If charge_rate == 0, charging
	and discharging should be FALSE

	Bug is caused by HAL freedesktop bug #5752

	Fixes #328964

2006-01-29  Raphael Higino  <raphaelh@cvs.gnome.org>

	* configure.in: Added pt_BR to ALL_LINGUAS.

2006-01-29  Chao-Hsiung Liao  <j_h_liau@yahoo.com.tw>

	* configure.in: Add 'zh_HK' 'zh_TW' to ALL_LINGUAS.

2006-01-28 Jaap Haitsma  <jaap@haitsma.org>

	* gpm-manager.c : Oops my previous checkin did not compile

2006-01-28 Jaap Haitsma  <jaap@haitsma.org>

	* gpm-power.c: (battery_kind_cache_update) refactor.

	Move percentagecharged to gpm-manager.c. gpm-power.c should just give
	current status. gpm-manager.c should monitor this

	* gpm-marshal.list: take into account that percentagechanged is not
	anymore in the signal of power changed

	* gpm-manager.c: Add private variable done_notification_fully_charged to
	prevent fully charged being shown multiple times

	Fixes bug #328958

2006-01-28  Christopher Aillon  <caillon@redhat.com>

	* data/Makefile.am:
	* data/gnome-power-manager.spec.in:
	Fix the autostart file location to match the spec

2006-01-28  Richard Hughes  <richard@hughsie.com>

	* SConstruct, sconstools/*: Add the scons build framework.
	BJörn Lindqvist has provied a framework for g-p-m that lets us build
	using the new scons framework (which I've been testing for a few weeks).
	The old autotools system will remain as default, as it works.

2006-01-28 Jaap Haitsma  <jaap@haitsma.org>

	* gpm-manager.c: Remove doxygen comments for functions

	(maybe_notify_battery_power_changed): simplify logic to make sure that
	notifications are shown only once. Move tray_icon_update to
	power_battery_power_changed_cb

	(maybe_notify_on_ac_changed) move tray_icon_update call to
	power_on_ac_changed_cb

	(invalidate_notification_warnings) Remove this function

	Fixes bug #328759

2006-01-25  Richard Hughes  <richard@hughsie.com>

	* configure.in: Post release bump to 2.13.90

2006-01-25  Richard Hughes  <richard@hughsie.com>

	==== Version 2.13.5 ====

2006-01-25  Richard Hughes  <richard@hughsie.com>

	* src/gpm-manager.c: Add the done_warning_critical,
	done_warning_very_low, done_warning_low bools to the struct so we can
	keep knowledge of previous notifications.

	(maybe_notify_battery_power_changed): Change to NOT primary OR
	NOT discharging as the logic was wrong. Should fix bug (#328228)
	Also only do the notifications once, and don't do lots of
	notifications on startup if battery is very low. (#327963)

	(invalidate_notification_warnings): Add this function so we can
	reset the notification accounting, which we want to do if we go from
	battery -> AC -> battery.

	(power_battery_power_changed_cb): Do a libnotify warning stating the
	action 5 seconds before we do the critical action. We should always
	explain the action we are going to do.

2006-01-25  Richard Hughes  <richard@hughsie.com>

	* data/gnome-power-manager.schemas.in: Add the dim_on_idle gconf key
	so we can work on this functionality after the string freeze.

2006-01-25  Richard Hughes  <richard@hughsie.com>

	* src/gpm-manager.c (power_battery_power_changed_cb): Only do action
	when discharging, trying to fix bug (#328228)

2006-01-25  Richard Hughes  <richard@hughsie.com>

	* src/gpm-prefs.h: 'policy_can_hibernate' -> 'can_hibernate' Dohh.

2006-01-24  Richard Hughes  <richard@hughsie.com>

	* src/gpm-prefs.c (gpm_prefs_setup_action_combo): Don't segfault if
	gconf value is missing, just issue warning.

	* data/gnome-power-manager.schemas.in: Remove the elusive 'j'
	Also change the default brightnesses for AC to be 100, and battery 50.

2006-01-24  Richard Hughes  <richard@hughsie.com>

	* src/gpm-manager.c:
	Define the BATTERY_*_REMAINING_TIME constants.

	(maybe_notify_battery_power_changed): Only warn on primary battery,
	and also provide two methods for working out the notifications, to try
	to keep the peace for bug (#326743). This is based on a patch from
	Jaap, to change the notifications to time-remaining values rather than
	percentage charge.

	(power_battery_power_changed_cb): Invalidate the prior warning level
	as the power state has changed.

	(gpm_manager_init): Invalidate the warning level, and set the default
	to per-time rather than per-percentage. We can change this easily if
	this doesn't work in real world conditions, or perhaps make this a
	gconf configurable.

	(power_battery_power_changed_cb): Only do critical action on primary
	battery, fixing bug (#328228). Patch originally from Jaap.

2006-01-24  Richard Hughes  <richard@hughsie.com>

	* data/gnome-power-manager.schemas.in, src/gpm-prefs.h:
	Flattern the gconf schema so that we don't have lots of subfolders
	for very few keys.

	* data/gnome-power-manager.schemas.in, src/gpm-prefs.h,
	gpm-manager.c (gpm_manager_can_suspend, gpm_manager_can_hibernate):
	Query the can_suspend and can_hibernate keys to fix bug (#327894)

2006-01-24  Richard Hughes  <richard@hughsie.com>

	* data/gpm-prefs.glade: Do a
	s/'Power Preferences'/'Power Management Preferences' to fix the
	bug (#328397)

2006-01-24  William Jon McCann  <mccann@jhu.edu>

	* src/gpm-tray-icon.c (gpm_tray_icon_button_press_cb):
	Show menu for any button press.  Fixes #327959.

2006-01-24  Richard Hughes  <richard@hughsie.com>

	* data/gnome-power-manager.spec.in: Add %{_datadir}/autostart/* so that
	the rpm builds.

2006-01-24  Richard Hughes  <richard@hughsie.com>

	* data/Makefile.am: Fix up Rodrigo's commit so 'make distcheck' works

2006-01-24  Richard Hughes  <richard@hughsie.com>

	* src/gpm-power.c (power_get_summary_for_kind),
	src/gpm-prefs.c (gpm_prefs_format_time_cb),
	src/gpm-manager.c (maybe_notify_battery_power_changed),
	src/gpm-common.{h|c},

	Convert s\get_timestring_from_minutes\gpm_get_timestring so we now take
	seconds as the argument. This fixes bug (#328289).

2006-01-24  Richard Hughes  <richard@hughsie.com>

	* docs/www/images/*, docs/www/*: Remove as this is already in
	gnomeweb-wml CVS. Fixes bug (#328280).

2006-01-24  Richard Hughes  <richard@hughsie.com>

	* src/gpm-manager.c: Add the FIXME constants BATTERY_LOW_PERCENTAGE
	and BATTERY_CRITICAL_PERCENTAGE so we can get 99% of the patch of
	#326743 in CVS.

2006-01-24  Jaap Haitsma  <jaap@haitsma.org>

	* data/gnome-power-manager.schemas.in: Remove threshold_low,
	threshold_critical

	* data/gpm-prefs.glade: Remove threshold_low, threshold_critical sliders

	* src/gpm-prefs.{c|h}: Remove threshold_low, threshold_critical sliders
	and preferences

2006-01-24  Clytie Siddall <clytie@riverland.net.au>

	* configure.in	Added vi in ALL_LINGUAS line.

2006-01-23  Rodrigo Moya <rodrigo@novell.com>

	* data/gnome-power-manager.desktop.in:
	* data/Makefile.am: added .desktop file for gnome-session's
	autostart mechanism.

2006-01-23  Richard Hughes  <richard@hughsie.com>

	* configure.in: Add fexceptions to the configure line as it makes
	g-p-m blow up while testing if the signals are wrong (good thing).

	* src/gpm-hal-monitor.c (gpm_hal_monitor_class_init): Change
	gpm_marshal_VOID__STRING_STRING to gpm_marshal_VOID__STRING as we
	only send one argument.

	* src/gpm-power.c (hal_battery_added_cb): Remove the reserved parameter
	as it's not used anywhere and only confuses us. This should fix the bug
	where the g-p-m crashes and 'gdb bt' intermittently gives:
	hal_monitor_start->gpm_coldplug_batteries->g_signal_emit->
	g_signal_emit_valist->g_value_array_copy->g_strdup->strlen

2006-01-23  Richard Hughes  <richard@hughsie.com>

	* src/gpm-brightness.c (gpm_brightness_init): Actually check for the
	hardware so we don't get errors on desktop systems.

2006-01-22  Richard Hughes  <richard@hughsie.com>

	* src/gpm-manager.c (gpm_manager_init): Add a call to
	change_power_policy () so we set the correct lcd brightness on
	startup. This meant that the lcd brightness was not being set on
	the first cold boot of g-p-m.

2006-01-22  Richard Hughes  <richard@hughsie.com>

	* src/gpm-brightness.{c|h}: Add these files which abstract out the
	lcd brightness interface nicely. The new class internally deals with
	the hardware values (0..x) and externally deals with percentages
	so that the changes recently in g-g_signal_emitp-p to store percentage now work.

	* src/Makefile.am: Add gpm-brightness.{c|h} to g-p-m.

	* src/gpm-hal.{h|c}: Remove all the LCD brightness code. This was
	always a bodge putting it in this file, and now it's faster and
	cleaner in the new class.

	* src/gpm-manager.c: Adapt for the new lcd brightness function names.
	Also add the code to change the brightness when we change the
	gconf key in g-p-p. This fixes (#327895).

2006-01-22  Richard Hughes  <richard@hughsie.com>

	* docs/release-plan.txt: Add this file, so I can follow a tick sheet
	for a formal release :-)

2006-01-22  Richard Hughes  <richard@hughsie.com>

	* Makefile.am: Add MAINTAINERS to the tarball, advice from Behdad,
	http://mces.blogspot.com/2006/01/release-your-maintainers.html

2006-01-22  Richard Hughes  <richard@hughsie.com>

	* src/gpm-hal-monitor.c (watch_device_condition): Find the UDI from
	the proxy path, as before we were just reading random data...

2006-01-22  Richard Hughes  <richard@hughsie.com>

	* docs/dbus-interface.txt: Document CanSuspend and CanHibernate.

2006-01-21  Richard Hughes  <richard@hughsie.com>

	* src/gpm-manager.c (gpm_manager_init): Add a call to tray_icon_update
	so that desktop systems get an icon if specified in gconf.
	Fixes problems described in #327799, Comment 16.

2006-01-21  Richard Hughes  <richard@hughsie.com>

	* src/gpm-tray-icon.c (gpm_tray_icon_set_image_from_stock): Comment out
	gtk_image_clear() as it requires gtk 2.8. For FC4 we can't depend on
	more then 2.6. No visual change.

2006-01-20  William Jon McCann  <mccann@jhu.edu>

	* src/gpm-tray-icon.c (gpm_tray_icon_set_image_from_stock):
	Interpret a NULL stock id as no icon.
	(gpm_tray_icon_embedded): Set a flag when embedded in
	a socket.
	(gpm_tray_icon_class_init, gpm_tray_icon_notify): If
	not embedded don't do notifications.

	* src/gpm-manager.c (get_stock_id): Return in one place.
	(tray_icon_update, maybe_notify_on_ac_changed)
	(maybe_notify_battery_power_changed): Don't try to
	send notifications if we don't have a tray icon.  Move
	policy do out of here.
	(power_battery_power_changed_cb): Do the policy action
	here.

	Fixes #327799.

2006-01-20  William Jon McCann  <mccann@jhu.edu>

	* src/gpm-power.c: (power_get_summary_for_kind) Make tooltip more
	concise. Make some comments clearer or remove them.
	* src/gpm-common.c: return 'Unknown time' if minutes <=0 for
 	get_timestring_from_minutes ()

	Patch from Jaap Haitsma  <jaap@haitsma.org>
	Fixes #327443

2006-01-20  William Jon McCann  <mccann@jhu.edu>

	* src/gpm-prefs.h: Use enum for icon policy.

	* src/gpm-prefs.c (gpm_dbus_method_bool, gpm_can_suspend)
	(gpm_can_hibernate): Check with the daemon to see if
	we are capable and allowed to do these things.
	(gpm_has_batteries, gpm_has_lcd, gpm_has_button_sleep)
	(gpm_has_button_lid): Make functions to check these
	things.
	(gpm_prefs_icon_radio_cb): Don't leak gconf client.
	(gpm_prefs_format_brightness_cb): Don't use
	device dependent lcdsteps.
	(gpm_prefs_format_percentage_cb): Don't cast to int
	to guard against overflow.
	(gpm_prefs_format_time_cb): Use one return.
	(gpm_prefs_sleep_slider_changed_cb): Don't leak client.
	(gpm_prefs_setup_sleep_slider): ditto.
	(gpm_prefs_brightness_slider_changed_cb): Don't leak
	client.  Don't try to change brightness of devices here.
	(gpm_prefs_setup_brightness_slider): Don't leak client.
	Don't use device dependent lcdsteps.
	(gpm_prefs_action_combo_changed_cb): Don't leak.
	(gpm_prefs_setup_action_combo): Don't leak.  Use
	local _can_ functions instead of checking HAL directly
	so that we can also check gconf policy.
	(gpm_prefs_battery_low_slider_changed_cb): Don't leak.
	(setup_page_one, setup_page_two, setup_page_three)
	(gpm_prefs_create): Break up the creation and setup
	of each notebook tab to make it less monolithic.

	* src/gpm-manager.xml: Add CanSuspend, CanHibernate,
	and CanShutdown.

	* src/gpm-manager.[ch] (gpm_manager_can_suspend)
	(gpm_manager_can_hibernate, gpm_manager_can_shutdown):
	Make these methods public and expose to the bus.
	(get_stock_id): Make icon_policy an enum so
	we don't have to parse and compare strings.
	(tray_icon_update): Convert gconf icon-policy
	string to an enum for internal use.
	(gpm_manager_shutdown, gpm_manager_hibernate)
	(gpm_manager_suspend, gpm_manager_setup_tray_icon):
	Use new API for _can_ functions.

	* src/Makefile.am: Don't need gpm-screensaver
	for prefs.

	* data/gpm-prefs.glade: Remove time estimates
	for low and critical battery since this is
	device and system dependent.

2006-01-19  William Jon McCann  <mccann@jhu.edu>

	* src/Makefile.am:
	* src/gpm-hal-callback.[ch]: Remove hal-callback.

	* src/gpm-hal-monitor.c: Don't use hal-callback
	to get HAL signals.  Do it here.

	Fixes #327235

2006-01-19  William Jon McCann  <mccann@jhu.edu>

	* src/gpm-prefs.c (gpm_prefs_help_cb): Use gnome_help.
	Fixes #326890

2006-01-18  Richard Hughes  <richard@hughsie.com>

	* src/gpm-manager.c (maybe_notify_battery_power_changed):
	Revert the 20, 10, 5, and 2 checks. Definatly needs more work.
	Apologies, brain was not in gear.

2006-01-18  Richard Hughes  <richard@hughsie.com>

	* src/gpm-power.c (battery_kind_cache_add_device): Turn the warning
	about 'Adding missing device, may bug' into a debug statement, as this
	is now well tested.

	* src/gpm-manager.c (maybe_notify_battery_power_changed):
	Only notify the user of low battery on the 20, 10, 5, and 2
	minute intervals. Probably needs more work.

2006-01-18  Richard Hughes  <richard@hughsie.com>

	* data/gpm-prefs.glade: Make the combo bokes in options expand so that
	we don't get comboboxes of different sizes.

2006-01-18  William Jon McCann  <mccann@jhu.edu>

	* src/gpm-power.c (battery_kind_cache_update): Use floating
	point division to get a fraction.  Don't declare a variable
	in the middle of a block.  Use spaces around all operators.
	Use braces around blocks.
	(power_get_summary_for_kind): Use spaces around operators.
	Fix case where !is-charging && !is-discharging.
	Fixes #327471

2006-01-18  Richard Hughes  <richard@hughsie.com>

	* src/gpm-main.c (gpm_signal_handler_noc, signalhandler_noc):
	Be less vocal about changes in the bus -- we only want to know about
	g-p-m and hal, not everything else.

2006-01-17  Adam Weinberger  <adamw@gnome.org>

	* data/gnome-power-manager.schemas.in: Correct two typos.
	  Fixes bug #327396.

2006-01-17  Richard Hughes  <richard@hughsie.com>

	* src/gpm-manager.c (gpm_manager_init):
	Do not do tray_icon_update () in the initialization, else
	we get an ac_adapter icon for a split second (as state is unknown)
	then a battery icon.

	* src/gpm-manager.c (maybe_notify_battery_power_changed),
	* src/gpm-manager.c (maybe_notify_on_ac_changed):
	Remove the checks on manager->priv->tray_icon, as the icon does not
	have to exist before entering these functions.
	* src/gpm-tray-icon.c (gpm_tray_icon_init): Don't initialise this
	to the ac_adapter icon, use a blank image instead.

2006-01-17  Jaap Haitsma  <jaap@haitsma.org>

	* AUTHORS: Add myself.

	* src/gpm-tray-icon.c: Add myself as an author.

	* src/gpm-power.{c|h}: Fix multi battery setups. Change remaining time
	to seconds instead of minutes.

	* src/gpm-manager.c: Use seconds instead of minutes

2006-01-17  Richard Hughes  <richard@hughsie.com>

	* configure.in, NEWS: Update version to 2.13.5 so we match the GNOME
	version numbers. I know I missed the tarball deadline.

	doc/www/index.html: Update version requirements for HAL.

	* doc/www/images/gpm-about.png, doc/www/images/pref-options.png,
	doc/www/images/pref-main.png, doc/www/images/pref-advanced.png:
	Update to something more modern -- I've synced gnomeweb-wml too.

2006-01-17  Richard Hughes  <richard@hughsie.com>

	* src/gpm-main.h, src/Makefile.am, po/POTFILES.in:
	Remove this non-required file.

	* src/gpm-prefs.c, src/gpm-common.h, src/gpm-tray-icon.c,
	src/gpm-main.c, src/gpm-hal-monitor.c: Fix so that our name is
	'Power Manager' rather than 'GNOME Power Manager' in the warnings
	and menus so that we adhere to the GNOME HIG (#327277)

2006-01-16  Richard Hughes  <richard@hughsie.com>

	* autogen.sh: Now that omf.make has been removed, we should really tell
	gnome-common that we are using USE_COMMON_DOC_BUILD.

	* src/gpm-tray-icon.c: Fix the !libnotify build.
	Also switch HAVE_LIBNOTIFY to LIBNOTIFY_VERSION_MINOR >=2 so we can
	easily build with scons.

	* src/gpm-stock-icons.c: Fix the scons build by including config.h

	* po/*: Do a intltool-update --pot && make update-po to freshen up the
	translations.

	* src/gpm-dbus-client.{h|c}, src/Makefile.am, po/POTFILES.in:
	Remove these non-required files. (#327236)

	* data/gnome-power-manager.schemas.in:
	Update the descriptions, and add a few more <short> and <long> tags.
	Remove the hard-drive spindown keys also, we don't use them anymore.
	Also make all the time values in seconds.

	* src/gpm-idle, src/gpm-manager.c, src/gpm-prefs.c: Update, as now all
	the gconf values are in seconds. (#327007)

	* src/gpm-power.c (add_battery): Add a warning for a low capacity
	battery, to start to fix (#326740) -- yet more work required.

2006-01-14  William Jon McCann  <mccann@jhu.edu>

	* data/gpm-prefs.glade: A few HIG spacing fixes.  This makes
	it look the same as g-v-m.

2006-01-13  Richard Hughes  <richard@hughsie.com>

	* src/gpm-power.c: Fix newline logic to be the same as before (so it
	doesn't truncate the last bracket in some cases).
	Also replace spaces-for-tabs in this file with actual tabs.

	* src/gpm-marshal.list, src/gpm-manager.c, src/gpm-power.c:
	Add a parameter 'charging' and 'percentagechanged' which lets us veto
	some actions when doing the initial startup. This stops the message
	'Your battery is fully charged'	when starting g-p-m with a full battery.
	Also unconditionally send a signal battery-power-changed when *any*
	battery property changes, so that the icon changes when !charging
	as this was not being done.

	* MAINTAINERS: I have a name, I am not an email address.

	* CodingStyle: Update with suggestions from (#326515)

	* src/gpm-power.c (battery_kind_cache_update): Always send a
	BATTERY_POWER_CHANGED signal when devices disappear.

	* src/gpm-power.c (gpm_power_get_battery_percentage): Return false
	when a BatteryKindCacheEntry is marked as not present, as ACPI
	batteries are not removed from HAL when they are removed.
	This fixes (#326865)

	* docs/www/*.html: Update the archive links, and make sure the header
	is bold for each section.

	* src/gpm-tray-icon.c (gpm_tray_icon_show_help_cb):
	Replace spaces-for-tabs with actual tabs.

2006-01-12  William Jon McCann  <mccann@jhu.edu>

	* src/gpm-power.[ch]: New powered device handling.

	* src/gpm-prefs.c: Fix compiler warning.

	* src/gpm-marshal.list: Add new one.

	* src/gpm-manager.xml: Remove set_on_ac from API.

	* src/gpm-manager.[ch]: Don't manage on-ac state.
	(get_stock_id): Remove all sysdev stuff.  Use gpm-power.
	(tray_icon_update): Get summary from gpm-power.
	(sync_dpms_policy): Use gpm-power for on-ac.
	(maybe_notify_battery_power_changed): Update for gpm-power.
	(gpm_manager_get_on_ac, dpms_mode_changed_cb)
	(power_button_pressed, suspend_button_pressed)
	(lid_button_pressed, power_button_pressed_cb)
	(power_battery_power_changed_cb, gpm_manager_set_property)
	(gpm_manager_get_property, callback_gconf_key_changed)
	(gpm_manager_init, gpm_manager_finalize): Updates for gpm-power

	* src/gpm-main.c: Fix compiler warnings.

	* src/gpm-hal-monitor.c: Remove core and sysdev.  Make
	into a singleton.  Make signals a bit more generic.
	Primarily serve as a HAL proxy.

	* src/gpm-hal-callback.h: Fix prototypes.

	* src/gpm-dpms.h: Fix typo.

	* src/Makefile.am: Remove gpm-core and gpm-sysdev.
	Use found glib-genmarshal.

	* configure.in: Look for glib-genmarshal. Add
	extra warnings when building from CVS.

	Fixes #326515

2006-01-12  Richard Hughes  <richard@hughsie.com>

	* po/POTFILES.in: Remove gpm-dbus-signal-handler.{c|h} to fix
	make diskcheck.

	* src/gpm-hal.c (gpm_hal_can_suspend), (gpm_hal_can_hibernate):
	Fix logic so that is key is missing we do not do the action.
	Fixes bug #326552

2006-01-11  William Jon McCann  <mccann@jhu.edu>

	* src/gpm-tray-icon.c: Add missing includes.

	* src/gpm-sysdev.c (hal_to_device_type): Moved here from gpm-common.

	* src/gpm-prefs.c: Add missing includes.

	* src/gpm-manager.c: Add include for gnome-client.h and sysdev.
	(_gpm_manager_can_suspend, _gpm_manager_can_hibernate)
	(_gpm_manager_can_shutdown): Add functions to use instead of
	calling HAL directly.
	(get_stock_id): Use our own on_ac property instead of calling HAL.
	(get_full_tooltip): Ditto.
	(gpm_manager_shutdown, gpm_manager_hibernate)
	(gpm_manager_suspend): Call our own _can_ functions.
	(gpm_manager_setup_tray_icon): Ditto.

	* src/gpm-main.c
	* src/gpm-dbus-signal-handler.c: Moved functionality to gpm-main.

	* src/gpm-core.c: Include sysdev here.

	* src/gpm-common.[ch]: Don't depend on sysdev.  Don't use gnome.h
	and gconf.

	* src/Makefile.am: Remove gpm-console and gpm-dbus-signal-handler

2005-01-11  Richard Hughes  <richard@hughsie.com>

	* src/Makefile.am, src/gpm-dbus-client.c, src/gpm-idle.c,
	src/gpm-hal.c, src/gpm-hal-callback.c, src/gpm-idle.c,
	src/gpm-manager.c, src/gpm-screensaver.c, src/gpm-prefs.c:
	Remove gpm-dbus-common from all the files. This file was originally
	used when the DBUS API was churning so all the changes could be done
	in one place. Now the glib DBUS api is stable, hardcode these simple
	functions in the respective places.

2006-01-10  William Jon McCann  <mccann@jhu.edu>

	* src/gpm-manager.c (hal_power_button_cb, hal_lid_button_cb):
	Add debug statements.

2006-01-10  William Jon McCann  <mccann@jhu.edu>

	* src/gpm-manager.c (manager_policy_do)
	(gpm_manager_tray_icon_hibernate, gpm_manager_tray_icon_suspend):
	Actually do the action.  Forgot to fix this after Richard
	asked me to the other day.

2006-01-10  William Jon McCann  <mccann@jhu.edu>

	* src/gpm-manager.c (sync_dpms_policy):
	Check errors.
	(gpm_manager_set_dpms_mode, gpm_manager_get_dpms_mode)
	(idle_changed_cb, dpms_mode_changed_cb, hal_lid_button_cb):
	Report errors back to DBUS.
	(gpm_manager_init): Rename signal.

	* src/gpm-dpms-x11.c (gpm_dpms_error_quark): Add errors.
	(x11_sync_server_dpms_settings): Set errors.
	Also allow zero timeouts as this is how we'll disable
	DPMS now that we enable it by default.
	(x11_get_mode, x11_set_mode): Use a more DBUSy
	design.
	(sync_settings): Use zero for timeouts instead of
	our configured ones when DPMS isn't active.
	(gpm_dpms_get_enabled, gpm_dpms_set_enabled, gpm_dpms_get_active)
	(gpm_dpms_set_active, gpm_dpms_set_timeouts):
	Use DBUSy design.
	(gpm_dpms_set_mode): Allow mode to be set even
	if DPMS is not active.
	(gpm_dpms_get_mode): DBUSy design.
	(gpm_dpms_set_standby_timeout, gpm_dpms_set_suspend_timeout)
	(gpm_dpms_set_off_timeout): Setters for properties.
	(gpm_dpms_set_property, gpm_dpms_get_property)
	(gpm_dpms_class_init): Add properties and rename signal.

	Changes to allow setting DPMS mode while DPMS is not active
	and to report errors back to DBUS.

2005-01-10  Richard Hughes  <richard@hughsie.com>

	* src/icons/*: Move to data/icons/24x24

	* data/icons/svg: Add the svg images here too.

2006-01-10  William Jon McCann  <mccann@jhu.edu>

	* src/gpm-screensaver.c:
	* src/gpm-manager.xml:
	* src/gpm-main.c:
	* src/gpm-idle.c:
	* src/gpm-dbus-common.h:
	* src/gpm-dbus-client.c:
	* src/gpm-console.c (signalhandler_nlost):
	* docs/www/faq.html:
	* data/gnome-power-manager.service.in:
	* data/gnome-power-manager.conf:
	Rename DBUS services.  GnomePowerManger -> PowerManager
	and screensaver -> ScreenSaver.  Fixes #326492

2005-01-10  Richard Hughes  <richard@hughsie.com>

	* src/gpm-manager.c: Add some debug text so we know the state.

	* src/gpm-dpms-x11.c (gpm_dpms_mode_from_string): Fix typo where
	'on' should be GPM_DPMS_MODE_ON rather than GPM_DPMS_MODE_OFF.

	* Makefile.am: Use DISTCHECK_CONFIGURE_FLAGS (copied from evince)
	so make diskcheck doesn't try to run scrollkeeper.

	* help/Makefile.am: Enable yelp file build.

	* data/gnome-power-manager.spec.in: Add the two files to the file list.

	* src/gpm-tray-icon.c (gpm_tray_icon_show_help_cb): Now use yelp
	help-pages rather than just displaying the webpage -- note these
	need serious love.

	* src/gpm-stock-icons.c (gpm_stock_icons_init): Replace
	GTK_ICON_SIZE_LARGE_TOOLBAR with GTK_ICON_SIZE_MENU as we want the
	smaller icons used in the tray.

	* man/gnome-power-info.sgml: remove as unused.

	NEWS, configure.in: Update to 0.3.4, as I think enough work has been
	done to constitute a release bump. :-)

2006-01-09  William Jon McCann  <mccann@jhu.edu>

	* src/gpm-manager.xml: Mark return string as constant.

	* src/gpm-manager.[ch] (gpm_manager_set_on_ac)
	(gpm_manager_get_on_ac, gpm_manager_set_dpms_mode)
	(gpm_manager_get_dpms_mode, hal_on_ac_changed_cb)
	(gpm_manager_set_property, gpm_manager_init):
	Change functions to actually work with the DBus bindings.

2005-01-09  Richard Hughes  <richard@hughsie.com>

	* configure.in, Makefile.am, help/Makefile.am: Still process the
	help directory, just disable the scrollkeeper update for now.

	* data/gnome-power-manager.spec.in: Don't use this for cvs building
	anymore, so make it generic.

	* docs/dbus-interface.txt: Add this file explaining the DBUS interface.

2006-01-09  William Jon McCann  <mccann@jhu.edu>

	* src/gpm-manager.c (gpm_manager_set_on_ac): Emit a
	signal when on-ac changes.
	(gpm_manager_set_dpms_mode, gpm_manager_get_dpms_mode):
	Add API for DPMS mode.
	(dpms_changed_cb): Emit a signal when DPMS mode changes.
	(gpm_manager_class_init): Add signals.

	* src/gpm-main.c (gpm_object_register): Move here
	from gpm-dbus-server.
	(main): Connect manager to bus.

	* src/gpm-dpms-x11.c (gpm_dpms_mode_from_string)
	(gpm_dpms_mode_to_string, gpm_dpms_set_mode):
	Add method to translate from enum to string and back.

	* src/Makefile.am: Remove gpm-dbus-server.*
	Rename gnome-power-service.xml to gpm-manager.xml.

	Fixes #326307

2006-01-09  Jaap Haitsma  <jaap@haitsma.org>

	* src/gpm-common.[ch]: Remove unused functions

2005-01-09  Richard Hughes  <richard@hughsie.com>

	* src/gpm-prefs.c (gpm_prefs_create): hide radiobutton_icon_charge
	and radiobutton_icon_critical when we do not have any batteries (as
	these states make no sense).

	* src/gpm-tray-icon.c (libnotify_event): Fix a small typo that
	prevented building with the old libnotify.

2006-01-09  William Jon McCann  <mccann@jhu.edu>

	* src/gpm-tray-icon.c (libnotify_event)
	(gpm_tray_icon_action_entries): Use #defined icon names.

	* src/gpm-stock-icons.c (gpm_stock_icons_init):
	Add gnome-icon-theme icons to factory.  Add #defines for
	icon names.

2006-01-09  William Jon McCann  <mccann@jhu.edu>

	* src/gpm-dpms.h:
	* src/gpm-dpms-x11.c: New class to control DPMS.

	* src/gpm-screensaver.[ch]: Remove DPMS stuff.

	* src/gpm-prefs.c (gpm_prefs_create): Don't use
	C99 declarations that aren't at the top of a block since
	it breaks under non-C99 compliant compilers.  Always
	enable DPMS.
	(main): Rename function in case we want to turn it into
	a class later.

	* src/gpm-manager.c (change_power_policy): Don't
	set session timeout.  Sync DPMS settings.
	(sync_dpms_policy): Sync all DPMS settings.
	(idle_changed_cb): Activate/deactivate DPMS.
	(dpms_changed_cb): Throttle screensaver when screen not on.
	(hal_lid_button_cb): Turn monitor power on/off when lid changed.
	(callback_gconf_key_changed): Sync DPMS settings.
	(gpm_manager_init): Add DPMS object.
	(gpm_manager_finalize): Unref DPMS object.

	* src/gpm-idle.c (remove_all_timers, gpm_idle_set_mode)
	(gpm_idle_set_property, gpm_idle_get_property)
	(gpm_idle_class_init): Remove session timeout since
	it isn't used and is broken.
	(acquire_screensaver, gpm_idle_init): Break out function.

	* src/Makefile.am: Add gpm-dpms.

	* configure.in: Check for DPMS ext.

	Fixes #326276

2006-01-08  William Jon McCann  <mccann@jhu.edu>

	* src/gpm-tray-icon.[ch]: New class to encapsulate
	tray icon and notification handling.

	* src/gpm-manager.c (get_index_from_percent, get_stock_id)
	(get_tooltip_system_struct, get_tooltips_system_device)
	(get_tooltips_system_device_type, get_full_tooltip)
	(tray_icon_update): Moved here from gpm-notification.c.
	Fix to support GpmTrayIcon.
	(maybe_notify_on_ac_changed, maybe_notify_battery_power_changed):
	Move all notification stuff to tray icon.
	(callback_gconf_key_changed): Update the tray icon.
	(gpm_manager_tray_icon_hibernate, gpm_manager_tray_icon_suspend):
	Add signal handlers.
	(gpm_manager_setup_tray_icon): Create the tray icon.
	(gpm_manager_init): Update/create the tray icon.
	(gpm_manager_finalize): Destroy the tray icon.

	* src/Makefile.am: Remove gpm-libnotify.{c,h} and
	gpm-notification.{c,h}. Add gpm-tray-icon.{c,h}.

	Fixes #326241

2006-01-08  William Jon McCann  <mccann@jhu.edu>

	* src/gpm-manager.[ch]: New class to act as a management
	shell.

	* src/gpm-hal-monitor.[ch]: New class to encapsulate all
	the HAL monitoring.

	* src/gpm-screensaver.h: Add G_BEGIN_DECLS and glib includes.

	* src/gpm-notification.c (callback_actions_activated):
	Disable the actions temporarily until we can use signals
	to do this cleanly.

	* src/gpm-marshal.list: Add new signal for battery
	status changed.

	* src/gpm-main.c: Move functionality out of here and
	split into GpmManager and GpmHalMonitor.

	* src/gpm-idle.[ch]: Turn into a class for monitoring
	the session and system idle.

	* src/gpm-hal.h: Add G_BEGIN_DECLS and glib includes.

	* src/gpm-hal-callback.[ch] (signal_handler_PropertyModified)
	(signal_handler_DeviceRemoved, signal_handler_NewCapability)
	(signal_handler_Condition, gpm_hal_callback_init):
	Add user data to be returned to callbacks.

	* src/gpm-dbus-server.[ch]: Don't use gnome.h.  Don't
	export signal enum.
	* src/Makefile.am: Add new files.
	* AUTHORS: Updated.

	Refactored to support handling signals from gnome-screensaver,
	laying groundwork for DPMS management, and making HAL
	optional. Fixes #325911.

2005-01-06  Richard Hughes  <richard@hughsie.com>

	* data/: src/gnome-power-preferences.glade,
	gnome-power-manager.conf, gnome-power-manager.schemas.in,
	gnome-power-manager.service.in, gnome-power-manager.spec.in,
	gnome-power-preferences.desktop.in: Move these files to this new
	directory to match other gnome projects:

2005-01-05  Richard Hughes  <richard@hughsie.com>

	* gnome-power-manager.schemas.in, src/gpm-main.c, src/gpm-prefs.h:
	Add /notify/fully_charged to fix bug:
	#325876

	* src/Makefile.am: Build the generated files a slightly easier way, as
	suggested by BJörn Lindqvist.
	Also comment out the gnome-power-console stuff until the DBUS bug is
	fixed -- as now it's pretty useless.

	* configure.in: Fix the ALL_LINGUAS to be all on one line, else
	autogen.sh fails.

	*configure.in, Makefile.am: Don't build help/ yet as
	'make distcheck' fails (which means no rpm's)

2006-01-03  Slobodan D. Sredojevic  <ssl@uns.ns.ac.yu>

	* configure.in: Added 'sr' and 'sr@Latn' to ALL_LINGUAS

2006-01-03  Anders Pedersen <anders@zredna.dk>

	* src/gpm-notification.c : fixed typo where global variable
	where used instead of passed parametre

2005-12-30  Jaap Haitsma  <jaap@haitsma.org>

	* src/gpm-prefs.c : removed require pw option. We just rely on
	gnome-screensaver for this now

	* src/gpm-prefs.glade : removed require pw option.

2005-12-30  Jaap Haitsma  <jaap@haitsma.org>

	* src/gpm-prefs.c : refactored slider format callbacks
	Added a line that Richard and myself are the authors of this file

2005-12-30  Jaap Haitsma  <jaap@haitsma.org>

	* configure.in : remove -ansi compiler option to fix daemon warning

	* src/gpm-main.c: remove daemon prototype

	* src/gpm-console.c: remove daemon prototype

2005-12-30  Richard Hughes  <richard@hughsie.com>

	* man/: Move manual files here.

	* help/: Add this directory for the yelp help files.

	* configure.in, Makefile.am, docs/Makefile.am: Fix build to work.

2005-12-29  Richard Hughes  <richard@hughsie.com>

	* gnome-power-manager.spec.in: Add 'Requires: dbus-x11' to fix
	rh:176656

	* src/gpm-sysdev.{c|h}, src/gpm-console.c, src/gpm-core.c,
	src/gpm-main.c, src/gpm-notification.c:
	Replace all the SysDev functions with gpm_sysdev_ to closer match
	GNOME CodingStyle.

	* src/gpm-hal.c (gpm_hal_is_on_ac): Fix for the case of a desktop,
	where there is no ac_adapter.

	* src/gpm-screensaver (gpm_screensaver_get_idle): Do a
	s/getIdleTime/getActiveTime to update to the new API.

2005-12-28  Richard Hughes  <richard@hughsie.com>

	* src/gpm-prefs.c, src/gpm-main.c, src/gpm-screensaver.{c|h}:
	Much modified patch from Jaap to use the gnome-screensaver
	screensave enable gconf key, rather than our own complete replacement.

2005-12-26  Jaap Haitsma  <jaap@haitsma.org>

	* src/gpm_marshal.list: rename to gpm-marshal.list

	* src/Makefile.am : change gpm_marshal.{c|h} to gpm-marshal.{c|h}

	* src/gpm-dbus-common.c: change gpm_marshal.h to gpm-marshal.h

	* src/gpm-hal-callback.c: change gpm_marshal.h to gpm-marshal.h

2005-12-26  Richard Hughes  <richard@hughsie.com>

	* src/gpm-prefs.c: Patch from Jaap: Suspend is still using battery so
	for a critical level of the battery suspend is not viable option.

2005-12-24  Richard Hughes  <richard@hughsie.com>

	* src/gpm-prefs.c: Don't hardcode acpi_BAT1, but work out the name
	using the capability.

	Another mega patch from Jaap. I've merged the obvious bit for now,
	and when I've reviewed the rest I'll commit that too.

	* Renamed some function like gpm_screensaver_set_dpms to
	gpm_screensaver_enable_dpms. This way it's immediately clear what the
	argurment TRUE or FALSE does.

	* Some other renames which should make the code clearer.

	* Fixes a couple of minor bugs

	* Moved some definition from *.h to *.c. It's good practice to export
	as little as possible.

2005-12-23  Richard Hughes  <richard@hughsie.com>

	* src/*: Rename the local dbus_* wrappers gpm_dbus_* to make sure
	it's obvious that they are local functions and not the direct API.

	* gnome-power-manager.conf: Add root to the allowed users. Required
	for replacement without a GUI running.

	* src/gpm-dbus-signal-handler.{c|h}: Add these files to abstract the
	DBUS NameOwnerChanged and NameLost glib functionality.

	* src/glibhal-callback.{c|h}: Remove the NameOwnerChanged bodged
	support from these files. It never belonged here..

	* src/Makefile.am, src/gpm-console.c, src/gpm-dbus-common.c,
	src/gpm-main.c: Use gpm-dbus-signal-handler and start to implement
	NameLost functionality for a shared bus. Also pass more connections
	by reference, rather than assuming then are system or session.

	* src/gpm-hal.c: Move gpm_hal_is_running here, and delete the copy in
	glibhal-main.

	* src/gpm-dbus-common.{c|h}, src/gpm-main.c, src/gpm-dbus-server.c:
	Make USECACHE an ifdef to try and profile.
	Also add GPM_SYSTEM_BUS so we can put g-p-m on the system bus if
	we want, so it can be shared between users. This cannot be turned on
	until https://bugs.freedesktop.org/show_bug.cgi?id=4637 is fixed.

	* src/gpm-hal.c: Fix valgrinds 'Conditional jump or move depends on
	uninitialised value(s)' by initialising the return value to 0.

	* src/gpm-dbus-common.h, src/glibhal.c, src/glibhal-callback.c,
	src/gpm-hal.c, src/gpm-main.c: Define the HAL_DBUS_* constants and
	use them in preference to hardcoding each name.

	* src/glibhal-main.{c|h}: Merge the remainder of these functions into
	gpm-hal.{c|h} and prefix the functions with gpm_ for clarity.

	* src/glibhal-callback.{c|h}: Move these functions into
	gpm-hal-callback.{c|h} and prefix the functions with gpm_ for clarity.

2005-12-22  Richard Hughes  <richard@hughsie.com>

	* src/gpm-prefs.c: If no valid options are available then disable
	the 'Actions' frame as it will be empty.

	* src/gpm-prefs.h, src/gpm-main.c, gnome-power-manager.schemas.in:
	Implement /apps/gnome-power-manager/notify/ac_adapter so we can
	disable this message if we want to. Fixes the bug:
	rh:176433

	* src/gpm-libnotify.{c|h}, src/gpm-notification.c, src/gpm-main.c:
	Rename the local libnotify_* wrappers gpm_libnotify_* to make sure
	it's obvious that they are local functions and not the direct API.

2005-12-21  Richard Hughes  <richard@hughsie.com>

	* src/gpm-prefs.c: Only hide the battery stuff in the advanced
	tab, and fix to actually hide the correct label in Options.

	* src/gpm-notification.c: Don't g_free eggtrayicon->popup_menu
	or eggtrayicon->tray_icon_tooltip else we segfault on rawhide.

	* src/gpm-main.c: Assume we are on AC power (desktop) if we have
	no batteries or ac_adapters detected. Fixes a problem with g-p-m
	running on a VMWware host thinking we are on batteries.

	* src/gpm-libnotify.c: Use widget->allocation to get size to avoid
	having to ref the pixbuf. Also make lots of libnotify 0.3.x
	fixes. I think notify-daemon has a positioning bug...

	* src/gpm-idle.c: Only print debug messages once.

2005-12-20  Richard Hughes  <richard@hughsie.com>

	* src/gpm-prefs.c: Hide, process, then show the top window so that
	the dialogue resizes itself without redrawing.
	Fixes #323562

	* gnome-power-manager.spec.in: Apply a patch from Matthias Saou to
	fix rh:172963

2005-12-19  Richard Hughes  <richard@hughsie.com>

	* src/eggtrayicon.c, src/gpm-prefs.c: Update so that if gnome-panel
	disappears we just re-instantiate the icon without crashing.
	Fixes #324446

	* src/gpm-sysdec.{c|h}, gpm-notification.c: Add the sd->isPresent
	flag so we can detect when an sd has no present sds members.
	Fixes #323563

2005-12-19  Nikos Charonitakis  <nikosx@gmail.com>

	* configure.in: Added 'el' to ALL_LINGUAS.

2005-12-19  Ankit Patel  <ankit644@yahoo.com>

        * configure.in: Added 'gu' to ALL_LINGUAS.

2005-12-18  Richard Hughes  <richard@hughsie.com>

	* src/glibhal-extras.{c|h}: Rename to gpm-hal.{c|h} and prefix the
	functions with 'gpm_'. Affects most of the other souce files!

	* src/gpm-info.{c|h|glade}: Removed until we have a point.

	* src/gpm-gtk-utils.{c|h}: Removed as unused.

	* src/compiler.h: Removed as now unused.

	* configure.in: Make warnings stop build. Fix said warnings.

	* src/gpm-prefs.c: Don't use a pointer like a global variable, else
	it bites back. Use INT_TO_POINTER to wrap it up nicely.

	* src/gpm-hal.c, src/gpm-prefs.c: Add gpm_hal_is_on_ac() so we can get
	rid of the gpm dbus dependance on gpp.

	* configure.in, src/gpm-libnotify.c: Automatically compile the correct
	code for the new libnotify. Thanks again to Jaap.

2005-12-17  Josep Puigdemont i Casamajó  <josep.puigdemont@gmail.com>

	* configure.in: Added 'ca' to ALL_LINGUAS.

2005-12-15  Richard Hughes  <richard@hughsie.com>

	* configure.in: Bump to 0.3.3, and depend on HAL CVS (0.5.6) as we need
	the new power_management keys and the Shutdown() method not present in
	0.5.5.1.

	* src/glibhal-extras.{c|h}, src/gpm-main.c, src/gpm-prefs.h:
	Create the function hal_shutdown () that lets us simplify the
	shutdown stuff, and take the magic string out of gconf.

	MASSIVE Patch from Jaap Haitsma <jaap@haitsma.org> with tweaks from me:

	* src/gpm-common.{c|h}: Move get_widget_position to gpm-libnotify.c
	Remove the enumerated types, and conversion functions, and remove
	the function run_gconf_script()

	* src/compiler.h: Remove as unused.

	* src/gpm-console: Refactor some code, and remove compiler definition.

	* src/gpm-core.c: Refactor some code, remove globals, fix up some
	wrong return values.

	* src/gpm-dbus-common.c: Include <string.h>

	* src/gpm-notification.c: Remove the enumerated types, and conversion
	functions. Other minor warnings fixed.

	* src/gpm-main.{c|h}: Added the constants for gconf.
	Make the policy change more centered. Remove helper functions.

	* src/gpm-networkmanager.c: Removed some unused variables.

	* src/gpm-prefs.glade: Step size update

	* src/gpm-screensaver.{c|h}: Removed some unused variables.
	Added the constants for gconf.

	* src/gpm-sysdev.{h|c}: Mark the debug functions as such, and use the
	debug functions.

2005-12-11  Theppitak Karoonboonyanan  <thep@linux.thai.net>

	* configure.in: Added 'th' (Thai) to ALL_LINGUAS.

2005-12-10  Richard Hughes  <richard@hughsie.com>

	* src/gpm-dbus-common.c: Cache the dbus connection in two private
	pointers so we don't have to keep doing dbus_g_bus_get everytime we
	want the bus address.

2005-12-07  Richard Hughes  <richard@hughsie.com>

	* src/gpm-common.{c|h}, src/gpm-main.c, src/gpm-prefs.c:
	Remove ACTION_WARNING as nothing uses it. Also make the critical
	warning happen at the critical threshold, and any action performed when
	it gets lower than that. This will stop the PC randomly shutting down
	without giving a critical warning a few minutes before.

	* src/gpm-main.c (gnome_shutdown): Create this function so we can
	save the state interactivly for the case of a power button, or save
	the state non-interactivly for the case of the power-critically-low
	case. Inspired by a patch from Jaap Haitsma <jaap@haitsma.org>.

	* src/gpm-prefs.c, gnome-power-manager.schema.in:
	Remove the options for the power button, as we now display the menu
	(which remembers our state, so we don't need a configurable).
	Patch from Jaap Haitsma <jaap@haitsma.org>, many thanks.

2005-12-03  Richard Hughes  <richard@hughsie.com>

	* src/gpm-common.h, src/gpm-main.c, gnome-power-manager.schemas.in:
	Remove the reboot command as it's not used, and probably shouldn't be
	part of g-p-m anyway. Taken from a larger patch from
	Jaap Haitsma <jaap@haitsma.org>.

2005-12-03  Richard Hughes  <richard@hughsie.com>

	* src/glibhal-extras.c: Now upstream HAL is using the new
	power_management.* keys, we should not be checking .is_enabled as this
	has been removed in CVS.

	* src/gpm-common.c (get_timestring_from_minutes): Use ngettext to get
	plural form. Based on a patch from Gabor Kelemen, many thanks.
	Fixes bug #322773

	* src/gpm-main.c: Add in the virtual buttons Hibernate, Suspend and
	Lock.

	* src/gpm-screenaver.c: Do not expect a DBUS answer when we lock or
	poke as we have to wait for the dbus connection to time out.

	* src/gpm-main.c: Replace use of get_time_string with the data itself.
	Fixes bug: #323135

	* src/gpm-common.c (get_time_string): Remove this function as it is
	no longer in use.

2005-12-01  Richard Hughes  <richard@hughsie.com>

	* configure.in: Bump to 0.3.2

	* src/glibhal-extras.{h|c}: Move hal_pm_check() here, and create the
	new methods hal_pm_can_suspend() and hal_pm_can_hibernate().
	Also add hal_set_brightness_up() and hal_set_brightness_down () so
	we can start to play around with new HAL stuff.

	* src/gpm-main.c: Warn if we attempt to hibernate or suspend when HAL
	says we shouldn't.

	* src/gpm-main.c: Add support for the HAL 'virtual button' device.
	NB. This is not yet in HAL CVS, and support is patched in only if you
	use the RPM's in my utopia-experimental repo. The interface WILL change
	before it is accepted upstream.

	* src/gpm-notification.c: Don't add the menu items if we can't do the
	actions. NOTE: just because HAL (i.e. the kernel) says it has
	hibernation or suspend support compiled in, doesn't automatically
	mean that it will *work*.

	* src/gpm-prefs.c: Don't show the options if we can't do the action.
	Also make the whitespace a bit more sane in this file.

	* src/gpm-prefs.c: Don't try to free a constant if schema missing.
	Fixes bug: rh:174196

2005-11-28  Richard Hughes  <richard@hughsie.com>

	* src/gpm-notification.c (gpn_icon_update): Don't try to free a
	constant, i.e. use g_strdup so we unconditionally free the string.
	This bug only appears when the gconf schema isn't being applied,
	which is probably a packaging bug.

2005-11-28  Ignacio Casal Quinteiro  <nacho.resa@gmail.com>

	* configure.in: Added 'gl' to ALL_LINGUAS.

2005-11-27  Richard Hughes  <richard@hughsie.com>

	* src/gpm-main.c (perform_power_policy): Create this new function
	so we can put all the common code together. This also lets us sets
	all the settings in one place, so we can now do every power saving
	action simply when we are booted from battery. This fixes the bug where
	the brightness wasn't being set on boot.

	* src/gpm-main.c (perform_sleep_methods): Put all the common code in
	one place so we can set the password resume policy in one place.

	* gnome-power-manager.schemas.in: Add general/require_password to
	signify if we require a password when resuming from suspend.

	* src/gpm-prefs.c, src/gpm-prefs.glade:
	Add the required widgets to control 'general/require_password'

	* configure.in: Bump HAL dep to 0.5.4 as using 0.5.3 doesn't work
	correctly with Ubuntu breezy HAL, which is causing lots of bug reports.

	* gnome-power-manager.spec.in: Remove the prefix line as it's not
	correct, and the rpm builds fine without it.

	* src/gpm-notification.h, src/gpm-notification.c:
	Fix the problem where the About window's content is not localizable.
	Apply a patch from Gabor Kelemen that makes it localizable.
	Fixes #322547

2005-11-26  Marcel Telka  <marcel@telka.sk>

	* configure.in (ALL_LINGUAS): Added sk.

2005-11-26  Richard Hughes  <richard@hughsie.com>

	* gnome-power-manager.schemas.in:
	Default to suspend on lid close on advice of Havoc Pennington, to
	address bug rh:174160
	Also make /apps/gnome-power-manager/policy/sleep_type to type suspend
	as nothing is no longer a valid option.

	* configure.in:
	Bump to 0.3.1

	* src/gpm-notification.c:
	Disable 'Power Info' from the menu until we show something interesting.

	* gnome-power-preferences.desktop.in:
	Rename 'Power Preferences' to 'Power Management' to better fit in with
	the other menu items.

2005-11-21  Richard Hughes  <richard@hughsie.com>

	* src/gpm-prefs.c, src/gpm-prefs.glade:
	Merge a patch by Jaap Haitsma <jaap@haitsma.org>:
	- Changed vertical spacing between some items in dialog from 4 to 6
	pixels (HIG says it should be 6)
	- All capplets have the dialog hint set for the window so they don't
	have a minimize button.
	- Removed the setting from the icon from the glade file to the C file.

2005-11-21  Richard Hughes  <richard@hughsie.com>

	* src/gpm-prefs.c, src/gpm-prefs.glade:
	Merge a patch by Jaap Haitsma <jaap@haitsma.org>:
	Split the General section in the options Tab to two sections:
	General and Actions. Tweaked by me.
	Furthermore it changes accesskeys of some labels to more sensible keys.
	Also remove the gnome-screensaver button now g-p-m is less tied into
	g-s with the DPMS settings.

	* src/gpm-core.{c|h}:
	Add the core, abstracted interfaces so we can use them with a console
	program. Taken from gpm-main.c.

	* src/gpm-console.c:
	Add the beginning of a console g-p-m for GDM.

	* src/gpm-common.{c|h}:
	Re-organise with the console muddle.

	* src/gpm-idle.c, src/gpm-info.c, src/gpm-main.c,
	src/gpm-screensaver.{c|h}:
	s/gscreensaver_/gpm_screensaver/g for consistancy.
	Also add gpm_screensaver_poke so we can interrupt the screensaver
	instead of waiting for a keypress.

2005-11-17  Richard Hughes  <richard@hughsie.com>

	* src/gpm-networkmanager.{c|h}:
	Add methods to call NetworkManager to tell it to sleep or wake during
	the suspend/resume calls. This isn't connected into the build yet
	as we have to solve 3 sec timeout problem when NM isn't running.

	* src/glibhal-extras.c:
	If the manufacturer is IBM, then assume we are a ThinkPad,
	and don't do the new-fangled dimming routine. The ThinkPad dims
	gently itself. This fixes the bug:
	rh:173382

	* src/gpm-dbus-common.{c|h}:
	Add dbus_is_active_service so we can print and search the services
	on the system bus.

	* src/gpm-screensaver.{c|h}, src/gpm-prefs.c, src/gpm-idle.c:
	First, do s\gscreensaver_\gpm_screensaver_\g to be consistant.
	Also add gpm_screensaver_poke() to allow us to 'poke' g-s so we can
	displays the unlock dialogue, so the user doesn't have to move the
	mouse or press any key.

2005-11-15  Richard Hughes  <richard@hughsie.com>

	* src/gpm-main.c, src/gpm-info.c, src/gpm-prefs.c, src/gpm-prefs.glade,
	src/icons/Makefile.am:
	Merge a patch by Jaap Haitsma <jaap@haitsma.org>:
	- 'Never' on the right of the sleep sliders
	- Sleep sliders range from 1 to 60 minutes with steps of 1 minute
	- In Makefiles GPM_DATA had a trailing slash. This is not common.
	- Some code refactoring: There was now one callback handling all the
	different sliders. Since there are three types of sliders:
	1. Setting sleep time
	2. Setting disply brightness
	3. The low and critical threshold
	That callback became quite messy. So instead of 1 difficult to
	understand I made 3 of them which should be quite easy to understand.

	* src/gpm-notification.c: display the charged icon whenever we are
	not discharging and not charging as opposed to when at 100% as some
	batteries will never get to the maximum value.
	Should fix #321034

2005-11-14  Richard Hughes  <richard@hughsie.com>

	* src/gpm-main.c, src/gpm-prefs.c:
	Merge a patch by Jaap Haitsma <jaap@haitsma.org>:
	- Make gpm use the standard gnome way to do command line parsing
	(using popt).
	- Furthermore after a gnome_program_init there is no need to do a
	gtk_init, g_type_init etc. because gnome_program_init already does this.
	- Also, gpm-prefs did not have the standard calls to bindtextdomain etc.

2005-11-13  Richard Hughes  <richard@hughsie.com>

	* src/gpm-screensaver.{c|h}: Add gscreensaver_set_dpms() to solve the
	case where the laptop backlight isn't being turned off when the
	lid goes down. For the time being, we'll use the hack that is xset,
	but when (if?) gnome-screensaver supports a DBUS method we'll switch
	to that. Should solve #321313

	* src/gpm-main.c: Use gscreensaver_set_dpms on the lid events.

	* po/nl.po: Updated, thanks Theetjuh.

	* src/Makefile.am: Add the extra director defines.

2005-11-10  Richard Hughes  <richard@hughsie.com>

	* src/gpm-sysdev.c: Create a helper function sysDevGetIndex so we don't
	have to bounds check every request, and cast in every call.

	* src/icons/gnome-power-ac-charged.png,	src/gpm-notification.c,
	src/gpm-stock-icons.{c|h}:
	Remove the charging symbol when the battery is at 100% and not charging.

	* docs/www/packages.html: Add info about running HAL as root in breezy.

2005-11-10  Richard Hughes  <richard@hughsie.com>

	* src/gpm-notification.h: Give credit to the translators.

	* src/gpm-main.c, gpm-sysdev.c: Rearrange the icon processing so it's
	done *after* the sysdev update.

2005-11-10  Alexander Shopov  <ash@contact.bg>

	* configure.in: Added 'bg' (Bulgarian) to ALL_LINGUAS

2005-11-10  Fabio Marzocca  <thesaltydog@gmail.com>

	* po/ChangeLog:
	* po/it.po:

	Updated italian translation

2005-11-10  Ilkka Tuohela  <hile@iki.fi>

	* configure.in: Added Finnish (fi) to ALL_LINGUAS.

2005-11-10  Satoru SATOH <ss@gnome.gr.jp>

	* configure.in: Added Japanese (ja) to ALL_LINGUAS.

2005-11-10  Žygimantas Beručka  <zygis@gnome.org>

	* configure.in: Added Lithuanian to ALL_LINGUAS.

2005-11-09  Richard Hughes  <richard@hughsie.com>

	* po/: Update all the po files with the latest translations.

	* src/gpm-sysdev.c (sysDevUpdate): The ac_adapter charging thing was
	causing more trouble than it's worth...

2005-11-08  Richard Hughes  <richard@hughsie.com>

	* src/gpm-main.c, src/gpm-libnotify.{c|h}:
	Clear the libnotify box for where we add back the ac_adapter before
	the 'AC Power unplugged' message times out.

	* src/gpm-notification.c, src/gpm-main.c, src/gpm-prefs.glade,
	gpm-common.{c|h}, gpm-prefs.c:
	Make the notification icons into radio boxes and make the options sane.

2005-11-07  Richard Hughes  <richard@hughsie.com>

	* src/gpm-sysdev.c: Shortcut for the single battery case so we don't
	average over 1 each time. Might save a few CPU cycles.
	Also try to start to fix:
	rh:169158
	by multiplying the remainingTime by the number of devices present
	if one battery is discharging and others not. This assumes they have
	the same capacity, and needs to be fixed properly.

	* src/gpm-main.c: Don't use sysDevUpdateAll when we have the UDI and
	can work out the system device to do a specific sysDevUpdate.
	This should make g-p-m less processor hungry.

2005-11-06  Richard Hughes  <richard@hughsie.com>

	* src/gpm-notification.c, src/gpm-sysdev.c:
	Do not segfault when battery bay is empty, and only add present
	batteries to the calculations.
	Fixes #320658

	* src/gpm-notification.c: Check for discharging and charging instead
	of checking for 100%.
	Should fix #320836

	* src/gpm-sysdev.{c|h}, src/gpm-main.c: Add sd link to parent so we
	can find our device type. Update the correct battery type, not just
	BATT_PRIMARY on HAL event.

	* src/gpm-notification.c: Do not leak eggtrayicon by just hiding it,
	but properly unrealize it. This fixes the bug where the icon 'moved'
	across the notification area when it was repeatedly shown/hidden.

	* src/gpm-sysdev.{c|h}, gpm-main.c (hal_device_property_modified):
	Check that the battery is at 100%, AND of type 'primary' before
	notifying the user that their battery is charged :-)

2005-11-05  Richard Hughes  <richard@hughsie.com>

	* configure.in: Change libwnck dep to 2.10.0. Not sure what happened
	with that... Update version 0.2.10 as I have made MASSIVE changes
	to the internals of g-p-m.

	* src/gpm-sysdev.{c|h}: New files to abstract away the multiple device
	problem. We are not using the shitty slotData and VirtualType system
	anymore as it is not flexible and it not understandable.
	Imagine ripping out the Ford Fiesta engine and replacing it with a
	Ferrarri engine and you get the idea of the changes...
	This will let us support multi-batteries *much* better.

	* src/gpm-common.{c|h}: Rip out the old device structures and functions.
	This makes hughsie happy.

	* src/gpm-notification.c: Now we show the icons if low, or if we want
	to overrride for the primary battery. Anything else is crack.

	* src/gpm-libnotify.c: Now make all notifications replace the former,
	to stop notifications from piling up the screen. Also point to the
	bottom middle part of the icon, not the top left most point.

	* src/gpm-dbus-server.c, gpm-main.c: Replace use of statedata
	with onAcPower.

	* src/gpm-prefs.glade, gnome-power-manager.schemas.in, src/gpm-prefs.c:
	Remove the configurable option for ac_adapter removal
	(warning hardcoded). Also remove the Always Display textbox.

2005-11-01  Richard Hughes  <richard@hughsie.com>

	* configure.in: Bump to 0.2.9.2 as we have lots of new stuff to test.

	* src/gpm-notification.c: Replace create_icon_pixbuf () with
	get_stock_id_for_slot_data so we can use the new stock icons.

	* src/gpm-stock-icons.{c|h}: Add the extra icons.

	* src/gpm-common.{c|h}: Remove gpm_set_icon_with_theme () and
	gpm_icon_theme_fallback () as Jaap has provided a proper framework for
	us to use.

	* src/icons/*.png: Refactor icons to 24x24 to keep the HIG people happy
	and also so we can use the stock icons functionality.

	* src/icons/Makefile.am: Add new files gnome-power-mouse.png and
	gnome-power-keyboard.png as we will use these files soon for low
	device warning.

2005-10-31  Christopher Aillon  <caillon@redhat.com>

	* src/gpm-common.c:
	* src/gpm-common.h:
	Signature of get_time_string () and get_timestring_from_minutes ()
	now return gchar* instead of GString*
	Also, handle the case when we have multiple hours but only 1 minute
	and use commas to separate the units.

	* src/gpm-main.c:
	* src/gpm-notification.c:
	* src/gpm-prefs.c:
	Use gchar* instead of GString* for calls to get_time_string ()
	and get_timestring_from_minutes ()

2005-10-31  Richard Hughes  <richard@hughsie.com>

	* configure.in: Spring clean this file so it's readable.

	* CodingStyle: Update.

	* gnome-power-manager.spec.in: Use the dep values from autoconf.

	* gnome-power-manager.sgml,
	* gnome-power-preferences.sgml,
	* gnome-power-info.sgml: Move to docs/man/

2005-10-31  Dennis Cranston  <dennis_cranston@yahoo.com>

	* src/gpm-prefs.glade:  GNOME HIG fixes (spacing, mnemonics,
	and capitalization)

2005-10-31  Richard Hughes  <richard@hughsie.com>

	* src/gpm-main.c (main): Disable GNOME_RESTART_IMMEDIATELY as a couple
	of users are getting constant crashes that they can't kill.

2005-10-30  Richard Hughes  <richard@hughsie.com>

	* src/gpm-notification.c,
	* src/gpm-main.c,
	* src/gpm-common.h,
	* README,
	* gnome-power-manager.spec.in,
	* gnome-power-manager.sgml,
	* gnome-power-preferences.sgml,
	* gnome-power-info.sgml,
	* doc/www/*:
	s/gnome-power.sf.net/http://www.gnome.org/projects/gnome-power-manager/

2005-10-30  Richard Hughes  <richard@hughsie.com>

	* Configure.in: Default to off for doxygen documentation as most users
	do not need these (and this saves us time for each compile).
	Also bump to 0.2.9, as we are introducing new functionality.

	* src/gpm-notification.c: Fix up the menu to be more in line with
	GNOME HIG. Thanks to Jaap Haitsma <jaap@haitsma.org> for the patch.

	* src/gpm-main.c: remove the last bits of the 'registered' gslist.
	Also invalidate the remaining time on battery.rechargeable.is_charging
	as we need to wait for the next HAL update. This is a HAL bug I think.

	* src/gpm-prefs.c: Use gtk_image_set_from_icon_name rather than
	our inbuilt functions.

	* src/gpm-stock-icons.{c|h}: This is the start for generic stock
	icons functionality. At the moment it just adds the ac_adapter icon,
	but it's expected to work for all the other icons too.
	Initial patch by Jaap Haitsma.

	* src/icons/: Move gnome-dev-acadapter.png and gnome-power.png here.

	* src/pixmaps/: Remove this directory as it is now not required.

2005-10-29  Christopher Aillon  <caillon@redhat.com>

	* src/gpm-libnotify.c:
	* src/gpm-libnotify.h:
	(libnotify_event) Add a new argument for setting the
	primary text of a notify event, and use it for calls to
	libnotify and its GtkMessageDialog fallback.

	* src/gpm-main.c:
	* src/gpm-prefs.c:
	Send descriptive primary text with libnotify_event () calls.

2005-10-29  Richard Hughes  <richard@hughsie.com>

	* gpm-notification.c (get_object_tooltip): Do not display
	'Unknown remaining' for missing remaining time.
	Fixes #320135

	* src/icons/gnome-power-keyboard.png,
	src/icons/gnome-power-mouse.png: New icons from Diana Fong to convey
	a low power USB mouse and keyboard. Many thanks!

	* docs/www: Update to the new HTML website design, in prep for moving
	to gnome.org hosting.

2005-10-27  Richard Hughes  <richard@hughsie.com>

	* docs/www/report_bug.php, src/gpm-main.c (main): don't ask people to
	report bugs directly to me, but use bugzilla.

2005-10-27  JP Rosevear  <jpr@novell.com>

	* src/gpm-dbus-server.c (gpm_object_register): don't assert for
	things not related to our internal state

	* src/gpm-prefs.c (callback_gconf_key_changed): ditto
	(callback_combo_changed): ditto
	(callback_hscale_changed): ditto
	(callback_check_changed): ditto
	(format_value_callback_percent): ditto
	(format_value_callback_percent_lcd): ditto
	(format_value_callback_time): ditto

	* src/gpm-notification.c (callback_actions_activated): ditto
	(tray_icon_release): ditto
	(tray_icon_press): ditto

2005-10-26  JP Rosevear  <jpr@novell.com>

	* src/gpm-main.c (callback_gconf_key_changed): don't assert for
	things not related to our internal state

	* src/gpm-notification.c (create_icon_pixbuf): do not assert
	before freeing, g_free handles null pointers

	* src/gpm-main.c (get_policy_string): ditto
	(gpm_exit): ditto
	(add_battery): ditto
	(hal_device_condition): ditto

	* src/glibhal-main.c (is_hald_running): ditto
	(hal_free_capability): ditto
	(hal_num_devices_of_capability_with_value): ditto

	* src/glibhal-callback.c (glibhal_watch_remove_device_property_modified): ditto
	(glibhal_watch_remove_device_condition): ditto

2005-10-26  JP Rosevear  <jpr@jprosevear.org>

	* src/pixmaps/Makefile.am: ditto

	* src/icons/Makefile.am: ditto

	* src/Makefile.am: ditto

	* docs/Makefile.am: don't explicitly clean Makefile and
	Makefile.in

	* Makefile.am: remove extraneous tab; don't dist autogen,
	configure is all you need; don't dist mkinstalldirs, thats done
	automatically; don't explicitly clean Makefile and Makefile.in and
	other automatically handled files

2005-10-26  Richard Hughes  <richard@hughsie.com>

	* docs/www/dbus_interface.php, src/gpm-dbus-server.{c|h},
	src/gnome-power-service.xml: Make the DBUS interface much simpler.

	* src/gpm-dbus-test.c, src/Makefile.am: Remove gpm-dbus-test as part
	of making the interface simpler.

	* src/gpm-common.{c|h}, src/gpm-main.c: Remove some obsolete code.

	* configure.in: Bump to 0.2.8.2

	* src/gpm-notification.c: Add patch from Jaap Haitsma
	<jaap@haitsma.org> so that the menu just shows below/above the
	top/bottom panel.

2005-10-25  Richard Hughes  <richard@hughsie.com>

	* src/gpm-prefs.glade: Remove trailing dot from checkboxes to confirm
	to GNOME HIG. Spotted by Mark Rosenstand <mark@borkware.net>, thanks.

	* src/gpm-prefs.c (combo_setup_dynamic) : Don't leak policyoption.

2005-10-24  Richard Hughes  <richard@hughsie.com>

	* Makefile: Ship autogen.sh

	* gnome-power-info.sgml: Add this file to keep the ubuntu build quiet.

	* configure.in: Change hal dep from 0.5.4 to 0.5.3 so we can build on
	ubuntu breezy. 0.5.3 will work with g-p-m, but there are lots of bugs
	in 0.5.3 fixed in later releases.
	Also bump to 0.2.8.1, and release.

	* src/gpm-info.glade : Don't hide this window, make it 'normal' like
	the others.

	* src/gpm-main.c (main) : Register the name of the application rather
	than something random (to the session-manager).
	Patch from Matthew Garrett <mjg59@srcf.ucam.org>

	* Makefile.am: Delete the Makefile.in's in MAINTAINERCLEAN rather
	than DISTCLEAN so we can build on ubuntu.

2005-10-22  Christopher Aillon  <caillon@redhat.com>

	* src/gpm-libnotify.c:
	Use GtkMessageDialog instead of GnomeMessageBox since the former
	supports PangoMarkup and the latter is deprecated.

2005-10-20  Richard Hughes  <richard@hughsie.com>

	* src/gpm-main.c, gpm-common.c: Fix a NULL pointer dereference where
	the remaining_time isn't known, and the battery is low.
	Also don't crash when we do not have gnome-dev-memory in our theme.
	Reported by Andrey Tuev, thanks!

2005-10-17  Richard Hughes  <richard@hughsie.com>

	* src/*.c: Lots of doxygen additions and cleanups.

2005-10-15  Richard Hughes  <richard@hughsie.com>

	* po/POTFILES.in: Added the new translatable files. Lots more stuff
	to translate, sorry! (but I *really* appreciate your work...)

	* src/gpm-main.c, src/glibhal-callback.{c|h}: Added the
	NameOwnerChanges callback infrastructure, so we can now detect when
	HAL disappears from the system bus.

2005-10-12  Robert Love  <rml@novell.com>

	* src/gpm-info.c: Fix various compiler warnings.

2005-10-10  Richard Hughes  <richard@hughsie.com>

	* src/gpm-common.c, src/gpm-main.c: Little tidy-ups.
	Moved the functions gpm_set_icon_with_theme () and
	gpm_icon_theme_fallback () here from gpm-notification.c

	* src/gpm-prefs.c, src/gpm-prefs.glade: Adds the estimated time
	property to the slider widgets. Add themed icons for Rodrigo Moya.

2005-10-06  Richard Hughes  <richard@hughsie.com>

	* src/gpm-gtk-utils.{c|h} (gpm_gtk_set_sensitive): Add new function
	to let us quickly set widget sensitivity.

	* src/gpm-prefs.c, src-gpm-main.c, gnome-power-schemas.in,
	src/gpm-prefs.glade, src/gpm-notification.c: Add the new
	display_icon_others functionality so we can support desktops with
	wireless mice. This is turned off by default.

2005-10-06  Richard Hughes  <richard@hughsie.com>

	* src/gpm-main.c (read_battery_data): Try to get an debug report if
	we are missing battery.remaining_time or
	battery.charge_level.percentage.
	Also add a newline after the version string -- patch thanks to
	Wouter Bolsterlee <uws+gnome@xs4all.nl>

	* src/gpm-notificiation.c (get_notification_icon): Check before
	dereferencing eggtrayicon.

	* src/pixmaps/stock_about.png, src/pixmaps/stock_notebook.png
	src/pixmaps/stock-properties.png, src/pixmaps/Makefile.am: Add default
	fallbacks as not present on debian.

2005-10-04  Richard Hughes  <richard@hughsie.com>

	* src/gpm-dbus-client.{c|h}: Abstract this away from gpm-prefs.c

	* src/gpm-gtk-utils.{c|h}: Abstract this away from gpm-prefs.c

	* src/gpm-prefs.c: Make lots smaller :-) This is in prep for another
	program, g-p-i.

	* src/gpm-info.c: The start of another program, GNOME Power Info

	* src/Makefile.am: Add these extra files, and add gnome-power-info
	to the built files.

	* src/dbus-common.{c|h}: Rename to gpm-dbus-common.{c|h}

2005-10-04  Rodrigo Moya <rodrigo@novell.com>

	* src/gpm-main.c (hal_device_property_modified): display a notification
	when the battery is fully charged.

2005-10-04  Richard Hughes  <richard@hughsie.com>

	* configure.in: Update docs and remove sounds.

	* src/sounds: Remove.

	* src/icons, src/gpm-notification.c: Rename icons to better suit gpm.

	* src/preferences.glade: Remove

	* src/gpm-prefs.glade, src/gpm-info.glade: Add these new files.
	I've split the information stuff into it's own glade file as requested
	by Robert Love.

	* src/compiler.h: Add this file to hold all the GCC4 check ifdefs.

	* src/gpm-prefs.c, src/Makefile.am: Update glade file reference.
	Remove the information page refresher stuff and move to gpm-info.c

	* src/gpm-notification.c: Use run_bin_program to lauch (all) our
	external programs.
	Also coalesce all the custom functions in (menu_main_create) to use
	just menu_add_action_item (which lets us group the callbacks too)
	Also fix so the seporator is shown...

	* src/gpm-common.{c|h}: Add run_bin_program to allow us to run
	g-p-p and the new g-p-i (to come... :-) programs.

	* doc/*: Update so www has it's own directory, and move down html into
	a lower level doxygen directory.

2005-10-02  Richard Hughes  <richard@hughsie.com>

	* configure.in: Bump to 0.2.7. Add in Doxygen configure logic.

	* docs/code: New directory for the Doxygen generated pages

	* docs/Makefile.am, docs/.cvsignore: Add these files so we can
	build ./code.

	* docs/code/Makefile.am, docs/code/Doxygen.in: Add Doxygen build files.

	* src/*.c, src/*.h: Add Doxygen comments. Phew!

2005-10-02  Richard Hughes  <richard@hughsie.com>

	* configure.in: Bump to 0.2.6.1

	* src/gpm-idle.c (gpm_idle_update): Don't return FALSE is timeout is
	set to zero, as the polling will stop. The polling needs to continue
	in case the value is changed in g-conf.

	* src/gpm-notification.c (gtk_icon_theme_fallback): Do the icon
	fallback is a more robust way (so sizes are unimportant).
	(create_icon_pixbuf): Return the pixmap for type POWER_AC_ADAPTER.
	Fixes problems reported by Dumitru Ciobarcianu.

2005-10-01  Richard Hughes  <richard@hughsie.com>

	* src/gpm-idle.c (update_idle_function): Actually print the return
	value of gscreensaver_get_idle ();
	Also check the value of the timeout to check it's not set to zero.

	* src/gpm-notification.c: Moved callback_gconf_key_changed () to
	src/gpm-main.c so we can do clever stuff. Not sure why it was ever in
	this file in the first place...

	* src/gpm-main.c: Fix two typos in the gconf keys threshold_low and
	threshold_critical, and one thinko in the order of calculating the
	old and new charges. The warnings and auto-action should now work
	again now. Found as a co-incidence of running out of battery power...
	(callback_gconf_key_changed): Add case where g-p-p should force an
	update to dmps_suspend without having to change state.
	Reported by Theetjuh <theetjuh@gmail.com>.

	* src/gpm-main.c, src/gpm-idle.c: Add in the full idle functionality,
	so that we can either suspend or hibernate when we are deemed idle.

	* src/gpm-screensaver.c: setThrottleEnabled now doesn't return us a value.
	Fix our calling function to also return the value of getIdleTime,
	rather than just the success.

	* docs/gnome_power_manager.php, docs/gnome_power_preferences.php:
	Add a couple of new images and update the text a bit.

	* src/glibhal-extras.c: Return a success value, and pass in steps by
	reference.

	* src/gpm-prefs.c: make sure hscale_batteries_display and
	hscale_ac_display are set to 5 minute divisions.
	Also, only set the LCD slider points if we have LCD hardware.
	This removes a warning on desktop systems.

2005-09-30  Richard Hughes  <richard@hughsie.com>

	* configure.in: Bump to 0.2.5.4

	* src/gpm-common.c (get_widget_position): new function to get center
	point of a widget.

	* src/gpm-libnotify.c: Added back (in a better way) the
	libnotify-points-to-icon feature.

	* src/gpm-prefs.c: Turn on DPMS if not enabled at start.

	* src/gpm-screensaver.c: Attempt to get return val right.

	* src/gpm-idle.c: Do not continue to poll gnome-screensaver if the
	first call failed. This will avoid a warning every minute.

	* src/gpm-main.c, src/gpm-notification.c: Use the new libnotify
	widget centering functionality.

	* src/*.c: Use new the macros G_GNUC_WARNUNCHECKED for a few vital
	functions (where we MUST check the return value), and then fix up
	all my sloppy programming...

2005-09-29  Richard Hughes  <richard@hughsie.com>

	* configure.in: Bump to 0.2.5.3

	* src/glibhal-extras.c (hal_is_laptop): Factor out this code into it's
	own function so we can use it in a different way...

	* src/gpm-prefs.c (gtk_set_label): Make a simple wrapper...

	* src/gpm-prefs.c (refresh_info_page) Make a function to populate the
	new 'Information' tab present in the glade file.

	* src/preferences.glade: Add the new 'Information' tab with system
	information. This is all very immature, and likely to change.

	* src/gpm-prefs.c (combo_setup_dynamic),
	src/gpm-main.c (get_policy_string): Make sure we check for a null
	gconf return string. This was reported by Myk Melez <myk@mozilla.org>
	where the gconf schema installation was incorrect. This means we
	shouldn't trigger the assert in gpm_common.c (convert_string_to_policy).

2005-09-28  Richard Hughes  <richard@hughsie.com>

	* src/gpm-libnotify.{c|h}: Factor out the notification stuff into
	these two new files.

	* src/gpm-prefs.c, src/gpm-prefs.c: use the new libnotify stuff and
	delete the local functions which do the same thing.
	Also fix desktops that do not have an LCD panel. Oops.

	* src/*.{c|h}: I've audited these files and added complete NULL
	dereference assert checks, and made sure *all* local pointers are
	always setup with deault value NULL. This may break stuff, but will
	make debugging easier.

	* src/gpm-notification.c (callback_about_activated): Use the
	gtk_about_dialog functionality instead of replying on depreciated
	functionality. Also add GNU licence and the translators.

2005-09-26  Robert Love  <rml@novell.com>

	* src/gpm-main.c: Daemonize by default, via daemon(3).  Add
	  '--no-daemon' flag.

2005-09-26  Richard Hughes  <richard@hughsie.com>

	* src/gpm-prefs.c, src/gpm-idle.c, src/gpm-screensaver.{c|h},
	src/glibhal-extras.c, .cvsignore, src/Makefile.am: Fix build warnings.
	Patch from Robert Love <rml@novell.com>, Many thanks.

	* src/configure.in: Apply many fixes from Robert Love, many thanks.

2005-09-26  Richard Hughes  <richard@hughsie.com>

	* gnome-power-manager.spec.in: Now kill gconfd-2 on update to force
	schema, and use @VERSION@ to make my life easier.

	* docs/compile.php, docs/faq.php: Add new information

	* src/glibhal-extras.c (hal_get_brightness_item): New function, to
	get the LCD brightness value.
	(hal_set_brightness_dim): New function, allows us to dim the screen
	slowly, rather than one big jump.
	We now support ONLY the new SetBrightness HAL API in HAL CVS.
	http://article.gmane.org/gmane.comp.freedesktop.hal/3280

	* src/gpm-notification.c: Remove some #if 0 stuff.

	* src/gpm-prefs.c: make the new functionality of format_value_callback_percent_lcd () so the slider can step only to allowed values.

	* src/preferences.glade: Make percentages have no decimal points.

	* src/gpm-main.c: Use the hal_set_brightness_dim functionality.

	* configure.in: Bump to 0.2.5.1

2005-09-22  Rodrigo Moya <rodrigo@novell.com>

	* src/gpm-prefs.c:
	* src/glibhal-extras.c: added missing string.h for 64bit compilation.

	* src/gpm-notification.c (callback_about_activated): fixed 64bit
	warning.

2005-09-21  Richard Hughes  <richard@hughsie.com>

	* src/gpm-prefs.c (main): Actually make gnome-screensaver detection
	work, and tie the sliders into divisions of 5 minutes.

	* gnome-power-manager.spec.in: Add dep on gnome-screensaver
	Also fix the directory owning problem, where we couldn't access our
	shared files on some machines.
	Reported by Ben Liblit <liblit@cs.wisc.edu> -- Thanks.

	* configure.in: Bump to 0.2.5 (odd = unstable).

2005-09-21  Richard Hughes  <richard@hughsie.com>

	* src/gpm-common.{c|h}: remove unused function
	convert_powerdevice_to_gnomeicon.

	* src/gpm-notification.c: remove the LCD sub menu as the icons have
	now gone. This belongs in an applet, if at all.

	* gnome-power-manager.spec.in: Add back the libnotify stuff as we are
	not building locally for redhat, and we provide libnotify rpm's.

	* configure.in: Bump to 0.2.4.

2005-09-21  Rodrigo Moya <rodrigo@novell.com>

	* src/gpm-main.c: include dbus-glib-lowlevel for
	dbus_g_connection_get_connection for clean 64bit compilation.

2005-09-20  Richard Hughes  <richard@hughsie.com>

	* src/glibhal-extras.c (hal_setlowpowermode): Only call SetPowerSave
	if system.formfactor is 'laptop'. Patch pending for PMU for HAL.

	* src/gpm-prefs.c: Remove all the GSCREENSAVER #ifdefs and switch to
	runtime detection of the dbus service.

	* configure.in: Remove detection for gnome-screensaver as we now do
	this at runtime.

	* src/Makefile.am: Add gpm-screensaver.{c|h} to gnome_power_preferences.

	* src/gpm-screensaver.{c|h}: Add funtion gscreensaver_is_running ().

2005-09-13  Richard Hughes  <richard@hughsie.com>

	* configure.in: bump to 0.2.3.2
	Also add the command line --enable-glibhal to try out the new code.

	* gnome-power-manager.spec.in: Updated with davidz's (redhat) changes.

	* docs/contact.php : Add Matthias Grimm, and Matthew Garrett to the
	credits - thanks guys!

	* docs/faq.php: Add 'Why do events take so long to register?'

	* docs/gnome_power_manager.php : Move content from index.

	* docs/index.php: Add content from Matthias Grimm.

	* src/gpm-screensaver.{c|h}: New files for the GNOME Screensaver stuff.

	* src/gpm-idle.{c|h}: New files for the idle calculation stuff.

	* src/Makefile.am : Add these new files to gnome_power_manager

	* src/glibhal-* : Some tidying up, and wightspace fixes.

	* src/glibhal-main.{c|h} : Add is_hald_running (), hal_pm_check ().

	* src/gpm-main.c : Add calls to gscreensaver_set_throttle.
	Also check that we can connect to HAL before we start issuing commands,
	thanks to Trond Husø for pointing this out!
	Call the idle calculation function every 5 seconds.

	* src/gpm-prefs.{c|h} : Wightspace fixes.

2005-09-13  Richard Hughes  <richard@hughsie.com>

	* configure.in: bump to 0.2.3.1

	* Makefile.am, gnome-power-manager.service.in : Make DBUS
	auto-launch services work.

	* docs/compile.php : Add note about pmscripts and rawhide kernel

	* glibhal-callback : Rename registered to reg to avoid GCC complaining.

	* src/gpm-main.c : Add info to check the FAQ page before reporting
	emailing me with bugs.

	* src/gpm-notification.c : Change #if to #if defined(foo) to shut up
	GCC's extra warnings. Add note about running on a desktop machine.

	* src/gpm-prefs.c : Add config.h - this was causing libnotify not to
	be defined.
	Also add gpm_is_on_ac () so we can jumpstart g-p-m if not running, and
	display a warning if impossible.
	Also convert to the dynamic option comboboxes. This allows us to choose
	more sane options for each combo.

2005-09-09  Richard Hughes  <richard@hughsie.com>

	* src/glibhal-callback.{c|h} : Finish the backend code.

	* src/gpm-main.c : use the swanky new backend code. (still disabled by
	default)

	*  src/gpm-prefs.c, src/preferences.glade: Patch from
	Jaap Haitsma <jaap@haitsma.org> to remove the obsolete hdd spindown
	checkbox. Thanks!

2005-09-08  Richard Hughes  <richard@hughsie.com>

	* src/hal-glib.{c|h} : Removed these files.

	* src/dbus-common.{c|h} : New files providing the basic dbus glib
	functionality, e.g. dbus_get_service.

	* src/glibhal-main.{c|h} : New files providing the core glibhal
	functionality, e.g. reading a boolean value.

	* src/glibhal-extras.{c|h} : New files providing the extra glibhal
	functionality, e.g. changing the screen brightness.

	* src/glibhal-callback.{c|h} : New files providing the callback
	functionality of glibhal, e.g. libhal_device_removed.

	* src/*.c : Adjusted to new glibhal framework
	(which we still don't use yet - working with the old libhal)

	* src/Makefile.am : Adjusted to new glibhal framework.

2005-09-08  Richard Hughes  <richard@hughsie.com>

	* docs/faq.php, docs/index.css: Update, and make a quick table for all
	new faq's at the top of the page.

	* src/hal-glib.c (dbus_glib_error): Do not print to warning level for
	a missing key, only print to debug. This was causing false bugreports.

	* src/gpm-main.c (main): Fix the typo for session connection checks.
	This was the reason 0.2.2.1 was pushed out the door so fast. Thanks to
	Mike Bydalek for testing and reporting the problem so fast.

	* src/gpm-notification.c (get_tooltip_state): removed and inlined as
	only one user.

	* gnome-power-manager.spec.in: Fix the problem where stderr wasn't
	being redirected in the gconf section.

2005-09-07  Richard Hughes  <richard@hughsie.com>

	* configure.in: bump to 0.2.3

	* docs/pm.php, docs/menu.php: Remove PowerManager docs as obsolete.

2005-09-06  Richard Hughes  <richard@hughsie.com>

	* gnome-power-manager.schemas.in: Fixed the problem where the
	noticiation icon wasn't being shown by default.
	(Add the missing general/display_icon)

	* src/gpm-main.c: Warn user when dbus session server is not running

	* doc/faq.php: Add FAQ entry for the libnotify dbus problem.

	* src/hal-glib.c: Make get_system_connection and get_session_connection
	not abort on failed connection (as we wan't to trap the error.)

	* po/pl.po: New Polish translation by Michał Kastelik
	<mkastelik@gmail.com> - Many thanks.

	* configure.in: add pl translation.

	* configure.in, Makefile.am: Make docbook2man a automatic configurable.
	If this program is missing, the man files will not be built.
	Suggested by Eugenia Loli-Queru.

	* gnome-power-manager.conf, src/gnome-power-service.xml,
	src/gpm-common.h: s/net.sf.PowerManager/org.gnome.GnomePowerManager

	* docs/dbus_interface.php, src/gnome-power-service.xml, src/gpm-main.c:
	Add isOnBattery, isOnUps, isOnAC and remove isRunningOnMains.

	* src/gpm-common.h: Remove last bits of CVSHAL (obs. now we depend on
	0.5.4). Also make GPM_SIMULATE half-logical.

	* src/gpm-main.c: make more of LIBHAL_EXPERIMENT work -
	a future libhal replacement. (note, still disabled)

	* src/gpm-prefs.c: new function, gpm_is_on_mains() - so we can adjust
	the correct LCD slider depending if we are on AC or batteries.

	NEWS: Update, and format to standards, not just a random dumping ground
	for all my pre-paste news :-)

	doc/faq.php, doc/report_bug.php: Update with latest FAQ's :-)

2005-09-05  Richard Hughes  <richard@hughsie.com>

	* configure.in: bump to 0.2.2

	* src/makefile.am: Fix from wrobell <wrobell@pld-linux.org> to fix
	compilation on PLD Linux.

2005-09-05  Richard Hughes  <richard@hughsie.com>

	* gnome-power-manager.schema.in: Fix the problem where reboot or halt
	weren't being called correctly. i.e. do s/usb/usr. oops.

2005-09-04  Richard Hughes  <richard@hughsie.com>

	* configure.in: Add -fstack-check -pedantic -Wfloat-equal -Wundef
	-Wpointer-arith -Wbad-function-cast -Wredundant-decls to check code.

	* docs/images/drop-down.png, docs/gnome_power_manager.php:
	Remove surpus image.

	* docs/images/gpm-taskbar.png, docs/images/pref-advanced.png,
	docs/images/pref-main.png, docs/images/pref-options.png: Update.

	* src/gpm-common.c, src/gpm-common.h, src/gpm-dbus-test.c,
	src/gpm-main.c, src/gpm-notification.c, src/gpm-prefs.c,
	hal-glib.c, hal-glib.h: Fix up *lots* of compiler warnings, and make
	more C99 compliant. Also refactored code a little.

	* src/gpm-main.c: Add --version switch to just print the version.

	* doc/report_bug.php: New file, how to file a perfect bug.

2005-09-01  Richard Hughes  <richard@hughsie.com>

	* configure.in: Bump to 0.2.1
	Add new Italian translation by Daniele Medri <daniele@medri.org>.

	* src/gpm-common.h, gpm-main.c: s/LCDPanel/LaptopPanel to match HAL CVS.
	Move g-p-p enums to gpm-prefs.h.

	* src/gpm-main.c: Fix a problem for Andrew Duggan where the incorrect
	ACPI reading was tripping up our over-zealous checks. I've removed the
	check that was the issue, which should hopefully fix the issue.

	* src/gpm-prefs.c: Move get_devices_capability and
	get_devices_capability_with_value to src/hal-glib.c (
	hal_num_devices_of_capability, hal_num_devices_of_capability_with_value)
	Also do s/POLICY_NONE/POLICY_SLEEP.

	src/hal-glib.c: s/LCDPanel/LaptopPanel to match HAL CVS.

	src/preferences.glade: Fix combobox_sleep_type, and move to options tab.

2005-08-30  Richard Hughes  <richard@hughsie.com>

	* src/icons/gnome-power-system-ups-{0..8}-of-8.png: Added back by
	popular request.

	* NEWS: Update.

	* src/icons/Makefile.am: Add UPS icons.

	* src/gpm-notification.c: use UPS icons. Also fix a bug where {junk}%
	was dislayed when primary battery not present.

2005-08-30  Richard Hughes  <richard@hughsie.com>

	* configure.in: Bump to 0.2.0, signifying the obsolete of PowerManager.
	Also raise hal dep to 0.5.4

	* src/gpm-main.c: Remove code using USE_POWERMANAGER.

	* gnome-power-manager.schemas.in: Use 'halt -s', not shutdown.

	* doc/faq.php: Explain the obsolete PowerManager.

	* gnome-power-manager.spec.in: Add 'Obsoletes: PowerManager' so that
	we uninstall the PowerManager Daemon.

2005-08-30  Richard Hughes  <richard@hughsie.com>

	* src/preferences.glade: Fix the combobox padding, and make all siders
	update policy to 'continous' so we can do some clever stuff with steps.

	* src/gpm-prefs.c: Rename capability to lcdpanel.

	* src/gpm-main.c: fix a warning for:
	'g_value_set_uint: assertion `G_VALUE_HOLDS_UINT (value)' failed'
	by switching to return a G_TYPE_UINT value.

	* src/gpm-main: (hal_set_brightness, hal_set_brightness_item):
	Create new functions to support the new
	org.freedesktop.Hal.Device.LCDPanel.SetBrightness method.

	* src/gpm-common.h: Add HAL_DBUS_INTERFACE_LCD

	* src/hal-glib.{c|h}: Move hal specificy code into here from gpm-main.

	* src/gpm-prefs: (format_value_callback_percent): Set to 1 digit
	precision, e.g. 56.3% so we can do steps.

	* src/gpm-prefs: (callback_hscale_changed): Add divisions support so
	we can lock to correct values for LCD brightness.
	This also lets us snap to 5 minute intervals for the sleep hscale's.

2005-08-26  Richard Hughes  <richard@hughsie.com>

	* doc/compile.php: Add information about CVS and Fedora core, and
	Fedora rawhide.

	* doc/faq.php, doc/menu.php, doc/index.css: Add FAQ page.

2005-08-21  Richard Hughes  <richard@hughsie.com>

	* src/gpm-common.c: removed update_percentage_charge as we now depend on
	CVS HAL.

	* src/gpm-main.c: Remove all code paths that rely on !CVSHAL.

2005-08-21  Richard Hughes  <richard@hughsie.com>

	* src/gpm-main.c, src/preferences.glade: removed the user setting of
	hard drive spindown time, and double click action.
	This was agued by many as having no place in the UI.

	* src/gpm-main.c (hal_setlowpowermode): add a new funtion to call
	SetPowerSave on the HAL root computer object.

	* Makefile.am: Use the new define, DBUS_SYS_DIR

	* configure.in: Add configuration for DBUS_SYS_DIR and DBUS_SERVICES_DIR
	I hope these don't break the RPM :-)

	* gnome-power-manager.service.in: new file, will act as a future service
	file for the dbus service.

2005-08-23  Richard Hughes  <richard@hughsie.com>

	* po/*.po, src/gpm-main.c: Changed explaination to explanation.

2005-08-21  Richard Hughes  <richard@hughsie.com>

	* src/gpm-main.c (update_has_logic): removed as we can trivially move the
	remaining checks into the state check function.
	Fix detection of onBatteryPower so that it's instantaneous.

	* src/gpm-prefs.c (get_devices_capability_with_value): New function, so
	that we can match a capability with a key string. Useful for buttons
	and ide drives.

2005-08-20  Richard Hughes  <richard@hughsie.com>

	* Make the gnome-power.foo files into gnome-power-manager.foo files.
	CVS churn...

	* src/gpm-common.h, src/hal-glib.c, src/hal-glib.h, src/gpm-main.c: Make
	hal_device_get_* to return success value rather than data so we can
	test for the tag not existing. This is needed for CVSHAL.
	Also add hal_free_capability convenience function.

	* src/gpm-prefs.c, src/gpm-main.c, src/gpm-common.h: Start getting rid of has*
	gconf data keys	- all that remain are hasBatteries and hasAcAdaptor -
	also need to make proper the solution in gpm-prefs w.r.t. the
	button handling.

	* gnome-power.schemas.in: Remove all the has* keys as we are not setting
	or reading these values now.

2005-08-19  Richard Hughes  <richard@hughsie.com>

	* src/gpm-notification.c, src/gpm-main.c, gpm-notification.h, src/gpm-common.h:
	Add a warning when show_icon is set to false.
	Remove the struct IconData as the show and show_if_full gconf values
	can now be read for each icon refresh as they are quick. The global
	variable main_icon could be reduced in scope to one function, so I did
	that too.
	Remove the setupData field as we can now set GPM_SIMULATE (instead of
	doActions) and verbose is just a global now.

	* src/gpm-notification.c: Removed the ability to generate our own icons,
	so we'll rely on the packaged ones. This desision wasn't taken lightly,
	but a11y considerations meant this had to be removed.

	* src/gpm-common.h: Add the HAL dbus defines.

	* src/gpm-main.c: Start adding the CVS HAL method support in. Also
	un-#if the GSCREENSAVER stuff - worst case we get a dbus warning if
	not present.

	* gnome-power.spec.in, doc/index.html: Bump to dep of hal 0.5.4

	* src/gpm-dbus-test.c: s/GPM_DBUS_POWEROFF/GPM_DBUS_SHUTDOWN to match.

	* gnome-power.schemas.in: Add general/cmd_reboot and
	general/cmd_shutdown so that we can get rid of PowerManager.

	* doc/index.html: Remove pmscripts as this has been taken over with
	pm-utils carried upstream.

2005-08-17  Richard Hughes  <richard@hughsie.com>

	* gnome-power.schemas.in: Remove /apps/gnome-power/lockdown/* as we can
	now use hald. Remove /apps/gnome-power-manager/policy/UPSCritical as we
	can use BatteryCritical. Improved lots of short descriptions.
	Do s/gnome-power/gnome-power-manager and s/AC/ac and
	s/Batteries/batteries (and convert StudlyCaps to usual_style) so that
	we are more consistant as a Gnome application. Fixes suggested by
	David Zeuthen.

	* src/gpm-notification.c, src/gpm-main.c, src/gpm-common.h: remove
	lockdown stuff,	and also use the new gconf keynames.

	* gpm-prefs.c: Remove combobox_ups_critical

	* TODO: Update.

	* src/gpm-main.c: Remove the GPMGLIB stuff as we don't compile anymore
	with !GPMGLIB thanks to all the new code.
	Also refactored the signal stuff into nice inline functions.

2005-08-16  Richard Hughes  <richard@hughsie.com>

	* src/gpm-dbus-common.{c|h}: Now the GLIB signal stuff is working,
	remove these empty files. The GLIB dbus stuff allows us to clean up the
	source substantially. I will be making the GPMGLIB stuff enforced,
	i.e. removing compatability with the older dbus's.

	* src/gpm-main.c (action_policy_do): New function (gscreensaver_lock).
	Add the commands to lock the screen using gnome-screensaver. Thanks to
	Diego González for the basis for this patch.

	* src/gpm-common.h: Add the GS_DBUS_SERVICE, GS_DBUS_PATH, and
	GS_DBUS_INTERFACE defines here.

2005-08-15  Richard Hughes  <richard@hughsie.com>

	* Apply patch from Steev Klimaszewski to change a TIMOUT to TIMEOUT
	- which I blame entirely on this laptop keyboard.

	* configure.in: Add --enable-gscreensaver to configure arguments so that
	we do not try to read in the gconf values and throw an error if this
	program is not built. We still need to write the auto check for
	gnome-screensaver in configure.in. Spotted by Steev Klimaszewski.

	* src/gpm-main.c, src/gpm-main.c: Sprinkle with #if HAVE_GSCREENSAVER
	so that we disable the un-needed parts.

	* src/gpm-dbus-common.c: Fix the PowerManager interface line. Note that
	this file is going when we go 100% glib.
	Also PowerManager support is going when HAL gets event support (soon).

	* src/gpm-notification.c: Remove setup.hasQuit and setup.hasActions and
	the associated logic.

2005-08-14  Richard Hughes  <richard@hughsie.com>

	* Update src/pixmaps/gnome-dev-acadapter.png so that it matches the
	'dfong' bluecurve theme.

	* gpm-main.c: Continue playing with LIBHAL_EXPERIMENT so that we can
	remove the libhal dep and use the pure glib bindings. With this we are
	uncovering lots of problems with the glib dbus bindings and so is a good
	thing :-) If you use LIBHAL_EXPERIMENT then please use CVS dbus, else
	little will work. Thanks to davidz and walters for all the help so far.

	* src/gpm_marshal.list: Added marshal file for use by glib-genmarshal

	* src/Makefile.am: Add support for gpm_marshall.c and gpm_marshall.h

2005-08-09  Maxim Dziumanenko <mvd@mylinux.ua>

	* configure.in: Added 'uk' to ALL_LINGUAS.

2005-08-04  Richard Hughes  <richard@hughsie.com>

	* gpm-common.h: Add GPMURL define

	* gpm-dbus-common.{c|h}: Remove the signal stuff we don't use and we
	now use the glib method stuff unconditionally, so remove them.

	* gpm-main.c: Use the libnotify glib initialisation stuff.
	Also start experimenting with GLIB methods.

	* gpm-prefs.c: Use the libnotify glib initialisation stuff.

	* configure.in: Bump to 0.2.1

	* Makefile.am: Add the glib glue stuff.

2005-07-28  Richard Hughes  <richard@hughsie.com>

	* src/gnome-power-service.xml: Comment out stuff we are not using.

	* src/gpm-main.c: Continue playing with glib.

	* src/gpm-dbus-common.{c|h}: Remove the obsolete method functions
	Signals are next on the hit-list.

2005-07-28  Richard Hughes  <richard@hughsie.com>

	* src/hal-glib.c, src/hal-glib.h: new files for the glib libhal functions

	* src/Makefile.am: add hal-glib.{c|h} into the build.

	* src/gpm-main.c: use the glib libhal functions as it makes everything
	easier to read and debug.

	* src/gpm-main.c (pm_do_action, set_hdd_spindown_device): Communicate
	with PowerManager using the glib bindings. Try and initialise as much
	as we can with dbus-glib. Notice a trend?

	* src/gpm-main.h: put all constants in gpm-common.c

	* Makefile.am: Remove Makefile.in's on maintainer-clean

	* src/gnome-power-service.xml: Update without the veto prefix,
	and add signals - this will prepare for the glib bindings in the future.

2005-07-25  Richard Hughes  <richard@hughsie.com>

	* src/gpm-prefs.c: Make sure we only use GCONF_ROOT once.
	Add libnotify box informing user that they do not have gnome-screensaver
	DPMS support.

	* src/gpm-common.h: Move NOTIFY_TIMOUT here.

	* src/gpm-main.c: Remove invalid gconf check.
	Added support for writing /apps/gnome-screensaver/dpms_suspend for
	gnome-screensaver.

	* configure.in, src/Makefile.am, src/gpm-notification.c,
	src/prefs.c: Make libnotify a configurable build option, on the advice
	of David Zeuthen.

	* gnome-power.spec.in: Add --enable-libnotify.

2005-07-25  Richard Hughes  <richard@hughsie.com>

	* gnome-power.spec.in: Do not restart messagebus on install

	* src/gnome-power-service.xml: new file, prepare for dbus glib'ification.
	We will be able to remove lots of code when we use the glib bindings.

2005-07-21  Richard Hughes  <richard@hughsie.com>

	* src/gpm-dbus-test.c: Added back the NameOwnerChanged signals.
	Add some #ifdefs to allow test.c to use gpm-dbus-common.h
	Added some help text in the --help screen.

2005-07-21  Richard Hughes  <richard@hughsie.com>

	* README, docs/index.html: updated dep information.

	* src/preferences.glade: Add some new sexy stuff.

2005-07-21  Richard Hughes  <richard@hughsie.com>

	* dbus-interface.html: Removed as information is more up to date in docs/

	* autogen.sh: Changed to use gnome-common

	* src/sounds/critial.wav: New sound file from GAIM for critical notification

	* src/sounds/normal.wav: New sound file from Iagno for other notifications

	* src/gpm-main.c (use_libnotify): Now do a sound for the notifications.
	I don't think libnotify supports this yet, but when it does, this should
	'just-work' :-)

	* src/gpm-prefs.c (recalc): Add support for missing lid/power/sleep buttons.
	Also add the GCONF_ROOT prefix to the keys manually, so we can use
	gnome-screensaver ones in the future.

	* src/preferences.glade: Name the labels so that the above works correctly.

	* gnome-power.spec.in: Add gnome-common dep, and update others.

	* configure.in: Add src/sounds/Makefile and src/icons/Makefile

	* src/sounds/Makefile.am: New file, to add the wave files.

	* src/icons/Makefile.am: New file, and move over the icons. This means we
	can install different icon sets, e.g. bluecurve, gnome or LowContrast if
	people don't like the icons.

	* src/gpm-notification.c (callback_about_activated): No point displaying
	'Unknown Translator' for un-translated files.

2005-07-20  Richard Hughes  <richard@hughsie.com>

	* src/pixmaps/gnome-power-system*.png: New icons thanks to Diana Fong
	and David Zeuthen. They look great - thanks!

	* docs/images/*.png: Update screenshots to a bit more recent.

	* src/gpm-notification.c (get_icon_position): New function, tell libnotify
	where to point to. This is a bit rough-and-ready at the moment but seems to
	work well.

	* src/gpm-main.c (use_libnotify): Now setting an image with position, lets
	see what people think.

	* src/gpm-dbus-server.c (dbus_method_handler): Add in all the existing
	signals as methods. dbus-glib, where for art thou. :-)

	* src/gpm-dbus-server.c (dbus_signal_filter): Removed support for the
	signal API.

2005-07-19  Richard Hughes  <richard@hughsie.com>

	* src/pixmaps/gnome-power.png: New file (we now have an icon thanks to
	Diana Fong)

	* src/pixmaps/Makefile.am: Added gnome-power.png

	* configure.in: We now require dbus-glib-0.35.2 (an unpopular move).
	I want to use the new glib bindings throughout the programs. There is too
	many dbus wrapper-type functions that add to bloat and make the program
	generally difficult to read. After reading the dbus-glib sample code,
	I'm sure this is the way to go. For all you FC4 users, rawhide's DBUS seems
	to work well with no ill effects.

	* doc/*: Updated documentation with new logo, and a few new screenshots.

	* src/gpm-dbus-test.c: Converted to just use the glib bindings - this file
	is a bit of a mess at the moment, but you see the plan. I'm thinging making
	ACK, NACK etc, into methods instead of signals. Methods seem more the right
	thing to use, so I'll start converting gpm-dbus-server.c to accept these
	methods instead.

	* src/gpm-dbus-server.c: Add in method support for ACK, others to follow.

2005-07-18  Richard Hughes  <richard@hughsie.com>

	* configure.in: Changed module name to gnome-power-manager to better
	reflect the gnome module name. The next release will have a tarball
	gnome-power-manager.tar.gz instead of gnome-power.tar.gz

	* src/pixmaps/Makefile.am: New file, splitting from src/Makefile.am -
	I should have done this a long time ago.

	* Makefile.am, src/Makefile.am: Tidy up, and move the build of
	preferences.glade to src/ - it never belonged here anyway.
	Also, we'll now use /usr/share/gnome-power-manager to be more specific.

2005-07-18  Adam Weinberger  <adamw@gnome.org>

	* configure.in: Added en_CA to ALL_LINGUAS. I think it's important
	  right now to note that nearly every single source string in the
	  entire program has at least one grammar or spelling error.

2005-07-17  Richard Hughes  <richard@hughsie.com>

	* src/gpm-notification.c: Made eggtrayicon a global, and got rid of the
	complicated icon->td structure. We don't need to be so complicated now
	we only have one icon.

	* src/*dbus*.c: Added note that we will be changing to glib bindings soon.

	* TODO: updated.

2005-07-17  Christophe Merlet  <redfox@redfoxcenter.org>

	* configure.in: Added 'fr' to ALL_LINGUAS.

2005-07-16  Christian Rose  <menthos@menthos.com>

	* configure.in: Added 'sv' to ALL_LINGUAS.

2005-07-15  Richard Hughes  <richard@hughsie.com>

	* src/gpm-dbus-server.c (vetoActionUnregisterInterest): Add an option so we
	can supress the error (for random client disconnections)

	* src/gpm-prefs.c (main): set hscale_battery_critical on load, not just on
	change,	else we get the slider changing in unpredictable ways.

	* src/gpm-*.c: s/g_assert/g_return_if_fail and g_return_val_if_fail
	This will make the programs a little more error friendly (we still get
	critical errors, but the program doesn't die)

	* src/gpm-notification.c: Finish removing the low_icon mess.

	* src/gpm-notification.c (callback_about_activated): Added translatable
	string 'Unknown Translator' for all you translators to get a bit of credit.

2005-07-15  Terance Sola  <terance@lyse.net>

	* configure.in: Added 'nb' and 'no' to ALL_LINGUAS.

2005-07-14  Richard Hughes  <richard@hughsie.com>

	* gnome-power.preferences.desktop.in:
	Replace 'GNOME Power Preferences' with 'Power Preferences' - we shouldn't
	have 'GNOME' in the Preferences menu title.

	* src/gpm-main.c (read_battery_data): Re-arrange the initialisation to
	known defaults so that valgrind doesn't get upset with a UPS attached.

	* gnome-power.schemas.in: Added criticalThreshold value

	* gpm-prefs.c (callback_hscale_changed): Add in new code for
	criticalThreshold, and make sure that criticalThreshold > lowThreshold
	by changing the limits of the criticalThreshold slider.

	* src/gpm-main.c (property_modified): Added notification and action for
	battery critical. Now we are cooking with gas.
	p.s. Thanks to the translators for all the recent work. Appreciated.

2005-07-15  Abel Cheung  <maddog@linuxhall.org>

	* configure.in: Added 'mk' to ALL_LINGUAS.

2005-07-13  Francisco Javier F. Serrador  <serrador@cvs.gnome.org>

	* configure.in Added to LINGUAS 'es' and missing  'pa' and 'zh_CN'.

2005-07-13  Richard Hughes  <richard@hughsie.com>

	* configure.in: Add check for libnotify.

	* src/gpm-common.c: Add initial code for libnotify support. Patches for
	libnotify and DBUS 0.33 have been sent upstream, along with a spec file
	for FC4. Ubuntu is also packaging this in the next few weeks, so the
	extra dep shouldn't be a problem.

	* src/gpm-main.c (use_libnotify): new function, convenience. Added lots more
	notifications where we used to have dialogues, for the warning states.

	* src/gpm-common.c (property_modified): Fix bug where update_state_logic
	was being called with coldplug TRUE, when it quite plainly isn't.

	* src/gpm-common.c (get_timestring_from_minutes): Fix translationable string
	to be constant number. Fix from Hendrik Brandt, thanks.

	* gnome-power.schemas.in : Change tense of a description to be less like the
	borg :-) Fix from Hendrik Brandt, thanks.

	* doc/*: Added lots more information and other images.

	* src/preferencs.glade: Name the new label label_double_click so we can
	disable it :-)

	* src/gpm-prefs.c: Disable the double click stuff for now

	* src/gpm-main.c (property_modified): Add the code where the user is
	informed of the low battery state. This works for any rechargeable device.

2005-07-12  Richard Hughes  <richard@hughsie.com>

	* src/gpm-main.c (set_hdd_spindown): New stub function that sets the
	spindown for all hard-drives attached to the system.

	* MAINTAINERS, README.cvs: new files, needed for movement to GNOME CVS
	servers. I'll update the help when they allow anonymous checkouts.

	* doc/*: New folder with quite a bit of documentation in HTML form.

2005-07-12  David Zeuthen  <davidz@redhat.com>

	* src/gpm-notification.c (create_icon_pixbuf): Use the new icons
	for system-wide power state so it's much easier to theme

	* src/Makefile.am:
	(Data_DATA): Add pixmaps/gnome-power-system[-ac]-[0-8]-of-8.png

	* src/pixmaps/gnome-power-system[-ac]-[0-8]-of-8.png: New files

2005-07-11  Richard Hughes  <richard@hughsie.com>

	* gnome-power.spec.in : Added depend of PowerManager - this is now the
	only way we can call root scripts. PowerManager is only a temp fix,
	HAL will have the required actions soon.
	Fedora Extras fixes from Andreas Thienemann, thanks!

	* gnome-power.schemas.in : Removed the scripts/ gconf directory.
	Removed the ShowIconLow boolean as we don't support this anymore.

	* src/gpm-dbus-common.c : Add convert_dbus_enum_to_string () so we can make
	the interactive prompts more user-friendly.

	* src/gpm-dbus-list.c : Removed, as we can use the dbus tools instead.

	gnome-power-manager.sgml, gnome-power-preferences.sgml : New files from
	Oliver Grawert <ogra@ubuntu.com> for man support. Still need to fill these
	in to be complete, and up to date (and to patch Makefile and spec) but
	I've uploaded them so people can see them and improve them.

2005-07-07 Richard Hughes  <richard@hughsie.com>

	* src/gpm-dbus-common.h : Renamed net.sf.PowerManager to
	net.sf.GnomePower so we can use a desktop agnostic backend.
	Add PM_DBUS_INTERFACE as a test.

	* src/gpm-dbus-common.h : Create pm_do_action () as a test using PM_DBUS.

2005-07-04 Richard Hughes  <richard@hughsie.com>

	* dbus-interface.html : New file, detailing the DBUS interface and
	progress.

	* src/gpm-dbus-server.c : Continue to impliment the spec (above)

	* src/gpm-dbus-test.c : Start writing lots of tests so we can really
	pound the PowerManager DBUS interface.

	* src/gpm-main.c : Now does action ACPower fail. Noticed by Ow Mun Heng.

	* .cvsignore, po/.cvsignore, src/.cvsignore : New files to help me
	keep on top of the CVS directories.

2005-07-02 Richard Hughes  <richard@hughsie.com>

	* src/gpm-dbus-test.[c|h] New files for test DBUS service.
	* src/gpm-dbus-list.[c|h] New files for test DBUS service.
	* src/gpm-dbus-server.[c|h] New files for test DBUS service.
	* src/gpm-dbus-test.[c|h] New files for test DBUS service.
	* gnome-power.conf : New DBUS conf file
	(belongs in /etc/dbus-1/system.d/)

	* src/Makefile.am : Added the above files to build the new DBUS bits.

	* src/clipboard.{c|h} : Removed these files as we can use DBUS for
	startup checking.

	* Makefile.am : Installed /etc/dbus-1/system.d/gnome-power.conf
	* gnome-power.spec.in : Install /etc/dbus-1/system.d/gnome-power.conf
	and restart messagebus.

2005-07-01 Richard Hughes  <richard@hughsie.com>

	* src/gpm-notification.c : Removed the low icon code in prep for
	DavidZ and Andrei's patches. Code is simpler and less complicated.
	Also created create_virtual_of_type() to play with. May be usefull for
	multi-instance devices like batteries where we want to average the values.

2005-06-30 Richard Hughes  <richard@hughsie.com>

	* src/prefs.glade : split some options into a new tab.

	* src/gpm-notification.c : After discussing with Paul Ionescu, I've
	created the new funtion get_percentagecharge_batteries () that
	understands multibattery setups. Hopefully this should be useful.
	Also made this function work. += is the correct line, =+ is incorrect!

	* src/gpm-notification.c : Also added the new functions
	get_tooltip_state () and get_object_tooltip () which will hopefully
	help the work Andrei is doing with the new left click menu.

2005-06-28 Richard Hughes  <richard@hughsie.com>

	* Makefile.am : Fix typo that was tripping up intltool-*
	* src/Makefile.am : Add *.h files so that we pass make distcheck
	Patches from Andrew Duggan - thanks.

2005-06-27 Richard Hughes  <richard@hughsie.com>

	* PATCH: Converted names to be clearer on advice of Jaap Haitsma:
	common 	-> 	gpm-common
	gpm 	-> 	gpm-main
	gpn 	-> 	gpm-notification
	prefs 	-> 	gpm-prefs

	You can get the old versions using:
	http://www.cs.utexas.edu/users/almstrum/cs373/general/cvsguide.html#revision

	* Removed icons.{c|h} as we don't need stub functions.

2005-06-22 Richard Hughes  <richard@hughsie.com>

	* src/gpn.{h|c} : Add showIfFull to IconData struct so we can update
	on the fly.

	* src/prefs.c : Fix a bug where we automatically overwrite the value of
	displayIconFull and displayIconLow (to true) on g-p-p startup.

	* src/Makefile.am : Remove discharging.png as it's no longer part of
	the build.

	* src/gpn.c : new function get_object_of_powertype () - helps us with
	the displayIconFull problem. We should do the right thing with the
	main icon now. Reported by Paul Ionescu - Thanks.

2005-06-21 Richard Hughes  <richard@hughsie.com>

	* src/common.c : Add POWER_AC_ADAPTER to convert_powerdevice_to_gnomeicon

	* src/gpm.c (add_ac_adapter) : Make sure we set struct fields
	(like isRechargeable) to a known value. Fixes the problem of a desktop
	showing an ac_adapter icon with an overlay.
	Also create a new funtion (read_battery_data)to seporate creating the
	battery object and populating it. Solves the crash at boot with no
	batteries inserted. We can also populate known data if the battery isn't
	present like we did for ac_adapter.
	Reported by Paul Ionescu. - Thanks.

	* src/Makefile.am : Change ac_adapter.png to gnome-dev-acadapter.png

2005-06-19 Richard Hughes  <richard@hughsie.com>

	* po/de.po : New file - translation from Hendrik Brandt - thanks!

	* src/{gpm|prefs|gpn|common}.c : Mark some strings translatable

	* po/POTFILES.in : Add the above files for translation.

	* configure.in : add translation de.

	* src/gpn.c : Add initial LCD work, but don't enable it yet.

2005-06-19 Richard Hughes  <richard@hughsie.com>

	* src/{gpm|prefs|gpn}.c : replace /apps/gnome-power/ with GCONF_ROOT

	* src/common.c : make some simple functions return gchar rather than
	GString to speed them up. We don't need to be overly clever for no gain.
	Removed convert_powerdevice_to_haltype () as unused.

	* gnome-power.schemas.in : Add /apps/gnome-power/general/displayIconFull
	so we can ignore a fully charged device. Requested as feature.
	Also add:
	/schemas/apps/gnome-power/lockdown/{shutdown|suspend|hibernate|reboot}
	so we can use sabayon to lock down users to not do specific things.
	Distros can use this (e.g. Fedora) if they consider an action dangerous.
	We could use HAL in the future for this information, and we definatly
	need to work out what the hardware can do. No point displaying
	'Hibernate' if the machine is of type APM, for instance.

	* src/prefs.c : Added variable displayIconFull and added in checks for
	the new checkbox checkbutton_display_icon_full.

	* src/common.h : Added lockdown stuff to SetupData.

	* src/gpm.c, src/gpn.c : Read in lockdown information to SetupData, and
	apply when needed. Only refreshed on program invocation as the data
	isn't going to change frequently, if at all.

2005-06-18 Richard Hughes  <richard@hughsie.com>

	* configure.in : Bump to 0.0.6 as I released 0.0.5 today.

	* src/prefs.c : Remove the horror that was getPolicyFromWidgetname ()
	- replace with sexy g_object pointers.

	* gnome-power.schemas.in : Add /schemas/apps/gnome-power/scripts/
	{shutdown|suspend|hibernate|reboot} after talking to David Zeuthen about
	HAL events (which might not be used on all distros/archs..)
	We can always use:
		dbus-send --system --dest=org.freedesktop.Hal  \
		/org/freedesktop/Hal/devices/computer \
		org.freedesktop.Hal.Device.SystemPower.Suspend
	When HAL event support is added, this can be patched in by distros.

	* src/common.h : Added ACTION_REBOOT

	* src/gpn.c : Added callback_actions_activated so we can get some
	callbacks for the actions such as 'Shutdown'
	Also add menu_add_separator_item to split the menu up a bit,
	Add menu_add_action_item's for all the states. At the moment all the
	states are shown (irrespective to whether supported) but this is mainly
	for my testing.

	* src/Makefile.am, src/pixmaps/gnome-* : Add icons for actions.

	* src/common.c, src/prefs.c : Remove stdio.h includes as not required.

	* src/info.c : Removed as unused.

	* src/gpm.c : Added call to g_type_init () as some users were getting:
	GLib-GObject-CRITICAL **: gtype.c:2254: initialization assertion failed,
	use IA__g_type_init() prior to this function.
	- lets hops this fixes it.

	* src/gnome-power.spec.in : Fixed a typo where integer should be int.

2005-06-16 Richard Hughes  <richard@hughsie.com>

	* src/gpm.c, src/common.c : valgrind doesn't like 'Conditional jump or
	move depends on uninitialised value(s)' when ->present is assumed true.
	Add check in add_ac_adapter () just use the ->percentageCharge directly.

	* src/gpn.c (create_icon_pixbuf) : Use gtk_icon_info_free () as we
	leak memory otherwise. Thanks valgrind.

	* src/gpm.c : Add check for battery.charge_level.rate so we don't spew
	g_message's.

2005-06-15 Richard Hughes  <richard@hughsie.com>

	* src/*.[ch] : Fix from David Zeuthen to get rid of DOS newlines.
	The moral of the story is not to email yourself code from outlook.

	* src/*.[ch] : Add in GPLv2 text to make licencing clearer.

	* src/*.c : Make code better fit in 80 char line.

	* src/gpm.c : Remove UPS hack as patch is upstream.

	* src/logger.* : Removed these files as we are swiching to glib
	based logging.

	* src/gpn.c, src/gpm.c, src/common.c, src/icons.c, src/prefs.c : Switch
	to g_log functions from GPM_ type macros. Smaller code, yay.

	* src/common.c : New function, g_log_ignore (this will ignore messages
	for us when non-verbose)

2005-06-13 Richard Hughes  <richard@hughsie.com>

	* src/gpn.c, src/gpm.c, src/common.c, src/icons.c, src/prefs.c :
	Remove '!= NULL' from g_assert statements as not needed.

	* Added code from Andrei Yurkevich for dynamic icons,
	e.g. icons that do not have the colour bar hardcoded. Big thank you.

	* src/gpn.c : New functions: level_bar_get_color, create_icon_pixbuf

	* src/icons.c : new function: icon_modify_image_pixbuf

	* src/common.c : New function: convert_powerdevice_to_gnomeicon
	Removed : get_icon_filename, get_powerstate_discrete

	* src/Makefile.am : Remove all the icons, and move some to pixmaps,
	also removed reference to object_table.c

	* src/icons/* : Removed thanks to Andrei!

	* src/pixmaps/* : Removed existing, replaced with GNOME default
	device icons so we are portable without complicated
	configue.in checks.

	* src/gpn.* : Removed filename field as it's not needed.

	* src/object_table.* : removed array functions, g_ptr_array is quick
	and more efficient than an array ,and gives us smaller, more
	elegant code.

	* src/common.h : removed MAX_ICONS for good :-)

	* configure.in : Bumped version to 0.0.5 (as we have had a
	LOT of new code in the last few weeks)

2005-05-31 Richard Hughes  <richard@hughsie.com>

	* src/gpn.c, src/gpn.c : New files - takes the notification
	functions out of gpm.c and make it more manageable in size.
	For the moment, use shared variables (no need for IPC as we
	are still one program..)

	* src/gpm.c : Convert to use the new gpn_ functions provided
	by gpn.c - also allow us to use the new constants ICON_MAIN,
	ICON_LOW and ICON_ALL.

2005-05-29 Richard Hughes  <richard@hughsie.com>

	* src/object_table.c : make object_table_find return void, and
	convert slotData to NULL if we do not find object - this will
	trigger the g_assert'ion, rather than seg-faulting in
	gpm.c:property_modified

	* src/gpm.c : To prevent g_assert'ing when first adding an
	ac_adapter after we have booted, add ac_adapter
	unconditionaly on present state.

2005-05-25 Richard Hughes  <richard@hughsie.com>

	* src/gpm.c : Add new functon 'powerDeviceToHalType' to convert
	the powerDevice to the HAL name.
	Get action_policy_do working again, so that *Shutdown* events
	are triggered.
	Simplify property_modified so that we only check battery* and
	ac_adapter* keys. Also BUG when we can't find the device, as
	this signifies a bug in HAL.

	* src/icons/primary* : Rename the battery- icons to primary to
	avoid confusion with other types of batteries (this lets us use
	powerDeviceToHalType and simplify getIconFilenameFromSlot)

	* src/icons/pda*-c|-d* : Create the PDA charging/discharging
	icons so we could use them in the future if we wish.

	* src/Makefile.am : Add new PDA icons, and stop installing
	icons that we no longer use!

	* src/*.c : Changed some StudlyCaps function names to be more
	C-like, and consistant e.g.
	'getHoursStringFromMinutes' -> 'get_timestring_from_minutes'
	Also changed a lot of int's to gint's and chars to gchars for
	glib portibility (makes no difference at the moment).

2005-05-25 Richard Hughes  <richard@hughsie.com>

	* src/common.c, src/common.h, src/gpm.c : Add a patch from
	Andrei Yurkevich for PDA support, see http://synce.sf.net
	for the hal-addon. Thanks!

	* src/common.c : refactored a lump of code to the function
	HalTypeToPowerDevice to abstract gpm.c a little.

2005-05-17 Richard Hughes  <richard@hughsie.com>

	* src/gpm.c : AC_ADAPTER should not be a valid choice for
	icon_low - check for this. Also document a few functions while
	I'm here.

2005-05-16 Richard Hughes  <richard@hughsie.com>

	* src/gpm.c, src/common.c, src/icons.c, src/prefs.c : Add a
	load of g_assert's to try and find all the funny crashes and get
	rid of the unneeded error paths where abort would be the best
	solution.

	* src/gpm.c : Be a lot more careful with freeing memory.
	Remove kludgey string logic in getIconFilenameFromSlot and use
	itegers and %03i format.

	* src/preferences.glade : Add the low threshold slider.

	* src/prefs.c : Support the new slider, adding new callback tools
	and modifying policy lookup function (getPolicyFromWidgetname)

	* src/gpm.c : Make threshold slider dynamically add/remove low icon.

2005-05-14 Richard Hughes  <richard@hughsie.com>

	* src/gpm.c : Fix a segfault in the situation on having no low
	power devices attached. Should also sort the problem of running
	GPM on a PC without any powerdevices, but this I'll have to check.
	Fixed a memory-leak where we were not calling free_icon_structure
	after removing an icon.

2005-05-13 Richard Hughes  <richard@hughsie.com>

	* src/gpm.c : fixed the saving of remaining_time for batteries.
	Rename the function mememe as it's a point of embarrassment. :-)
	Make get_main_tooltip use powerDeviceToString for consistency.

	* gnome-power.schemas.in : Added lowThreshold to the schema

2005-05-12 Richard Hughes  <richard@hughsie.com>

	* src/common.*, src/gpm.c : FINALLY sorted out the mess that was icon
	and tooltip generation. Next on my list is the actions support which
	is a mess as well. Lots of changes.

	* src/icons.* : Removed the filename parameter from icon_create to
	avoid having to do clever things before creating the icon. This may
	display the GTK broken image for a split second while loading,
	although I can't see it on my laptop at all.

	* src/object_table.c : Removed use of removed properties. Less junk.

	* gnome-power.schemas.in : Added displayIconLow to the schema

	* src/prefs.c, src/preferences.glade : Added displayIconLow support.

2005-05-11  Richard Hughes  <richard@hughsie.com>

	* src/common.* : Got rid of the ACPI calculation as the patch is now
	in HAL CVS that makes time_remaining part of the interface. Nice.

	* src/gpm.c : Got rid of the special case ACPI calculations.

	* gnome-power.schemas.in : Updates policy to reflect what we are
	actually using, and choose some defaults.

	* src/common.c : policyoption_to_enum, enum_to_policyoption :
	new functions to convert the enum ACTION_HIBERNATE into a string
	'hibernate' and vice versa, for use in gconf to prettyfy names.
	Still needs some work.

2005-05-09  Richard Hughes  <richard@hughsie.com>

	* src/* : Changed printf => g_print and fprintf(stderr) => GPM_ERROR
	on advice of Jaap Haitsma, thanks.

	* ../hal : Fixed up so that UPS's always set battery.present = TRUE.
	Also making progress on moving battery.time_remaining into HAL, rather
	than the mess of special cases we have in GPM at the moment.

	* src/common.* : New function, powerDeviceToString to make easy work
	of converting a magic number into a human string.

2005-05-08  Richard Hughes  <richard@hughsie.com>

	* src/icons.c, src/icons.h : Re-implimented the notification area
	icon destroy/create/modify functions to be more logical and
	segfault friendly as these functions have caused lots of crashes.
	Also made the dropdown menu icon specific rather than global for the
	different types of icon.

	* src/gpm.c : Changed to use new icon functions and misc cleanups.

	* src/common.h : Removed redundant icon checking fields.

	* src/prefs.c : Make the icon checkbox get it's value from gconf.

2005-05-05  Richard Hughes  <richard@hughsie.com>

	* New frontend according the GNOME HIG (2 weeks work!)

	* Backend displaying multiline tooltip and single icon, unless
	battery device is low (todo!)

	* Begin switching char* functions into GString functions.

2005-04-19  Richard Hughes  <richard@hughsie.com>

	* src/preferences.glade : misc grammar/spelling fixes from
	Simon Howard, Thanks!

	* src/icons/ups-*-*.png, src/Makefile.am: New UPS discharge and
	charge icons to match battery.

	* src/common.c : Support new UPS charging and discharging icons.

2005-04-18  Richard Hughes  <richard@hughsie.com>

	* configure.in, NEWS : Bumped version to 0.0.4

	* src/prefs.c : Removed the users ability to show/hide the
	ac-adapter icon as this is going away in 0.0.4

	* src/gpm.c, src/alert.c : Removed the alert checkbox on the
	advice of Paul Ionescu.

	* src/common.c : Removed getFilenameNumberFormat to simplify logic.

	* src/common.h : Added isDischarging property because
	isDischarging != isCharging :-)

	* src/icons/battery-*-*.png, src/Makefile.am: New discharge and
	charge icons, thanks to Paul Ionescu for the mockup and
	David Zeuthen for the idea.

2005-04-07  Richard Hughes  <richard@hughsie.com>

	* src/gpm.c : Fix some seg-faulting goodness when we try to modify
	a tooltip of an icon that was never created.
	Also added lots of function comments.

	* src/prefs.c : Make checkboxes use a SList like the combos.
	This neatens things up, and means gconf policy name doesn't have to
	match the libglade widgetname.
	Made the 'help' button lauch a web-browser displaying g-p-m homepage.
	Also added lots of function comments.

2005-04-06  Richard Hughes  <richard@hughsie.com>

	* src/Makefile.am : Tidy up, don't include .h files here.

	* src/prefs.c : Got rid of the nasty, nasty arrays.

	* src/prefs.h : New file, just for preferences stuff

2005-04-05  Richard Hughes  <richard@hughsie.com>

	* src/gpm.c : Patch from Andrei Yurkevich to fix seg-fault on DBUS
	initialisation, thanks!

	* src/prefs.c : Massive overhaul so that gconf ky name is decoupled
	from libglade name - this lets us choose pretty names in gconf.
	Also made so that lcd_brightness is measured in percent in gconf
	so power-users could make changes without looking up the enum.
	Added error checking and suitable framework.

	* gnome-power.schemas.in, src/gpm.c, src/prefs.c : Make gconf names
	pretty, not ones derived from libglade.

2005-04-04  Richard Hughes  <richard@hughsie.com>

	* src/alert.c, src/alert.glade : New files for the about dialogue for
	battery low notification.

	* src/Makefile.am, Makefile.am : added information for gnome-power-alert,
	Uncommented the gconf install line, install .desktop file.

	* src/pixmaps/* : Added new icons with battery icons superimposed.

	* src/common.*, src/gpm.* : Removed .enabled from the struct, now using
	POWER_NONE to signify that there is no device. Also done lots more checking
	for NULL for the slotBase structures being passed around.

	* gnome-power-preferences.desktop.in : New file, create launcher to modify
	GNOME Power Preferences from the GNOME system menu.

	* gnome-power.spec.in : First version of the RPM spec, based mainly on
	GNOME Volume Manager's spec file. Produces RPM's ok, I think.

2005-04-03  Richard Hughes  <richard@hughsie.com>

	* autogen.sh : Made to automatically run ./configure on the advice of
	Jaap Haitsma.

	* src/gpm.c src/common.c : Add tweaks, and start to make interface suitable
	for DBUS.

	* src/common.h, src/icons.h, src/object_table.h : Split prototypes for
	header files to clean up include mess.

2005-04-01  Richard Hughes  <richard@hughsie.com>

	* src/logger.c, src/logger.h : New files for logging
	Shamelessly copied from hald, by David Zeuthen

	* src/gpm.c, src/common.c : Updated to better support Logitech mice and
	changed all the printing to stdout to use the new logging functions.

	* src/gpm.c, src/prefs.c, src/common.h, src/preferences.glade :
	Implemented the /icons/icon* gconf properties so that users can hide
	or show icons.

	* src/common.h : Removed type for battery, now we'll use a string for speed.

	* Makefile.am : Removed local-build powermanager.c - oops.

2005-03-30  Richard Hughes  <richard@hughsie.com>

	* doc/ : removed the temporary directory and split into the new
	CVS module www.

	* src2/ : removed the developmental directory and split into the new
	CVS module power-manager. The code is in flux, and probably will
	not compile or run for a while. I'm concentrating on PowerManager before
	I work anymore on the GNOME GUI.

	* www/* : Updated the directory with new php based layout from Jaap.

2005-03-25  Richard Hughes  <richard@hughsie.com>

	* prefs.c, preferences.glade : rebuild menus...
	New file structure, with tabbed layout and more options. There are
	no schemes now, as they make no logical sense in the current format.

	* g-p-m.schemas.in, added new properties for policy, and removed schemes.

	* docs/index.html, change references to module head to gnome-power
	For GNOME Power Manager to build in jhbuild, the CVS module name must
	be similar to the project. Renamed head to gnome-power.

	* gnome-power.modules, new file:
	Added template for jhbuild users, thanks Jaap Haitsma!

	* TODO, Added list of things to do!
	* NEWS, Added list of releases, well, both of them.
	* README, Added link to website.
	* HACKING, Added plea for help!

2005-03-24  Richard Hughes  <richard@hughsie.com>

	* src/common.c, new function : updateLogic()
	This function runs through the old state, calculates the new
	state, then performs and notification actions. It obsoletes
	most of do_action() and all of the hasBatteriesCheck type code.

	* src/gpm.c: Misc, Hooks added to most of the update code to support
	updateLogic (where appropriate).

	* src/common.h: make enums match CodingStyle, also added lots more
	states to the StateData structure to support updateLogic().

	* src/common.c: Made the percentage/mWh calculations more common, and more
	resistant to errors.

	* src/prefs.c: Made the PowerState ComboBox change the others according to
	policy. Also values now populated dynamically, not in the glade file.
	Static policy in use, and documentation has been updated.

2005-03-23  Richard Hughes  <richard@hughsie.com>

	* src/prefs.c, new file:  - also imported all the pixmaps into
	cvs and worked trying to connect up all the signals.

	* src/gpm.c: Added new option to drop-down on all the icons for preferences
	dialogue, and set the file to execute.

	* src/common.c: Also added preliminary gconf backend, 'Preferences' will
	dynamically adjust it's output depending on the gconf settings.

	* Removed some compiled files that snuck into CVS.

2005-03-22  Richard Hughes  <richard@hughsie.com>

	* src/properties.glade, new file:
	Added preliminary glade properties file, with thanks to David Zeuthen
	for the original.

	* mkinstalldirs, new file: Add a needed file for 'make install'. Oops.

2005-03-21  Richard Hughes  <richard@hughsie.com>

	* Initial release of 0.0.2
